(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-62085595"],{1648:function(e,t,o){"use strict";o.r(t);var n=o("7a23");const a={style:{display:"flex","justify-content":"flex-start"}},r={class:"his-card"};function c(e,t,o,c,i,l){const s=Object(n["resolveComponent"])("date-range-picker"),d=Object(n["resolveComponent"])("ion-button"),u=Object(n["resolveComponent"])("ion-col"),p=Object(n["resolveComponent"])("ion-label"),b=Object(n["resolveComponent"])("ion-badge"),j=Object(n["resolveComponent"])("ion-item"),O=Object(n["resolveComponent"])("ion-list"),m=Object(n["resolveComponent"])("line-chart"),f=Object(n["resolveComponent"])("ion-row"),h=Object(n["resolveComponent"])("ion-grid");return Object(n["openBlock"])(),Object(n["createBlock"])(h,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(f,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"3",offset:"9",class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",a,[Object(n["createVNode"])(s,{modelValue:e.range,"onUpdate:modelValue":t[0]||(t[0]=t=>e.range=t),class:"ion-margin-end",style:{padding:"5px"}},null,8,["modelValue"]),Object(n["createVNode"])(d,{color:"primary",onClick:e.fetchData,style:{height:"44px"}},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Submit")]),_:1},8,["onClick"])])]),_:1}),Object(n["createVNode"])(u,{size:"2",class:"ion-padding-top"},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",r,[Object(n["createVNode"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(j,{button:"",onClick:t[1]||(t[1]=t=>e.drilldown(e.totalAttendance,"Total Attendance"))},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Total Attendance ")]),_:1}),Object(n["createVNode"])(b,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.totalAttendance.length),1)]),_:1})]),_:1}),Object(n["createVNode"])(j,{button:"",onClick:t[2]||(t[2]=t=>e.drilldown(e.totalPatientVisits,"Total patient visits"))},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Patient Visit ")]),_:1}),Object(n["createVNode"])(b,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.totalPatientVisits.length),1)]),_:1})]),_:1}),Object(n["createVNode"])(j,{button:"",onClick:t[3]||(t[3]=t=>e.drilldown(e.totalGuardianVisits,"Total guardian visits"))},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Guardian Visit ")]),_:1}),Object(n["createVNode"])(b,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.totalGuardianVisits.length),1)]),_:1})]),_:1})]),_:1})])]),_:1}),Object(n["createVNode"])(u,{size:"10"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{series:e.series,options:e.options,onPointSelection:e.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})}o("14d9");var i=o("c5be"),l=o("d867"),s=o("2ef0"),d=o("7717"),u=o("ad8d"),p=o("b211"),b=o("23e6"),j=o("da44"),O=o("564f"),m=o("6605"),f=o("9283"),h=o("0011"),w=o("3a8c"),C=Object(n["defineComponent"])({components:{LineChart:i["a"],IonGrid:l["IonGrid"],IonRow:l["IonRow"],IonCol:l["IonCol"],DateRangePicker:d["a"]},setup(){const e=Object(m["i"])(),t=Object(n["ref"])({}),o=Object(n["ref"])([]),a=Object(n["computed"])(()=>{var e;return(null===(e=o.value[0])||void 0===e?void 0:e.raw.flat())||[]}),r=Object(n["computed"])(()=>{var e;return(null===(e=o.value[1])||void 0===e?void 0:e.raw.flat())||[]}),c=Object(n["computed"])(()=>o.value.map(({raw:e})=>e).flat(3)),i={title:{text:"Patient Vists Statistics",align:"left"},yaxis:{title:{text:"Number of clients"},plotAreaHeight:800}},l=e=>{const t={},o={},n={},a=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(e).forEach(([e,r])=>{t[e]=[],o[e]=[],n[e]=[],Object.entries(r).forEach(([a,{patient_present:r,guardian_present:c}])=>{c&&r?n[e].push({patientId:a,date:e}):r?t[e].push({patientId:a,date:e}):c&&o[e].push({patientId:a,date:e})});const c=new Date(e).getTime();a[0].data.push([c,t[e].length]),a[0].raw.push(t[e]),a[1].data.push([c,o[e].length]),a[1].raw.push(o[e]),a[2].data.push([c,n[e].length]),a[2].raw.push(n[e])}),a},d=async()=>{p["a"].show();const e=new u["b"];e.setStartDate(t.value.start),e.setEndDate(t.value.end);const n=await e.getPatientVisitTypes();o.value=l(n),p["a"].hide()},C=async e=>{const t=await b["a"].findByID(e),o=new b["a"](t);return{arv_number:o.getArvNumber(),birthdate:o.getBirthdate(),gender:o.getGender(),address:""+o.getCurrentVillage(),...t}},v=async(t,o="Drill down clients")=>{if(Object(s["isEmpty"])(t))return;const a=[{path:"arv_number",label:"ARV Number",initialSort:!0,initialSortOrder:"asc",preSort:w["a"]},{path:"birthdate",label:"Date of Birth",formatter:f["c"].toStandardHisDisplayFormat},{path:"gender",label:"Gender",formatter:h["g"]},{path:"date",label:"Visit Date",formatter:f["c"].toStandardHisDisplayFormat},{path:"address",label:"Address"}],r=Object(n["ref"])([]),c=async()=>{for(const{patientId:e,date:o}of t){const t=await C(e);r.value.push({...t,date:o})}};c();const i=[{label:"Select",action:t=>e.push("/emc/patient/"+t["patient_id"])}];await j["a"].show(O["a"],{title:o,columns:a,rows:r.value,rowActionButtons:i})},g=async(e,t)=>{if(!Object(s["isEmpty"])(o.value))try{await v(o.value[t].raw[e],o.value[t].name+" visits")}catch(n){console.error(n)}};return{range:t,series:o,options:i,totalAttendance:c,totalPatientVisits:a,totalGuardianVisits:r,fetchData:d,pointSelection:g,drilldown:v}}}),v=o("d959"),g=o.n(v);const V=g()(C,[["render",c]]);t["default"]=V},"3a8c":function(e,t,o){"use strict";function n(e){return parseInt(e.split("-")[2])||0}o.d(t,"a",(function(){return n}))},"40e3":function(e,t,o){"use strict";o.d(t,"a",(function(){return d}));var n=o("4971"),a=o("2ef0"),r=o("1c74"),c=o("5a0c"),i=o.n(c);function l(e){try{return e.replace(/<(?:.|\n)*?>/gm," ").replace(/\n/g," ").replace(/\t/g," ").replace(/\s{2,}/g," ").replace(/=/g," ").replace(/,/g," ").trim()}catch(t){return e}}function s({columns:e,rows:t,quarter:o,period:c,filters:s}){let d=e.filter(e=>!1!==e.exportable).map(e=>e.label).join(",");return d+="\n",d+=Object(n["sortRows"])(t,(null===s||void 0===s?void 0:s.sort)||[]).map(t=>e.filter(e=>!1!==e.exportable).map(e=>{let o=Object(a["get"])(t,e.path);return"function"===typeof e.formatter&&o&&(o=e.formatter(o,t)),l(e.drillable&&Array.isArray(o)?o.length:o)}).join(",")).join("\n"),d+="\nDate Created:  "+i()().format("DD/MMM/YYYY HH:MM:ss"),o&&(d+="\nQuarter: "+o),c&&(d+="\nQuarter: "+c),d+="\ne-Mastercard Version : "+r["e"].getAppVersion(),d+="\nAPI Version "+r["e"].getApiVersion(),d+="\nSite UUID: "+r["e"].getSiteUUID(),d}function d(e){const t=new Blob([s(e)],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=window.URL.createObjectURL(t),o.setAttribute("download",e.filename+".csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}},"564f":function(e,t,o){"use strict";var n=o("7a23");function a(e,t,o,a,r,c){const i=Object(n["resolveComponent"])("IonIcon"),l=Object(n["resolveComponent"])("IonButton"),s=Object(n["resolveComponent"])("IonButtons"),d=Object(n["resolveComponent"])("IonTitle"),u=Object(n["resolveComponent"])("IonToolbar"),p=Object(n["resolveComponent"])("IonHeader"),b=Object(n["resolveComponent"])("data-table"),j=Object(n["resolveComponent"])("IonContent"),O=Object(n["resolveComponent"])("IonPage");return Object(n["openBlock"])(),Object(n["createBlock"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,{slot:"end",onClick:t[0]||(t[0]=t=>e.modal.hide()),"icon-only":""},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(i,{icon:e.close},null,8,["icon"])]),_:1})]),_:1}),Object(n["createVNode"])(d,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.title),1)]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(j,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{rows:e.rows,"async-rows":e.asyncRows,columns:e.columns,"row-actions-buttons":e.rowActionButtons,"actions-buttons":e.actionBtns,color:"custom"},null,8,["rows","async-rows","columns","row-actions-buttons","actions-buttons"])]),_:1})]),_:1})}o("14d9");var r=o("d867"),c=o("4971"),i=o("ff79"),l=o("da44"),s=o("5a0c"),d=o.n(s),u=o("40e3"),p=Object(n["defineComponent"])({name:"DrilldownTable",components:{DataTable:c["DataTable"],IonButton:r["IonButton"],IonPage:r["IonPage"],IonHeader:r["IonHeader"],IonContent:r["IonContent"],IonToolbar:r["IonToolbar"],IonButtons:r["IonButtons"],IonTitle:r["IonTitle"],IonIcon:r["IonIcon"]},props:{title:{type:String,default:"Report"},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},columns:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},actionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},period:{type:String,default:""}},setup(e){const t=Object(n["computed"])(()=>{const t=[...e.actionButtons];return e.canExportCsv&&t.push({label:"CSV",color:"primary",action:async(t,o,n,a)=>Object(u["a"])({rows:o,filters:n,columns:a,period:e.period.includes("Custom")?e.period.substring(6):e.period,filename:`${e.title}-${d()().format("DD-MMM-YYYY")}`})}),t});return{close:i["close"],modal:l["a"],actionBtns:t}}}),b=o("d959"),j=o.n(b);const O=j()(p,[["render",a]]);t["a"]=O},7717:function(e,t,o){"use strict";var n=o("7a23");const a={class:"date-picker-wrapper"},r=["value"],c=["value"];function i(e,t,o,i,l,s){const d=Object(n["resolveComponent"])("ion-icon"),u=Object(n["resolveComponent"])("date-picker");return Object(n["openBlock"])(),Object(n["createBlock"])(u,{modelValue:e.range,"onUpdate:modelValue":t[0]||(t[0]=t=>e.range=t),"is-range":"",masks:e.masks,popover:e.popover},{default:Object(n["withCtx"])(({inputValue:t,inputEvents:o})=>[Object(n["createElementVNode"])("div",a,[Object(n["createElementVNode"])("input",Object(n["mergeProps"])({value:t.start,class:"box date-picker-input"},Object(n["toHandlers"])(o.start,!0),{placeholder:"DD/MMM/YYYY"}),null,16,r),Object(n["createVNode"])(d,{icon:e.arrowForward,class:"date-picker-icon"},null,8,["icon"]),Object(n["createElementVNode"])("input",Object(n["mergeProps"])({value:t.end,class:"box date-picker-input"},Object(n["toHandlers"])(o.start,!0),{placeholder:"DD/MMM/YYYY"}),null,16,c)])]),_:1},8,["modelValue","masks","popover"])}var l=o("d867"),s=o("ff79"),d=o("0261"),u=o("9283"),p=Object(n["defineComponent"])({name:"DateRangePicker",components:{IonIcon:l["IonIcon"],DatePicker:d["b"]},props:{modelValue:{type:Object,default:()=>({start:"",end:""})}},emits:["update:modelValue"],setup(e,{emit:t}){const o=Object(n["ref"])({input:"DD/MMM/YYYY"}),a=Object(n["ref"])({visibility:"click"}),r=Object(n["computed"])({get:()=>e.modelValue,set:({start:e,end:o})=>t("update:modelValue",{start:u["c"].toStandardHisFormat(e),end:u["c"].toStandardHisFormat(o)})});return{arrowForward:s["arrowForward"],range:r,masks:o,popover:a}}}),b=(o("8d9a"),o("d959")),j=o.n(b);const O=j()(p,[["render",i],["__scopeId","data-v-60c07fe7"]]);t["a"]=O},"8d9a":function(e,t,o){"use strict";o("916c")},"916c":function(e,t,o){},c5be:function(e,t,o){"use strict";var n=o("7a23");function a(e,t,o,a,r,c){const i=Object(n["resolveComponent"])("apex-chart"),l=Object(n["resolveComponent"])("ion-card-content"),s=Object(n["resolveComponent"])("ion-card");return Object(n["openBlock"])(),Object(n["createBlock"])(s,{class:"his-card",style:{height:"100%"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(i,{width:"100%",height:e.height,type:"line",options:e.chartOptions,series:e.series,onMarkerClick:e.onPointSelection},null,8,["height","options","series","onMarkerClick"])]),_:1})]),_:1})}var r=o("d867"),c=o("ae27"),i=o.n(c),l=Object(n["defineComponent"])({name:"LineChart",props:{series:{type:Array,default:()=>[]},options:{type:Object,default:()=>({})},height:{type:[String,Number],default:560},placeholder:{type:String,default:"Loading data..."}},components:{IonCard:r["IonCard"],IonCardContent:r["IonCardContent"],ApexChart:i.a},emits:["pointSelection"],setup(e,{emit:t}){const o=Object(n["computed"])(()=>{const t={chart:{id:"line-chart",type:"line"},xaxis:{type:"datetime",tickAmount:2,labels:{show:!0,rotate:-75}},markers:{size:8,hover:{sizeOffset:3}},tooltip:{x:{format:"dd/MMM/yyyy"}},title:{text:"Line Chart",align:"left"},noData:{text:e.placeholder,align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{color:"#a7a7a7",fontSize:"25px",fontFamily:"Helvetica"}}};for(const o in e.options)t[o]={...t[o],...e.options[o]};return t}),a=(e,o,{dataPointIndex:n,seriesIndex:a})=>{console.log(e,o),t("pointSelection",n,a<=0?0:a)};return{chartOptions:o,onPointSelection:a}}}),s=o("d959"),d=o.n(s);const u=d()(l,[["render",a]]);t["a"]=u},da44:function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));var n=o("d867");const a={async show(e,t,o="custom-modal",a=!0){const r=await n["modalController"].create({component:e,cssClass:o,backdropDismiss:a,componentProps:t});r.present();const{data:c}=await r.onWillDismiss();if(c)return c},async hide(e){await n["modalController"].dismiss(e)}}}}]);
//# sourceMappingURL=chunk-62085595.b6bf72d0.js.map