(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-82881052"],{1509:function(t,e,n){"use strict";n.r(e);var r=n("7a23");const o={id:"report-content"},a=Object(r["createElementVNode"])("div",{id:"print"},null,-1);function i(t,e,n,i,s,l){const d=Object(r["resolveComponent"])("ion-loading"),c=Object(r["resolveComponent"])("his-standard-form"),h=Object(r["resolveComponent"])("cohort-v"),p=Object(r["resolveComponent"])("cohort-h"),m=Object(r["resolveComponent"])("cohort-ft"),u=Object(r["resolveComponent"])("ion-content"),b=Object(r["resolveComponent"])("his-footer"),g=Object(r["resolveComponent"])("ion-page");return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],null,[Object(r["createVNode"])(d,{"is-open":t.isLoading,message:"Please wait..."},null,8,["is-open"]),t.reportReady?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createBlock"])(c,{key:0,onOnFinish:t.onPeriod,skipSummary:!0,fields:t.fields},null,8,["onOnFinish","fields"])),t.reportReady?(Object(r["openBlock"])(),Object(r["createBlock"])(g,{key:1},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(u,null,{default:Object(r["withCtx"])(()=>[(Object(r["openBlock"])(),Object(r["createBlock"])(h,{key:t.componentKey,indicators:t.indicators},null,8,["indicators"])),Object(r["createElementVNode"])("div",o,[(Object(r["openBlock"])(),Object(r["createBlock"])(p,{key:t.componentKey,reportparams:t.period,clinicName:t.clinicName},null,8,["reportparams","clinicName"])),(Object(r["openBlock"])(),Object(r["createBlock"])(m,{key:t.componentKey,onOnClickIndicator:t.onDrillDown,indicators:t.indicators},null,8,["onOnClickIndicator","indicators"]))])]),_:1}),Object(r["createVNode"])(b,{btns:t.btns},null,8,["btns"])]),_:1})):Object(r["createCommentVNode"])("",!0),a],64)}n("13d5"),n("14d9");var s=n("0f25"),l=n("d867"),d=n("7920"),c=n("44e3"),h=n("b31c"),p=n("bdc2"),m=n("364b"),u=n("0795"),b=n("9283"),g=n("bef6"),f=n("9ceb"),w=n("5a0c"),D=n.n(w),y=n("1c74"),x=n("ba82"),C=n("2ef0"),v=n("b5e4"),O=Object(r["defineComponent"])({mixins:[c["a"]],components:{IonLoading:l["IonLoading"],CohortH:p["a"],CohortV:m["a"],CohortFt:u["a"],HisStandardForm:d["a"],HisFooter:s["a"],IonPage:l["IonPage"],IonContent:l["IonContent"]},data:()=>({formData:{},componentKey:0,computedFormData:{},indicators:{},cohort:{},btns:[],isLoading:!1,fields:[],reportID:-1,clinicName:h["a"].getLocationName(),reportReady:!1,disaggregatedReportParams:"",startDate:"",endDate:"",quarter:"",onGenerateTempCallback:null}),created(){this.btns=this.getBtns(),this.fields=this.getDateDurationFields(!0,!0,21,null)},methods:{async onPeriod(t,e,n=!1){this.componentKey+=1,this.formData=t,this.computedFormData=e,this.reportReady=!0,this.isLoading=!0,this.report=new h["a"],this.report.setRegenerate(n);let r={};"custom_period"===t.quarter.value?(this.quarter="Custom",this.startDate=e.start_date,this.endDate=e.end_date):(this.quarter=t.quarter.label,this.startDate=b["c"].toStandardHisFormat(t.quarter.other.start),this.endDate=b["c"].toStandardHisFormat(t.quarter.other.end)),this.report.setQuarter(this.quarter),this.report.setStartDate(this.startDate),this.report.setEndDate(this.endDate),"Custom"===this.quarter?(this.period="Custom "+this.report.getDateIntervalPeriod(),r=this.report.datePeriodRequestParams()):(this.period=this.quarter,r=this.report.qaurterRequestParams()),this.disaggregatedReportParams=g["a"].parameterizeObjToString({start_date:this.startDate,end_date:this.endDate,quarter:this.quarter});const o=await this.report.requestCohort(r);if(o.ok){const t=setInterval(async()=>{r.regenerate=!1;const e=await this.report.requestCohort(r);if(200===e.status){const n=await e.json();if(this.reportID=n.id,this.cohort=n.values,this.indicators=this.toIndicators(n.values),this.isLoading=!1,this.report.cacheCohort(n.values),clearInterval(t),"function"===typeof this.onGenerateTempCallback){const t=this.onGenerateTempCallback;t(),this.onGenerateTempCallback=null}}},3e3)}},toIndicators(t){return t.reduce((t,e)=>(t[e.name]=parseInt(e.contents),t),{})},regenerate(){return this.onPeriod(this.formData,this.computedFormData,!0)},async onDrillDown(t){const e=Object(C["find"])(this.cohort,{name:t});if(!e)return;const n=e.id,r=[[f["a"].thTxt("ARV number"),f["a"].thTxt("Name",{exportable:!1}),f["a"].thTxt("Gender"),f["a"].thTxt("Birth Date"),f["a"].thTxt("Outcome"),f["a"].thTxt("Action")]],o=async()=>{const r=this.sortByArvNumber(await this.report.getCohortDrillDown(n)||[],"arv_number"),o=r.map(t=>[this.tdARV(t["arv_number"]),f["a"].td(`${t["given_name"]} ${t["family_name"]}`),f["a"].td(this.formatGender(t["gender"])),f["a"].td(`${b["c"].toStandardHisDisplayFormat(t["birthdate"])} (${b["c"].getAgeInYears(t["birthdate"])})`),f["a"].td(t["outcome"]||"N/A"),f["a"].tdBtn("Select",async()=>{await l["modalController"].dismiss({}),this.$router.push({path:"/patient/dashboard/"+t.person_id})})]);return parseInt(e.contents)>0&&o.length<=0&&await Object(v["a"])("Unable to fetch drilldown patients, Do you want to rebuild cohort to resolve this?")&&setTimeout(()=>{l["modalController"].getTop().then(t=>t?l["modalController"].dismiss():null),this.onGenerateTempCallback=()=>this.onDrillDown(t),this.regenerate()},100),o};await this.drilldownAsyncRows(e.description,r,o)},exportToCsv(){const t=["Indicator","Value"],e=Object.keys(this.indicators).map(t=>[t,this.indicators[t]]),n=`${y["e"].getLocationName()} cohort report ${this.period}`;Object(x["a"])([t],[...e,["Date Created: "+D()().format("DD/MMM/YYYY HH:MM:ss")],["Quarter: "+(this.quarter.match(/custom/i)?`${this.startDate} - ${this.endDate}`:this.quarter)],["HIS-Core Version: "+y["e"].getCoreVersion()],["API Version: "+y["e"].getApiVersion()],["Site: "+y["e"].getLocationName()],["Site UUID: "+y["e"].getSiteUUID()]],n)},printSpec(){const t=document.getElementById("report-content");t&&Object(x["b"])(`\n          <html>\n            <head>\n              <title>Print Cohort</title>\n              <style> \n                .numbers {\n                  width: 2.5%;\n                  text-align: center;\n                  border-width: 0px 1px 0px 0px;\n                  border-style: dotted;\n                }\n                .row-title {\n                  width: 17.75%;\n                  text-align: left;\n                  padding-left: 5px;\n                  border-style: dotted;\n                }\n                .signatures {\n                  width: 39.875%;\n                  text-align: left;\n                  padding-left: 5px;\n                  border-style: dotted;\n                }\n                .row-name {\n                  width: 39.875%;\n                  text-align: left;\n                  padding-left: 5px;\n                  border-style: dotted;\n                  border-left-style: solid;\n                }\n                .no-borders {\n                  border-width: 0px;\n                }\n                #version-row td {\n                  height: 30px;\n                }\n                #version {\n                  text-align: right;\n                  padding-right: 5px;\n                  font-size: 10px;\n                }\n                #consistency_check div {\n                  color: red;\n                  padding-bottom: 10px;\n                }\n                a {\n                  color: black;\n                  text-decoration: none;\n                }\n                table {\n                  width: 100%;\n                  border-collapse: collapse;\n                  margin-top: 10px;\n                }\n                tr {\n                  height: 45px;\n                }\n                .vertical-separator {\n                  border-width: 0px;\n                }\n                td {\n                  border-style: solid;\n                  border-width: 1px;\n                  padding: 1em;\n                  text-align: center;\n                }\n                .section-description td {\n                  border-width: 0px;\n                }\n                .horisonatl-separator td {\n                  border-width: 0px;\n                }\n                .numbers {\n                  width: 2.5%;\n                  text-align: center;\n                  border-width: 0px 1px 0px 0px;\n                  border-style: dotted;\n                }\n                .sum-arrows {\n                  width: 75px;\n                  height: 55px;\n                }\n                .postfixes {\n                  font-size: x-small;\n                  font-weight: bold;\n                  position: relative;\n                  top: -15px;\n                  left: -40px;\n                }\n                .granules {\n                  width: 100%;\n                  height: 32px;\n                  margin: 10px;\n                  display: table;\n                }\n                .granules-row {\n                  display: table-row;\n                }\n                .granules-cell {\n                  display: table-cell;\n                  text-align: center;\n                }\n                .granules span{\n                  font-size: 10px;\n                }\n                .granules-right-td {\n                  border-right-style: dotted !important;\n                  border-right-width: 1px;\n                }\n\n                @media print\n                {\n                  table { page-break-after:auto }\n                  tr    { page-break-inside:avoid; page-break-after:auto }\n                  td    { page-break-inside:avoid; page-break-after:auto }\n                  thead { display:table-header-group }\n                  tfoot { display:table-footer-group }\n                }\n              </style>\n            </head>\n            <body>\n              ${t.innerHTML}\n            </body>\n          </html>\n        `)},getBtns(){return[{name:"CSV",size:"large",slot:"start",color:"primary",visible:!0,onClick:()=>this.exportToCsv()},{name:"PDF",size:"large",slot:"start",color:"primary",visible:!0,onClick:()=>this.printSpec()},{name:"Regenerate",size:"large",slot:"end",color:"danger",visible:!0,onClick:async()=>this.regenerate()},{name:"Disaggregeted",size:"large",slot:"end",color:"primary",visible:!0,onClick:()=>this.$router.push("/art/moh_disaggregated_report?"+this.disaggregatedReportParams)},{name:"Finish",size:"large",slot:"end",color:"success",visible:!0,onClick:()=>this.$router.push({path:"/"})}]}}}),k=n("d959"),j=n.n(k);const F=j()(O,[["render",i]]);e["default"]=F},"44e3":function(t,e,n){"use strict";n("14d9");var r=n("1c74"),o=n("7a23"),a=n("b446"),i=n("23e6"),s=n("9283"),l=n("d867"),d=n("d6aa"),c=n("5969"),h=n("d95e"),p=n("2706"),m=n("9ceb"),u=n("2ef0"),b=Object(o["defineComponent"])({data:()=>({fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",drillDownCache:{}}),methods:{formatGender(t){const e=(""+t).toUpperCase();return"M"===e||"MALE"===e?"Male":"F"===e||"FEMALE"===e?"Female":/fbf|fnp|fp/i.test(t)?e:t},toDate(t){return s["c"].toStandardHisDisplayFormat(t)},sortByArvNumber(t,e="arv_number"){try{return t.sort((t,n)=>this.getArvInt(t[e])>this.getArvInt(n[e])?1:-1)}catch(n){return console.error(n),t}},getArvInt(t){if("string"===typeof t){const[e,n,r]=t.split("-"),o=parseInt(r);return"number"===typeof o?o:0}return 0},tdARV(t,e={}){return m["a"].td(t,{sortValue:this.getArvInt(t),...e})},confirmPatient(t){return this.$router.push("/patients/confirm?person_id="+t)},async drilldownAsyncRows(t,e,n,r=!0){const o=await l["modalController"].create({component:d["a"],cssClass:"large-modal",componentProps:{title:t,columns:e,asyncRows:n,canExport:r,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>l["modalController"].dismiss()}});o.present()},async drilldownData(t,e,n,r){const o=await l["modalController"].create({component:d["a"],cssClass:"large-modal",componentProps:{title:t,columns:e,rows:n,rowParser:r,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>l["modalController"].dismiss()}});o.present()},getDefaultDrillDownTable(){const t=[[m["a"].thTxt("ARV number"),m["a"].thTxt("Gender"),m["a"].thTxt("Birth Date"),m["a"].thTxt("Actions")]],e=async t=>{let e=0;const n=t.map(async t=>{let n=null,r=null;if(Object(u["isArray"])(t)){const[e,n]=t;if(r=e,n in this.drillDownCache){const[t,...e]=this.drillDownCache[n];return[r,...e]}}else if(n=t,n in this.drillDownCache)return this.drillDownCache[n];const o=await i["a"].findByID(n),a=new i["a"](o),s=[];return r&&(e=1,s.push(r)),s.push(this.tdARV(a.getArvNumber())),s.push(m["a"].td(this.formatGender(a.getGender()))),s.push(m["a"].tdDate(a.getBirthdate().toString())),s.push(m["a"].tdBtn("Show",async()=>{await l["modalController"].dismiss({}),this.$router.push({path:"/patient/dashboard/"+n})})),this.drillDownCache[n]=s,s}),r=await Promise.all(n);return r.sort((t,n)=>t[e].sortValue>n[e].sortValue?1:-1)};return{rowParser:e,columns:t}},runTableDrill(t,e="Drilldown patients"){const{columns:n,rowParser:r}=this.getDefaultDrillDownTable();this.drilldownData(e,n,t,r)},drill(t,e="Drill table"){return t&&t.length>0?m["a"].tdLink(t.length,()=>this.runTableDrill(t,e)):m["a"].td(0)},getQuaterOptions(){const t=c["a"].getReportQuarters();return t.map(t=>({label:t.name,value:t.start,other:t}))},getDateDurationFields(t=!1,e=!1,n=5,o=r["e"].getSessionDate()){const i="2000-01-01";return[{id:"quarter",helpText:"Select Quarter",type:h["b"].TT_SELECT,condition:()=>t,validation:t=>p["a"].required(t),options:()=>{const t=c["a"].getReportQuarters(n);let r=t.map(t=>({label:t.name,value:t.start,other:t}));return e&&(r=[{label:"Set custom period",value:"custom_period",other:{}},...r]),r}},...Object(a["b"])({id:"start_date",helpText:"Start",required:!0,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t,minDate:()=>i,maxDate:()=>o,estimation:{allowUnknown:!1},computeValue:t=>t}),...Object(a["b"])({id:"end_date",helpText:"End",required:!0,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t,unload:(t,e,n,r)=>{"next"===e&&(this.endDate=r.end_date)},minDate:(t,e)=>e.start_date,maxDate:()=>o,estimation:{allowUnknown:!1},computeValue:t=>t})]}}});const g=b;e["a"]=g},7920:function(t,e,n){"use strict";var r=n("7a23");function o(t,e,n,o,a,i){return Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["resolveDynamicComponent"])(t.formType),{fields:t.fields,skipSummary:t.skipSummary,activeField:t.activeField,cancelDestinationPath:t.cancelDestinationPath,onOnFinish:t.onFinish,onFinish:t.onFinishAction,onOnIndex:t.onIndex},null,40,["fields","skipSummary","activeField","cancelDestinationPath","onOnFinish","onFinish","onOnIndex"])}var a=n("9441"),i=Object(r["defineComponent"])({name:"HisStandardForm",components:{TouchScreenForm:a["a"]},emits:["onFinish","onIndex"],data:()=>({formType:"touch-screen-form"}),props:{onFinishAction:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String,required:!1}},methods:{onFinish(t,e){this.$emit("onFinish",t,e)},onIndex(t){this.$emit("onIndex",t)}}}),s=n("d959"),l=n.n(s);const d=l()(i,[["render",o]]);e["a"]=d}}]);
//# sourceMappingURL=chunk-82881052.c8659f49.js.map