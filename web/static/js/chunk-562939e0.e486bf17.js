(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-562939e0"],{"00a4":function(e,t,a){},"0690":function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a("ade3"),o=(a("13d5"),a("cc6f")),i=a("9283"),r=a("2ef0"),l=a("32b3"),c=a("5a0c"),s=a.n(c);class d extends o["a"]{constructor(e,t){super(e,68,t),Object(n["a"])(this,"lastDrugs",void 0),Object(n["a"])(this,"lastReceiptDate",void 0),this.lastDrugs=[],this.lastReceiptDate=""}async loadPreviousDrugs(e=!1){const t=new Date(this.date);t.setDate(t.getDate()-1);const a=e=>i["c"].toStandardHisFormat(e),n=await o["a"].getJson(`patients/${this.patientID}/drugs_received`,{date:a(t)});if(!Object(r["isEmpty"])(n)){this.lastReceiptDate=n.reduce((e,t)=>!e||new Date(a(t.order.start_date))>new Date(e)?a(t.order.start_date):e,null);const t=l["a"].htnDrugReferences().map(e=>e.drug_id);if(this.lastDrugs=n.filter(e=>!t.includes(e.drug["drug_id"])&&a(e.order.start_date)===this.lastReceiptDate),e){const e=await this.getPreviousDrugPillCount()||{};this.lastDrugs=this.lastDrugs.map(t=>(e[t.drug.drug_id]&&t.quantity&&(t.quantity+=e[t.drug.drug_id]),t))}}}getReceiptDate(){return this.lastReceiptDate}getLastDrugs(){return this.lastDrugs}receivedDrugsBefore(){return!Object(r["isEmpty"])(this.lastDrugs)}buildPillCountObs(e,t){return this.buildValueNumber("Number of tablets brought to clinic",t,null,e)}getPreviousDrugPillCount(){return o["a"].getJson("last_drugs_pill_count",{patient_id:this.patientID,program_id:this.programID,date:this.lastReceiptDate})}async buildAdherenceObs(e,t,a){const n=await o["a"].getConceptID("Drug adherence",!0);return{concept_id:n,value_numeric:a,value_drug:t,value_modifier:"%",order_id:e,person_id:this.patientID,obs_datetime:o["a"].getSessionDate()}}isAdherenceGood(e){return e>=95&&e<=105}calculateAdherence(e,t,a){return Math.round(100*(e-t)/(e-a))}calculateExpected(e,t,a,n){const o="QW"===n?"week":"day",i=this.calcTimeElapsed(a,o);return e-i*parseFloat(t.toString())}calcTimeElapsed(e,t){return s()(i["c"].toStandardHisFormat(this.date)).diff(i["c"].toStandardHisFormat(e),t)+1}calculateUnaccountedOrMissed(e,t){const a=parseFloat(e)-parseFloat(t);return a<0?-1*a+" missed":a+" unacc"}}},"0b22":function(e,t,a){"use strict";function n(e,t){return[...new Map(e.filter(Boolean).map(e=>{const a=Array.isArray(t)?t.map(t=>e[t]).join("_"):e[t];return[a,e]})).values()]}a.d(t,"a",(function(){return n}))},"0cb1":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("cc6f");class o extends n["a"]{constructor(e,t){super(e,57,t)}}},"1f9a":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a("ade3"),o=a("1c74"),i=a("ad60"),r=a("d10e");class l extends o["e"]{constructor(){super()}static create(e){return super.postJson("/person_attributes",e)}}var c=a("4db7");class s extends o["e"]{constructor(){super(),Object(n["a"])(this,"personId",void 0),this.personId=0}getPersonID(){return this.personId}setPersonID(e){this.personId=e}async registerPatient(e,t){await this.createPerson(e),await this.createPersonAttributes(t);const a=await this.createPatient();return await this.printPatient(),a}async registerGuardian(e){return this.createPerson(e)}updatePerson(e){return new r["a"](e).update(this.personId)}async createPerson(e){const t=await new r["a"](e).create();return this.personId=t.person_id,t}createPatient(){return i["a"].createPatient(this.personId)}async createPersonAttributes(e){for(const t in e)await l.create({...e[t],person_id:this.personId})}printPatient(){return new c["a"](this.personId).printNidLbl()}}},"265c":function(e,t,a){},"2cef":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("1c74");class o extends n["e"]{constructor(){super()}static voidRelation(e,t,a){return n["e"].void(`people/${e}/relationships/${t}`,{reason:a})}static async amendRelation(e,t,a,n){return await o.voidRelation(e,a,"Updating guardian relationship"),o.createRelation(e,t,n)}static getRelations(){return super.getJson("types/relationships")}static createRelation(e,t,a){return super.postJson(`people/${e}/relationships`,{relationship_type_id:a,relation_id:t})}}},"32b3":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return r}));var n,o=a("cc6f"),i=a("7957");(function(e){e["Prescription"]="htnPrescription"})(n||(n={}));class r extends o["a"]{constructor(e,t){super(e,48,t)}static getBpGrade(e,t){return e<140&&t<90?"normal":e>=140&&e<160||t>=100&&t<110?"grade 1":e>=180&&t>110||e>=180?"grade 3":e>=160&&e<180||t>=110?"grade 2":"N/A"}static isBpNormotensive(e){const[t,a]=Object.values(e).sort((e,t)=>e.date<t.date?1:0).map(e=>this.getBpGrade(e.sbp,e.dbp));return"normal"===t&&"normal"===a}getSystolicBp(){return i["a"].getFirstValueNumber(this.patientID,"Systolic blood pressure")}getDiastolicBp(){return i["a"].getFirstValueNumber(this.patientID,"Diastolic blood pressure")}async onBpDrugs(){const e=await i["a"].getFirstValueCoded(this.patientID,"Treatment status");return!!e&&"Yes"===e}async getBPTrail(){return await o["a"].getJson(`/patients/${this.patientID}/bp_trail`)}async getCurrentDrugs(){return await o["a"].getJson(`/patients/${this.patientID}/current_bp_drugs`)}async getLastDrugs(){return await o["a"].getJson(`/patients/${this.patientID}/last_bp_drugs_dispensation`)}async getAdherence(e,t){return await o["a"].postJson(`/patients/${this.patientID}/remaining_bp_drugs`,{drug_id:e,pills:t})}async enrollPatient(e){return await o["a"].postJson(`/patients/${this.patientID}/update_or_create_htn_state`,e)}static htnDrugReferences(){return[{drug_id:275,drug_name:"HCZ (25mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:942,drug_name:"Enalapril (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:943,drug_name:"Enalapril (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:558,drug_name:"Amlodipine (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:559,drug_name:"Amlodipine (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:117,drug_name:"Atenolol (50mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:11,drug_name:"Atenolol(100mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"}]}getDrugs(){return{HCZ:{drugs:[{drugName:"HCZ (25mg tablet)",drugID:275,amount:"25mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null}],selected:null,notes:[]},Enalapril:{drugs:[{drugName:"Enalapril (5mg tablet)",drugID:942,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Enalapril (10mg tablet)",drugID:943,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Amlodipine:{drugs:[{drugName:"Amlodipine (5mg tablet)",drugID:558,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Amlodipine (10mg tablet)",drugID:559,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Atenolol:{drugs:[{drugName:"Atenolol (50mg tablet)",drugID:117,amount:"50mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Atenolol(100mg tablet)",drugID:11,amount:"100mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]}}}}},3794:function(e,t,a){"use strict";a("265c")},"3b8c":function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a("cc6f"),o=a("7957"),i=a("5a0c"),r=a.n(i),l=a("2ef0");class c extends n["a"]{constructor(e,t){super(e,53,t)}getFamilyPlanningMethods(){return["ORAL CONTRACEPTIVE PILLS","DEPO-PROVERA","INTRAUTERINE CONTRACEPTION","CONTRACEPTIVE IMPLANT","MALE CONDOMS","FEMALE CONDOMS","TUBAL LIGATION","NONE"]}async getTptTreatmentStatus(){return n["a"].getJson(`/patients/${this.patientID}/tpt_status`)}async patientHitMenopause(){const e=await o["a"].getFirstObs(this.patientID,"Why does the woman not use birth control");return!(!e||"string"!==typeof(null===e||void 0===e?void 0:e.value_text))&&(!!e.value_text.match(/menopause/i)&&n["a"].obsInValidPeriod(e))}async hasTreatmentHistoryObs(){const e=await o["a"].getFirstObs(this.patientID,"Previous TB treatment history");return e&&n["a"].obsInValidPeriod(e)}getDrugSideEffects(){return n["a"].getJson(`programs/${n["a"].getProgramID()}/patients/${this.patientID}/medication_side_effects`,{date:this.date})}getClient(){return n["a"].getFirstValueCoded(this.patientID,"Patient present")}async clientDueForCxCa(){const e=await n["a"].getJson("last_cxca_screening_details",{id:this.patientID,date:this.date});if(!Object(l["isEmpty"])(e)){const t=e["date_screened"],a=r()(this.date).diff(t,"years");return a>=1}return!0}async clientHasHadAHysterectomy(){const e=await n["a"].getFirstValueCoded(this.patientID,"Reason for NOT offering CxCa");if("Hysterectomy"===e)return!0;const t=await n["a"].getFirstValueText(this.patientID,"Treatment");return"Hysterectomy"===t}async getTLObs(){const e=e=>e&&"Tubal ligation"===e.value_coded&&n["a"].obsInValidPeriod(e),t=await n["a"].getFirstObs(this.patientID,"Family planning");if(e(t))return e(t);{const t=await n["a"].getFirstObs(this.patientID,"Method of family planning");return e(t)}}async getPreviousDrugs(){const e=await n["a"].getJson(`patients/${this.patientID}/drugs_received`);if(!e)return;const t={};return e.forEach(e=>{t[e.drug_inventory_id]=e}),t}familyPlanningMethods(e,t){const a={"ORAL CONTRACEPTIVE PILLS":{"DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","CONTRACEPTIVE IMPLANT":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"DEPO-PROVERA":{"ORAL CONTRACEPTIVE PILLS":"N","INTRAUTERINE CONTRACEPTION":"N","CONTRACEPTIVE IMPLANT":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"INTRAUTERINE CONTRACEPTION":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","CONTRACEPTIVE IMPLANT":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"CONTRACEPTIVE IMPLANT":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"MALE CONDOMS":{"ORAL CONTRACEPTIVE PILLS":"Y","DEPO-PROVERA":"Y","INTRAUTERINE CONTRACEPTION":"Y","CONTRACEPTIVE IMPLANT":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"Y","TUBAL LIGATION":"N",VASECTOMY:"Y"},"FEMALE CONDOMS":{"ORAL CONTRACEPTIVE PILLS":"Y","DEPO-PROVERA":"Y","INTRAUTERINE CONTRACEPTION":"Y","CONTRACEPTIVE IMPLANT":"Y","MALE CONDOMS":"Y","RYTHM METHOD":"Y","TUBAL LIGATION":"N",VASECTOMY:"Y"},"RYTHM METHOD":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","CONTRACEPTIVE IMPLANT":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"TUBAL LIGATION":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"N","FEMALE CONDOMS":"N","CONTRACEPTIVE IMPLANT":"N","RYTHM METHOD":"N",VASECTOMY:"N"},VASECTOMY:{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"Y","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"N","CONTRACEPTIVE IMPLANT":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N"},NONE:{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"N","FEMALE CONDOMS":"N","CONTRACEPTIVE IMPLANT":"N","RYTHM METHOD":"N","TUBAL LIGATION":"N"}},n=a[e];return t.map(e=>"N"===n[e.label]?{label:e.label,value:e.value,isChecked:!1,disabled:!0}:{label:e.label,value:e.value,isChecked:e.isChecked,disabled:!1})}}},"5b71":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a("ade3"),o=a("9b7c"),i=a("cc6f");class r extends i["a"]{constructor(e){super(e,57),Object(n["a"])(this,"patientID",void 0),Object(n["a"])(this,"testTypeID",void 0),Object(n["a"])(this,"resultDate",void 0),Object(n["a"])(this,"testID",void 0),this.patientID=e,this.testTypeID=-1,this.resultDate="",this.testID=-1}createLabResult(e){return i["a"].postJson(`lab/tests/${this.testID}/results`,{encounter_id:this.encounterID,date:this.resultDate,measures:e})}getTestID(){return this.testID}getTestTypeID(){return this.testTypeID}setTestTypeID(e){this.testTypeID=e}setResultDate(e){this.resultDate=e}setTestID(e){this.testID=e}getTestsWithoutResults(){return o["a"].getOrders(this.patientID,{status:"drawn"})}getTestIndicators(){return o["a"].getJson("lab/test_result_indicators",{test_type_id:this.testTypeID})}}},"5e76":function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return d})),a.d(t,"b",(function(){return u})),a.d(t,"e",(function(){return m}));a("13d5"),a("14d9");var n=a("7957"),o=a("0011"),i=a("2ef0"),r=a("b211"),l=a("b5e4");async function c(e){for(const t in e){if(e[t].required&&Object(i["isEmpty"])(e[t].value)){e[t].error="This field is required";continue}if("function"!==typeof e[t].validation){e[t].error="";continue}const a="object"===typeof e[t].value?e[t].value:{label:e[t].value,value:e[t].value},n=await e[t].validation(a,e);n&&n.length>0?e[t].error=n.toString():e[t].error=""}return Object.values(e).every(({error:e})=>!e)}function s(e,t=!1){const a={},n={};for(const i in e)if(e[i].value){const r=t?Object(o["j"])(i):i;a[r]=e[i].value,"function"===typeof e[i].computedValue&&(n[r]=e[i].computedValue(e[i].value,e))}return{formData:a,computedFormData:n}}function d(e,t=""){const a=Object.values(e).filter(e=>e&&(e.tag===t||""===t)).reduce((e,t)=>{const a=t.obs?t.obs:t;return Array.isArray(a)?e=e.concat(a):e.push(a),e},[]);return Promise.all(a)}function u(e,t){return Promise.all(t.map(async t=>n["a"].buildGroupValueCoded(e,t.label,t.isChecked?"Yes":"No")))}async function m(e,t,a){if(!await c(e))return;const n=(null===a||void 0===a?void 0:a.showloader)||!1;try{n&&await r["a"].show();const{formData:o,computedFormData:i}=s(e,null===a||void 0===a?void 0:a.underscoreKeys);await t(o,i)}catch(o){Object(l["e"])(""+o),console.error(o)}finally{n&&await r["a"].hide()}}},"5f2c":function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a("ade3"),o=(a("14d9"),a("cc6f")),i=a("71c3"),r=(a("13d5"),a("1c74"));class l extends r["e"]{constructor(){super()}static async fetchAvailableDrugStock(e){const t=await this.getJson("pharmacy/items",{drug_id:e});if(t&&t.length>0)return t.reduce((e,t)=>e+t.current_quantity,0)}}var c=a("d1ca");const s={11:[30],21:[25],22:[60],24:[30,60,90,100],30:[90],39:[60],73:[120],74:[60],76:[1e3],297:[30,60,90],576:[30,60,90],613:[60],731:[60],732:[60],733:[60],734:[30],735:[30],736:[60],738:[60],931:[12,30,60],932:[30],954:[60],963:[30,60,90],968:[60],969:[30],971:[30,60,90],976:[60],977:[30],982:[30],983:[30,90],1039:[30,60,90],1043:[60],1044:[30],1056:[24],1216:[3,6,8,12]};class d extends o["a"]{constructor(e,t){super(e,54,t),Object(n["a"])(this,"drugHistory",void 0),Object(n["a"])(this,"currentDrugOrder",void 0),Object(n["a"])(this,"useDrugManagement",void 0),this.drugHistory=[],this.currentDrugOrder=[],this.useDrugManagement=!1}setIsDrugManagementEnabled(e){this.useDrugManagement=e}async loadDrugManagementEnabled(){this.useDrugManagement=await c["b"].drugManagementEnabled()}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}buildDispensations(e,t,a){const n=[];for(let o=0;o<a;o++)n.push({drug_order_id:e,date:this.date,quantity:t/a});return n}saveDispensations(e){return o["a"].postJson("/dispensations",{dispensations:e,program_id:o["a"].getProgramID()})}async voidOrder(e){return o["a"].void("/dispensations/"+e,{})}async loadDrugHistory(){try{const e=await i["a"].getDrugOrderHistory(this.patientID);e&&(this.drugHistory=e)}catch(e){console.warn(e)}}async loadCurrentDrugOrder(){const e=await i["a"].getDrugOrders(this.patientID);if(e){if(this.useDrugManagement){const t=e.map(async e=>(e["available_stock"]=await l.fetchAvailableDrugStock(e.drug.drug_id),e));return void(this.currentDrugOrder=await Promise.all(t))}this.currentDrugOrder=e}}getDrugPackSizes(e){return e in s?s[e]:[30,60,90]}calcCompletePack(e,t){const a=e.barcodes.sort((e,t)=>e.tabs-t.tabs);if(0==a.length||0==t)return t;for(const o in a){const{tabs:e}=a[o];if(parseInt(e)>=t)return e}const n=parseInt(a[a.length-1].tabs);return n}}},"66c5":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a("ade3"),o=a("cc6f"),i=a("ad60"),r=a("cc74");class l extends o["a"]{constructor(e,t){super(e,51,t),Object(n["a"])(this,"sitePrefix",void 0),this.sitePrefix=""}getSitePrefix(){return this.sitePrefix}async loadSitePrefix(){this.sitePrefix=await r["b"].sitePrefix()}createArvNumber(e){return i["a"].postJson("/patient_identifiers/",{patient_id:this.patientID,identifier_type:4,identifier:e})}buildArvNumber(e){return`${this.sitePrefix}-ARV-${e}`}}},"6ff7":function(e,t,a){"use strict";a("9c7b")},"71c3":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("1c74");class o extends n["e"]{constructor(){super()}static create(e){return this.postJson("drug_orders",e)}static updateDispensationOrders(e){return this.postJson("dispensations",{program_id:this.getProgramID(),dispensations:e.map(e=>({date:this.getSessionDate(),drug_order_id:e["order_id"],quantity:e["quantity"]}))})}static getDrugOrderHistory(e){return this.getJson("drug_orders",{patient_id:e})}static getDrugOrders(e){return this.getJson("drug_orders",{patient_id:e,date:this.getSessionDate(),program_id:this.getProgramID()})}static getAllDrugOrders(e,t=1e3){return this.getJson("drug_orders",{patient_id:e,program_id:n["e"].getProgramID(),page_size:t})}static getLastDrugsReceived(e){return this.getJson(`patients/${e}/last_drugs_received`,{date:this.getSessionDate(),program_id:this.getProgramID()})}static getDrugDosages(e,t,a=this.getSessionDate()){const n={drug_id:t,date:a};return this.getJson(`programs/${this.getProgramID()}/patients/${e}/drug_doses`,n)}static getOrderByPatient(e,t){return this.getJson("/drug_orders",{patient_id:e,program_id:this.getProgramID(),...t})}}},"76df":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("7f35");async function o(e,t="action-sheet-modal"){const a=await Object(n["c"])("Are you sure you want to void record?","Please specify reason for voiding this record",["Mistake/ Wrong Entry","Duplicate","System Error"],[{name:"Cancel",slot:"start"},{name:"Void",color:"danger",slot:"end",role:"action"}],"",t);a.selection&&"Void"===a.action&&await e(a.selection)}},"7f12":function(e,t,a){"use strict";var n=a("7a23");const o={key:0},i={key:1};function r(e,t,a,r,l,c){const s=Object(n["resolveComponent"])("ion-title"),d=Object(n["resolveComponent"])("ion-toolbar"),u=Object(n["resolveComponent"])("ion-header"),m=Object(n["resolveComponent"])("his-basic-table"),b=Object(n["resolveComponent"])("text-skeloton"),p=Object(n["resolveComponent"])("ion-content"),O=Object(n["resolveComponent"])("ion-button"),g=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.title),1)]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[e.ready?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",o,[Object(n["createVNode"])(m,{columns:e.columns,rows:e.rows},null,8,["columns","rows"])])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",i,[Object(n["createVNode"])(b)]))]),_:1}),Object(n["createVNode"])(g,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,{color:"danger",onClick:e.closeModal,slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Close ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var l=a("a3a5"),c=a("d867"),s=a("ded6"),d=Object(n["defineComponent"])({components:{HisBasicTable:l["a"],IonHeader:c["IonHeader"],IonToolbar:c["IonToolbar"],IonContent:c["IonContent"],IonFooter:c["IonFooter"],IonButton:c["IonButton"],TextSkeloton:s["a"]},props:{title:{type:String,required:!0},columns:{type:Object,required:!0},onRows:{type:Function,required:!0}},data:()=>({rows:[],ready:!1}),watch:{onRows:{async handler(e){e&&(this.rows=await e(),this.ready=!0)},immediate:!0,deep:!0}},methods:{async closeModal(){await c["modalController"].dismiss({})}}}),u=a("d959"),m=a.n(u);const b=m()(d,[["render",r]]);t["a"]=b},"83af":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("cc6f");class o extends n["a"]{constructor(e,t){super(e,7,t)}async getNextAppointment(){const e=n["a"].getProgramID();return n["a"].getJson(`/programs/${e}/patients/${this.patientID}/next_appointment_date`,{date:this.date})}static async getDailiyAppointments(e){const t=n["a"].getProgramID();return n["a"].getJson(`/programs/${t}/booked_appointments`,{date:e,paginate:!1})}}},"99e7":function(e,t,a){"use strict";a.r(t);var n=a("7a23");function o(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("information-header"),c=Object(n["resolveComponent"])("ion-col"),s=Object(n["resolveComponent"])("ion-row"),d=Object(n["resolveComponent"])("visits-summary"),u=Object(n["resolveComponent"])("ion-grid"),m=Object(n["resolveComponent"])("layout");return Object(n["openBlock"])(),Object(n["createBlock"])(m,null,{default:Object(n["withCtx"])(()=>[e.isReady?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:0,class:"ion-no-margin ion-no-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{size:"12"},{default:Object(n["withCtx"])(()=>[e.patient?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,patient:e.patient,guardians:e.guardians,artStartDate:e.artStartDate,onUpdateARVNumber:e.updateARVNumber,onAddGuardian:e.addGuardian,onUpdatePatient:e.updateDemographics},null,8,["patient","guardians","artStartDate","onUpdateARVNumber","onAddGuardian","onUpdatePatient"])):Object(n["createCommentVNode"])("",!0)]),_:1})]),_:1}),Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[e.patient?(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:0,patient:e.patient,startDate:e.artStartDate},null,8,["patient","startDate"])):Object(n["createCommentVNode"])("",!0)]),_:1})]),_:1})]),_:1})):Object(n["createCommentVNode"])("",!0)]),_:1})}var i=a("9283"),r=a("7def"),l=a("8d56");const c=e=>(Object(n["pushScopeId"])("data-v-4936bde9"),e=e(),Object(n["popScopeId"])(),e),s=c(()=>Object(n["createElementVNode"])("span",{class:"title"},"Summary of Visits",-1)),d={class:"ion-float-right ion-margin-end ion-margin-bottom"};function u(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-icon"),c=Object(n["resolveComponent"])("ion-button"),u=Object(n["resolveComponent"])("ion-card-title"),m=Object(n["resolveComponent"])("ion-card-header"),b=Object(n["resolveComponent"])("report-table"),p=Object(n["resolveComponent"])("ion-card-content"),O=Object(n["resolveComponent"])("ion-card");return Object(n["openBlock"])(),Object(n["createBlock"])(O,{class:"his-card",style:{padding:"0 !important"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[s,Object(n["createElementVNode"])("span",d,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.actionButtons,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(c,{key:e.label,onClick:e.action,color:e.color||"primary"},{default:Object(n["withCtx"])(()=>[e.icon?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,icon:e.icon,class:"ion-margin-right"},null,8,["icon"])):Object(n["createCommentVNode"])("",!0),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.label),1)]),_:2},1032,["onClick","color"]))),128))])]),_:1})]),_:1}),Object(n["createVNode"])(p,{class:"ion-no-padding",style:{"min-height":"45vh"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{rows:e.rows,columns:e.columns,config:e.tableConfig},null,8,["rows","columns","config"])]),_:1})]),_:1})}a("14d9");var m=a("7f12"),b=a("9ceb"),p=a("80e3"),O=a("ec2a"),g=a("7957"),v=a("23e6"),h=a("ad60"),f=a("76df"),j=a("d867"),C=a("5a0c"),N=a.n(C);function V(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-toolbar"),s=Object(n["resolveComponent"])("ion-header"),d=Object(n["resolveComponent"])("DateInput"),u=Object(n["resolveComponent"])("ion-col"),m=Object(n["resolveComponent"])("SelectInput"),b=Object(n["resolveComponent"])("NumberInput"),p=Object(n["resolveComponent"])("ion-row"),O=Object(n["resolveComponent"])("ion-label"),g=Object(n["resolveComponent"])("ion-checkbox"),v=Object(n["resolveComponent"])("ion-item"),h=Object(n["resolveComponent"])("ion-grid"),f=Object(n["resolveComponent"])("ion-content"),j=Object(n["resolveComponent"])("ion-button"),C=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Viral Load Results")]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(f,{class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(h,{style:{width:"100%"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"12",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{modelValue:e.form.orderDate,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.orderDate=t),form:e.form,minDate:e.birthdate,maxDate:e.today},null,8,["modelValue","form","minDate","maxDate"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.reason,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.reason=t),options:e.reasons},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.specimenConcept,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.specimenConcept=t),options:e.specimens},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(u,{size:"12",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{modelValue:e.form.resultDate,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.resultDate=t),form:e.form,minDate:e.form.orderDate.value,"max-date":e.today},null,8,["modelValue","form","minDate","max-date"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.modifier,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.modifier=t),options:e.modifiers},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.form.result,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.result=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})]),_:1}),Object(n["createVNode"])(p,{class:"ion-margin-top"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"12"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,{class:"ion-padding-vertical bold"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Other Results Options: ")]),_:1}),Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("LDL")]),_:1}),Object(n["createVNode"])(g,{slot:"start",modelValue:e.ldl,"onUpdate:modelValue":t[6]||(t[6]=t=>e.ldl=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(C,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(j,{color:"primary",onClick:t[7]||(t[7]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Close")]),_:1}),Object(n["createVNode"])(j,{color:"warning",onClick:e.resetResults,slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Reset")]),_:1},8,["onClick"]),Object(n["createVNode"])(j,{color:"success",onClick:e.saveResults,slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Save")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}a("d9e2");var I=a("5ab5"),D=a("be95"),w=a("f27f"),_=a("403e"),y=a("9b7c"),T=a("0cb1"),A=a("5e76"),E=a("5b71"),x=a("8158"),P=a("0ba8"),R=a("b5b2"),k=a("da44"),S=a("b5e4"),B=Object(n["defineComponent"])({components:{IonContent:j["IonContent"],IonFooter:j["IonFooter"],IonHeader:j["IonHeader"],IonTitle:j["IonTitle"],IonToolbar:j["IonToolbar"],IonButton:j["IonButton"],IonLabel:j["IonLabel"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonCheckbox:j["IonCheckbox"],IonItem:j["IonItem"],DateInput:I["a"],SelectInput:D["a"],NumberInput:w["a"]},props:{patient:{type:Object,required:!0}},setup(e){const t=Object(n["ref"])(!1),a=Object(_["d"])(["=",">","<",">=","<="]),o=Object(_["d"])(["Routine","Targeted","Confirmatory","Stat","Repeat / Missing","Follow up after Low Level Viremia","Follow up after High Viral Load"]),r=Object(n["ref"])([]),l=N()().format(i["b"]),c=N()(e.patient.getBirthdate()).format(i["b"]),s=Object(n["reactive"])({orderDate:{value:"",label:"Order Date",required:!0,validation:async e=>N()(e.value).isValid()?new Date(e.value)>new Date(l)?["Order date cannot be in the future"]:new Date(e.value)<new Date(c)?["Order date cannot be before patient's date of birth"]:null:["Invalid date"]},resultDate:{value:"",label:"Result Date",required:!0,validation:async(e,t)=>N()(e.value).isValid()?new Date(e.value)>new Date(l)?["Result date cannot be in the future"]:new Date(e.value)<new Date(t.orderDate.value)?["Result date cannot be before order date"]:null:["Invalid date"]},specimenConcept:{value:"",label:"Specimen",placeholder:"Select a specimen",required:!0},modifier:{value:"",label:"Modifier",placeholder:"Select a modifier",required:!0},reason:{value:"",label:"Reason",placeholder:"Select a reason",required:!0},result:{value:"",label:"Result Value",placeholder:"Enter a result value",required:!0}}),d=async()=>Object(A["e"])(s,async a=>{await T["a"].setSessionDate(a.orderDate);const n=new T["a"](e.patient.getID(),-1),o=await x["a"].getConceptID("HIV viral load"),i=await n.createEncounter();if(!i)throw new Error("Unable to create lab order encounter");const r=await y["a"].buildLabOrders(i,[{specimenConcept:a.specimenConcept.value,reason:a.reason.value,concept_id:o}]),l=await y["a"].saveOrdersArray(i.encounter_id,r);if(!l)throw new Error("Unable to save lab orders");await E["a"].setSessionDate(a.resultDate);const c=new E["a"](e.patient.getID());c.setTestID(l[0].tests[0].id),c.setResultDate(a.resultDate);const s=await c.createEncounter();if(!s)throw new Error("Unable to create lab result encounter");await c.createLabResult([{indicator:{concept_id:o},value:t.value?"LDL":parseInt(a.result),value_modifier:t.value?"=":a.modifier.value,value_type:t.value?"text":"numeric"}]),await E["a"].resetSessionDate(),await k["a"].hide(),P["b"].emit(R["a"].RELOAD_LATEST_VL_RESULT),P["b"].emit(R["a"].RELOAD_PATIENT_VISIT_DATA)}),u=async()=>{if(await Object(S["a"])("Are you sure you want to clear all fields?")){t.value=!1;for(const e in s)s[e].value="",s[e].error="";P["b"].emit(R["a"].ON_CLEAR)}};return Object(n["watch"])(t,e=>{e&&(s.modifier.value="",s.result.value=void 0,s.modifier.error="",s.result.error=""),s.modifier.disabled=e,s.modifier.required=!e,s.result.disabled=e,s.result.required=!e}),Object(n["onMounted"])(async()=>{r.value=(await y["a"].getSpecimens("HIV viral load")).map(e=>({label:e.name,value:e["concept_id"]}))}),{today:l,birthdate:c,form:s,modifiers:a,reasons:o,specimens:r,ldl:t,modal:k["a"],resetResults:u,saveResults:d}}}),M=a("d959"),L=a.n(M);const F=L()(B,[["render",V]]);var H=F;function G(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-toolbar"),s=Object(n["resolveComponent"])("ion-header"),d=Object(n["resolveComponent"])("ion-badge"),u=Object(n["resolveComponent"])("ion-col"),m=Object(n["resolveComponent"])("ion-row"),b=Object(n["resolveComponent"])("enrollment-form"),p=Object(n["resolveComponent"])("outcome-form"),O=Object(n["resolveComponent"])("outcomes-table"),g=Object(n["resolveComponent"])("ion-grid"),v=Object(n["resolveComponent"])("ion-content"),h=Object(n["resolveComponent"])("ion-button"),f=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Patient Outcomes")]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,{style:{width:"100%"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{color:"lightblue",class:"ion-padding",style:{width:"100%"},disabled:""},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.enrollmentStatus),1)]),_:1})]),_:1})]),_:1}),e.isEnrolled?(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:1},[e.outcomes?(Object(n["openBlock"])(),Object(n["createBlock"])(m,{key:0,class:"his-card",style:{"margin-bottom":".4rem"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{"date-enrolled":e.enrollDate,birthdate:e.birthdate,outcomes:e.outcomes,onSaveOutcome:e.saveOutcome},null,8,["date-enrolled","birthdate","outcomes","onSaveOutcome"])]),_:1})):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(m,{class:"his-card",style:Object(n["normalizeStyle"])([{padding:"0 !important"},{minHeight:e.totalStates?"0":"30vh"}])},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"12",class:"ion-no-padding"},{default:Object(n["withCtx"])(()=>{var t;return[Object(n["createVNode"])(O,{patientStates:null===(t=e.program)||void 0===t?void 0:t.patient_states,onVoidOutcome:e.voidOutcome},null,8,["patientStates","onVoidOutcome"])]}),_:1})]),_:1},8,["style"])],64)):(Object(n["openBlock"])(),Object(n["createBlock"])(m,{key:0,class:"his-card",style:{"margin-bottom":".4rem"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"12"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{patientProgram:e.patientProgram,birthdate:e.birthdate,onEnrollProgram:e.enrollProgram},null,8,["patientProgram","birthdate","onEnrollProgram"])]),_:1})]),_:1}))]),_:1})]),_:1}),Object(n["createVNode"])(f,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(h,{color:"primary",onClick:t[0]||(t[0]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Close")]),_:1}),e.isEnrolled?(Object(n["openBlock"])(),Object(n["createBlock"])(h,{key:0,color:"danger",onClick:e.voidProgram,slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Void Program")]),_:1},8,["onClick"])):Object(n["createCommentVNode"])("",!0)]),_:1})]),_:1})],64)}var U=a("74f4"),q=a("2ef0");const $=Object(n["createElementVNode"])("p",{class:"ion-padding-horizontal ion-margin-vertical bold ion-margin-top"},"Previous Outcomes",-1);function Y(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("data-table");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[$,Object(n["createVNode"])(l,{rows:e.rows,columns:e.columns,config:e.tableConfig,"row-actions-buttons":e.TableRowActions,color:"custom"},null,8,["rows","columns","config","row-actions-buttons"])],64)}var z=a("4971"),J=Object(n["defineComponent"])({name:"OutcomesTable",props:{patientStates:{type:Array,required:!0}},components:{DataTable:z["DataTable"]},emits:["voidOutcome"],setup(e,{emit:t}){const a=[{path:"name",label:"Outcome"},{path:"start_date",label:"Start Date",formatter:e=>N()(e).format(i["a"])},{path:"end_date",label:"End Date",formatter:e=>N()(e).format(i["a"])}],o={showSearchField:!1,showSubmitButton:!1},r=Object(n["computed"])(()=>e.patientStates.map((e,t)=>({...e,index:t}))),l=[{label:"void",color:"danger",action:async e=>{await Object(S["a"])("Are you sure you want to void this outcome?")&&t("voidOutcome",{stateId:e.patient_state_id,index:e.index})}}];return{rows:r,columns:a,tableConfig:o,TableRowActions:l}}});const W=L()(J,[["render",Y]]);var Q=W;function K(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("DateInput"),c=Object(n["resolveComponent"])("ion-col"),s=Object(n["resolveComponent"])("ion-button"),d=Object(n["resolveComponent"])("ion-row"),u=Object(n["resolveComponent"])("ion-grid");return Object(n["openBlock"])(),Object(n["createBlock"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{size:"12"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.date=t),form:e.form,minDate:e.birthdate,"max-date":e.today},null,8,["modelValue","form","minDate","max-date"])]),_:1}),Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{color:"warning",onClick:e.onReset},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Reset")]),_:1},8,["onClick"]),Object(n["createVNode"])(s,{color:"success",onClick:e.enrollProgram},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Enroll")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}var Z=Object(n["defineComponent"])({name:"EnrollmentForm",components:{DateInput:I["a"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonButton:j["IonButton"]},props:["birthdate"],emits:["enrollProgram"],setup(e,{emit:t}){const a=N()().format("YYYY-MM-DD"),o=Object(n["reactive"])({date:{value:"",label:"Date of Enrollment",required:!0,validation:async t=>new Date(t.value)<new Date(e.birthdate)?["Date of enrollment cannot be before date of birth"]:new Date(t.value)>new Date(a)?["Date of enrollment cannot be in the future"]:null}}),i=async()=>{await Object(S["a"])("Are you sure you want to clear all fields")&&(o.date.value="",o.date.error="",P["b"].emit(R["a"].ON_CLEAR))},r=async()=>Object(A["e"])(o,({date:e})=>t("enrollProgram",e));return{form:o,today:a,onReset:i,enrollProgram:r}}});const X=L()(Z,[["render",K]]);var ee=X;const te=Object(n["createElementVNode"])("p",null,"Add New Outcome",-1);function ae(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-col"),c=Object(n["resolveComponent"])("DateInput"),s=Object(n["resolveComponent"])("SelectInput"),d=Object(n["resolveComponent"])("text-input"),u=Object(n["resolveComponent"])("ion-button"),m=Object(n["resolveComponent"])("ion-row"),b=Object(n["resolveComponent"])("ion-grid");return Object(n["openBlock"])(),Object(n["createBlock"])(b,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,{size:"12"},{default:Object(n["withCtx"])(()=>[te]),_:1}),Object(n["createVNode"])(l,{size:"6",class:"ion-margin-top-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.date=t),form:e.form,minDate:e.dateEnrolled,"max-date":e.today},null,8,["modelValue","form","minDate","max-date"])]),_:1}),Object(n["createVNode"])(l,{size:"6",class:"ion-margin-top-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{modelValue:e.form.status,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.status=t),form:e.form,options:e.outcomes},null,8,["modelValue","form","options"])]),_:1}),e.isTransferredOut?(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:0},[Object(n["createVNode"])(l,{size:"6",class:"ion-margin-top-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{modelValue:e.form.nextFacility,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.nextFacility=t),form:e.form,asyncOptions:e.getFacilities},null,8,["modelValue","form","asyncOptions"])]),_:1}),Object(n["createVNode"])(l,{size:"6",class:"ion-margin-top-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{modelValue:e.form.reason,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.reason=t),form:e.form,options:e.transferOutReasons},null,8,["modelValue","form","options"])]),_:1}),e.specifyOther?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,size:"12",class:"ion-margin-top-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{modelValue:e.form.otherReason,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.otherReason=t),form:e.form},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0)],64)):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(l,{size:"12",class:"ion-margin-top"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{color:"warning",onClick:e.onReset},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Reset")]),_:1},8,["onClick"]),Object(n["createVNode"])(u,{color:"success",onClick:e.onSave},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Save")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}var ne=a("0db2"),oe=a("2706"),ie=a("e86e"),re=Object(n["defineComponent"])({name:"OutcomeForm",props:{outcomes:{type:Array,required:!0},dateEnrolled:{type:String,required:!0},birthdate:{type:String,required:!0}},components:{DateInput:I["a"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonButton:j["IonButton"],SelectInput:D["a"],TextInput:ne["a"]},emits:["saveOutcome"],setup(e,{emit:t}){const a=N()().format("YYYY-MM-DD"),o=Object(n["reactive"])({date:{value:"",label:"Outcome Date",required:!0,validation:async t=>new Date(t.value)<new Date(e.birthdate)?["Outcome date cannot be before date of birth - "+N()(e.birthdate).format(i["a"])]:new Date(t.value)<new Date(e.dateEnrolled)?["Outcome date cannot be before enrollment date- "+N()(e.dateEnrolled).format(i["a"])]:null},status:{value:"",label:"Outcome",required:!0},nextFacility:{value:"",label:"Next Facility",validation:async(e,t)=>"Patient transferred out"===t.status.value.label&&oe["a"].required(e)},reason:{value:"",label:"Reason for transfer out",validation:async(e,t)=>"Patient transferred out"===t.status.value.label&&oe["a"].required(e)},otherReason:{value:"",label:"Other reason for transfer out",placeholder:"Specify other reason for transfer out",validation:async(e,t)=>{var a,n,o,i;return"Patient transferred out"===(null===(a=t.status)||void 0===a||null===(n=a.value)||void 0===n?void 0:n.label)&&"Other"===(null===(o=t.reason)||void 0===o||null===(i=o.value)||void 0===i?void 0:i.label)&&oe["a"].required(e)}}}),r=Object(n["computed"])(()=>{var e;return"Patient transferred out"===(null===(e=o.status.value)||void 0===e?void 0:e.label)}),l=Object(n["computed"])(()=>{var e,t;return"Other"===(null===(e=o.reason)||void 0===e||null===(t=e.value)||void 0===t?void 0:t.label)}),c=async()=>{if(await Object(S["a"])("are you sure you want to clear all fields")){for(const e in o)o[e].value="",o[e].error="";P["b"].emit(R["a"].ON_CLEAR)}},s=()=>Object(A["e"])(o,e=>t("saveOutcome",{...e,isTransferredOut:r.value}));return{form:o,today:a,isTransferredOut:r,specifyOther:l,onSave:s,onReset:c,getFacilities:ie["b"],transferOutReasons:_["f"]}}});const le=L()(re,[["render",ae]]);var ce=le,se=Object(n["defineComponent"])({components:{IonContent:j["IonContent"],IonFooter:j["IonFooter"],IonHeader:j["IonHeader"],IonTitle:j["IonTitle"],IonToolbar:j["IonToolbar"],IonButton:j["IonButton"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonBadge:j["IonBadge"],OutcomesTable:Q,EnrollmentForm:ee,OutcomeForm:ce},props:{patient:{type:Object,required:!0}},setup(e){const{toStandardHisDisplayFormat:t,toStandardHisFormat:a}=i["c"],o=new U["a"](e.patient.getID()),r=Object(n["computed"])(()=>a(e.patient.getBirthdate())),l=Object(n["ref"])(),c=Object(n["computed"])(()=>!Object(q["isEmpty"])(l.value)),s=Object(n["ref"])(""),d=Object(n["ref"])(),u=Object(n["computed"])(()=>{var e,t,a;return null!==(e=null===(t=l.value)||void 0===t||null===(a=t.patient_states)||void 0===a?void 0:a.length)&&void 0!==e?e:0}),m=Object(n["computed"])(()=>c.value&&s.value?"Patient enrolled in this porgram on "+t(s.value):"Patient is not enrolled in this program"),b=async({date:e,status:t,nextFacility:a,reason:n,otherReason:i,isTransferredOut:r})=>{if(o.setStateDate(e),o.setStateId(t.value),r){const e="Other"!==n.value?n.value:i;await o.transferOutEncounter(a.other,e)}await o.updateState(),await Object(S["d"])("Outcome saved successfully",1e3),await k["a"].hide(),P["b"].emit(R["a"].RELOAD_PATIENT_VISIT_DATA)},p=async e=>{o.setProgramDate(e),await o.enrollProgram(),await Object(S["d"])("Program enrolled successfully",1e3),await k["a"].hide(),P["b"].emit(R["a"].RELOAD_PATIENT_VISIT_DATA)},O=async()=>{var e;o.setPatientProgramId((null===(e=l.value)||void 0===e?void 0:e.patient_program_id)||-1),await o.voidProgram("duplicate / system error"),await Object(S["d"])("Patient voided from program successfully",1e3),await k["a"].hide(),P["b"].emit(R["a"].RELOAD_PATIENT_VISIT_DATA)},g=async({stateId:e,index:t})=>{var a;o.setStateId(e),await o.voidState("duplicate / system error"),Object(S["d"])("Outcome voided successfully"),null===(a=l.value)||void 0===a||a.patient_states.splice(t,1),P["b"].emit(R["a"].RELOAD_PATIENT_VISIT_DATA)};return Object(n["onMounted"])(async()=>{const e=await o.getPrograms();if(l.value=e.find(e=>"HIV PROGRAM"===e.program.name),l.value){s.value=l.value.date_enrolled;const e=await o.getProgramOutcomes();d.value=e.map(e=>({label:e.name,value:e.program_workflow_state_id,other:e}))}}),{modal:k["a"],patientProgram:o,isEnrolled:c,enrollDate:s,birthdate:r,enrollmentStatus:m,outcomes:d,program:l,totalStates:u,toStandardHisDisplayFormat:t,saveOutcome:b,enrollProgram:p,voidProgram:O,voidOutcome:g}}});const de=L()(se,[["render",G]]);var ue=de;function me(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-toolbar"),s=Object(n["resolveComponent"])("ion-header"),d=Object(n["resolveComponent"])("DateInput"),u=Object(n["resolveComponent"])("ion-col"),m=Object(n["resolveComponent"])("NumberInput"),b=Object(n["resolveComponent"])("SelectInput"),p=Object(n["resolveComponent"])("yes-no-input"),O=Object(n["resolveComponent"])("ion-label"),g=Object(n["resolveComponent"])("ion-checkbox"),v=Object(n["resolveComponent"])("ion-item"),h=Object(n["resolveComponent"])("multi-column-view"),f=Object(n["resolveComponent"])("ion-row"),j=Object(n["resolveComponent"])("ion-grid"),C=Object(n["resolveComponent"])("ion-content"),N=Object(n["resolveComponent"])("ion-button"),V=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Patient Visit")]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(C,{class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(j,{style:{width:"100%"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(f,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{modelValue:e.form.visitDate,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.visitDate=t),form:e.form,minDate:e.birthdate,maxDate:e.today},null,8,["modelValue","form","minDate","maxDate"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.weight,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.weight=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1}),e.showHeightField?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:0,size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.height,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.height=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(u,{class:"ion-margin-vertical",size:e.showHeightField?6:12},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.form.tbStatus,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.tbStatus=t),options:e.tbStatuses},null,8,["modelValue","options"])]),_:1},8,["size"]),e.isFemale?(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:1},[Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical ion-padding-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{modelValue:e.form.isPregnant,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.isPregnant=t),inline:""},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical ion-padding-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{modelValue:e.form.isBreastfeeding,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.isBreastfeeding=t),inline:""},null,8,["modelValue"])]),_:1})],64)):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{modelValue:e.form.hasContraindications,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.hasContraindications=t),inline:""},null,8,["modelValue"]),e.hasContraindications?(Object(n["openBlock"])(),Object(n["createBlock"])(h,{key:0,items:e.contraIndications,numberOfColumns:2},{default:Object(n["withCtx"])(({entries:e})=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(v,{lines:"none",key:e.value},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.label),1)]),_:2},1024),Object(n["createVNode"])(g,{slot:"start",modelValue:e.isChecked,"onUpdate:modelValue":t=>e.isChecked=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1},8,["items"])):Object(n["createCommentVNode"])("",!0)]),_:1}),Object(n["createVNode"])(u,{class:"ion-padding-start",size:"6"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{modelValue:e.form.hasSideEffects,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.hasSideEffects=t),inline:""},null,8,["modelValue"]),e.hasSideEffects?(Object(n["openBlock"])(),Object(n["createBlock"])(h,{key:0,items:e.sideEffects,numberOfColumns:2},{default:Object(n["withCtx"])(({entries:e})=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(v,{lines:"none",key:e.value},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.label),1)]),_:2},1024),Object(n["createVNode"])(g,{slot:"start",modelValue:e.isChecked,"onUpdate:modelValue":t=>e.isChecked=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1},8,["items"])):Object(n["createCommentVNode"])("",!0)]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.form.regimen,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.regimen=t),options:e.regimens},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalArvsGiven,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.totalArvsGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalCPTGiven,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.totalCPTGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.form.tbMed,"onUpdate:modelValue":t[11]||(t[11]=t=>e.form.tbMed=t),options:e.tbMeds},null,8,["modelValue","options"])]),_:1}),e.hasGiven6H||e.hasGivenRFP?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:2,size:"6"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalIPTGiven,"onUpdate:modelValue":t[12]||(t[12]=t=>e.form.totalIPTGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),e.hasGivenRFP?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:3,size:"6"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalRFPGiven,"onUpdate:modelValue":t[13]||(t[13]=t=>e.form.totalRFPGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),e.hasGiven3HP?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:4,size:"6"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.total3HPGiven,"onUpdate:modelValue":t[14]||(t[14]=t=>e.form.total3HPGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),e.hasGiven3HP||e.hasGivenRFP||e.hasGiven6H?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:5,size:"6"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalPyridoxineGiven,"onUpdate:modelValue":t[15]||(t[15]=t=>e.form.totalPyridoxineGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{modelValue:e.form.patientPresent,"onUpdate:modelValue":t[16]||(t[16]=t=>e.form.patientPresent=t),inline:"",disabled:e.form.patientPresent.disabled},null,8,["modelValue","disabled"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{modelValue:e.form.guardianPresent,"onUpdate:modelValue":t[17]||(t[17]=t=>e.form.guardianPresent=t),inline:""},null,8,["modelValue"])]),_:1}),e.prevDrugs.length>0?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:6,size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.pillCount,"onUpdate:modelValue":t[18]||(t[18]=t=>e.form.pillCount=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(u,{size:e.prevDrugs.length>0?6:12,class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{modelValue:e.form.nextAppointmentDate,"onUpdate:modelValue":t[19]||(t[19]=t=>e.form.nextAppointmentDate=t),form:e.form,minDate:e.form.visitDate.value,maxDate:e.drugRunOutDate},null,8,["modelValue","form","minDate","maxDate"])]),_:1},8,["size"])]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(V,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(N,{color:"primary",onClick:t[20]||(t[20]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Close")]),_:1}),Object(n["createVNode"])(N,{color:"warning",onClick:e.onClear,slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Reset")]),_:1},8,["onClick"]),Object(n["createVNode"])(N,{color:"success",onClick:e.onSubmit,slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Save")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var be=a("13ea"),pe=a.n(be),Oe=a("6b6c"),ge=a("92c1"),ve=a("1c74"),he=a("71c3");class fe extends v["a"]{constructor(e){super(e)}async isPregnant(){const e=await g["a"].getFirstObs(this.getID(),"Is patient pregnant");return e&&!!e.value_coded.match(/Yes/i)&&g["a"].obsInValidPeriod(e)}async hasPregnancyObsToday(){const e=await g["a"].getFirstObsDatetime(this.getID(),"Is patient pregnant");return e&&i["c"].toStandardHisFormat(e)===ve["e"].getSessionDate()&&this.isFemale()}async hasPregnancyAtARTInitiation(){const e=await g["a"].getLastValueCoded(this.getID(),"Is patient pregnant");return e&&await g["a"].getConceptName(e)}async breastFeedingAtARTInitiation(){const e=await g["a"].getLastValueCoded(this.getID(),"Is patient breast feeding");return e&&await g["a"].getConceptName(e)}async getInitialWeight(){return g["a"].getLastValueNumber(this.getID(),"weight")}async getRecentWeight(){return g["a"].getFirstValueNumber(this.getID(),"weight")||-1}async getInitialHeight(){return g["a"].getLastValueNumber(this.getID(),"Height")}async getInitialTBStatus(){const e=await g["a"].getLastValueCoded(this.getID(),"TB Status at Initiation");if(e)return g["a"].getConceptName(e)}async getRecentHeight(){return g["a"].getFirstValueNumber(this.getID(),"Height")||-1}async getWeightHistory(){try{const e=await g["a"].getAll(this.getID(),"weight");return e.map(e=>({weight:e.value_numeric,date:e.obs_datetime}))}catch(e){return console.warn(e),[]}}async getCompleteTBTherapyHistory(){const e=await g["a"].getAll(this.getID(),"TB treatment history");return e.filter(e=>e.value_text.match(/Complete/i))}async getInitialBMI(){return g["a"].getLastValueNumber(this.getID(),"BMI")}async everReceivedART(){return g["a"].getFirstValueCoded(this.getID(),"Ever received ART")}async agreesToFollowUp(){return g["a"].getFirstValueCoded(this.getID(),"Agrees to followup")}async getHIVTestDate(){const e=await g["a"].getFirstObs(this.getID(),"Confirmatory HIV test date");return e&&e.value_datetime?e.value_datetime:e&&e.value_text?e.value_text:null}async getARTStartDate(){const e=await g["a"].getFirstObs(this.getID(),"Date ART started");if(e&&e.value_datetime)return e.value_datetime;if(e&&e.value_text)return e.value_text;const t=await he["a"].getAllDrugOrders(this.getID(),Number.MAX_SAFE_INTEGER);return Object(q["isEmpty"])(t)?null:t[0].order["start_date"]}async getHIVTestLocation(){return g["a"].getFirstValueText(this.getID(),"Confirmatory HIV test location")}async getReasonForStartingART(){return g["a"].getFirstValueCoded(this.getID(),"Reason for ART eligibility")}async getStagingCondition(){return g["a"].getFirstValueCoded(this.getID(),"Who stages criteria present")}getWhoStage(){return g["a"].getFirstValueCoded(this.getID(),"Who stage")}}var je=a("6d32"),Ce=a("b515"),Ne=a("3b8c"),Ve=a("66c5"),Ie=a("0690"),De=a("83af"),we=a("dac2"),_e=a("aee2"),ye=a("5f2c"),Te=a("0b22"),Ae=Object(n["defineComponent"])({components:{IonContent:j["IonContent"],IonFooter:j["IonFooter"],IonHeader:j["IonHeader"],IonTitle:j["IonTitle"],IonToolbar:j["IonToolbar"],IonButton:j["IonButton"],IonItem:j["IonItem"],IonLabel:j["IonLabel"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonCheckbox:j["IonCheckbox"],SelectInput:D["a"],NumberInput:w["a"],DateInput:I["a"],YesNoInput:Oe["a"],MultiColumnView:ge["a"]},props:{patient:{type:Object,required:!0}},setup(e){const t=Object(n["computed"])(()=>e.patient.getID()),a=new Ce["a"](t.value,-1),o=new Ne["a"](t.value,-1),r=new we["a"](t.value,-1),l=new ye["a"](t.value,-1),c=new Ve["a"](t.value,-1),s=new Ie["a"](t.value,-1),d=new De["a"](t.value,-1),u=Object(n["ref"])(),m=Object(n["ref"])([]),b=Object(n["ref"])([]),p=Object(n["ref"])([]),O=Object(n["ref"])([]),g=Object(n["computed"])(()=>!(u.value&&e.patient.getAge()>18)),v=Object(n["computed"])(()=>e.patient.isFemale()),h=Object(n["ref"])(""),f=N()().format(i["b"]),j=N()(e.patient.getBirthdate()).format(i["b"]),C=Object(n["reactive"])({visitDate:{value:N()().format("YYYY-MM-DD"),label:"Visit Date",required:!0,validation:async e=>new Date(e.value)>new Date(f)?["Visit date cannot be after today's date"]:new Date(e.value)<new Date(j)?["Visit date cannot be before patient's birth date"]:null},weight:{value:void 0,label:"Weight",required:!0,computedValue:e=>({tag:"vitals",obs:a.buildValueNumber("Weight",e)}),validation:(e,t)=>!pe()(e)&&e.value||"No"!==t.patientPresent.value?a.validator({...e,label:"Weight"}):null},height:{value:void 0,label:"Height",computedValue:e=>({tag:"vitals",obs:a.buildValueNumber("Height",e)}),validation:e=>g.value&&(!pe()(e)&&e.value||"No"!==C.patientPresent.value)?a.validator({...e,label:"Height"}):null},isPregnant:{value:void 0,label:"Is the patient pregnant?",computedValue:e=>({tag:"consultation",obs:o.buildValueCoded("Is patient pregnant",e)}),validation:async e=>v.value&&oe["a"].required(e)},isBreastfeeding:{value:void 0,label:"Is the patient breastfeeding?",computedValue:e=>({tag:"consultation",obs:o.buildValueCoded("Is patient breast feeding",e)}),validation:async e=>v.value&&oe["a"].required(e)},nextAppointmentDate:{value:void 0,label:"Next Appointment Date",required:!0,computedValue:e=>({tag:"appointment",obs:d.buildValueDate("Appointment date",e)}),validation:async(e,t)=>new Date(e.value)<new Date(t.visitDate.value)?["Appointment date cannot be before visit date"]:new Date(e.value)>new Date(h.value)?["Appointment date cannot be after drug run out date"]:null},patientPresent:{value:void 0,label:"Is the patient present?",required:!0,computedValue:e=>({tag:"reception",obs:c.buildValueCoded("Patient present",e)})},guardianPresent:{value:void 0,label:"Is the guardian present?",required:!0,computedValue:e=>({tag:"reception",obs:c.buildValueCoded("Guardian present",e)})},pillCount:{value:void 0,label:"Pill Count",required:O.value.length>0,validation:async e=>O.value.length>0&&oe["a"].isNumber(e)},regimen:{value:void 0,label:"Regimen",placeholder:"Select a regimen",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","Antiretroviral drugs")})},totalCPTGiven:{value:void 0,label:"Total CPT Given",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","CPT")})},totalIPTGiven:{value:void 0,label:"Total IPT Given",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","INH")}),validation:async(e,t)=>{var a,n;return("6H"===(null===(a=t.tbMed.value)||void 0===a?void 0:a.label)||"3HP (RFP + INH)"===(null===(n=t.tbMed.value)||void 0===n?void 0:n.label))&&oe["a"].isNumber(e)}},totalRFPGiven:{value:void 0,label:"Total RFP Given",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","3HP (RFP + INH)")}),validation:async(e,t)=>{var a;return"3HP (RFP + INH)"===(null===(a=t.tbMed.value)||void 0===a?void 0:a.label)&&oe["a"].isNumber(e)}},total3HPGiven:{value:void 0,label:"Total 3HP Given",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","INH 300 / RFP 300 (3HP)")}),validation:async(e,t)=>{var a;return"3HP (INH 300 / RFP 300)"===(null===(a=t.tbMed.value)||void 0===a?void 0:a.label)&&oe["a"].isNumber(e)}},totalArvsGiven:{value:void 0,label:"Total ARVs Given",validation:async(e,t)=>!pe()(t.regimen.value)&&oe["a"].isNumber(e)},totalPyridoxineGiven:{value:void 0,label:"Total Pyridoxine Given",validation:async(e,t)=>{var a;return(null===(a=t.tbMed.value)||void 0===a?void 0:a.label)&&oe["a"].isNumber(e)}},tbMed:{value:void 0,label:"TB Medication",placeholder:"Select a TB medication"},hasContraindications:{value:"No",label:"Has Side Effects / Contraindications ?",validation:async e=>oe["a"].validateSeries([()=>oe["a"].required(e),()=>"No"===e.value||b.value.some(e=>e.isChecked)?null:["Please select at least one side effect"]])},hasSideEffects:{value:"No",label:"Has Other Side Effects ?",validation:async e=>oe["a"].validateSeries([()=>oe["a"].required(e),()=>"No"===e.value||p.value.some(e=>e.isChecked)?null:["Please select at least one side effect"]])},tbStatus:{value:void 0,label:"TB Status",computedValue:e=>({tag:"consultation",obs:o.buildValueCoded("TB Status",e.value)}),validation:async e=>oe["a"].required(e)}}),V=async(e,t)=>{const a={label:"Unkown",value:"Unkown",other:[{drug_id:1046,drug_name:"Unknown ARV",am:1,pm:0,units:"",frequency:"Daily (QOD)"}]},n=await je["a"].getRegimensByWeight(e,t);return pe()(n)?[a]:Object.keys(n).map(e=>({label:e,value:e,other:n[e]})).concat([a])};Object(n["watch"])(C.patientPresent,e=>{"No"===e.value?(C.weight.required=!1,C.weight.error="",C.guardianPresent.value="Yes"):C.weight.required=!0}),Object(n["watch"])(C.guardianPresent,e=>{"No"===e.value&&(C.patientPresent.value="Yes")}),Object(n["watch"])([()=>C.weight.value,()=>C.tbStatus.value],async([e,t])=>{C.regimen.value="";const a=!pe()(t)&&!t.label.match(/TB Not Suspected/i);e?(m.value=await V(C.weight.value,a),C.patientPresent.value="Yes",C.patientPresent.disabled=!0):e||(C.patientPresent.value=void 0,C.patientPresent.disabled=!1),C.tbMed.disabled=a}),Object(n["watch"])([()=>C.totalArvsGiven.value,()=>C.pillCount.value],()=>{const e=parseInt(C.totalArvsGiven.value)||0,t=parseInt(C.pillCount.value)||0;h.value=N()(C.visitDate.value).add(e+t,"days").format(i["b"]),C.nextAppointmentDate.label=`Next Appointment Date (Drug run out date: ${N()(h.value).format(i["a"])})`,C.nextAppointmentDate.value=h.value});const I=Object(n["computed"])(()=>{var e;return"3HP (INH 300 / RFP 300)"===(null===(e=C.tbMed.value)||void 0===e?void 0:e.label)}),D=Object(n["computed"])(()=>{var e;return"3HP (RFP + INH)"===(null===(e=C.tbMed.value)||void 0===e?void 0:e.label)}),w=Object(n["computed"])(()=>{var e;return"6H"===(null===(e=C.tbMed.value)||void 0===e?void 0:e.label)}),y=Object(n["computed"])(()=>"Yes"===C.hasContraindications.value),T=Object(n["computed"])(()=>"Yes"===C.hasSideEffects.value),E=Object(_["d"])(["Confirmed TB Not on treatment","Confirmed TB on treatment","TB Not Suspected","TB Suspected"]),B=Object(_["d"])(["6H","3HP (RFP + INH)","3HP (INH 300 / RFP 300)"]),M=async e=>{const t=e.height||u.value,n=_e["a"].calculateBMI(e.weight,t);return a.buildValueNumber("BMI",n)},L=async()=>{const e=[await o.buildValueCoded("Patient using family planning","No")],t=o.getFamilyPlanningMethods();return t.forEach(async t=>{e.push(await o.buildValueCoded(t,"No"))}),e},F=async()=>Promise.all(x["a"].getConceptsByCategory("tb_symptom",!0).map(async e=>o.buildGroupValueCoded(e.name,e.name,"No"))),H=(e,t,a,n)=>({drug_inventory_id:e.drug_id,equivalent_daily_dose:r.calculateEquivalentDosage(e.am,e.pm),dose:r.calculateDosage(e.am,e.pm),start_date:n,auto_expire_date:N()(n).add(a,"days").format("YYYY-MM-DD"),units:e.units,qty:t,frequency:e.frequency,instructions:r.getInstructions(e.drug_name,e.am,e.pm,e.units)}),G=async()=>{await fe.setSessionDate(C.visitDate.value),a.setDate(C.visitDate.value),o.setDate(C.visitDate.value),r.setDate(C.visitDate.value),c.setDate(C.visitDate.value),s.setDate(C.visitDate.value),d.setDate(C.visitDate.value),l.setDate(C.visitDate.value),await Object(A["e"])(C,async(e,t)=>{var n;await a.createEncounter();const i=await Object(A["d"])(t,"vitals");if(!pe()(i)){const t=await M(e);await a.saveObservationList([...i,t])}await o.createEncounter();let u=await Object(A["d"])(t,"consultation");u=[...u,...await Object(A["b"])("Malawi ART side effects",b.value)],u=[...u,...await F()],T.value&&(u=[...u,...await Object(A["b"])("Other side effect",p.value)]),v.value&&(u=[...u,...await L()]),await o.saveObservationList(u),await r.createEncounter();const m=[];let g=0;if(!pe()(e.regimen)&&e.totalArvsGiven){const t=e.regimen.other;g=Math.min(...t.map(t=>e.totalArvsGiven/(t.am+t.pm)+2)),t.forEach(t=>m.push(H(t,e.totalArvsGiven,g,e.visitDate)))}if(e.totalCPTGiven&&Object(Te["a"])(await je["a"].getRegimenExtras("Cotrimoxazole",e.weight),"concept_name").filter(e=>"Daily (QOD)"===e.frequency).forEach(t=>m.push(H(t,e.totalCPTGiven,g,e.visitDate))),null!==(n=e.tbMed)&&void 0!==n&&n.value){const t=Object(Te["a"])(await je["a"].getRegimenExtras("INH",e.weight),["concept_name","frequency"]),a=t.find(e=>"Pyridoxine"===e["concept_name"]);if(a&&e.totalPyridoxineGiven&&m.push(H(a,e.totalPyridoxineGiven,g,e.visitDate)),e.totalIPTGiven){const a=t.find(e=>"Isoniazid"===e["concept_name"]&&(w.value&&"Daily (QOD)"===e.frequency||D.value&&"Weekly (QW)"===e.frequency));m.push(H(a,e.totalIPTGiven,g,e.visitDate))}if(e.totalRFPGiven&&D.value){const t=await je["a"].getRegimenExtras("Rifapentine",e.weight);t.length&&m.push(H(t[0],e.totalRFPGiven,g,e.visitDate))}if(e.total3HPGiven&&I.value){const t=await je["a"].getRegimenExtras("INH / RFP",e.weight);m.push(H(t[0],e.total3HPGiven,g,e.visitDate))}}const h=await r.createDrugOrder(m),f=h.map(e=>{const t=m.find(t=>t.drug_inventory_id===e.drug_inventory_id);return l.buildDispensations(e.order_id,t.qty,1)});await l.saveDispensations(f.flat(1)),await c.createEncounter();const j=await Object(A["d"])(t,"reception");if(await c.saveObservationList(j),O.value.length>0){await s.createEncounter();const t=await Promise.all(O.value.map(async t=>{const a=s.calculateExpected(t.quantity,t.equivalent_daily_dose,t.order.start_date,t.frequency),n=s.calculateAdherence(t.quantity,e.pillCount,a);return[await s.buildAdherenceObs(t.order_id,t.drug_inventory_id,n),await s.buildPillCountObs(t.order_id,e.pillCount)]}));await s.saveObservationList(t.flat(1))}await d.createEncounter();const C=await Object(A["d"])(t,"appointment");await d.saveObservationList(C),await Object(S["d"])("Patient visit saved successfully"),await fe.resetSessionDate(),await k["a"].hide(),P["b"].emit(R["a"].RELOAD_PATIENT_VISIT_DATA),P["b"].emit(R["a"].RELOAD_STAGING_INFORMATION)})},U=async()=>{if(await Object(S["a"])("Are you sure you want to clear all fields?")){for(const e in C)C[e].value="",C[e].error="",C[e].disabled=!1;P["b"].emit(R["a"].ON_CLEAR)}};return Object(n["onMounted"])(async()=>{u.value=await e.patient.getRecentHeight();const t=await e.patient.getRecentWeight();t&&(m.value=await V(t)),O.value=await he["a"].getLastDrugsReceived(e.patient.getID()),C.pillCount.required=O.value.length>0,b.value=x["a"].getConceptsByCategory("contraindication",!0).map(e=>({value:e.concept_id,label:e.name,other:e})),p.value=x["a"].getConceptsByCategory("side_effect",!0).map(e=>({value:e.concept_id,label:e.name,other:e}))}),{today:f,form:C,regimens:m,contraIndications:b,sideEffects:p,tbStatuses:E,tbMeds:B,hasGiven3HP:I,hasGivenRFP:D,hasGiven6H:w,showHeightField:g,isFemale:v,modal:k["a"],hasContraindications:y,hasSideEffects:T,prevDrugs:O,drugRunOutDate:h,birthdate:j,onSubmit:G,onClear:U}}});a("6ff7");const Ee=L()(Ae,[["render",me],["__scopeId","data-v-3f1f203e"]]);var xe=Ee,Pe=Object(n["defineComponent"])({props:{patient:{type:Object,required:!0},startDate:{type:String,required:!0}},components:{ReportTable:p["a"],IonCard:j["IonCard"],IonCardHeader:j["IonCardHeader"],IonCardTitle:j["IonCardTitle"],IonCardContent:j["IonCardContent"],IonButton:j["IonButton"]},setup(e){const t=Object(n["ref"])([]),a=Object(n["computed"])(()=>e.patient.getID()),o=Object(n["reactive"])({showIndex:!1,tableCssTheme:"emc-datatable-theme"}),r=Object(n["ref"])([{label:"Add Visit",action:async()=>k["a"].show(xe,{patient:e.patient})},{label:"Update Outcome",action:async()=>k["a"].show(ue,{patient:e.patient})},{label:"Enter VL Results",action:async()=>k["a"].show(H,{patient:e.patient})}]),l=Object(n["ref"])([[b["a"].thTxt("Visit Date"),b["a"].thTxt("Given To"),b["a"].thTxt("Weight (Kg)"),b["a"].thTxt("Height (cm)"),b["a"].thTxt("BMI"),b["a"].thTxt("Preg"),b["a"].thTxt("B/F"),b["a"].thTxt("TB STATUS"),b["a"].thTxt("Side Effects"),b["a"].thTxt("ART Regimen"),b["a"].thTxt("Next Appointment"),b["a"].thTxt("Outcome"),b["a"].thTxt("Viral Load"),b["a"].thTxt("Void Visit")]]),c=t=>{const a="N/A"!==e.startDate?"("+N()(t).diff(e.startDate,"months")+"M)":"";return`${i["c"].toStandardHisDisplayFormat(t)} ${a}`},s=async(e,t,a=[])=>{if(Object(q["isEmpty"])(e))return;const n=await j["modalController"].create({component:m["a"],cssClass:"custom-modal",componentProps:{title:t,columns:a,onRows:()=>e}});await n.present()},d=async(e=[],t)=>{const a=["DRUG NAME","QUANTITY","UNITS"],n=e.map(e=>[e[0],e[1],"tab(s)"]),o="Drugs dispensed on "+i["c"].toStandardHisDisplayFormat(t);return s(n,o,a)},u=async(e=[],t)=>{const a="Side Effects Noted on "+i["c"].toStandardHisDisplayFormat(t),n=e.map(e=>[e]);return s(n,a)},p=async(e,t,n)=>{Object(f["a"])(async o=>{const i=await O["a"].getEncounters(a.value,{date:e});i.forEach(async e=>{await O["a"].voidEncounter(e.encounter_id,o)}),n.splice(t,1)},"small-modal")},C=()=>{v["a"].getPatientVisits(a.value,!0).then(async e=>{t.value=[];for(const n of e){const e=await h["a"].getCurrentProgramInformation(a.value,n);let o="",r="",l="",s="";if("Defaulted"!==e.outcome){const t=await g["a"].getFirstValueDatetime(a.value,"appointment date",n);if(t&&(o=i["c"].toStandardHisDisplayFormat(t)),r=await g["a"].getFirstValueCoded(a.value,"Is patient pregnant",n),l=await g["a"].getFirstValueCoded(a.value,"Is patient breast feeding",n),"N/A"===e["viral_load"]){const e=await g["a"].getFirstObs(a.value,"HIV viral load",n);e&&e.value_text&&e.value_numeric&&(s=1===e.value_numeric?"LDL":e.value_text+e.value_numeric.toString())}else s=e["viral_load"]}e&&t.value.push([b["a"].td(c(n)),b["a"].td(e["visit_by"].match(/Unk/i)?"":e["visit_by"]),b["a"].td("Defaulted"===e.outcome?"":e.weight),b["a"].td("Defaulted"===e.outcome?"":e.height),b["a"].td("Defaulted"===e.outcome?"":e.bmi),b["a"].td(r||""),b["a"].td(l||""),b["a"].td(e["tb_status"].match(/Unknown/i)||"Defaulted"===e.outcome?"":await x["a"].getCachedConceptName(e["tb_status"])||""),b["a"].tdLink(e["side_effects"].length?"Yes":"Defaulted"!==e.outcome?"No":"",()=>u(e.side_effects,n)),b["a"].tdLink("Defaulted"===e.outcome?"":e.regimen,()=>d(e.pills_dispensed,n)),b["a"].td(o||""),b["a"].td(e.outcome.match(/Unk/i)?"":e.outcome),b["a"].td(s),b["a"].tdBtn("X",(e,t)=>p(n,e,t),{},"danger")])}})};return P["b"].on(R["a"].RELOAD_PATIENT_VISIT_DATA,()=>C()),Object(n["onMounted"])(()=>{C()}),{actionButtons:r,tableConfig:o,columns:l,rows:t}}});a("3794");const Re=L()(Pe,[["render",u],["__scopeId","data-v-4936bde9"]]);var ke=Re;const Se={style:{width:"100%",display:"flex",justifyContent:"space-between"}},Be={key:0},Me={key:1},Le={key:2},Fe={key:3};function He(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-item"),c=Object(n["resolveComponent"])("ion-list"),s=Object(n["resolveComponent"])("multi-column-view");return Object(n["openBlock"])(),Object(n["createBlock"])(s,{items:e.patientInfo,numberOfColumns:3},{default:Object(n["withCtx"])(({entries:t})=>[Object(n["createVNode"])(c,{class:"his-card ion-margin-end"},{default:Object(n["withCtx"])(()=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(t,(a,o)=>(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:o,lines:o===t.length-1?"none":"",button:e.clickable(a),onClick:t=>e.onClickHandler(a)},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",Se,[a.label?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",Be,Object(n["toDisplayString"])(a.label)+": ",1)):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",Me)),e.clickable(a)?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",Le,[Object(n["createElementVNode"])("a",null,[Object(n["createElementVNode"])("b",null,Object(n["toDisplayString"])(a.value||"N/A"),1)])])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",Fe,[Object(n["createElementVNode"])("b",null,Object(n["toDisplayString"])(a.value||"N/A"),1)]))])]),_:2},1032,["lines","button","onClick"]))),128))]),_:2},1024)]),_:1},8,["items"])}a("13d5");var Ge=a("afbc"),Ue=a("8e8b"),qe=a("0011"),$e=Object(n["defineComponent"])({components:{MultiColumnView:ge["a"]},props:{patient:{type:Object,required:!0},artStartDate:{type:String,required:!0},guardians:{type:String,default:""}},emits:["updatePatient","updateARVNumber","addGuardian"],setup(e,{emit:t}){const a=Object(n["ref"])(0),o=Object(n["ref"])(0),r=Object(n["ref"])(0),l=Object(n["ref"])(""),c=Object(n["ref"])(""),s=Object(n["ref"])(""),d=Object(n["ref"])(""),u=Object(n["ref"])(""),m=Object(n["ref"])(""),b=Object(n["ref"])(""),p=Object(n["ref"])(""),O=Object(n["ref"])(""),g=Object(n["ref"])(""),v=Object(n["ref"])(""),h=e=>e.other&&"function"===typeof e.other.onClickHandler,f=async e=>{var t;h(e)&&await(null===(t=e.other)||void 0===t?void 0:t.onClickHandler())},j=()=>{const t=e.patient.getBirthdate(),a="N/A"!==e.artStartDate?N()(e.artStartDate).diff(t,"years"):"";return`${i["c"].toStandardHisDisplayFormat(t)} (${a})`},C=(t=!1)=>{t&&Ue["a"].invalidate("PATIENT_LAB_ORDERS"),Ue["a"].get("PATIENT_LAB_ORDERS",{patientID:e.patient.getID()}).then(e=>{const t=e.reduce((e,t)=>{const a=t.tests.filter(e=>e.name.match(/hiv/i)&&!Object(q["isEmpty"])(e.result)).map(e=>e.result);return e.concat(a.reduce((e,t)=>e.concat(t),[]))},[]).sort((e,t)=>new Date(e.date)>new Date(t.date)?-1:1);g.value=Object(q["isEmpty"])(t)?"":`${t[0].value_modifier}${t[0].value} (${i["c"].toStandardHisDisplayFormat(t[0].date)})`})},V=Object(n["computed"])(()=>[{label:"ARV Number",value:e.patient.getArvNumber(),other:{onClickHandler:()=>t("updateARVNumber")}},{label:"National Patient ID",value:e.patient.getNationalID()},{label:"Name",value:e.patient.getGivenName()+" "+e.patient.getFamilyName(),other:{onClickHandler:()=>t("updatePatient","given_name")}},{label:"DOB and Age at Initiation",value:j(),other:{onClickHandler:()=>t("updatePatient","birthdate")}},{label:"Sex",value:Object(qe["g"])(e.patient.getGender()),other:{onClickHandler:()=>{t("updatePatient","gender")}}},{label:"Location",value:e.patient.getCurrentVillage(),other:{onClickHandler:()=>{t("updatePatient","home_village")}}},{label:"Landmark",value:e.patient.getClosestLandmark(),other:{onClickHandler:()=>{t("updatePatient","landmarks")}}},{label:"Phone Number",value:e.patient.getPhoneNumber(),other:{onClickHandler:()=>{t("updatePatient","phone_number")}}},{label:"Guardian",value:e.guardians?e.guardians:"add",other:{...Object(q["isEmpty"])(e.guardians)?{onClickHandler:()=>{t("addGuardian")}}:{}}},{label:"Agrees to follow up",value:u.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Date of starting first line ARV Regimen",value:e.artStartDate,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Initial Weight (KG)",value:a.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Initial Height (CM)",value:o.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Initial BMI",value:r.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Initial TB Status",value:l.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Pregnant at Initiation",value:s.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Breastfeeding at Initiation",value:c.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Latest VL Result and Result Date",value:g.value},{label:"TI",value:d.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"HIV test place",value:p.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"HIV test date",value:b.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"WHO stage",value:v.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Reason for starting ART",value:m.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}},{label:"Staging codition",value:O.value,other:{onClickHandler:()=>Ge["a"].push(`/emc/registration/${e.patient.getID()}/false`)}}]),I=async()=>{const t=await e.patient.getHIVTestDate();t&&(b.value=i["c"].toStandardHisDisplayFormat(t))},D=()=>{e.patient.getInitialWeight().then(e=>a.value=e),e.patient.getInitialHeight().then(e=>o.value=e),e.patient.getInitialBMI().then(e=>r.value=e),e.patient.getInitialTBStatus().then(e=>l.value=e),e.patient.hasPregnancyAtARTInitiation().then(e=>s.value=e),e.patient.breastFeedingAtARTInitiation().then(e=>c.value=e),e.patient.everReceivedART().then(e=>d.value=e),e.patient.agreesToFollowUp().then(e=>u.value=e),e.patient.getReasonForStartingART().then(e=>m.value=e),e.patient.getHIVTestLocation().then(e=>p.value=e),e.patient.getStagingCondition().then(e=>O.value=e),e.patient.getWhoStage().then(e=>v.value=e),C(),I()};return Object(n["onMounted"])(()=>{D(),P["b"].on(R["a"].RELOAD_LATEST_VL_RESULT,()=>C()),P["b"].on(R["a"].RELOAD_STAGING_INFORMATION,()=>D())}),{patientInfo:V,onClickHandler:f,clickable:h}}});a("fcd8");const Ye=L()($e,[["render",He],["__scopeId","data-v-556ed409"]]);var ze=Ye;function Je(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-icon"),s=Object(n["resolveComponent"])("ion-button"),d=Object(n["resolveComponent"])("ion-buttons"),u=Object(n["resolveComponent"])("ion-toolbar"),m=Object(n["resolveComponent"])("ion-header"),b=Object(n["resolveComponent"])("TextInput"),p=Object(n["resolveComponent"])("ion-col"),O=Object(n["resolveComponent"])("DateInput"),g=Object(n["resolveComponent"])("SelectInput"),v=Object(n["resolveComponent"])("ion-row"),h=Object(n["resolveComponent"])("ion-grid"),f=Object(n["resolveComponent"])("ion-content"),j=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Edit Patient Demographics")]),_:1}),Object(n["createVNode"])(d,{slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{onClick:t[0]||(t[0]=t=>e.modal.hide())},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{slot:"icon-only",name:"close"})]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(f,{class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(h,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.patient.givenName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.patient.givenName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.patient.middleName,"onUpdate:modelValue":t[2]||(t[2]=t=>e.patient.middleName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.patient.familyName,"onUpdate:modelValue":t[3]||(t[3]=t=>e.patient.familyName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,{modelValue:e.patient.birthdate,"onUpdate:modelValue":t[4]||(t[4]=t=>e.patient.birthdate=t),allowEstimation:!0,estimationLabel:"Estimate Age",minDate:"1900-01-01",maxDate:e.today,onIsEstimated:t[5]||(t[5]=t=>e.isBirthdateEstimated=t)},null,8,["modelValue","maxDate"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,{modelValue:e.patient.gender,"onUpdate:modelValue":t[6]||(t[6]=t=>e.patient.gender=t),options:e.genderOptions},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.patient.cellPhoneNumber,"onUpdate:modelValue":t[7]||(t[7]=t=>e.patient.cellPhoneNumber=t),allowUnknown:""},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,{modelValue:e.patient.homeVillage,"onUpdate:modelValue":t[8]||(t[8]=t=>e.patient.homeVillage=t),asyncOptions:e.getVillagesByName,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,{modelValue:e.patient.landmark,"onUpdate:modelValue":t[9]||(t[9]=t=>e.patient.landmark=t),asyncOptions:e.getLandmarks,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(j,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{color:"primary",onClick:t[10]||(t[10]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Close")]),_:1}),Object(n["createVNode"])(s,{class:"ion-margin-end",color:"success",onClick:e.onFinish,slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Save")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var We=a("5713"),Qe=a("1f9a"),Ke=Object(n["defineComponent"])({components:{IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],TextInput:ne["a"],DateInput:I["a"],SelectInput:D["a"]},props:{patientService:{type:Object,required:!0}},setup(e){const t=N()().format(i["b"]),a=Object(n["ref"])(!1),o=Object(n["reactive"])({givenName:{label:"First Name",value:e.patientService.getGivenName(),placeholder:"First Name",required:!0,validation:e=>oe["a"].isName(e)},familyName:{label:"last Name",value:e.patientService.getFamilyName(),placeholder:"Last Name",required:!0,validation:e=>oe["a"].isName(e)},middleName:{label:"middle Name",value:e.patientService.getMiddleName(),placeholder:"middle Name",validation:e=>!!e&&oe["a"].isName(e)},gender:{value:e.patientService.getGender(),required:!0,label:"Gender",placeholder:"select gender"},birthdate:{value:e.patientService.getBirthdate(),label:"Date of Birth",placeholder:"Date of Birth",required:!0},cellPhoneNumber:{value:e.patientService.getPhoneNumber(),required:!0,label:"Cellphone Number",placeholder:"cellphone number e.g. 0991234567",validation:async e=>!("Unknown"===e.value||"N/A"===e.value)&&oe["a"].isMWPhoneNumber(e)},homeVillage:{value:e.patientService.getCurrentVillage(),label:"Home Village",placeholder:"Home Village",required:!0},landmark:{value:e.patientService.getClosestLandmark(),label:"Landmark",placeholder:"Closest Landmark or Plot Number",required:!0}}),r=async e=>{var t;const a={current_district:"N/A",current_traditional_authority:"N/A",current_village:e.label},n=null!==(t=e.other)&&void 0!==t&&t.traditional_authority_id?await We["a"].getTraditionalAuthorityById(e.other.traditional_authority_id):null;if(!Object(q["isEmpty"])(n)){a["current_traditional_authority"]=n[0].name;const e=await We["a"].getDistrictByID(n[0].district_id);Object(q["isEmpty"])(e)||(a["current_district"]=e[0].name)}return a},l=async()=>Object(A["e"])(o,async t=>{const a={};if(t.givenName!==e.patientService.getGivenName()&&(a["given_name"]=t.givenName),t.familyName!==e.patientService.getFamilyName()&&(a["family_name"]=t.familyName),t.middleName!==e.patientService.getMiddleName()&&(a["middle_name"]=t.middleName),t.birthdate!==e.patientService.getBirthdate()&&(a["birthdate"]=t.birthdate),t.gender.value!==e.patientService.getGender()&&(a["gender"]=t.gender.value),t.cellPhoneNumber!==e.patientService.getPhoneNumber()&&(a["cell_phone_number"]=t.cellPhoneNumber),t.landmark.label!==e.patientService.getClosestLandmark()&&(a["landmark"]=t.landmark.label),t.homeVillage!==e.patientService.getCurrentVillage()&&Object.assign(a,{...a,...await r(t.homeVillage)}),!Object(q["isEmpty"])(a)){const t=new Qe["a"];t.setPersonID(e.patientService.getID()),await t.updatePerson(a)}await k["a"].hide(),P["b"].emit(R["a"].RELOAD_PATIENT_DATA)});return{today:t,patient:o,getLandmarks:ie["e"],genderOptions:_["b"],isBirthdateEstimated:a,modal:k["a"],onFinish:l,getVillagesByName:ie["j"]}}});const Ze=L()(Ke,[["render",Je]]);var Xe=Ze;function et(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-icon"),s=Object(n["resolveComponent"])("ion-button"),d=Object(n["resolveComponent"])("ion-buttons"),u=Object(n["resolveComponent"])("ion-toolbar"),m=Object(n["resolveComponent"])("ion-header"),b=Object(n["resolveComponent"])("TextInput"),p=Object(n["resolveComponent"])("ion-col"),O=Object(n["resolveComponent"])("ion-row"),g=Object(n["resolveComponent"])("ion-grid"),v=Object(n["resolveComponent"])("ion-content"),h=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Add Guadian Demographics")]),_:1}),Object(n["createVNode"])(d,{slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{onClick:t[0]||(t[0]=t=>e.modal.hide())},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{slot:"icon-only",name:"close"})]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(v,{class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.guardian.givenName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.guardian.givenName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.guardian.familyName,"onUpdate:modelValue":t[2]||(t[2]=t=>e.guardian.familyName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.guardian.cellPhoneNumber,"onUpdate:modelValue":t[3]||(t[3]=t=>e.guardian.cellPhoneNumber=t),allowUnknown:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(h,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{color:"primary",onClick:t[4]||(t[4]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Close")]),_:1}),Object(n["createVNode"])(s,{class:"ion-margin-end",color:"success",onClick:e.onFinish,slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Save")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var tt=a("2cef"),at=Object(n["defineComponent"])({components:{IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],TextInput:ne["a"]},props:{patientId:{type:Number,required:!0}},setup(e){const t=Object(n["reactive"])({givenName:{label:"First Name",value:"",placeholder:"First Name",required:!0,validation:e=>oe["a"].isName(e)},familyName:{label:"Last Name",value:"",placeholder:"Last Name",required:!0,validation:e=>oe["a"].isName(e)},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",validation:async e=>"Unknown"!==e.value&&oe["a"].isMWPhoneNumber(e)}}),a=async()=>Object(A["e"])(t,async t=>{const a={home_district:"N/A",home_traditional_authority:"N/A",home_village:"N/A",current_district:"N/A",current_traditional_authority:"N/A",current_village:"N/A",middle_name:"",gender:"N/A",birthdate:"N/A",birthdate_estimated:"N/A",landmark:"N/A",relationship:"N/A",patient_type:"",isPatient:!1,patient_id:e.patientId,...t},n=new Qe["a"];await n.registerGuardian(a);const o=n.getPersonID();await tt["a"].createRelation(e.patientId,o,13),await k["a"].hide(),P["b"].emit(R["a"].RELOAD_GUARDIAN_DATA)},{underscoreKeys:!0});return{guardian:t,modal:k["a"],onFinish:a}}});const nt=L()(at,[["render",et]]);var ot=nt;function it(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-icon"),s=Object(n["resolveComponent"])("ion-button"),d=Object(n["resolveComponent"])("ion-buttons"),u=Object(n["resolveComponent"])("ion-toolbar"),m=Object(n["resolveComponent"])("ion-header"),b=Object(n["resolveComponent"])("text-input"),p=Object(n["resolveComponent"])("ion-col"),O=Object(n["resolveComponent"])("ion-row"),g=Object(n["resolveComponent"])("ion-grid"),v=Object(n["resolveComponent"])("ion-content"),h=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("ARV NUMBER")]),_:1}),Object(n["createVNode"])(d,{slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{onClick:t[0]||(t[0]=t=>e.modal.hide())},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{slot:"icon-only",name:"close"})]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(v,{class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.form.arvNumber,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.arvNumber=t),form:e.form,prefix:e.sitePrefix+"-ARV-"},null,8,["modelValue","form","prefix"])]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(h,{class:"ion-padding-horizontal"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{color:"primary",onClick:t[2]||(t[2]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Close")]),_:1}),e.hasValidARVNumber?(Object(n["openBlock"])(),Object(n["createBlock"])(s,{key:0,color:"danger",onClick:e.voidARV,slot:"start"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Void ARV Number")]),_:1},8,["onClick"])):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(s,{color:"success",onClick:e.onFinish,slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Save")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var rt=a("b211"),lt=a("cc74"),ct=Object(n["defineComponent"])({components:{IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],TextInput:ne["a"]},props:{patient:{type:Object,required:!0}},setup(e){const t=Object(n["ref"])(""),a=Object(n["computed"])(()=>e.patient.getArvNumber()),o=Object(n["computed"])(()=>!Object(q["isEmpty"])(a.value)&&"Unknown"!==a.value),i=Object(n["reactive"])({arvNumber:{value:o.value?a.value.split("-")[2]:"",label:(o.value?"Edit":"Add New")+" ARV Number",placeholder:"Enter ARV Number",required:!0,validation:async e=>{const n=oe["a"].isNumber(e,"POSITIVE_INTEGERS");if(null!==n)return n;if(e.value===a.value.split("-")[2])return null;const o=await v["a"].findByOtherID(4,`${t.value}-ARV-${e.value}`);return Object(q["isEmpty"])(o)?null:["ARV Number already exists"]}}}),r=async()=>Object(A["e"])(i,async n=>{n.arvNumber!==a.value.split("-")[2]&&(o.value?await e.patient.updateARVNumber(`${t.value}-ARV-${n.arvNumber}`):await e.patient.createArvNumber(`${t.value}-ARV-${n.arvNumber}`),P["b"].emit(R["a"].RELOAD_PATIENT_DATA)),await k["a"].hide()}),l=async()=>{const e=await Object(S["a"])(`Are you sure you want to void this ARV Number ${a.value}?`);if(e){await rt["a"].show("Voiding ARV Number...");try{await h["a"].voidARVNumber(a.value),await rt["a"].hide(),await k["a"].hide(),P["b"].emit(R["a"].RELOAD_PATIENT_DATA)}catch(t){await rt["a"].hide(),console.log(t)}}};return Object(n["onMounted"])(async()=>{t.value=await lt["b"].sitePrefix()}),{form:i,modal:k["a"],sitePrefix:t,arvNumber:a,hasValidARVNumber:o,onFinish:r,voidARV:l}}});const st=L()(ct,[["render",it]]);var dt=st,ut=a("6605"),mt=Object(n["defineComponent"])({components:{Layout:l["a"],VisitsSummary:ke,InformationHeader:ze},setup(){const e=Object(ut["h"])(),t=parseInt(e.params.patientId.toString())||0,a=Object(n["ref"])(),o=Object(n["ref"])(""),l=Object(n["ref"])(""),c=Object(n["computed"])(()=>!Object(q["isEmpty"])(a.value)),s=async()=>{if(t){const e=await fe.findByID(t);e&&(a.value=new fe(e))}},d=async()=>{const e=await r["a"].getGuardianDetails(t);l.value=e.map(e=>` ${e.name} (${e.relationshipType})`).join(", ")},u=async e=>{await k["a"].show(Xe,{patientService:a.value,attribute:e})},m=async()=>{await k["a"].show(ot,{patientId:t})},b=async()=>{await k["a"].show(dt,{patient:a.value})};return P["b"].on(R["a"].RELOAD_PATIENT_DATA,async()=>{await s()}),P["b"].on(R["a"].RELOAD_GUARDIAN_DATA,async()=>{await d()}),Object(n["onMounted"])(async()=>{var e;await s();const t=await(null===(e=a.value)||void 0===e?void 0:e.getARTStartDate());o.value=t?i["c"].toStandardHisDisplayFormat(t):"N/A",await d()}),{patient:a,artStartDate:o,guardians:l,isReady:c,updateDemographics:u,addGuardian:m,updateARVNumber:b}}});const bt=L()(mt,[["render",o]]);t["default"]=bt},"9c7b":function(e,t,a){},b515:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("14d9");var n=a("cc6f"),o=a("2ef0");class i extends n["a"]{constructor(e,t){super(e,6,t)}isNotEmptyandNumber(e){return(""+e.value).match(/^-?\d+\.?\d*$/)?null:["Invalid entry for "+e.label]}isNotEmptyandFloat(e){var t;return(""+e.value).match(/^\d{1,3}\.\d{1,5}$/)?null:[`Invalid entry for ${e.label}. Don't forget to add a decimal. e.g. 56.2 ${(null===(t=e.other)||void 0===t?void 0:t.modifier)||""}`]}checkMinMax(e,t,a){const n=[];var o,i;parseFloat(""+e.value)<t&&n.push([`${e.label} entered is less than minimum ${t} ${(null===e||void 0===e||null===(o=e.other)||void 0===o?void 0:o.modifier)||""}`]);parseFloat(""+e.value)>a&&n.push([`${e.label} entered is greater than maximum ${a} ${(null===e||void 0===e||null===(i=e.other)||void 0===i?void 0:i.modifier)||""}`]);return n.length>0?n:null}validateAll(e){const t=[];return e.map(e=>{const a=this.validator(e);return Object(o["isArray"])(a)?t.push(a):null}),t.length>0?t:null}mergeErrors(e){const t=[];return e.forEach(e=>{Object(o["isArray"])(e)&&t.push(e)}),t.length>0?t:null}isValidBPReading(e){const t=[],a=(""+e.value).match(/^\d{1,3}\/\d{1,3}$/g)?null:["Invalid BP reading"];if(t.push(a),null==a){const a=(""+e.value).split("/"),n={label:"Systolic",value:a[0]},o={label:"Diastolic",value:a[1]};t.push(this.checkMinMax(o,30,200)),t.push(this.checkMinMax(n,40,250))}return this.mergeErrors(t)}validator(e){const t=[{name:"Weight",validator:e=>{const t=this.isNotEmptyandFloat(e),a=this.checkMinMax(e,2,250);return this.mergeErrors([t,a])}},{name:"Height",validator:e=>{const t=[];return t.push(this.isNotEmptyandNumber(e)),t.push(this.checkMinMax(e,40,220)),this.mergeErrors(t)}},{name:"BP",validator:e=>this.isValidBPReading(e)},{name:"Temp",validator:e=>{const t=this.isNotEmptyandNumber(e),a=this.checkMinMax(e,30,42);return this.mergeErrors([t,a])}},{name:"SP02",validator:e=>{const t=this.checkMinMax(e,40,100);return this.mergeErrors([t])}},{name:"Pulse",validator:e=>{const t=this.checkMinMax(e,50,120);return this.mergeErrors([t])}}],a=t.filter(t=>t.name===e.label);return a.length>0?a[0].validator(e):null}}},b5b2:function(e,t,a){"use strict";var n;a.d(t,"a",(function(){return n})),function(e){e["RELOAD_PATIENT_DATA"]="reload_patient_data",e["RELOAD_PATIENT_VISIT_DATA"]="reload_patient_visit_data",e["RELOAD_GUARDIAN_DATA"]="reload_guardian_data",e["RELOAD_LATEST_VL_RESULT"]="reload_latest_vl_result",e["RELOAD_STAGING_INFORMATION"]="reload_staging_info",e["ON_CLEAR"]="on_clear",e["ON_INITIAL_VISIT_DATE"]="on_initital_visit_date"}(n||(n={}))},d10e:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a("ade3"),o=a("1c74");class i extends o["e"]{constructor(e){super(),Object(n["a"])(this,"person",void 0),this.person=e}create(){return o["e"].postJson("/people",this.person)}update(e){return o["e"].putJson("people/"+e,{...this.person,program_id:o["e"].getProgramID()})}static searchFamilyName(e){return super.getJson("/search/family_name",{search_string:e})}static searchGivenName(e){return super.getJson("/search/given_name",{search_string:e})}static async getPersonFullName(e){const t=await super.getJson(`/people/${e}/names`);return t&&t.length?t[0].given_name+" "+t[0].family_name:""}}},da44:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("d867");const o={async show(e,t,a="custom-modal",o=!0){const i=await n["modalController"].create({component:e,cssClass:a,backdropDismiss:o,componentProps:t});i.present();const{data:r}=await i.onWillDismiss();if(r)return r},async hide(e){await n["modalController"].dismiss(e)}}},dac2:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n,o=a("ade3"),i=(a("14d9"),a("71c3")),r=a("9283"),l=a("6d32"),c=a("2ef0"),s=a("cc6f");(function(e){e["CONTRAINDICATION"]="contraindication",e["SIDE_EFFECT"]="side_effect"})(n||(n={}));class d extends s["a"]{constructor(e,t){super(e,25,t),Object(o["a"])(this,"nextVisitInterval",void 0),Object(o["a"])(this,"fastTrack",void 0),Object(o["a"])(this,"regimenExtras",void 0),Object(o["a"])(this,"hangingPills",void 0),Object(o["a"])(this,"fastTrackMedications",void 0),Object(o["a"])(this,"medicationOrders",void 0),Object(o["a"])(this,"treatmentState",void 0),Object(o["a"])(this,"contraindications",void 0),Object(o["a"])(this,"sideEffects",void 0),Object(o["a"])(this,"tptPrescriptionCount",void 0),Object(o["a"])(this,"lastSideEffectDate",void 0),this.nextVisitInterval=0,this.fastTrack=!1,this.regimenExtras=[],this.fastTrackMedications=[],this.hangingPills=[],this.medicationOrders=[],this.treatmentState="",this.contraindications={},this.sideEffects={},this.tptPrescriptionCount=0,this.lastSideEffectDate=""}setNextVisitInterval(e){this.nextVisitInterval=e}getHangingPills(){return this.hangingPills}getMedicationOrders(){return this.medicationOrders.map(e=>s["a"].getCachedConceptName(e))}getTptPrescriptionCount(){return this.tptPrescriptionCount}getLastSideEffectDate(){return this.lastSideEffectDate}getContraindications(){return this.contraindications}getSideEffects(){return this.sideEffects}getRegimenExtras(){return this.regimenExtras}getPatientRegimens(){return l["a"].getRegimens(this.patientID)}getARVs(){return l["a"].getJson("arv_drugs")}getCustomIngridients(){return l["a"].getCustomIngridients()}getFastTrackMedications(){return this.fastTrackMedications}getTreatmentState(){return this.treatmentState}isFastTrack(){return this.fastTrack}medicationOrdersAvailable(){return!Object(c["isEmpty"])(this.medicationOrders)}shouldPrescribeArvs(){const e=s["a"].getCachedConceptID("Antiretroviral drugs");return this.medicationOrders.includes(e)}shouldPrescribeExtras(){const e=s["a"].getConceptsByCategory("art_extra_medication_order"),t=e.map(e=>this.medicationOrders.includes(e.concept_id));return t.some(Boolean)}getRegimenStarterpack(e,t){const a={weight:t,regimen:e};return s["a"].getJson(`programs/${s["a"].getProgramID()}/regimen_starter_packs`,a)}async getLvpDrugsByType(e,t){return s["a"].getJson(`programs/${s["a"].getProgramID()}/regimens/${t}`,{patient_id:this.patientID,lpv_drug_type:e})}async loadContraindications(){const e=await s["a"].getConceptID("Contraindications"),t=await s["a"].getObs({concept_id:e,person_id:this.patientID});t.forEach(e=>{const t=r["c"].toStandardHisFormat(e.obs_datetime);this.contraindications[t]||(this.contraindications[t]=[]);const a=s["a"].getCachedConceptName(e.value_coded);this.contraindications[t].push(a)})}async loadDrugInduced(){const e=await s["a"].getConceptID("Drug induced"),t=await s["a"].getObs({concept_id:e,person_id:this.patientID});t&&t.forEach(e=>{const t=r["c"].toStandardHisFormat(e.obs_datetime);if(this.lastSideEffectDate||(this.lastSideEffectDate=t),!e.value_drug||!e.value_coded)return;this.sideEffects[t]||(this.sideEffects[t]={}),this.sideEffects[t][e.value_drug]||(this.sideEffects[t][e.value_drug]=[]);const a=s["a"].getCachedConceptName(e.value_coded);this.sideEffects[t][e.value_drug].push(a)})}async loadTptPrescriptionCount(){const e=await s["a"].getJson("tpt_prescription_count",{patient_id:this.patientID,date:this.date});if(e){const t=e.count+1;this.tptPrescriptionCount=t>3?3:t}}async loadFastTrackStatus(){const e=await s["a"].getFirstValueCoded(this.patientID,"Fast track"),t=await s["a"].getConceptID("yes");e&&(this.fastTrack=e===t)}async loadRegimenExtras(e=this.date){const t=await l["a"].getJson(`programs/${l["a"].getProgramID()}/patients/${this.patientID}/dosages`,{date:e});t&&(this.regimenExtras=Object.values(t))}async loadMedicationOrders(){const e=await s["a"].getConceptID("Medication orders"),t=await s["a"].getObs({concept_id:e,date:this.date,person_id:this.patientID,page_size:5});this.medicationOrders=t.map(e=>e.value_coded)}async loadHangingPills(){const e=await s["a"].getAll(this.patientID,"Pills brought");e&&(this.hangingPills=e.filter(e=>e.value_numeric>=1&&e.order).map(e=>e.order.drug_order.drug_inventory_id))}async loadFastTrackMedications(){const e=await i["a"].getLastDrugsReceived(this.patientID),t=e.map(async e=>{const{drug:t}=e,a=await i["a"].getDrugDosages(this.patientID,t.drug_id);return{drug_id:t.drug_id,drug_name:t.name,units:t.units,am:a.am,noon:a.noon,pm:a.pm,frequency:e.frequency}});this.fastTrackMedications=await Promise.all(t)}async loadTreatmentState(){const e={date:this.date},t=await s["a"].getJson(`programs/${s["a"].getProgramID()}/patients/${this.patientID}/status`,e);t&&(this.treatmentState=t["status"])}findAndGroupDrugSideEffects(e){const t={};for(const a in this.sideEffects){const n=this.sideEffects[a];for(const o in n)e.includes(parseInt(o))&&(t[a]||(t[a]=[]),t[a]=[...t[a],...n[o]])}return t}calculatePillsPerDay(e,t,a){return parseFloat(e.toString())+t+a}estimatePackSize(e,t=0){const a=e*this.nextVisitInterval/t;let n=Math.round(a);return n<=0&&(n+=1),n}calculateDosage(e,t){let a=0;return 0===t&&(a=e),0==e&&(a=t),e>0&&t>0&&(a=(e+t)/2),a}calculateEquivalentDosage(e,t){return e+t}calculateDateFromInterval(){const e=new Date(this.date);return e.setDate(e.getDate()+this.nextVisitInterval),r["c"].toStandardHisFormat(e)}getDrugPackSize(e){if(e.pack_size)return e.pack_size;try{return e.barcodes[0].tabs}catch(t){return 30}}getInstructions(e,t,a,n){return`${e} :- Morning: ${t} ${n}, Evening: ${a} ${n}`}toOrderObj(e,t,a,n=0,o=0,i=""){return{drug_inventory_id:e,equivalent_daily_dose:this.calculateEquivalentDosage(n,o),start_date:this.date,auto_expire_date:this.calculateDateFromInterval(),units:a,instructions:this.getInstructions(t,n,o,a),dose:this.calculateDosage(n,o),frequency:i}}async getReasonForRegimenSwitch(){const e=await s["a"].getFirstValueText(this.patientID,"Reason for ARV switch");return e||"N/A"}async createDrugOrder(e){return i["a"].create({encounter_id:this.encounterID,drug_orders:e})}async createHangingPillsObs(e){return this.saveValueTextObs("appointment type",e)}async createRegimenSwitchObs(e){return this.saveValueTextObs("Reason for ARV switch",e)}}},fcd8:function(e,t,a){"use strict";a("00a4")}}]);
//# sourceMappingURL=chunk-562939e0.e486bf17.js.map