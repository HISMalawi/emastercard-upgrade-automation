(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4483f0f2"],{2048:function(e,t,a){"use strict";var n=a("7a23");function r(e,t,a,r,o,l){const i=Object(n["resolveComponent"])("v2Datatable"),u=Object(n["resolveComponent"])("ion-page");return Object(n["openBlock"])(),Object(n["createBlock"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(i,{title:e.title,subtitle:e.subtitle,columnData:e.reportData,columns:e.columns,"on-finish":e.onFinish,rowsPerPage:e.ITEMS_PER_PAGE},null,8,["title","subtitle","columnData","columns","on-finish","rowsPerPage"])]),_:1})}a("14d9");var o=a("d867"),l=a("99ae"),i=a("6605"),u=a("2ef0"),s=a("8734"),c=a("23e6"),d=a("0011");const p=20;var m=Object(n["defineComponent"])({props:{title:{type:String,default:"Drilldown"},patientIdentifiers:{type:Object},onFinish:{type:Function}},components:{IonPage:o["IonPage"],v2Datatable:l["a"]},setup(e){const t=Object(n["ref"])("-"),a=Object(n["ref"])([]),r=Object(i["i"])(),o=[[{label:"National ID",ref:"national_id"},{label:"First name",ref:"given_name"},{label:"Last name",ref:"family_name"},{label:"Birthdate",ref:"birthdate"},{label:"Action",ref:"patient_id",exportable:!1,tdClick:({data:e})=>r.push({path:"/patient/dashboard/"+e.patient_id}),value:()=>"View client"}]];return Object(n["watch"])(()=>e.patientIdentifiers,async e=>{if(a.value=[],t.value="Total: 0",!e||!e.length)return;const n=Object(u["chunk"])(e,p);for(const o of n){for(const n of o){try{const e=new c["a"](await c["a"].findByID(n));a.value.push({patient_id:e.getID(),national_id:e.getNationalID(),given_name:e.getGivenName(),family_name:e.getFamilyName(),birthdate:Object(d["f"])(e.getBirthdate())})}catch(r){console.error(r),a.value.push({})}t.value=`Total: ${a.value.length} of ${(e||[]).length}`}await Object(s["a"])(500)}},{immediate:!0}),{columns:o,subtitle:t,reportData:a,ITEMS_PER_PAGE:p}}}),f=a("d959"),b=a.n(f);const _=b()(m,[["render",r]]);t["a"]=_},"6be2":function(e,t,a){"use strict";a.d(t,"d",(function(){return o})),a.d(t,"g",(function(){return l})),a.d(t,"f",(function(){return i})),a.d(t,"e",(function(){return u})),a.d(t,"c",(function(){return s})),a.d(t,"b",(function(){return c})),a.d(t,"h",(function(){return p})),a.d(t,"a",(function(){return m}));var n=a("3800");const r=[n["m"],[["","Delete"]]],o=[n["j"],[["Delete"]]],l=[n["j"],[["Delete","Unknown"]]],i=[n["j"],[["N/A"],["Delete","Unknown"]]],u=[n["j"],[["Delete"]]],s=[n["j"],[["Unknown","Delete"],["Qwerty","A-Z"]]],c=[n["h"],[["Unknown"]]],d=[n["a"],[["0-9","Delete"],["Qwerty","Unknown"],["","Space"]]],p=[n["l"],[["","Delete"],["?123","0-9"],["Space","Unknown"]]],m=[{btn:"0-9",keyboard:s},{btn:"?123",keyboard:r},{btn:"A-Z",keyboard:d},{btn:"Qwerty",keyboard:p}]},"775a":function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,r,o=a("d95e"),l=a("1c74"),i=a("b446"),u=a("0011"),s=a("c731"),c=a("b5e4"),d=a("d867"),p=a("7a23"),m=a("2706");(function(e){e["MULTI_FIELD_DATE"]="Multipage date fields",e["CALENDAR_FIELD"]="Calendar",e["SINGLE_DATE_INPUT_FIELD"]="Single page date"})(n||(n={})),function(e){e["PERIOD_INPUT_TYPE"]="hts_report_date_period_type"}(r||(r={}));const f=Object(p["reactive"])({datePeriodInputType:localStorage.getItem(r.PERIOD_INPUT_TYPE)||n.MULTI_FIELD_DATE});function b(e){Object(s["a"])([...Object(i["b"])({id:"start_date",helpText:"Start",required:!0,minDate:()=>(null===e||void 0===e?void 0:e.minDate)||"",maxDate:()=>(null===e||void 0===e?void 0:e.maxDate)||l["e"].getSessionDate(),condition:()=>f.datePeriodInputType===n.MULTI_FIELD_DATE,estimation:{allowUnknown:!1},computeValue:e=>e}),...Object(i["b"])({id:"end_date",helpText:"End",required:!0,minDate:(e,t)=>t.start_date,maxDate:()=>(null===e||void 0===e?void 0:e.maxDate)||l["e"].getSessionDate(),condition:()=>f.datePeriodInputType===n.MULTI_FIELD_DATE,estimation:{allowUnknown:!1},computeValue:e=>e}),{id:"alt_start_date",proxyID:"start_date",helpText:"Start Date",type:o["b"].TT_FULL_DATE,validation:t=>{if(!t)return["Date is required"];const a=e.maxDate||l["e"].getSessionDate();return e.minDate&&new Date(t.value)<new Date(e.minDate)?[`${Object(u["f"])(""+t.value)} is less than minimum date of ${Object(u["f"])(e.minDate)}`]:a&&new Date(t.value)>new Date(a)?[`${Object(u["f"])(""+t.value)} is greater than max date of ${Object(u["f"])(a)}`]:null},computedValue:e=>e.value,condition:()=>f.datePeriodInputType===n.SINGLE_DATE_INPUT_FIELD},{id:"alt_end_date",proxyID:"end_date",helpText:"End Date",type:o["b"].TT_FULL_DATE,defaultValue:e=>e.start_date.value,validation:(t,a)=>{if(!t)return["Date is required"];const n=e.maxDate||l["e"].getSessionDate();return a.start_date.value&&new Date(t.value)<new Date(a.start_date.value)?[`${Object(u["f"])(""+t.value)} is less than minimum date of ${Object(u["f"])(a.start_date.value)}`]:n&&new Date(t.value)>new Date(n)?[`${Object(u["f"])(""+t.value)} is greater than max date of ${Object(u["f"])(n)}`]:null},computedValue:e=>e.label,condition:()=>f.datePeriodInputType===n.SINGLE_DATE_INPUT_FIELD},{id:"calendar_start_date",proxyID:"start_date",helpText:"Start Date",type:o["b"].TT_DATE_PICKER,computedValue:e=>e,condition:()=>f.datePeriodInputType===n.CALENDAR_FIELD,validation:e=>m["a"].required(e),config:{minDate:()=>e.minDate||null,maxDate:()=>e.maxDate||l["e"].getSessionDate(),infoItems:(e,t)=>[{label:"Start Date",value:Object(u["f"])(e)||"-"},{label:"End Date",value:Object(u["f"])(t.end_date)||"-"}],persistInfoItems:!1}},{id:"calendar_end_date",proxyID:"end_date",helpText:"End Date",type:o["b"].TT_DATE_PICKER,validation:e=>m["a"].required(e),defaultValue:e=>e.start_date.value,computedValue:e=>e,condition:()=>f.datePeriodInputType===n.CALENDAR_FIELD,config:{minDate:e=>e.start_date.value,maxDate:()=>e.maxDate||l["e"].getSessionDate(),infoItems:(e,t)=>[{label:"Start Date",value:Object(u["f"])(t.start_date)||"-"},{label:"End Date",value:Object(u["f"])(e)}],persistInfoItems:!1}}],async(t,a)=>{console.log(a),d["modalController"].dismiss();try{const t=`${Object(u["f"])(a.start_date)} to ${Object(u["f"])(a.end_date)}`;e.onFinish(a.start_date,a.end_date,t)}catch(n){Object(c["c"])("An error has occurred")}})}},a1b8:function(e,t,a){"use strict";a.r(t);var n=a("7a23");function r(e,t,a,r,o,l){const i=Object(n["resolveComponent"])("ion-loading"),u=Object(n["resolveComponent"])("v2Datatable"),s=Object(n["resolveComponent"])("ion-page");return Object(n["openBlock"])(),Object(n["createBlock"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(i,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),Object(n["createVNode"])(u,{title:"CXCA TX Report",subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:25,onConfigure:e.configure,csvQuarter:e.csvQuarter,onRefresh:()=>e.generate()},null,8,["subtitle","columns","columnData","onConfigure","csvQuarter","onRefresh"])]),_:1})}var o=a("d867"),l=a("99ae"),i=a("ad9e"),u=a("775a"),s=a("b5e4"),c=a("2048"),d=a("0011");const p=Object(n["ref"])([]),m=Object(n["ref"])(""),f=Object(n["ref"])(""),b=Object(n["ref"])(""),_=Object(n["ref"])(!1),v=Object(n["ref"])("");var h=Object(n["defineComponent"])({components:{IonPage:o["IonPage"],IonLoading:o["IonLoading"],v2Datatable:l["a"]},setup(){const e=async(e,t)=>{(await o["modalController"].create({component:c["a"],backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e,subtitle:b,patientIdentifiers:t,onFinish:()=>o["modalController"].getTop().then(e=>e&&o["modalController"].dismiss())}})).present()},t=[[{label:"#",ref:"index",span:{thRowspan:2}},{label:"Age group",ref:"age_group",span:{thRowspan:2}},{label:"Gender",ref:"gender",exportable:!1,span:{thRowspan:2}},{label:"1st time screened",ref:"",span:{thColspan:3}},{label:"Rescreened after previous negative",ref:"",span:{thColspan:3}},{label:"Post-treatment follow-up",ref:"",span:{thColspan:3}}],[{label:"Cryotherapy",ref:"first_time_screened_cryotherapy",secondaryLabel:"1st screened (cryotherapy)",value:e=>e.first_time_screened.cryotherapy.length,tdClick:({column:t,data:a})=>e(`${a.age_group} ${t.secondaryLabel}`,a.first_time_screened.cryotherapy)},{label:"Thermocoagulation",ref:"first_time_screened_thermocoagulation",secondaryLabel:"1st time screened (Thermocoagulation)",value:e=>e.first_time_screened.thermocoagulation.length,tdClick:({column:t,data:a})=>e(`${a.age_group} ${t.secondaryLabel}`,a.first_time_screened.thermocoagulation)},{label:"LEEP",ref:"first_time_screened_leep",secondaryLabel:"1st screened(leep)",value:e=>e.first_time_screened.leep.length,tdClick:({column:t,data:a})=>e(`${a.age_group} ${t.secondaryLabel}`,a.first_time_screened.leep)},{label:"Cryotherapy",ref:"post_treatment_followup_cryotherapy",secondaryLabel:"Post-treatment followup(Cryotherapy)",value:e=>e.post_treatment_followup.cryotherapy.length,tdClick:({column:t,data:a})=>e(`${a.age_group} ${t.secondaryLabel}`,a.post_treatment_followup.cryotherapy)},{label:"Thermocoagulation",ref:"post_treatment_followup_thermocoagulation",secondaryLabel:"Post-treatment followup (Thermocoagulation)",value:e=>e.post_treatment_followup.thermocoagulation.length,tdClick:({column:t,data:a})=>e(`${a.age_group} ${t.secondaryLabel}`,a.post_treatment_followup.thermocoagulation)},{label:"LEEP",ref:"post_treatment_followup_leep",secondaryLabel:"Post-treatment followup (leep)",value:e=>e.post_treatment_followup.leep.length,tdClick:({column:t,data:a})=>e(`${a.age_group} ${t.secondaryLabel}`,a.post_treatment_followup.leep)},{label:"Cryotherapy",ref:"rescreened_after_prev_visit_cryotherapy",secondaryLabel:"Rescreen after prev visit (Cryotherapy)",value:e=>e.rescreened_after_prev_visit.cryotherapy.length,tdClick:({column:t,data:a})=>e(`${a.age_group} ${t.secondaryLabel}`,a.rescreened_after_prev_visit.cryotherapy)},{label:"Thermocoagulation",ref:"rescreened_after_prev_visit_thermocoagulation",secondaryLabel:"Rescreen after prev visit (Thermocoagulation)",value:e=>e.rescreened_after_prev_visit.thermocoagulation.length,tdClick:({column:t,data:a})=>e(`${a.age_group} ${t.secondaryLabel}`,a.rescreened_after_prev_visit.thermocoagulation)},{label:"LEEP",ref:"rescreened_after_prev_visit_leep",secondaryLabel:"Rescreen after prev visit (leep)",value:e=>e.rescreened_after_prev_visit.leep.length,tdClick:({column:t,data:a})=>e(`${a.age_group} ${t.secondaryLabel}`,a.rescreened_after_prev_visit.leep)}]],a=async()=>{if(!m.value||!f.value)return Object(s["e"])("Start date and end date required!");_.value=!0,p.value=[];const e=new i["a"];e.startDate=m.value,e.endDate=f.value;try{p.value=(await e.getClinicReport("CXCA TX")).slice(5).map((e,t)=>(e.index=t+1,e.gender="Female",e))}catch(t){Object(s["c"])("Unable to generate report!")}_.value=!1},r=()=>Object(u["a"])({onFinish:(e,t,n)=>{m.value=e,f.value=t,b.value=`Period (${n})`,v.value=`${Object(d["f"])(m.value)} to ${Object(d["f"])(f.value)}`,a()}});return Object(n["onMounted"])(()=>!p.value.length&&r()),{columns:t,isLoading:_,reportData:p,period:b,csvQuarter:v,generate:a,configure:r}}}),D=a("d959"),g=a.n(D);const y=g()(h,[["render",r]]);t["default"]=y},ad9e:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a("ade3"),r=(a("14d9"),a("1c74")),o=a("9283");class l extends r["e"]{constructor(){super(),Object(n["a"])(this,"programID",void 0),Object(n["a"])(this,"startDate",void 0),Object(n["a"])(this,"endDate",void 0),Object(n["a"])(this,"date",void 0),this.endDate="",this.startDate="",this.date=r["e"].getSessionDate(),this.programID=r["e"].getProgramID()}getPepfarReport(e){return this.getReport("pepfar_cxca",{report_name:e})}getClinicReport(e){return this.getReport("screened_for_cxca",{report_name:e})}getMohReport(e){return this.getReport("screened_for_cxca",{report_name:e})}getDateIntervalPeriod(){return`${o["c"].toStandardHisDisplayFormat(this.startDate)} - ${o["c"].toStandardHisDisplayFormat(this.endDate)}`}setStartDate(e){this.startDate=e}setEndDate(e){this.endDate=e}getReportPeriod(){return this.startDate&&this.endDate?`${o["c"].toStandardHisDisplayFormat(this.startDate)} - ${o["c"].toStandardHisDisplayFormat(this.endDate)}`:"-"}getReport(e,t={}){return r["e"].getJson(e,this.buildRequest(t))}buildRequest(e={}){const t={date:this.date,program_id:24};return this.startDate&&this.endDate&&(t["start_date"]=this.startDate,t["end_date"]=this.endDate),{...t,...e}}static getReportQuarters(e=4){const t=[];let a=o["c"].getCurrentYear();for(let n=0;n<e;++n)t.push({name:"Q4 "+a,start:a+"-10-01",end:a+"-12-31"}),t.push({name:"Q3 "+a,start:a+"-07-01",end:a+"-09-30"}),t.push({name:"Q2 "+a,start:a+"-04-01",end:a+"-06-30"}),t.push({name:"Q1 "+a,start:a+"-01-01",end:a+"-03-31"}),--a;return t}}},b446:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return T}));a("14d9"),a("13d5");var n,r=a("d95e"),o=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}],l=a("9283"),i=a("2706"),u=a("3800"),s=a("6be2"),c=a("5a0c"),d=a.n(c),p=a("1c74");function m(e,t,a=!0){const n=[];return a&&n.push("UNKNOWN"),{id:e,helpText:t+" Year",appearInSummary:()=>!1,type:r["b"].TT_TEXT,config:{customKeyboard:[u["j"],[n,["DELETE"]]]}}}function f(e,t){return{id:e,helpText:t+" Month",appearInSummary:()=>!1,type:r["b"].TT_SELECT,options:()=>o}}function b(e,t){return{id:e,helpText:t+" Day",type:r["b"].TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function _(e,t){return{id:e,helpText:t+" Estimated period",type:r["b"].TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function v(e,t){return{id:e,helpText:t+" Age Estimate",type:r["b"].TT_NUMBER,appearInSummary:()=>!1,config:{keypad:s["e"]}}}function h(e){return parseInt(e)<10?"0"+e:e}async function D(e,t,a){if(t.defaultValue){const n=await t.defaultValue(e);if(n){const[e,t,r]=n.split("-");switch(a){case"Year":return e||"";case"Month":return parseInt(t)||"";case"Day":return parseInt(r)||""}}}return""}function g(e){return l["c"].toStandardHisDisplayFormat(e)}function y(e,t,a,n){if(t.minDate){const r=t.minDate(a,n);if(new Date(e)<new Date(r))return[`${g(e)} is less than minimum date of ${g(r)}`]}if(t.maxDate){const r=t.maxDate(a,n);if(r&&new Date(e)>new Date(r))return[`${g(e)} is greater than max date of  ${g(r)}`]}}function T(e,t=""){let a="",r="",u="",s="",c=!1;const T="year_"+e.id,I="month_"+e.id,w="day_"+e.id,E="age_estimate_"+e.id,x="duration_estimate_"+e.id,O=m(T,e.helpText,e.estimation.allowUnknown),j=f(I,e.helpText),$=b(w,e.helpText),L=v(E,e.helpText),k=_(x,e.helpText),S="boolean"===typeof e.estimation.allowUnknownMonthDay&&e.estimation.allowUnknownMonthDay,C=t=>!(t[T]&&t[T].value&&["Unknown"].includes(t[T].value))&&(!e.condition||e.condition(t)),P=(e,t)=>{const a=[{type:"year",value:r,default:"YYYY"},{type:"month",value:u,default:"MM"},{type:"day",value:s,default:"DD"}];return a.reduce((a,n)=>{const r=[null,void 0,"Unknown",""];return t===n.type?r.includes(e)?a.push(n.default):a.push(e):r.includes(n.value)?a.push(n.default):a.push(n.value),a},[]).join("-")};"function"===typeof e.init&&(O.init=e.init),O.updateHelpTextOnValue=e=>`${O.helpText} (${P(null===e||void 0===e?void 0:e.label,"year")})`,O.proxyID=e.id,O.unload=e=>r=e.value.toString(),O.config={...O.config,...e.config},O.defaultValue=t=>D(t,e,"Year"),O.condition=t=>!e.condition||e.condition(t),O.validation=(t,a,n)=>{if(e.required&&i["a"].required(t))return["Year cannot be empty"];const r=t?t.value:"";if(!e.estimation.allowUnknown&&r.toString().match(/unknown/i))return["Value unknown is not permitted"];if(r&&!["Unknown"].includes(r)&&isNaN(r)||r<1900)return["Invalid Year"];if(r&&"function"===typeof e.minDate){const t=l["c"].getYear(e.minDate(a,n));if(parseInt(r)<t)return[`Year of ${r} is less than Minimum year of ${t}`]}if(r&&"function"===typeof e.maxDate){const t=e.maxDate(a,n);if(t&&r>l["c"].getYear(t))return[`Year of ${r} exceeds Maximum year of ${l["c"].getYear(t)}`]}return null},O.summaryMapValue=()=>({label:e.summaryLabel||e.helpText,value:a?g(a):"Unknown"}),O.appearInSummary=(t,a)=>a===e.id,O.computedValue=t=>{if(a){const[n,r,o]=a.split("-");return a=`${t.value}-${r}-${o}`,e.computeValue(a,!1)}if(t&&"Unknown"===t.value)return a="",e.computeValue("Unknown",!1)},j.updateHelpTextOnValue=e=>`${j.helpText} (${P(null===e||void 0===e?void 0:e.label,"month")})`,j.proxyID=e.id,j.unload=e=>u=h(e.value.toString()),j.condition=e=>C(e),j.validation=e=>i["a"].required(e),j.defaultValue=t=>D(t,e,"Month"),S&&(j.options=()=>[...o,{label:"Unknown",value:"Unknown"}]),j.computedValue=(t,n)=>{if((""+t.value).match(/unknown/i))return a=n[T].value+"-07-15",e.computeValue(a,!0);if(a){const[n,r,o]=a.split("-"),l=h(""+t.value);return a=`${n}-${l}-${o}`,e.computeValue(a,!1)}},$.proxyID=e.id,$.updateHelpTextOnValue=e=>`${$.helpText} (${P(null===e||void 0===e?void 0:e.label,"day")})`,$.condition=e=>!(""+e[I].value).match(/unknown/i)&&C(e),$.validation=(t,n,o)=>i["a"].required(t)?["Day is required for date"]:(c=!!(""+t.value).match(/unknown/i),s=c?"15":h(""+t.value),a=`${r}-${u}-${s}`,y(a,e,n,o)),$.defaultValue=t=>D(t,e,"Day"),$.computedValue=()=>e.computeValue(a,c),$.unload=(t,a,n,r)=>{e.unload&&e.unload(t,a,n,r)},$.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),$.config={year:e=>e[T].value,month:e=>e[I].value},S||($.config.keyboardActions=[]);const N=(t,a)=>{const n=["Unknown"===t[T].value,!e.condition||e.condition(t),e.estimation.estimationFieldType===a];return n.every(Boolean)};return L.proxyID=e.id,L.validation=(t,n,r)=>{if(t&&t.value>300)return["Age estimate is too high and exceeding hard limit of 300"];if(isNaN(parseInt(t.value.toString())))return["Please enter a valid number"];const o=/^(12[0-7]|1[01][0-9]|[1-9]?[0-9])$/;if(!t.value.toString().match(o))return["Not a valid age estimate"];const l=d()(p["e"].getSessionDate()).subtract(t.value,"years").year();return a=l+"-07-15",y(a,e,n,r)},L.condition=e=>N(e,n.AGE_ESTIMATE_FIELD),L.computedValue=()=>e.computeValue(a,!0),L.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),k.proxyID=e.id,k.validation=(t,n,r)=>i["a"].required(t)?["Please select an estimate"]:(a=d()(p["e"].getSessionDate()).subtract(t.value,"day").format(l["b"]),y(a,e,n,r)),k.condition=e=>N(e,n.MONTH_ESTIMATE_FIELD),k.computedValue=()=>e.computeValue(a,!0),k.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),[O,j,$,L,k]}(function(e){e["AGE_ESTIMATE_FIELD"]="age-estimate-field",e["MONTH_ESTIMATE_FIELD"]="month-period-estimate-field"})(n||(n={}))}}]);
//# sourceMappingURL=chunk-4483f0f2.cfe22211.js.map