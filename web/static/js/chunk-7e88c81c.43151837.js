(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e88c81c"],{"18cf":function(t,e,a){"use strict";a("b03f")},3800:function(t,e,a){"use strict";a.d(e,"d",(function(){return i})),a.d(e,"l",(function(){return n})),a.d(e,"f",(function(){return s})),a.d(e,"o",(function(){return o})),a.d(e,"e",(function(){return r})),a.d(e,"b",(function(){return l})),a.d(e,"n",(function(){return c})),a.d(e,"k",(function(){return d})),a.d(e,"j",(function(){return u})),a.d(e,"h",(function(){return h})),a.d(e,"a",(function(){return p})),a.d(e,"m",(function(){return g})),a.d(e,"c",(function(){return m})),a.d(e,"i",(function(){return b})),a.d(e,"g",(function(){return f}));const i=[["1","2","3"],["4","5","6"],["7","8","9"],[".","0","Del"],["","Done",""]],n=[["1","2","3"],["4","5","6"],["7","8","9"],["Del","0","."],["Unknown","",""]],s=[["1","2","3"],["4","5","6"],["7","8","9"],[".","0",""]],o=[["1","2","3"],["4","5","6"],["7","8","9"],[".","0","Del"],["Clear","%","/"]],r=[["1","2","3"],["4","5","6"],["7","8","9"],["Del.","0","Clear"]],l=[["1","2","3","<"],["4","5","6",">"],["7","8","9","="],["","0",""]],c=[["1","2","3","+","-","/","*"],["4","5","6","%","=","<",">","Qwerty"],["7","8","9",".",","],["","0",""]],d=[["1","2","3"],["4","5","6"],["7","8","9"],["","0",""]],u=[["1","2","3"],["4","5","6"],["7","8","9"],["←","0","→"]],h=[["1","2","3","4","5","6","7"],["8","9","10","11","12","13","14"],["15","16","17","18","19","20","21"],["22","23","24","25","26","27","28"],["29","30","31"]],p=[["a","b","c","d","e","f","g","h","."],["i","j","k","l","m","n","o","p","q"],["r","s","t","u","v","w","x","y","z"]],g=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","'"],["z","x","c","v","b","n","m",",",".","A-Z"]],m=[["1","2","3","4","5","6","7","8","9","0"],["a","b","c","d","e","f","g","h","-","."],["i","j","k","l","m","n","o","p","q"],["r","s","t","u","v","w","x","y","z"]],b=[["1","2","3","4","5","6","7","8","9","0","Del"],["q","w","e","r","t","y","u","i","o","p","Clear"],["a","s","d","f","g","h","j","k","l",".","Caps"],["z","x","c","v","b","n","m","<",">","/","Enter"]],f=[["1","2","3","4","5","6","7","8","9","0"],["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","Del."],["z","x","c","v","b","n","m","Caps","Login"]]},"5f2c":function(t,e,a){"use strict";a.d(e,"a",(function(){return u}));var i=a("ade3"),n=(a("14d9"),a("cc6f")),s=a("71c3"),o=a("1c74"),r=a("2ef0");class l extends o["e"]{constructor(){super()}static async fetchAvailableDrugStock(t){const e=await this.getJson("pharmacy/items",{drug_id:t});if(!Object(r["isEmpty"])(e))return e.map(t=>({quantity:t.current_quantity,packSize:t.pack_size}))}}var c=a("d1ca");const d={11:[30],21:[25],22:[60],24:[30,60,90,100],30:[90],39:[60],73:[120],74:[60],76:[1e3],297:[30,60,90],576:[30,60,90],613:[60],731:[60],732:[60],733:[60],734:[30],735:[30],736:[60],738:[60],931:[12,30,60],932:[30],954:[60],963:[30,60,90],968:[60],969:[30],971:[30,60,90],976:[60],977:[30],982:[30],983:[30,90],1039:[30,60,90],1043:[60],1044:[30],1056:[24],1216:[3,6,8,12]};class u extends n["a"]{constructor(t,e){super(t,54,e),Object(i["a"])(this,"drugHistory",void 0),Object(i["a"])(this,"currentDrugOrder",void 0),Object(i["a"])(this,"useDrugManagement",void 0),this.drugHistory=[],this.currentDrugOrder=[],this.useDrugManagement=!1}setIsDrugManagementEnabled(t){this.useDrugManagement=t}async loadDrugManagementEnabled(){this.useDrugManagement=await c["b"].drugManagementEnabled()}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}buildDispensations(t,e,a){const i=[];for(let n=0;n<a;n++)i.push({drug_order_id:t,date:this.date,quantity:e/a});return i}saveDispensations(t){return n["a"].postJson("/dispensations",{dispensations:t,program_id:n["a"].getProgramID()})}async voidOrder(t){return n["a"].void("/dispensations/"+t,{})}async loadDrugHistory(){try{this.drugHistory=await s["a"].getDrugOrderHistory(this.patientID)||[]}catch(t){console.warn(t)}}async loadCurrentDrugOrder(){if(this.currentDrugOrder=await s["a"].getDrugOrders(this.patientID)||[],this.useDrugManagement)for(const t of this.currentDrugOrder)t.stocks=await l.fetchAvailableDrugStock(t.drug.drug_id)}getDrugPackSizes(t){return t in d?d[t]:[30,60,90]}calcCompletePack(t,e){const a=t.barcodes.sort((t,e)=>t.tabs-e.tabs);if(0==a.length||0==e)return e;for(const n in a){const{tabs:t}=a[n];if(parseInt(t)>=e)return t}const i=parseInt(a[a.length-1].tabs);return i}}},"6be2":function(t,e,a){"use strict";a.d(e,"d",(function(){return s})),a.d(e,"g",(function(){return o})),a.d(e,"f",(function(){return r})),a.d(e,"e",(function(){return l})),a.d(e,"c",(function(){return c})),a.d(e,"b",(function(){return d})),a.d(e,"h",(function(){return h})),a.d(e,"a",(function(){return p}));var i=a("3800");const n=[i["n"],[["","Delete"]]],s=[i["k"],[["Delete"]]],o=[i["k"],[["Delete","Unknown"]]],r=[i["k"],[["N/A"],["Delete","Unknown"]]],l=[i["k"],[["Delete"]]],c=[i["k"],[["Unknown","Delete"],["Qwerty","A-Z"]]],d=[i["h"],[["Unknown"]]],u=[i["a"],[["0-9","Delete"],["Qwerty","Unknown"],["","Space"]]],h=[i["m"],[["","Delete"],["?123","0-9"],["Space","Unknown"]]],p=[{btn:"0-9",keyboard:c},{btn:"?123",keyboard:n},{btn:"A-Z",keyboard:u},{btn:"Qwerty",keyboard:h}]},"6c3f":function(t,e,a){"use strict";a.r(e);var i=a("7a23");function n(t,e,a,n,s,o){const r=Object(i["resolveComponent"])("his-standard-form");return Object(i["openBlock"])(),Object(i["createBlock"])(r,{fields:t.fields,onFinishAction:t.onFinish,skipSummary:!0,cancelDestinationPath:t.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}a("14d9"),a("13d5");var s=a("d95e"),o=a("7920"),r=a("2706"),l=a("b5e4"),c=a("9283"),d=a("2ef0"),u=a("3b8c"),h=a("c1e4"),p=a("9b7c"),g=a("8158"),m=a("fe96"),b=a("d867");function f(t,e,a,n,s,o){const r=Object(i["resolveComponent"])("ion-title"),l=Object(i["resolveComponent"])("ion-toolbar"),c=Object(i["resolveComponent"])("ion-header"),d=Object(i["resolveComponent"])("ion-content"),u=Object(i["resolveComponent"])("ion-button"),h=Object(i["resolveComponent"])("ion-footer");return Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],null,[Object(i["createVNode"])(c,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(l,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(r,null,{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])("VL milestone has been reached")]),_:1})]),_:1})]),_:1}),Object(i["createVNode"])(d,{style:{overflowY:"hidden",background:"grey"}},{default:Object(i["withCtx"])(()=>[Object(i["createElementVNode"])("p",null,"ART start date : "+Object(i["toDisplayString"])(t.artStartDate),1),Object(i["createElementVNode"])("p",null,"Months on ART: "+Object(i["toDisplayString"])(t.monthsOnART),1),Object(i["createElementVNode"])("p",null,"Last VL order date "+Object(i["toDisplayString"])(t.lastOrder),1),Object(i["createElementVNode"])("p",null,"Current regimen / start date: "+Object(i["toDisplayString"])(t.currentRegimen)+" - "+Object(i["toDisplayString"])(t.regimenStartDate),1)]),_:1}),Object(i["createVNode"])(h,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(l,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(u,{slot:"end",color:"success",size:"large",onClick:e[0]||(e[0]=e=>t.closeModal("order"))},{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(" Order VL")]),_:1}),Object(i["createVNode"])(u,{slot:"end",size:"large",onClick:e[1]||(e[1]=e=>t.closeModal("wait"))},{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(" Wait till next milestone")]),_:1}),Object(i["createVNode"])(u,{slot:"start",color:"danger",size:"large",onClick:e[2]||(e[2]=e=>t.closeModal("later"))},{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(" Remind me later ")]),_:1})]),_:1})]),_:1})],64)}var v=Object(i["defineComponent"])({name:"Modal",props:{VLData:{type:Object,required:!0}},async created(){this.artStartDate=c["c"].toStandardHisDisplayFormat(this.VLData.earliest_start_date),this.monthsOnART=this.VLData.period_on_art,this.lastOrder=this.VLData.last_order_date?c["c"].toStandardHisDisplayFormat(this.VLData.last_order_date):"N/A",this.currentRegimen=this.VLData.current_regimen.name?this.VLData.current_regimen.name:"Other",this.regimenStartDate=c["c"].toStandardHisDisplayFormat(this.VLData.current_regimen.date_started)},methods:{async closeModal(t){await b["modalController"].dismiss(t)}},data(){return{content:"Content",artStartDate:"",monthsOnART:"",lastOrder:"",currentRegimen:"",regimenStartDate:""}},components:{IonHeader:b["IonHeader"],IonToolbar:b["IonToolbar"],IonTitle:b["IonTitle"],IonContent:b["IonContent"],IonFooter:b["IonFooter"],IonButton:b["IonButton"]}}),T=(a("18cf"),a("6b0d")),O=a.n(T);const _=O()(v,[["render",f],["__scopeId","data-v-509b8061"]]);var y=_,C=a("ad60"),D=a("cc6f");class w extends D["a"]{constructor(t,e){super(t,13,e)}async buildDefferedOrder(t){const e=await D["a"].getConceptID("HIV viral load"),a=await D["a"].getConceptID("Delayed milestones");return[{concept_id:e,value_text:"Wait till next milestone",value_coded:a,value_numeric:t}]}}var S=a("7f35");const I=t=>(Object(i["pushScopeId"])("data-v-77a8db25"),t=t(),Object(i["popScopeId"])(),t),P={style:{}},E=I(()=>Object(i["createElementVNode"])("div",{class:"side-title"}," Select reason ",-1)),x=I(()=>Object(i["createElementVNode"])("p",null,"Current Medication",-1)),N=I(()=>Object(i["createElementVNode"])("p",null,"Previous Medication",-1)),V=I(()=>Object(i["createElementVNode"])("p",null,null,-1));function j(t,e,a,n,s,o){const r=Object(i["resolveComponent"])("ion-title"),l=Object(i["resolveComponent"])("ion-toolbar"),c=Object(i["resolveComponent"])("ion-header"),d=Object(i["resolveComponent"])("ion-label"),u=Object(i["resolveComponent"])("ion-item"),h=Object(i["resolveComponent"])("ion-list"),p=Object(i["resolveComponent"])("ion-col"),g=Object(i["resolveComponent"])("ion-radio"),m=Object(i["resolveComponent"])("ion-radio-group"),b=Object(i["resolveComponent"])("ion-row"),f=Object(i["resolveComponent"])("ion-grid"),v=Object(i["resolveComponent"])("ion-content"),T=Object(i["resolveComponent"])("ion-button"),O=Object(i["resolveComponent"])("ion-footer");return Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],null,[Object(i["createVNode"])(c,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(l,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(r,null,{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])("Side effects suspected causes")]),_:1})]),_:1})]),_:1}),Object(i["createVNode"])(v,{style:{overflowY:"hidden",background:"grey"}},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(f,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(b,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(p,{size:"4"},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(h,{style:{overflowY:"auto",height:"78vh"}},{default:Object(i["withCtx"])(()=>[(Object(i["openBlock"])(!0),Object(i["createElementBlock"])(i["Fragment"],null,Object(i["renderList"])(t.sides,(e,a)=>(Object(i["openBlock"])(),Object(i["createBlock"])(u,{key:e,onClick:e=>t.selectSideEffect(a),detail:!0,style:Object(i["normalizeStyle"])(t.activeIndex===a?"color: green":"color: black")},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(d,null,{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.label),1)]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1})]),_:1}),Object(i["createVNode"])(p,{style:{overflowY:"auto",height:"78vh"}},{default:Object(i["withCtx"])(()=>[Object(i["createElementVNode"])("div",P,[Object(i["createVNode"])(h,null,{default:Object(i["withCtx"])(()=>[null!==t.activeIndex?(Object(i["openBlock"])(),Object(i["createBlock"])(m,{key:0,modelValue:t.sides[t.activeIndex]["reason"],"onUpdate:modelValue":e[0]||(e[0]=e=>t.sides[t.activeIndex]["reason"]=e)},{default:Object(i["withCtx"])(()=>[E,x,(Object(i["openBlock"])(!0),Object(i["createElementBlock"])(i["Fragment"],null,Object(i["renderList"])(t.drugs,(t,e)=>(Object(i["openBlock"])(),Object(i["createBlock"])(u,{key:e},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(d,null,{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(Object(i["toDisplayString"])(t.drug.name),1)]),_:2},1024),Object(i["createVNode"])(g,{slot:"start",value:t.drug_inventory_id},null,8,["value"])]),_:2},1024))),128)),N,Object(i["createVNode"])(u,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(d,null,{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])("Other, not drug related")]),_:1}),Object(i["createVNode"])(g,{slot:"start",value:"other"})]),_:1}),Object(i["createVNode"])(u,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(d,null,{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])("Drug side effect")]),_:1}),Object(i["createVNode"])(g,{slot:"start",value:"drug"})]),_:1})]),_:1},8,["modelValue"])):Object(i["createCommentVNode"])("",!0)]),_:1})]),V]),_:1})]),_:1})]),_:1})]),_:1}),Object(i["createVNode"])(O,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(l,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(T,{onClick:t.closeModal,slot:"end",color:"danger"},{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(" Close ")]),_:1},8,["onClick"]),Object(i["createVNode"])(T,{onClick:t.postSideEffects,slot:"end",disabled:!t.allSelected},{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(" Save ")]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})],64)}var k=Object(i["defineComponent"])({name:"Modal",props:{sideEffects:{type:Object,required:!0},drugs:{type:Array,default:()=>[]}},methods:{closeModal(){b["modalController"].dismiss()},async postSideEffects(){await b["modalController"].dismiss(this.sides)},selectSideEffect(t){this.activeIndex=t}},computed:{allSelected(){return this.sides.filter(t=>t["reason"]).length===this.sides.length}},mounted(){this.sides=this.sideEffects},data(){return{content:"Content",extendedLabsEnabled:!1,appActivities:[],sides:[],specimens:[],reasons:["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"],activeIndex:null}},components:{IonButton:b["IonButton"],IonContent:b["IonContent"],IonHeader:b["IonHeader"],IonTitle:b["IonTitle"],IonToolbar:b["IonToolbar"],IonLabel:b["IonLabel"],IonList:b["IonList"],IonItem:b["IonItem"],IonRadioGroup:b["IonRadioGroup"],IonRow:b["IonRow"]}});a("a843");const F=O()(k,[["render",j],["__scopeId","data-v-77a8db25"]]);var A=F,H=a("d1ca"),B=a("b446"),R=a("9ceb"),L=a("8df6"),M=a("dac2"),U=a("5f2c"),q=a("4db7"),$=a("8e8b"),Y=a("e86e"),W=a("6d32"),J=a("5a0c"),z=a.n(J),G=Object(i["defineComponent"])({mixins:[m["a"]],components:{HisStandardForm:o["a"]},data:()=>({fields:[],currentWeight:-1,weightTrail:[],customRegimens:[],labOrders:[],weightLossPercentageNum:0,lostTenPercentBodyWeight:!1,CxCaEnabled:!1,CxCaStartAge:-1,CxCaMaxAge:-1,DueForCxCa:!1,currentlyPregnant:!1,currentlyBreastfeeding:!1,patientHitMenopause:!1,hasPregnancyObsToday:!1,autoSelect3HP:!1,labOrderFieldContext:{},consultation:{},prescription:{},dispensation:{},completed3HP:!1,hasTbHistoryObs:!1,allergicToSulphur:!1,TBSuspected:!1,presentedTBSymptoms:!1,askAdherence:!1,lastDrugsReceived:[],sideEffectsHistory:{},onPermanentFPMethods:!1,reasonForDecliningTPTObs:{},malawiSideEffectReasonObs:[],otherSideEffectReasonObs:[],wasTransferredIn:!1,dateStartedArt:"",clientHadAHysterectomy:!1,isNoneClientPatient:!1,tptStatus:{},customDrugs:[],CxCaAppointDate:{},hasTbTreatmentDate:!1,isEligibleForTpt:!1}),watch:{ready:{handler(t){t&&(this.consultation=new u["a"](this.patientID,this.providerID),this.prescription=new M["a"](this.patientID,this.providerID),this.dispensation=new U["a"](this.patientID,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(t,e){const a=await this.consultation.createEncounter();if(!a)return Object(l["e"])("Unable to create encounter");const i=await this.resolveObs(e,"consultation"),n=(await Promise.all([...this.malawiSideEffectReasonObs,...this.otherSideEffectReasonObs,this.reasonForDecliningTPTObs])).filter(t=>!Object(d["isEmpty"])(t)),s=await this.consultation.saveObservationList([...i,...n]);if(Object(d["isEmpty"])(this.drugObs)||this.isNoneClientPatient||await this.saveAdherence(),!s)return Object(l["e"])("Unable to save patient observations");Object(l["d"])("Observations and encounter created!"),t.refer_to_clinician&&"Yes"===t.refer_to_clinician.value?this.gotoPatientDashboard():this.nextTask()},async getTptDrugs(t){const e=[],a=t.routine_tb_therapy.value;return Object(d["isEmpty"])(this.customDrugs)&&(this.customDrugs=await W["a"].getCustomIngridients()),a.match(/ipt/i)?e.push("INH or H (Isoniazid 300mg tablet)"):a.includes("3HP (RFP + INH)")?(e.push("INH or H (Isoniazid 300mg tablet)"),e.push("Rifapentine (150mg)")):a.includes("INH 300 / RFP 300 (3HP)")&&e.push("INH 300 / RFP 300 (3HP)"),Object(d["isEmpty"])(e)?[]:this.customDrugs.filter(t=>e.includes(t.name)).map(t=>({label:t.name,value:"",other:t}))},async getTransferInStatus(){const t=await u["a"].getFirstValueCoded(this.patientID,"Ever received ART"),e=await u["a"].getFirstObs(this.patientID,"Has transfer letter"),a=e?c["c"].toStandardHisFormat(e.obs_datetime):"";return t&&t.match(/yes/i)&&e&&(""+e.value_coded).match(/yes/i)&&a===this.consultation.getDate()},async getDateStartedArt(){const t=await u["a"].getFirstValueDatetime(this.patientID,"Date ART started");return t?c["c"].toStandardHisFormat(t):""},async checkIfWeightLossIsControlled(t){if(this.lostTenPercentBodyWeight&&(""+t.label).match(/malnutrition/i)&&(""+t.value).match(/no/i)){const e=await Object(S["a"])("Recommendation",`Patient's weight has dropped by ${this.weightLossPercentageNum}% , is this controlled weight loss??`,"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}]);t.value="Confirm weight loss"===e?"Yes":"No"}},async checkVLReminder(){const t=await C["a"].getPatientVLInfo(this.patientID);if(!0===t.eligibile){const e=await b["modalController"].create({component:y,backdropDismiss:!1,cssClass:"large-modal",componentProps:{VLData:t}});e.present();const{data:a}=await e.onDidDismiss();switch(a){case"order":await this.labOrderFieldContext.launchOrderSelection();break;case"wait":await this.waitForVL();break;case"later":break;default:break}}},async waitForVL(t=null){const e=new w(this.patientID,this.providerID),a=await e.createEncounter(),i=await e.buildDefferedOrder(t);if(!a)return Object(l["e"])("Unable to create encounter");await e.saveObservationList(i)},canScreenCxCa(){const t=this.patient.getAge();return this.patient.isFemale()&&this.DueForCxCa&&this.CxCaEnabled&&t>=this.CxCaStartAge&&t<=this.CxCaMaxAge&&!this.clientHadAHysterectomy},pregnancyEligible(){return this.patient.isChildBearing()&&!this.onPermanentFPMethods},showCurrentContraceptionMethods(t){return this.pregnancyEligible()&&!this.patientHitMenopause&&!this.isPregnant(t)&&!this.isANCclient()},showNewContraceptionMethods(t){return this.pregnancyEligible()&&!this.patientHitMenopause&&!this.isPregnant(t)&&!this.isOnTubalLigation(t)&&!this.isANCclient()},isPregnant(t){return t.pregnant_breastfeeding?this.inArray(t.pregnant_breastfeeding,t=>"Pregnant"===t.label&&"Yes"===t.value):this.currentlyPregnant},isBreastFeeding(t){return t.pregnant_breastfeeding?this.inArray(t.pregnant_breastfeeding,t=>"Breastfeeding"===t.label&&"Yes"===t.value):this.currentlyBreastfeeding},isOnTubalLigation(t){return this.inArray(t.current_fp_methods,t=>"TUBAL LIGATION"===t.value)},async disableFPMethods(t,e){if(e.isChecked&&"NONE"===e.label)return t.map(t=>("NONE"!=t.label&&(t.isChecked=!1,t.disabled=!1),t));if("NONE"!=e.label&&e.isChecked){e.label.match(/condom/gi)&&Object(l["b"])("Combine with other modern methods of family planning");const a=Object(d["findIndex"])(t,{label:"NONE"});t[a].isChecked=!1;const i=this.consultation.familyPlanningMethods(e.label,t),n=Object(d["findIndex"])(i,{label:e.label});return i[n].isChecked=!0,i}return t.map(t=>(t.disabled=!1,t))},disablePrescriptions(t,e){if(e.isChecked&&"NONE OF THE ABOVE"===e.label)return t.map(t=>("NONE OF THE ABOVE"!=t.label&&(t.isChecked=!1),t));if("NONE OF THE ABOVE"!=e.label&&e.isChecked){const e=Object(d["findIndex"])(t,{label:"NONE OF THE ABOVE"});t[e].isChecked=!1}return t},buildMedicationOrders(t){if(this.inArray(t,t=>"NONE OF THE ABOVE"===t.label))return this.consultation.buildValueCoded("Prescribe drugs","No");const e=this.consultation.buildValueCoded("Prescribe drugs","Yes"),a=t.map(t=>this.consultation.buildValueCoded("Medication orders",t.label));return[e,...a]},declinedFPM(t){return this.inArray(t.fp_methods,t=>"NONE"===t.value)&&this.inArray(t.current_fp_methods,t=>"NONE"===t.value)},riskOfUnplannedPregnancy(t){return"At risk of unplanned pregnancy"===t.reason_for_no_fpm.value},showOtherSideEffects(t){return this.inArray(t.side_effects,t=>"Other"===t.label&&"Yes"===t.value)},hasTBSymptoms(t){return this.presentedTBSymptoms=this.inArray(t.tb_side_effects,t=>"Yes"===t.value),this.presentedTBSymptoms},isTBSuspect(t){return this.TBSuspected=!!t.value.toString().match(/Yes|TB Suspected/i),this.TBSuspected},isAllergicToSulphur(t){return this.allergicToSulphur=t.value.match(/unknown/i)?null:!!t.value.match(/yes/i),this.allergicToSulphur},async buildSideEffectObs(t,e){const a=await this.getSideEffectsReasons(t);if(this[e]=[],void 0===a)return!1;if(-1!=a){const t=g["a"].getCachedConceptID("Drug induced",!0),i=t=>!!(""+t).match(/other|drug/i);this[e]=a.map(e=>({concept_id:t,value_coded:g["a"].getCachedConceptID(e.label,!0),value_text:i(e.reason)?"Past medication history":null,value_drug:i(e.reason)?null:e.reason}))}return!0},async getSideEffectsReasons(t){const e=t.filter(t=>!(""+t.label).match(/other/i)&&"Yes"===t.value);if(e.length>0){const t=await b["modalController"].create({component:A,backdropDismiss:!1,cssClass:"large-modal",componentProps:{sideEffects:e,drugs:this.lastDrugsReceived}});t.present();const{data:a}=await t.onDidDismiss();return a}return-1},getFPMethods(t=[],e){const a=this.consultation.getFamilyPlanningMethods(),i=a.filter(e=>!t.includes(e));return i.map(t=>({label:t,value:t,isChecked:e.map(t=>t.label).includes(t)}))},getOptions(t,e){return t.map(t=>{const a=Object(d["find"])(e,{label:t});return{label:t,value:a?a.value:"",other:{values:this.yesNoOptions()}}})},getContraindications(t){const e=g["a"].getConceptsByCategory("contraindication",!0).map(t=>t.name);return this.getOptions([...e,"Other"],t)},getOtherContraindications(t){const e=g["a"].getConceptsByCategory("side_effect",!0).map(t=>t.name),a=e.pop();return this.getOptions([...e,"Other (Specify)",""+a],t)},getTBSymptoms(t){const e=g["a"].getConceptsByCategory("tb_symptom",!0).map(t=>t.name);return this.getOptions([...e],t)},getReasonsForNoCxcaOptions(){return g["a"].getConceptsByCategory("reason_for_no_cxca").map(t=>({label:t.name,value:t.name,other:{c:t}}))},runAppendOptionParams(t,e){const a=e.filter(t=>t.isChecked).map(t=>t.label);return t.map(t=>{var e;if("function"===typeof(null===t||void 0===t||null===(e=t.other)||void 0===e?void 0:e.appendOptionParams)){var i;const e=null===t||void 0===t||null===(i=t.other)||void 0===i?void 0:i.appendOptionParams();if("object"===typeof e){const i={label:t.label,value:t.value,other:t.other};return e.isChecked?(i.isChecked=e.isChecked,delete e.isChecked):i.isChecked=a.includes(t.label),{...i,...e}}}return t})},didCompleted3HP(t){return!!this.completed3HP||!(!t.routine_tb_therapy||!t.routine_tb_therapy.value.match(/complete/i))},patientOnTpt(t){return null!=t.routine_tb_therapy?/Currently/i.test(t.routine_tb_therapy.value):null!==this.tptStatus.tpt&&!this.completed3HP},tptAutoSelectionMode(t){return this.autoSelect3HP&&!this.didCompleted3HP(t)},async on3HPValueUpdate(t,e,a){const i=t=>!!t.label.match(/IPT|3HP/i),n=(()=>{const e=t.reduce((t,e)=>(i(e)&&!(e.label in t)&&e.isChecked&&t.push(e.label),t),[]);return e.includes("IPT")&&(e.includes("3HP (RFP + INH)")||e.includes("INH 300 / RFP 300 (3HP)"))})(),s=i(e)&&t.filter(t=>i(t)).map(t=>!t.isChecked).every(Boolean);if(s&&this.patientOnTpt(a)){const t=await Object(S["c"])("Reasons for declining TPT","",["Patient declined","Side-effects (previous or current)","Stock-out","Starting TB treatment","Other"],[{name:"Done",slot:"start",role:"action"}]);this.reasonForDecliningTPTObs=this.consultation.buildValueText("Other reason for not seeking services",t.selection)}else this.reasonForDecliningTPTObs={};if(n){const e=await Object(S["a"])("IPT / 3HP conflict","IPT and 3HP can NOT be prescribed together","Please pick either one",[{name:"Prescribe 3HP",slot:"start",color:"primary"},{name:"Prescribe IPT",slot:"end",color:"primary"}]);return t.map(t=>(i(t)&&(t.isChecked="Prescribe IPT"===e&&"IPT"===t.label||"Prescribe 3HP"===e&&"INH 300 / RFP 300 (3HP)"===t.label),t))}return t.map(t=>(("3HP (RFP + INH)"===e.label&&"INH 300 / RFP 300 (3HP)"===t.label&&e.isChecked||"INH 300 / RFP 300 (3HP)"===e.label&&"3HP (RFP + INH)"===t.label&&e.isChecked)&&(t.isChecked=!1),t))},medicationOrderOptions(t,e=[]){this.isEligibleForTpt=!1;const a=this.didCompleted3HP(t),i=null!==this.tptStatus.tpt,n=this.tptAutoSelectionMode(t),s=this.isBreastFeeding(t),o=this.isPregnant(t),r=t=>({disabled:!0,isChecked:!1,description:{color:"danger",show:"always",text:t}}),l=(()=>s?{isChecked:!1,description:{color:"danger",show:"always",text:"Patient is breast feeding"}}:{})();return this.runAppendOptionParams([this.toOption("ARVs",{appendOptionParams:()=>({isChecked:n&&!this.TBSuspected})}),this.toOption("CPT",{appendOptionParams:()=>!n||this.TBSuspected||this.allergicToSulphur?this.allergicToSulphur?r("Allergic to CPT"):{disabled:!1}:{isChecked:!0}}),this.toOption("3HP (RFP + INH)",{appendOptionParams:()=>a?r("Completed TPT treatment"):this.tptStatus.tb_treatment?r("Completed/on TB treatment"):this.TBSuspected?r("TB Suspect"):o?r("Pregnant patient"):this.currentWeight<20?r("Weight below regulation"):i&&"3HP (RFP + INH)"!==this.tptStatus.tpt&&!this.tptStatus.completed?r(`On ${this.tptStatus.tpt} treatment`):(this.isEligibleForTpt=!0,"3HP (RFP + INH)"!==this.tptStatus.tpt||this.tptStatus.completed?void 0:{isChecked:!0,...l})}),this.toOption("INH 300 / RFP 300 (3HP)",{appendOptionParams:()=>a?r("Completed TPT treatment"):this.tptStatus.tb_treatment?r("Completed/on TB treatment"):this.TBSuspected?r("TB Suspect"):o?r("Pregnant patient"):this.currentWeight<30?r("Weight below regulation"):i&&"INH 300 / RFP 300 (3HP)"!==this.tptStatus.tpt&&!this.tptStatus.completed?r(`On ${this.tptStatus.tpt} treatment`):(this.isEligibleForTpt=!0,"INH 300 / RFP 300 (3HP)"!==this.tptStatus.tpt||this.tptStatus.completed?{isChecked:n,...l}:{isChecked:!0,...l})}),this.toOption("IPT",{appendOptionParams:()=>a?r("Completed TPT treatment"):this.tptStatus.tb_treatment?r("Completed/on TB treatment"):this.TBSuspected?r("TB Suspect"):o?r("Pregnant patient"):i&&"IPT"!==this.tptStatus.tpt&&!this.tptStatus.completed?r(`On ${this.tptStatus.tpt} treatment`):(this.isEligibleForTpt=!0,"IPT"!==this.tptStatus.tpt||this.tptStatus.completed?void 0:{isChecked:!0,...l})}),this.toOption("NONE OF THE ABOVE")],e)},async getVlLabData(){return p["a"].formatLabs(await $["a"].get("GET_LAB_ORDERS_WITH_GIVEN_RESULT_STATUS",{patientID:this.patientID}))},isANCclient(){return"ANC"===C["a"].getSuspendedProgram()},getFields(){return[{id:"other_patient_prescription",proxyID:"prescription",helpText:"Medication to prescribe during this visit",type:s["b"].TT_MULTIPLE_SELECT,init:async()=>{const t="No"===await this.consultation.getClient();return this.isNoneClientPatient=!!t||!!await L["a"].isDrugRefillPatient(this.patientID),this.isNoneClientPatient&&(this.currentWeight=Number(await this.patient.getRecentWeight()),this.autoSelect3HP=await $["a"].get("ART_AUTO_3HP_SELECTION"),this.tptStatus=await this.consultation.getTptTreatmentStatus(),this.completed3HP=null!==this.tptStatus.tpt&&this.tptStatus.completed),!0},beforeNext:async(t,e)=>!!(this.isBreastFeeding(e)||!this.isEligibleForTpt||this.patientOnTpt(e)||t.some(t=>/3hp|ipt/i.test(t.label))||await Object(l["a"])("Are you sure you want to skip TPT prescription for eligible client?")),validation:t=>r["a"].required(t),computedValue:t=>({tag:"consultation",obs:this.buildMedicationOrders(t)}),onValueUpdate:(t,e,a)=>{const i=this.disablePrescriptions(t,e);return this.on3HPValueUpdate(i,e,a)},options:(t,e,a,i)=>Object(d["isEmpty"])(i)?this.medicationOrderOptions(t):i,condition:()=>this.isNoneClientPatient,exitsForm:()=>!0},...Object(B["b"])({id:"date_last_received_arvs",helpText:"Last ARV Dispensation",required:!0,init:async()=>(this.wasTransferredIn=await this.getTransferInStatus()||!1,this.dateStartedArt=await this.getDateStartedArt(),!0),condition:()=>this.wasTransferredIn,minDate:()=>this.dateStartedArt,maxDate:()=>this.consultation.getDate(),computeValue:t=>(this.prescription.setDate(t),{tag:"consultation",date:t,obs:this.consultation.buildValueDate("Date drug received from previous facility",t)}),estimation:{allowUnknown:!1}}),{id:"previous_arvs_received",helpText:"Last ARV drugs dispensed",type:s["b"].TT_MULTIPLE_SELECT,computedValue:t=>t.map(t=>t.other),validation:t=>r["a"].required(t),options:async()=>{if(!Object(d["isEmpty"])(this.customRegimens))return this.customRegimens;const t=new M["a"](this.patientID,this.providerID);return this.customRegimens=(await t.getARVs()).map(t=>({label:t.name,value:t.drug_id,other:{...t}})),this.customRegimens},config:{showKeyboard:!0},condition:()=>this.wasTransferredIn},{id:"drug_interval",helpText:"Duration period for last received ARVs",type:s["b"].TT_NEXT_VISIT_INTERVAL_SELECTION,condition:()=>this.wasTransferredIn,validation:t=>r["a"].required(t),computedValue:t=>t.other.nextAppointment,options:()=>{const t=[{label:"2 weeks",value:14},{label:"1 month",value:28},{label:"2 months",value:56},{label:"3 months",value:84},{label:"4 months",value:112},{label:"5 months",value:140},{label:"6 months",value:168},{label:"7 months",value:196},{label:"8 months",value:224},{label:"9 months",value:252},{label:"10 months",value:280},{label:"11 months",value:308},{label:"12 months",value:336}];return t.map(({label:t,value:e})=>{this.prescription.setNextVisitInterval(e);const a=this.prescription.calculateDateFromInterval();return{label:t,value:e,other:{label:"Medication run-out date:",value:c["c"].toStandardHisDisplayFormat(a),nextAppointment:a,other:{label:"",value:[]}}}})}},{id:"arv_quantities",helpText:"Amount of drugs dispensed (From last ART Facility)",type:s["b"].TT_DRUG_TRANSFER_IN,validation:t=>this.validateSeries([()=>r["a"].required(t),()=>t.map(t=>{var e;return""===t.value||""===(null===t||void 0===t||null===(e=t.other)||void 0===e?void 0:e.pillsBrought)}).some(Boolean)?["Some Drugs are missing values"]:null]),computedValue:(t,e,a)=>({tag:"consultation",obs:t.map(async t=>{var e,i,n;const s=(null===t||void 0===t||null===(e=t.other)||void 0===e||null===(e=e.drug)||void 0===e?void 0:e.drug_id)||0;return{...await this.consultation.buildObs("Drug received from previous facility",{value_drug:s,value_datetime:(null===a||void 0===a?void 0:a.drug_interval)||null,value_numeric:(null===t||void 0===t?void 0:t.value)||0}),child:[await this.consultation.buildObs("Number of tablets brought to clinic",{value_drug:s,value_numeric:(null===t||void 0===t||null===(i=t.other)||void 0===i?void 0:i.pillsBrought)||-1,value_datetime:(null===a||void 0===a||null===(n=a.date_last_received_arvs)||void 0===n?void 0:n.date)||null})]}})}),options:(t,e,a)=>e.previous_arvs_received.map(t=>{const e=t["alternative_drug_name"]||t["drug_name"]||t["name"],i=Object(d["find"])(a,{label:e});let n="",s="";var o;i&&(n=null===i||void 0===i?void 0:i.value,s=null===i||void 0===i||null===(o=i.other)||void 0===o?void 0:o.pillsBrought);return{label:e,value:n,other:{drug:t,pillsBrought:s}}}),condition:()=>this.wasTransferredIn},{id:"patient_lab_orders",helpText:"Lab orders",type:s["b"].TT_LAB_ORDERS,init:async()=>(this.labOrders=await this.getVlLabData(),!0),unload:async()=>{await this.checkVLReminder();const t=this.labOrders.filter(t=>"No"===t.result_given);if(t.length&&await Object(l["a"])("Result(s) Given to Client?")){const e=new D["a"](this.patientID,-1,this.providerID),a=t.reduce((t,a)=>[...t,...a.resultIds.map(async t=>(e.encounterID=a.encounter_id,e.saveObs(await e.buildObs("Result Given to Client",{value_coded:"Yes",obs_group_id:t}))))],[]);await Promise.all(a)}this.labOrders=await this.getVlLabData()},onload:t=>this.labOrderFieldContext=t,options:()=>[{label:"Lab orders",value:"order trail",other:{values:this.labOrders}}],config:{printOrder:t=>new q["a"](this.patientID).printLabOrderLbl(t),hiddenFooterBtns:["Clear"],footerBtns:[{name:"Order",size:"large",slot:"end",color:"primary",visible:!0,onClick:async()=>{Object(d["isEmpty"])(this.labOrderFieldContext)||await this.labOrderFieldContext.launchOrderSelection()}}]}},{id:"pregnant_breastfeeding",helpText:"Patient Pregnant or breastfeeding?",init:async()=>(this.patient.isFemale()&&(this.patient.isChildBearing()&&(this.hasPregnancyObsToday=await this.patient.hasPregnancyObsToday(),this.currentlyPregnant=await this.patient.isPregnant(),this.currentlyBreastfeeding=await this.patient.isBreastfeeding()),this.onPermanentFPMethods=await this.consultation.getTLObs()),!0),condition:()=>!this.hasPregnancyObsToday&&this.pregnancyEligible(),type:s["b"].TT_MULTIPLE_YES_NO,validation:t=>this.validateSeries([()=>r["a"].required(t),()=>r["a"].anyEmpty(t)]),computedValue:t=>({tag:"consultation",obs:t.map(t=>this.consultation.buildValueCoded(t.other.concept,t.value)).concat(this.isANCclient()?[this.consultation.buildValueCoded("Is patient pregnant","Yes")]:[])}),options:t=>{const e=[];return this.isANCclient()||e.push({label:"Pregnant",value:"",other:{values:this.yesNoOptions(),concept:"Is patient pregnant"}}),e.push({label:"Breastfeeding",value:"",other:{values:this.yesNoOptions(),concept:"Is patient breast feeding"}}),t.pregnant_breastfeeding||e}},{id:"patient_weight_chart",helpText:"Patient weight chart",type:s["b"].TT_WEIGHT_CHART,init:async()=>(this.weightTrail=await this.patient.getWeightHistory(),this.weightLossPercentageNum=this.patient.getWeightLossPercentageFromTrail(this.weightTrail),this.lostTenPercentBodyWeight=this.weightLossPercentageNum>=10,!0),options:async()=>{const t=await this.patient.getBMI(),e=this.weightTrail;return[{label:"Weight for patient",value:"Weight trail",other:{bmi:t,values:e.map(t=>({x:c["c"].toStandardHisDisplayFormat(t.date),y:t.weight})),age:this.patient.getAge()}}]},config:{hiddenFooterBtns:["Clear"]}},{id:"has_fp_methods",helpText:"",type:s["b"].TT_TEXT_BANNER,condition:()=>this.onPermanentFPMethods,options:()=>this.mapStrToOptions(["Patient is on Tubal ligation method"])},{id:"current_fp_methods",helpText:"What method are you currently on?",type:s["b"].TT_MULTIPLE_SELECT,init:async()=>(this.patient.isFemale()&&(this.patientHitMenopause=await this.consultation.patientHitMenopause()),!0),validation:t=>r["a"].required(t),onValueUpdate:(t,e)=>this.disableFPMethods(t,e),computedValue:t=>({tag:"consultation",obs:t.map(t=>this.consultation.buildValueCoded("Family planning method",t.value))}),condition:t=>this.showCurrentContraceptionMethods(t),options:(t,e)=>this.getFPMethods([],e)},{id:"fp_methods",helpText:"What method are you providing today?",type:s["b"].TT_MULTIPLE_SELECT,condition:t=>this.showNewContraceptionMethods(t),validation:t=>r["a"].required(t),onValueUpdate:(t,e)=>this.disableFPMethods(t,e),computedValue:t=>({tag:"consultation",obs:t.map(t=>this.consultation.buildValueCoded("Family planning, action to take",t.value))}),options:(t,e)=>this.getFPMethods([],e)},{id:"reason_for_no_fpm",helpText:"Main reason for not using family planning methods",type:s["b"].TT_SELECT,validation:t=>r["a"].required(t),condition:t=>this.declinedFPM(t),computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueText("Why does the woman not use birth control",t.value)}),options:()=>this.mapStrToOptions(["Not Sexually active","Patient want to get pregnant","Not needed for medical reasons","At risk of unplanned pregnancy","Menopause"])},{id:"specific_reason_for_no_fpm",helpText:"Specific reason for not using family planning methods",type:s["b"].TT_SELECT,validation:t=>r["a"].required(t),computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueText("Reason for not using contraceptives",t.value)}),condition:t=>this.riskOfUnplannedPregnancy(t),options:()=>this.mapStrToOptions(["Following wishes of spouse","Religious reasons","Afraid of side effects","Never though about it","Indifferent (does not mind getting pregnant)"])},{id:"offer_contraceptives",helpText:"Offer contraceptives",type:s["b"].TT_SELECT,validation:t=>r["a"].required(t),condition:t=>this.riskOfUnplannedPregnancy(t),computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueCoded("Family planning, action to take",t.value)}),options:()=>[{label:"Accepted",value:"Yes"},{label:"Declined",value:"No"},{label:"Discuss with spouse",value:"Discuss with spouse"}]},{id:"offered_intervention",helpText:"Offered intervention",type:s["b"].TT_MULTIPLE_SELECT,validation:t=>r["a"].required(t),condition:t=>"Accepted"===t.offer_contraceptives.value,computedValue:t=>({tag:"consultation",obs:t.map(t=>this.consultation.buildValueCoded(t.label,t.value))}),options:(t,e)=>this.getFPMethods(["NONE"],e)},{id:"offer_cxca",helpText:"Refer client for CxCa screening",type:s["b"].TT_SELECT,init:async()=>{if(this.patient.isFemale()&&(this.CxCaEnabled=await H["b"].cervicalCancerScreeningEnabled(),this.CxCaEnabled)){const{start:t,end:e}=await H["b"].cervicalCancerScreeningAgeBounds();this.CxCaMaxAge=e,this.CxCaStartAge=t,this.DueForCxCa=await this.consultation.clientDueForCxCa(),this.clientHadAHysterectomy=await this.consultation.clientHasHadAHysterectomy()}return!0},validation:t=>r["a"].required(t),condition:t=>this.canScreenCxCa()&&!this.isPregnant(t),computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueCoded("Offer CxCa",t.value)}),options:()=>this.yesNoOptions()},{id:"cxca_reminder",helpText:"CxCa Screening Reminder",type:s["b"].TT_TEXT_BANNER,init:async()=>(this.CxCaEnabled&&this.patient.isFemale()&&(this.CxCaAppointDate=await this.patient.nextAppointment(24)),!0),condition:()=>{const t=30;return t>c["c"].dateDiffInDays(this.CxCaAppointDate,this.consultation.date)},options:()=>this.mapStrToOptions(["Patient is due for Cervical Cancer Screening on "+c["c"].toStandardHisDisplayFormat(this.CxCaAppointDate.appointment_date)])},{id:"reason_for_no_cxca",helpText:"Reason for NOT offering CxCa",type:s["b"].TT_SELECT,validation:t=>r["a"].required(t),condition:t=>"No"===t.offer_cxca.value,computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueCoded("Reason for NOT offering CxCa",t.value)}),options:()=>this.getReasonsForNoCxcaOptions()},...Object(B["b"])({id:"previous_cxca_test_date",helpText:"Previous CxCa test",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>u["a"].getSessionDate(),condition:t=>"Not due for screening"===t.reason_for_no_cxca.value,computeValue:(t,e)=>e?{tag:"consultation",obs:this.consultation.buildValueDateEstimated("CxCa test date",t)}:{tag:"consultation",obs:this.consultation.buildValueDate("CxCa test date",t)},estimation:{allowUnknown:!0,estimationFieldType:B["a"].MONTH_ESTIMATE_FIELD}}),{id:"previous_side_effects",helpText:"Side effects / Contraindications history",type:s["b"].TT_DATA_TABLE,init:async()=>(this.sideEffectsHistory=await this.consultation.getDrugSideEffects(),!0),config:{columns:()=>[[R["a"].thTxt("Date"),R["a"].thTxt("Condition"),R["a"].thTxt("Drug induced"),R["a"].thTxt("Drug")]],rows:()=>Object.keys(this.sideEffectsHistory).map(t=>Object.values(this.sideEffectsHistory[t]).filter(t=>!Object(d["isEmpty"])(t.name)).map(e=>[R["a"].tdDate(t),R["a"].td(e.name),R["a"].td(e.drug_induced?"Yes":"No"),R["a"].td(e.drug)])).reduce((t,e)=>t.concat(e),[])}},{id:"side_effects",helpText:"Contraindications / Side effects (select either 'Yes' or 'No')",type:s["b"].TT_MULTIPLE_YES_NO,init:async()=>(this.lastDrugsReceived=await this.consultation.getPreviousDrugs(),!0),validation:t=>this.validateSeries([()=>r["a"].required(t),()=>r["a"].anyEmpty(t)]),computedValue:t=>({tag:"consultation",obs:t.map(async t=>({...await this.consultation.buildValueCoded("Malawi ART side effects",t.label),child:[await this.consultation.buildValueCoded(t.label,t.value)]}))}),beforeNext:t=>this.buildSideEffectObs(t,"malawiSideEffectReasonObs"),options:(t,e)=>this.getContraindications(e)},{id:"other_side_effects",helpText:"Other Contraindications / Side effects (select either 'Yes' or 'No')",type:s["b"].TT_MULTIPLE_YES_NO,onValue:async t=>(await this.checkIfWeightLossIsControlled(t),!0),condition:t=>this.showOtherSideEffects(t),onConditionFalse:()=>this.otherSideEffectReasonObs=[],validation:t=>this.validateSeries([()=>r["a"].required(t),()=>r["a"].anyEmpty(t)]),computedValue:t=>({tag:"consultation",obs:t.filter(t=>"Other (Specify)"!=t.label).map(async t=>({...await this.consultation.buildValueCoded("Other side effect",t.label),child:[await this.consultation.buildValueCoded(t.label,t.value)]}))}),beforeNext:t=>this.buildSideEffectObs(t,"otherSideEffectReasonObs"),options:(t,e)=>this.getOtherContraindications(e)},{id:"other_side_effect_specify",helpText:"Other Contraindications / Side effects (specify)",type:s["b"].TT_NOTE,computedValue:async t=>({tag:"consultation",obs:{...await this.consultation.buildValueCoded("Other side effect","Other (Specify)"),child:[await this.consultation.buildValueText("Other (Specify)",t.value)]}}),condition:t=>this.inArray(t.other_side_effects,t=>"Other (Specify)"===t.label&&"Yes"===t.value),validation:t=>r["a"].required(t)},{id:"on_tb_treatment",helpText:"On TB Treatment?",type:s["b"].TT_SELECT,validation:t=>r["a"].required(t),computedValue:t=>({tag:"consultation",obs:[this.consultation.buildValueCoded("TB treatment",t.value)].concat(this.isTBSuspect(t)?[this.consultation.buildValueCoded("TB Status","Confirmed TB on treatment")]:[])}),options:()=>this.yesNoOptions()},{id:"tb_date_started_treatment_known",helpText:"TB treatment history",type:s["b"].TT_YES_NO,init:async()=>{this.hasTbTreatmentDate=!1;const t=await u["a"].getFirstValueDatetime(this.patientID,"TB treatment start date"),e=await u["a"].getFirstValueNumber(this.patientID,"TB treatment period");if(e&&t){const a=z()(this.consultation.date).diff(t,"months");this.hasTbTreatmentDate=a<=e}return!0},validation:t=>r["a"].required(t),condition:t=>!this.hasTbTreatmentDate&&"Yes"===t.on_tb_treatment.label,options:()=>[{label:"Date started treatment known?",values:this.yesNoOptions()}]},...Object(B["b"])({id:"tb_start_date",helpText:"Enter start date for treatment?",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>u["a"].getSessionDate(),condition:t=>"Yes"===t.tb_date_started_treatment_known,computeValue:t=>({tag:"consultation",obs:this.consultation.buildValueDate("TB treatment start date",t)}),estimation:{allowUnknown:!1}}),{id:"tb_treatment_period",helpText:"Enter period (In months)",type:s["b"].TT_NUMBER,validation:t=>r["a"].validateSeries([()=>r["a"].required(t),()=>r["a"].isNumber(t),()=>r["a"].rangeOf(t,3,9)]),condition:t=>"Yes"===t.tb_date_started_treatment_known,computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueNumber("TB treatment period",t.value)})},{id:"tb_side_effects",helpText:"TB Associated symptoms",type:s["b"].TT_MULTIPLE_YES_NO,onValue:async t=>(await this.checkIfWeightLossIsControlled(t),!0),validation:t=>this.validateSeries([()=>r["a"].required(t),()=>r["a"].anyEmpty(t)]),condition:t=>t.on_tb_treatment.value.match(/no/i),options:(t,e)=>this.getTBSymptoms(e),computedValue:(t,e)=>({tag:"consultation",obs:t.map(async t=>({...await this.consultation.buildValueCoded("Routine TB Screening",t.label),child:[await this.consultation.buildValueCoded(t.label,t.value)]})).concat(this.hasTBSymptoms(e)?[]:[this.consultation.buildValueCoded("TB Status","TB NOT suspected")])})},{id:"tb_status",helpText:"TB Status",type:s["b"].TT_SELECT,validation:t=>r["a"].required(t),condition:t=>this.hasTBSymptoms(t),onConditionFalse:()=>this.TBSuspected=!1,defaultValue:()=>"TB Suspected",computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueCoded("TB Status",t.value)}),beforeNext:async t=>{if(this.isTBSuspect(t)){const t=await Object(S["a"])("Lab Order","The patient is a TB suspect. Do you want to take lab orders?","",[{name:"Order now",slot:"start",color:"success"},{name:"NOT now",slot:"end",color:"danger"}]);"Order now"===t&&this.labOrderFieldContext.launchOrderSelection(["TB Microscopic Exam","GeneXpert","Culture & Sensitivity","TB Tests"])}return!0},options:()=>this.mapStrToOptions(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"])},{id:"routine_tb_therapy",helpText:"TB preventive therapy (TPT) history",type:s["b"].TT_SELECT,init:async()=>(this.hasTbHistoryObs=await this.consultation.hasTreatmentHistoryObs(),!0),validation:t=>r["a"].required(t),condition:()=>!this.hasTbHistoryObs,computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueText("Previous TB treatment history",t.value)}),options:t=>{let e=[];return/no/i.test(t.on_tb_treatment.value)&&(e=["Currently on IPT","Currently on 3HP (RFP + INH)","Currently on INH 300 / RFP 300 (3HP)"]),e=e.concat(["Complete course of 3HP in the past (3 months RFP+INH)","Complete course of IPT in the past (min. 6 months of INH)","Aborted course of 3HP (RFP + INH) in the past","Aborted course of INH 300 / RFP 300 (3HP) in the past","Aborted course of IPT in the past","Never taken IPT or 3HP"]),this.mapStrToOptions(e)}},...Object(B["b"])({id:"date_started_tpt",helpText:"Started TPT Treatment",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>u["a"].getSessionDate(),condition:t=>t.routine_tb_therapy.value.match(/currently/i),computeValue:t=>t,estimation:{allowUnknown:!0,estimationFieldType:B["a"].MONTH_ESTIMATE_FIELD}}),{id:"tpt_drugs_received",helpText:"TPT Drugs Received",required:!0,condition:t=>t.routine_tb_therapy.value.match(/currently/i),type:s["b"].TT_ADHERENCE_INPUT,options:t=>this.getTptDrugs(t),computedValue:(t,e,a)=>({tag:"consultation",obs:t.map(async t=>{var e;return this.consultation.buildObs("TPT Drugs Received",{value_drug:(null===t||void 0===t||null===(e=t.other)||void 0===e?void 0:e.drug_id)||0,value_datetime:(null===a||void 0===a?void 0:a.date_started_tpt)||null,value_numeric:(null===t||void 0===t?void 0:t.value)||0})})}),config:{titles:{label:"Drug name",value:"Tablets received"}}},{id:"tpt_tranfer_from",helpText:"Facility client is transferring in from",type:s["b"].TT_SELECT,computedValue:({label:t})=>({tag:"consultation",obs:this.consultation.buildValueText("Location TPT last received",t)}),validation:t=>r["a"].required(t),condition:t=>t.routine_tb_therapy.value.match(/currently/i),options:(t,e="")=>Object(Y["b"])(e),config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"allergic_to_sulphur",helpText:"Allergic to Cotrimoxazole",type:s["b"].TT_SELECT,validation:t=>r["a"].required(t),computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueCoded("Allergic to sulphur",t.value)}),beforeNext:t=>(this.isAllergicToSulphur(t),console.log(this.allergicToSulphur),!0),options:()=>this.yesNoUnknownOptions()},...this.getAdherenceFields(!0),{id:"refer_to_clinician",helpText:"Refer to clinician",type:s["b"].TT_SELECT,condition:()=>h["a"].isNurse(),validation:t=>r["a"].required(t),computedValue:t=>({tag:"consultation",obs:this.consultation.buildValueCoded("Refer to clinician",t.value)}),options:()=>this.yesNoOptions()},{id:"medication_to_prescribe",proxyID:"prescription",helpText:"Medication to prescribe during this visit",type:s["b"].TT_MULTIPLE_SELECT,init:async()=>(this.isNoneClientPatient||(this.currentWeight=Number(await this.patient.getRecentWeight()),this.autoSelect3HP=await $["a"].get("ART_AUTO_3HP_SELECTION"),this.tptStatus=await this.consultation.getTptTreatmentStatus(),this.completed3HP=null!==this.tptStatus.tpt&&this.tptStatus.completed),!0),beforeNext:async(t,e)=>!!(this.isBreastFeeding(e)||!this.isEligibleForTpt||this.patientOnTpt(e)||t.some(t=>/3hp|ipt/i.test(t.label))||await Object(l["a"])("Are you sure you want to skip TPT prescription for eligible client?")),condition:t=>!t.refer_to_clinician||(""+t.refer_to_clinician.value).match(/no/i),validation:t=>r["a"].required(t),computedValue:t=>({tag:"consultation",obs:this.buildMedicationOrders(t)}),onValueUpdate:(t,e,a)=>{const i=this.disablePrescriptions(t,e);return this.on3HPValueUpdate(i,e,a)},options:(t,e,a,i)=>this.medicationOrderOptions(t,i),config:{footerBtns:[{name:"Update allergic to CPT",onClickComponentEvents:{refreshOptions:(t,e,a)=>(this.allergicToSulphur="Allergic"===t.btnOutput,this.medicationOrderOptions(a,e))},onClick:()=>Object(S["a"])("Allergic to Cotrimoxazole update","Is the patient allergic to cotrimoxazole.","",[{name:"Allergic",slot:"start",color:"success"},{name:"NOT Allergic",slot:"end"}])}]}}]}}});const X=O()(G,[["render",n]]);e["default"]=X},"6d32":function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var i=a("1c74");class n extends i["e"]{constructor(){super()}static getAllArvRegimens(){return this.getJson(`programs/${this.getProgramID()}/all_arv_regimens`)}static getRegimens(t){return this.getJson(`programs/${this.getProgramID()}/regimens`,{patient_id:t})}static getRegimensByWeight(t,e=!1){return this.getJson(`programs/${this.getProgramID()}/regimens`,{weight:t,tb_dosage:e})}static getCustomIngridients(){return this.getJson(`programs/${this.getProgramID()}/custom_regimen_ingredients`)}static getCurrentRegimen(t,e=this.getSessionDate()){return this.getJson(`programs/${this.getProgramID()}/${t}`,{date:e})}static getRegimenExtras(t,e){return this.getJson(`programs/${this.getProgramID()}/regimen_extras`,{name:t,weight:e})}}},"71c3":function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var i=a("1c74");class n extends i["e"]{constructor(){super()}static create(t){return this.postJson("drug_orders",t)}static updateDispensationOrders(t){return this.postJson("dispensations",{program_id:this.getProgramID(),dispensations:t.map(t=>({date:this.getSessionDate(),drug_order_id:t["order_id"],quantity:t["quantity"]}))})}static getDrugOrderHistory(t){return this.getJson("drug_orders",{patient_id:t})}static getDrugOrders(t){return this.getJson("drug_orders",{patient_id:t,date:this.getSessionDate(),program_id:this.getProgramID()})}static getAllDrugOrders(t,e=1e3){return this.getJson("drug_orders",{patient_id:t,program_id:i["e"].getProgramID(),page_size:e})}static getLastDrugsReceived(t){return this.getJson(`patients/${t}/last_drugs_received`,{date:this.getSessionDate(),program_id:this.getProgramID()})}static getDrugDosages(t,e,a=this.getSessionDate()){const i={drug_id:e,date:a};return this.getJson(`programs/${this.getProgramID()}/patients/${t}/drug_doses`,i)}static getOrderByPatient(t,e){return this.getJson("/drug_orders",{patient_id:t,program_id:this.getProgramID(),...e})}}},"93ee":function(t,e,a){},a843:function(t,e,a){"use strict";a("93ee")},b03f:function(t,e,a){},b446:function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return y}));a("14d9"),a("13d5");var i,n=a("d95e"),s=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}],o=a("9283"),r=a("2706"),l=a("3800"),c=a("6be2"),d=a("5a0c"),u=a.n(d),h=a("1c74");function p(t,e,a=!0){const i=[];return a&&i.push("UNKNOWN"),{id:t,helpText:e+" Year",appearInSummary:()=>!1,type:n["b"].TT_TEXT,config:{customKeyboard:[l["k"],[i,["DELETE"]]]}}}function g(t,e){return{id:t,helpText:e+" Month",appearInSummary:()=>!1,type:n["b"].TT_SELECT,options:()=>s}}function m(t,e){return{id:t,helpText:e+" Day",type:n["b"].TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function b(t,e){return{id:t,helpText:e+" Estimated period",type:n["b"].TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function f(t,e){return{id:t,helpText:e+" Age Estimate",type:n["b"].TT_NUMBER,appearInSummary:()=>!1,config:{keypad:c["e"]}}}function v(t){return parseInt(t)<10?"0"+t:t}async function T(t,e,a){if(e.defaultValue){const i=await e.defaultValue(t);if(i){const[t,e,n]=i.split("-");switch(a){case"Year":return t||"";case"Month":return parseInt(e)||"";case"Day":return parseInt(n)||""}}}return""}function O(t){return o["c"].toStandardHisDisplayFormat(t)}function _(t,e,a,i){if(e.minDate){const n=e.minDate(a,i);if(new Date(t)<new Date(n))return[`${O(t)} is less than minimum date of ${O(n)}`]}if(e.maxDate){const n=e.maxDate(a,i);if(n&&new Date(t)>new Date(n))return[`${O(t)} is greater than max date of  ${O(n)}`]}}function y(t){let e="",a="",n="",l="",c=!1;const d="year_"+t.id,y="month_"+t.id,C="day_"+t.id,D="age_estimate_"+t.id,w="duration_estimate_"+t.id,S=p(d,t.helpText,t.estimation.allowUnknown),I=g(y,t.helpText),P=m(C,t.helpText),E=f(D,t.helpText),x=b(w,t.helpText),N="boolean"===typeof t.estimation.allowUnknownMonthDay&&t.estimation.allowUnknownMonthDay,V=e=>!(e[d]&&e[d].value&&["Unknown"].includes(e[d].value))&&(!t.condition||t.condition(e)),j=(t,e)=>{const i=[{type:"year",value:a,default:"YYYY"},{type:"month",value:n,default:"MM"},{type:"day",value:l,default:"DD"}];return i.reduce((a,i)=>{const n=[null,void 0,"Unknown",""];return e===i.type?n.includes(t)?a.push(i.default):a.push(t):n.includes(i.value)?a.push(i.default):a.push(i.value),a},[]).join("-")};"function"===typeof t.init&&(S.init=t.init),S.updateHelpTextOnValue=t=>`${S.helpText} (${j(null===t||void 0===t?void 0:t.label,"year")})`,S.proxyID=t.id,S.unload=t=>a=t.value.toString(),S.config={...S.config,...t.config},S.defaultValue=e=>T(e,t,"Year"),S.condition=e=>!t.condition||t.condition(e),S.validation=(e,a,i)=>{if(t.required&&r["a"].required(e))return["Year cannot be empty"];const n=e?e.value:"";if(!t.estimation.allowUnknown&&n.toString().match(/unknown/i))return["Value unknown is not permitted"];if(n&&!["Unknown"].includes(n)&&isNaN(n)||n<1900)return["Invalid Year"];if(n&&"function"===typeof t.minDate){const e=o["c"].getYear(t.minDate(a,i));if(parseInt(n)<e)return[`Year of ${n} is less than Minimum year of ${e}`]}if(n&&"function"===typeof t.maxDate){const e=t.maxDate(a,i);if(e&&n>o["c"].getYear(e))return[`Year of ${n} exceeds Maximum year of ${o["c"].getYear(e)}`]}return null},S.summaryMapValue=()=>({label:t.summaryLabel||t.helpText,value:e?O(e):"Unknown"}),S.appearInSummary=(e,a)=>a===t.id,S.computedValue=a=>{if(e){const[,i,n]=e.split("-");return e=`${a.value}-${i}-${n}`,t.computeValue(e,!1)}if(a&&"Unknown"===a.value)return e="",t.computeValue("Unknown",!1)},I.updateHelpTextOnValue=t=>`${I.helpText} (${j(null===t||void 0===t?void 0:t.label,"month")})`,I.proxyID=t.id,I.unload=t=>n=v(t.value.toString()),I.condition=t=>V(t),I.validation=t=>r["a"].required(t),I.defaultValue=e=>T(e,t,"Month"),N&&(I.options=()=>[...s,{label:"Unknown",value:"Unknown"}]),I.computedValue=(a,i)=>{if((""+a.value).match(/unknown/i))return e=i[d].value+"-07-15",t.computeValue(e,!0);if(e){const[i,,n]=e.split("-"),s=v(""+a.value);return e=`${i}-${s}-${n}`,t.computeValue(e,!1)}},P.proxyID=t.id,P.updateHelpTextOnValue=t=>`${P.helpText} (${j(null===t||void 0===t?void 0:t.label,"day")})`,P.condition=t=>!(""+t[y].value).match(/unknown/i)&&V(t),P.validation=(i,s,o)=>r["a"].required(i)?["Day is required for date"]:(c=!!(""+i.value).match(/unknown/i),l=c?"15":v(""+i.value),e=`${a}-${n}-${l}`,_(e,t,s,o)),P.defaultValue=e=>T(e,t,"Day"),P.computedValue=()=>t.computeValue(e,c),P.unload=(e,a,i,n)=>{t.unload&&t.unload(e,a,i,n)},P.beforeNext=(a,i)=>!t.beforeNext||t.beforeNext(e,i),P.config={year:t=>t[d].value,month:t=>t[y].value},N||(P.config.keyboardActions=[]);const k=(e,a)=>{const i=["Unknown"===e[d].value,!t.condition||t.condition(e),t.estimation.estimationFieldType===a];return i.every(Boolean)};return E.proxyID=t.id,E.validation=(a,i,n)=>{if(a&&a.value>300)return["Age estimate is too high and exceeding hard limit of 300"];if(isNaN(parseInt(a.value.toString())))return["Please enter a valid number"];const s=/^(12[0-7]|1[01][0-9]|[1-9]?[0-9])$/;if(!a.value.toString().match(s))return["Not a valid age estimate"];const o=u()(h["e"].getSessionDate()).subtract(a.value,"years").year();return e=o+"-07-15",_(e,t,i,n)},E.condition=t=>k(t,i.AGE_ESTIMATE_FIELD),E.computedValue=()=>t.computeValue(e,!0),E.beforeNext=(a,i)=>!t.beforeNext||t.beforeNext(e,i),x.proxyID=t.id,x.validation=(a,i,n)=>r["a"].required(a)?["Please select an estimate"]:(e=u()(h["e"].getSessionDate()).subtract(a.value,"day").format(o["b"]),_(e,t,i,n)),x.condition=t=>k(t,i.MONTH_ESTIMATE_FIELD),x.computedValue=()=>t.computeValue(e,!0),x.beforeNext=(a,i)=>!t.beforeNext||t.beforeNext(e,i),[S,I,P,E,x]}(function(t){t["AGE_ESTIMATE_FIELD"]="age-estimate-field",t["MONTH_ESTIMATE_FIELD"]="month-period-estimate-field"})(i||(i={}))},dac2:function(t,e,a){"use strict";a.d(e,"a",(function(){return u}));var i,n=a("ade3"),s=(a("14d9"),a("71c3")),o=a("9283"),r=a("6d32"),l=a("2ef0"),c=a("cc6f"),d=a("0011");(function(t){t["CONTRAINDICATION"]="contraindication",t["SIDE_EFFECT"]="side_effect"})(i||(i={}));class u extends c["a"]{constructor(t,e){super(t,25,e),Object(n["a"])(this,"nextVisitInterval",void 0),Object(n["a"])(this,"fastTrack",void 0),Object(n["a"])(this,"regimenExtras",void 0),Object(n["a"])(this,"hangingPills",void 0),Object(n["a"])(this,"fastTrackMedications",void 0),Object(n["a"])(this,"medicationOrders",void 0),Object(n["a"])(this,"treatmentState",void 0),Object(n["a"])(this,"contraindications",void 0),Object(n["a"])(this,"sideEffects",void 0),Object(n["a"])(this,"tptPrescriptionCount",void 0),Object(n["a"])(this,"lastSideEffectDate",void 0),this.nextVisitInterval=0,this.fastTrack=!1,this.regimenExtras=[],this.fastTrackMedications=[],this.hangingPills=[],this.medicationOrders=[],this.treatmentState="",this.contraindications={},this.sideEffects={},this.tptPrescriptionCount=0,this.lastSideEffectDate=""}setNextVisitInterval(t){this.nextVisitInterval=t}getHangingPills(){return this.hangingPills}getMedicationOrders(){return this.medicationOrders.map(t=>c["a"].getCachedConceptName(t))}getTptPrescriptionCount(){return this.tptPrescriptionCount}getLastSideEffectDate(){return this.lastSideEffectDate}getContraindications(){return this.contraindications}getSideEffects(){return this.sideEffects}getRegimenExtras(){return this.regimenExtras}getPatientRegimens(){return r["a"].getRegimens(this.patientID)}getARVs(){return r["a"].getJson("arv_drugs")}getCustomIngridients(){return r["a"].getCustomIngridients()}getFastTrackMedications(){return this.fastTrackMedications}getTreatmentState(){return this.treatmentState}isFastTrack(){return this.fastTrack}medicationOrdersAvailable(){return!Object(l["isEmpty"])(this.medicationOrders)}shouldPrescribeArvs(){const t=c["a"].getCachedConceptID("Antiretroviral drugs");return this.medicationOrders.includes(t)}shouldPrescribeExtras(){const t=c["a"].getConceptsByCategory("art_extra_medication_order"),e=t.map(t=>this.medicationOrders.includes(t.concept_id));return e.some(Boolean)}getRegimenStarterpack(t,e){const a={weight:e,regimen:t};return c["a"].getJson(`programs/${c["a"].getProgramID()}/regimen_starter_packs`,a)}async getLvpDrugsByType(t,e){return c["a"].getJson(`programs/${c["a"].getProgramID()}/regimens/${e}`,{patient_id:this.patientID,lpv_drug_type:t})}async loadContraindications(){const t=await c["a"].getConceptID("Contraindications"),e=await c["a"].getObs({concept_id:t,person_id:this.patientID});e.forEach(t=>{const e=o["c"].toStandardHisFormat(t.obs_datetime);this.contraindications[e]||(this.contraindications[e]=[]);const a=c["a"].getCachedConceptName(t.value_coded);this.contraindications[e].push(a)})}async loadDrugInduced(){const t=await c["a"].getConceptID("Drug induced"),e=await c["a"].getObs({concept_id:t,person_id:this.patientID});e&&e.forEach(t=>{const e=o["c"].toStandardHisFormat(t.obs_datetime);if(this.lastSideEffectDate||(this.lastSideEffectDate=e),!t.value_drug||!t.value_coded)return;this.sideEffects[e]||(this.sideEffects[e]={}),this.sideEffects[e][t.value_drug]||(this.sideEffects[e][t.value_drug]=[]);const a=c["a"].getCachedConceptName(t.value_coded);this.sideEffects[e][t.value_drug].push(a)})}async loadTptPrescriptionCount(){const t=await c["a"].getJson("tpt_prescription_count",{patient_id:this.patientID,date:this.date});if(t){const e=t.count+1;this.tptPrescriptionCount=e>3?3:e}}async loadFastTrackStatus(){const t=await c["a"].getFirstValueCoded(this.patientID,"Fast track"),e=await c["a"].getConceptID("yes");t&&(this.fastTrack=t===e)}async loadRegimenExtras(t=this.date){const e=await r["a"].getJson(`programs/${r["a"].getProgramID()}/patients/${this.patientID}/dosages`,{date:t});e&&(this.regimenExtras=Object.values(e))}async loadMedicationOrders(){const t=await c["a"].getConceptID("Medication orders"),e=await c["a"].getObs({concept_id:t,date:this.date,person_id:this.patientID,page_size:5});this.medicationOrders=e.map(t=>t.value_coded)}async loadHangingPills(){const t=await c["a"].getAll(this.patientID,"Pills brought")||[];this.hangingPills=t.filter(t=>t.value_numeric>=1&&(!(!t.value_drug||Object(d["h"])(t.obs_datetime)!==Object(d["h"])(this.date))||(t.order||!1))).map(t=>{var e;return(null===t||void 0===t||null===(e=t.order)||void 0===e||null===(e=e.drug_order)||void 0===e?void 0:e.drug_inventory_id)||t.value_drug})}async loadFastTrackMedications(){const t=await s["a"].getLastDrugsReceived(this.patientID),e=t.map(async t=>{const{drug:e}=t,a=await s["a"].getDrugDosages(this.patientID,e.drug_id);return{drug_id:e.drug_id,drug_name:e.name,units:e.units,am:a.am,noon:a.noon,pm:a.pm,frequency:t.frequency}});this.fastTrackMedications=await Promise.all(e)}async loadTreatmentState(){const t={date:this.date},e=await c["a"].getJson(`programs/${c["a"].getProgramID()}/patients/${this.patientID}/status`,t);e&&(this.treatmentState=e["status"])}findAndGroupDrugSideEffects(t){const e={};for(const a in this.sideEffects){const i=this.sideEffects[a];for(const n in i)t.includes(parseInt(n))&&(e[a]||(e[a]=[]),e[a]=[...e[a],...i[n]])}return e}calculatePillsPerDay(t,e,a){return parseFloat(t.toString())+e+a}estimatePackSize(t,e=0){const a=t*this.nextVisitInterval/(e||1);let i=Math.round(a);return i<=0&&(i+=1),i}calculateDosage(t,e){let a=0;return 0===e&&(a=t),0==t&&(a=e),t>0&&e>0&&(a=(t+e)/2),a}calculateEquivalentDosage(t,e){return t+e}calculateDateFromInterval(){const t=new Date(this.date);return t.setDate(t.getDate()+this.nextVisitInterval),o["c"].toStandardHisFormat(t)}getDrugPackSize(t){if(t.pack_size)return t.pack_size;try{return t.barcodes[0].tabs}catch(e){return 30}}getInstructions(t,e,a,i){return`${t} :- Morning: ${e} ${i}, Evening: ${a} ${i}`}toOrderObj(t,e,a,i=0,n=0,s=""){return{drug_inventory_id:t,equivalent_daily_dose:this.calculateEquivalentDosage(i,n),start_date:this.date,auto_expire_date:this.calculateDateFromInterval(),units:a,instructions:this.getInstructions(e,i,n,a),dose:this.calculateDosage(i,n),frequency:s}}async getReasonForRegimenSwitch(){const t=await c["a"].getFirstValueText(this.patientID,"Reason for ARV switch");return t||"N/A"}async createDrugOrder(t){return s["a"].create({encounter_id:this.encounterID,drug_orders:t})}async createHangingPillsObs(t){return this.saveValueTextObs("appointment type",t)}async createRegimenSwitchObs(t){return this.saveValueTextObs("Reason for ARV switch",t)}}},e86e:function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"d",(function(){return o})),a.d(e,"c",(function(){return r})),a.d(e,"g",(function(){return l})),a.d(e,"f",(function(){return c})),a.d(e,"a",(function(){return d})),a.d(e,"h",(function(){return u})),a.d(e,"i",(function(){return h})),a.d(e,"j",(function(){return p})),a.d(e,"e",(function(){return g}));var i=a("5713"),n=a("2ef0");async function s(t=""){const e=await i["a"].getFacilities({name:t});return e.filter(t=>!Object(n["isEmpty"])(t)&&""!=t.name.trim()).map(t=>({label:t.name,value:t.location_id,other:t}))}async function o(t=""){const e=await i["a"].getLabs({search_name:t});return e.map(t=>({label:t,value:t}))}async function r(t=""){const e=await i["a"].getFacilities({name:t,tag:"Facility adult sections"});return e.map(t=>({label:t.name,value:t.name,other:t}))}async function l(){const t=await i["a"].getSpecialistClinics();return t.map(t=>({label:t.name,value:t.name,other:t}))}async function c(){const t=await i["a"].getRegions();return t.map(t=>({label:t.name,value:t.region_id,other:t}))}async function d(t){const e=await i["a"].getDistricts(t);return e.map(t=>({label:t.name,value:t.district_id,other:t}))}async function u(t,e=""){const a=await i["a"].getTraditionalAuthorities(t,e);return a.map(t=>({label:t.name,value:t.traditional_authority_id,other:t}))}async function h(t,e=""){const a=await i["a"].getVillages(t,e);return a.map(t=>({label:t.name,value:t.village_id,other:t}))}async function p(t="a",e=1){const a=await i["a"].getVillagesByName(t,e);return a.map(t=>({label:t.name,value:t.village_id,other:t}))}function g(){const t=["Catholic Church","CCAP","Seventh Day","Mosque","Primary School","Borehole","Secondary School","College","Market","Football Ground","Other"];return t.map(t=>({label:t,value:t,other:{code:t}}))}}}]);
//# sourceMappingURL=chunk-7e88c81c.43151837.js.map