(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2e5c7e4b"],{1648:function(t,e,n){"use strict";n.r(e);var o=n("7a23");function a(t,e,n,a,r,s){const i=Object(o["resolveComponent"])("date-range-picker"),c=Object(o["resolveComponent"])("ion-col"),l=Object(o["resolveComponent"])("line-chart"),d=Object(o["resolveComponent"])("ion-row"),u=Object(o["resolveComponent"])("ion-grid"),p=Object(o["resolveComponent"])("layout");return Object(o["openBlock"])(),Object(o["createBlock"])(p,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(u,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(d,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(c,{size:"5",offset:"7",class:"ion-padding"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,{range:t.range,onRangeChange:t.fetchData},null,8,["range","onRangeChange"])]),_:1}),Object(o["createVNode"])(c,{size:"12"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(l,{series:t.series,options:t.options,onPointSelection:t.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})]),_:1})}n("14d9");var r=n("8d56"),s=n("c5be"),i=n("d867"),c=n("2ef0"),l=n("7717"),d=n("ad8d"),u=n("b211"),p=n("23e6"),b=n("da44"),h=n("564f"),m=n("6605"),g=n("9283"),f=n("5a0c"),O=n.n(f),j=n("0011"),y=Object(o["defineComponent"])({components:{Layout:r["a"],LineChart:s["a"],IonGrid:i["IonGrid"],IonRow:i["IonRow"],IonCol:i["IonCol"],DateRangePicker:l["a"]},setup(){const t=Object(m["i"])(),e=Object(o["reactive"])({}),n=Object(o["ref"])([]),a={title:{text:"Patient Vists Statistics",align:"left"}},r=(t,e)=>e.map(e=>t[e]),s=(t,e)=>e.map(e=>[new Date(e).getTime(),t[e].length]),i=(t,e,n,o)=>{e in n||(n[e]=[]);const a=Object.entries(t[e]).filter(([t,e])=>o(e.patient_present,e.guardian_present)).map(([t])=>t);return n[e]=[...n[e],...a],n},l=t=>{const e=Object(c["uniq"])(Object.keys(t)),n={},o={},a={};for(const r in t)i(t,r,n,(t,e)=>t&&!e),i(t,r,o,(t,e)=>!t&&e),i(t,r,a,(t,e)=>t&&e);return[{name:"Patient present",raw:r(n,e),data:s(n,e)},{name:"Guardian present",raw:r(o,e),data:s(o,e)},{name:"Both patient and guardian present",raw:r(a,e),data:s(a,e)}]},f=async t=>{u["a"].show(),Object.assign(e,t);const o=new d["b"];o.setStartDate(t.startDate),o.setEndDate(t.endDate);const a=await o.getPatientVisitTypes();n.value=l(a),u["a"].hide()},y=async e=>{if(!Object(c["isEmpty"])(n.value))try{const{dataPointIndex:a,seriesIndex:r}=e,s=r<=0?0:r,i=[{path:"arv_number",label:"ARV Number",initialSort:!0,initialSortOrder:"asc"},{path:"birthdate",label:"Date of Birth",formatter:t=>O()(t).format(g["a"])},{path:"gender",label:"Gender",formatter:j["f"]},{path:"address",label:"Address"}],c=Object(o["ref"])([]),l=async()=>{for(const t of n.value[s].raw[a]){const e=await p["a"].findByID(t),n=new p["a"](e);c.value.push({arv_number:n.getArvNumber(),birthdate:n.getBirthdate(),gender:n.getGender(),address:""+n.getCurrentVillage(),...e})}};l();const d=[{label:"Select",default:!0,action:e=>{t.push("/emc/patient/"+e["patient_id"])}}];await b["a"].show(h["a"],{title:"Patient Drilldown",columns:i,rows:c.value,rowActionButtons:d})}catch(a){console.log(a)}};return{range:e,series:n,options:a,fetchData:f,pointSelection:y}}}),w=n("d959"),C=n.n(w);const I=C()(y,[["render",a]]);e["default"]=I},"40e3":function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var o=n("4971"),a=n("2ef0"),r=n("1c74"),s=n("5a0c"),i=n.n(s);function c(t){try{return t.replace(/<(?:.|\n)*?>/gm," ").replace(/\n/g," ").replace(/\t/g," ").replace(/\s{2,}/g," ").replace(/=/g," ").replace(/,/g," ").trim()}catch(e){return t}}function l({columns:t,rows:e,quarter:n,period:s,filters:l}){let d=t.filter(t=>!1!==t.exportable).map(t=>t.label).join(",");return d+="\n",d+=Object(o["sortRows"])(e,(null===l||void 0===l?void 0:l.sort)||[]).map(e=>t.filter(t=>!1!==t.exportable).map(t=>{let n=Object(a["get"])(e,t.path);return"function"===typeof t.formatter&&n&&(n=t.formatter(n,e)),c(t.drillable&&Array.isArray(n)?n.length:n)}).join(",")).join("\n"),d+="\nDate Created:  "+i()().format("DD/MMM/YYYY HH:MM:ss"),n&&(d+="\nQuarter: "+n),s&&(d+="\nQuarter: "+s),d+="\ne-Mastercard Version : "+r["e"].getAppVersion(),d+="\nAPI Version "+r["e"].getApiVersion(),d+="\nSite UUID: "+r["e"].getSiteUUID(),d}function d(t){const e=new Blob([l(t)],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.setAttribute("download",t.filename+".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},"564f":function(t,e,n){"use strict";var o=n("7a23");function a(t,e,n,a,r,s){const i=Object(o["resolveComponent"])("IonIcon"),c=Object(o["resolveComponent"])("IonButton"),l=Object(o["resolveComponent"])("IonButtons"),d=Object(o["resolveComponent"])("IonTitle"),u=Object(o["resolveComponent"])("IonToolbar"),p=Object(o["resolveComponent"])("IonHeader"),b=Object(o["resolveComponent"])("data-table"),h=Object(o["resolveComponent"])("IonContent"),m=Object(o["resolveComponent"])("IonPage");return Object(o["openBlock"])(),Object(o["createBlock"])(m,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(p,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(u,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(l,{slot:"end"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(c,{slot:"end",onClick:e[0]||(e[0]=e=>t.modal.hide()),"icon-only":""},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,{icon:t.close},null,8,["icon"])]),_:1})]),_:1}),Object(o["createVNode"])(d,null,{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(t.title),1)]),_:1})]),_:1})]),_:1}),Object(o["createVNode"])(h,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(b,{rows:t.rows,"async-rows":t.asyncRows,columns:t.columns,"row-actions-buttons":t.rowActionButtons,"actions-buttons":t.actionBtns,color:"custom"},null,8,["rows","async-rows","columns","row-actions-buttons","actions-buttons"])]),_:1})]),_:1})}n("14d9");var r=n("d867"),s=n("4971"),i=n("ff79"),c=n("da44"),l=n("5a0c"),d=n.n(l),u=n("40e3"),p=Object(o["defineComponent"])({name:"DrilldownTable",components:{DataTable:s["DataTable"],IonButton:r["IonButton"],IonPage:r["IonPage"],IonHeader:r["IonHeader"],IonContent:r["IonContent"],IonToolbar:r["IonToolbar"],IonButtons:r["IonButtons"],IonTitle:r["IonTitle"],IonIcon:r["IonIcon"]},props:{title:{type:String,default:"Report"},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},columns:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},actionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},period:{type:String,default:""}},setup(t){const e=Object(o["computed"])(()=>{const e=[...t.actionButtons];return t.canExportCsv&&e.push({label:"CSV",color:"primary",action:async(e,n,o,a)=>Object(u["a"])({rows:n,filters:o,columns:a,period:t.period.includes("Custom")?t.period.substring(6):t.period,filename:`${t.title}-${d()().format("DD-MMM-YYYY")}`})}),e});return{close:i["close"],modal:c["a"],actionBtns:e}}}),b=n("d959"),h=n.n(b);const m=h()(p,[["render",a]]);e["a"]=m},5969:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var o=n("ade3"),a=(n("14d9"),n("1c74")),r=n("9283"),s=n("bef6"),i=n("5a0c"),c=n.n(i);class l extends a["e"]{constructor(){super(),Object(o["a"])(this,"programID",void 0),Object(o["a"])(this,"startDate",void 0),Object(o["a"])(this,"endDate",void 0),Object(o["a"])(this,"date",void 0),Object(o["a"])(this,"quarter",void 0),this.endDate="",this.startDate="",this.quarter="",this.date=a["e"].getSessionDate(),this.programID=a["e"].getProgramID()}getDateIntervalPeriod(){return`${r["c"].toStandardHisDisplayFormat(this.startDate)} - ${r["c"].toStandardHisDisplayFormat(this.endDate)}`}setStartDate(t){this.startDate=t}setEndDate(t){this.endDate=t}setQuarter(t){this.quarter=t}getReport(t,e={}){return a["e"].getJson(t,this.buildRequest(e))}getMaternalStatus(t,e="pepfar"){const n=s["a"].parameterizeObjToString(this.buildRequest({report_definition:e}));return a["e"].postJson("vl_maternal_status?"+n,{patient_ids:t})}buildRequest(t={}){const e={date:this.date,program_id:this.programID};return this.startDate&&this.endDate&&(e["start_date"]=this.startDate,e["end_date"]=this.endDate),this.quarter&&(e["quarter"]=this.quarter),{...e,...t}}static getQuarterBounds(t){const e=e=>c()(`${t}-${e}-01`).daysInMonth(),n=e=>`${t}-${e}-01 00:00`,o=n=>`${t}-${n}-${e(n)} 00:00`;return{Q1:{qtr:1,start:n("01"),end:o("03")},Q2:{qtr:2,start:n("04"),end:o("06")},Q3:{qtr:3,start:n("07"),end:o("09")},Q4:{qtr:4,start:n("10"),end:o("12")}}}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const n in e){const{start:o,end:a}=e[n];if(t>=new Date(o)&&t<=new Date(a))return e[n]}return null}static buildQtrObj(t,e){const n=this.getQuarterBounds(e),{start:o,end:a}=n[t];return{start:o,end:a,name:`${t} ${e}`}}static getReportQuarters(t=5){const e=[];let n=new Date,o=n.getFullYear();const a=o;n=new Date(`${a}-${n.getMonth()+1}-${n.getDate()} 00:00`);const r=this.getQtrByDate(n);let s=r.qtr,i=0;4===s&&e.push(this.buildQtrObj("Q1",o+1));while(i<t)0===i&&s<4&&e.push(this.buildQtrObj("Q"+(s+1),o)),e.push(this.buildQtrObj("Q"+s,o)),s=s>0?s-=1:s,o=0==s?o-1:o,s=0==s?s+=4:s,i++;return e}}},7717:function(t,e,n){"use strict";var o=n("7a23");function a(t,e,n,a,r,s){const i=Object(o["resolveComponent"])("ion-input"),c=Object(o["resolveComponent"])("ion-col"),l=Object(o["resolveComponent"])("ion-icon"),d=Object(o["resolveComponent"])("ion-row"),u=Object(o["resolveComponent"])("ion-grid");return Object(o["openBlock"])(),Object(o["createBlock"])(u,{class:"ion-no-padding ion-no-margin",style:{height:"100%"}},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(d,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(c,{size:"6"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,{modelValue:t.start,"onUpdate:modelValue":e[0]||(e[0]=e=>t.start=e),type:"date",class:"box",style:{width:"100%",height:"100%"}},null,8,["modelValue"])]),_:1}),Object(o["createVNode"])(c,{size:"1",style:{display:"flex","justify-content":"center"}},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(l,{icon:t.arrowForward,style:Object(o["normalizeStyle"])({fontSize:"24px",padding:".5rem"})},null,8,["icon","style"])]),_:1}),Object(o["createVNode"])(c,{size:"5"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,{modelValue:t.end,"onUpdate:modelValue":e[1]||(e[1]=e=>t.end=e),type:"date",class:"box",style:{width:"100%",height:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})}var r=n("d867"),s=n("ff79"),i=n("5a0c"),c=n.n(i),l=n("b5e4"),d=Object(o["defineComponent"])({name:"DateRangePicker",components:{IonInput:r["IonInput"],IonGrid:r["IonGrid"],IonRow:r["IonRow"],IonCol:r["IonCol"],IonIcon:r["IonIcon"]},props:{range:{type:Object,default:()=>({startDate:"",endDate:""})}},emits:["rangeChange"],setup(t,{emit:e}){const n=Object(o["ref"])(t.range.startDate),a=Object(o["ref"])(t.range.endDate),r=(t,e)=>!(!c()(t).isSame(e)&&!c()(t).isBefore(e))||(Object(l["e"])("Start date must be before or equal to end date"),!1),i=Object(o["computed"])(()=>{if(n.value&&a.value&&r(n.value,a.value))return{startDate:n.value,endDate:a.value}});return Object(o["watch"])(i,t=>{t&&e("rangeChange",t)}),{arrowForward:s["arrowForward"],start:n,end:a}}}),u=n("d959"),p=n.n(u);const b=p()(d,[["render",a]]);e["a"]=b},ad8d:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r}));var o=n("5969");const a=["<1 year","1-4 years","5-9 years","10-14 years","15-19 years","20-24 years","25-29 years","30-34 years","35-39 years","40-44 years","45-49 years","50-54 years","55-59 years","60-64 years","65-69 years","70-74 years","75-79 years","80-84 years","85-89 years","90 plus years"];class r extends o["a"]{constructor(){super()}getBookedAppointments(t){return o["a"].getJson(`programs/${this.programID}/scheduled_appointments`,{date:t})}getViralLoadResults(t){return this.getReport(`/programs/${this.programID}/reports/high_vl_patients`,{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport(`/programs/${this.programID}/reports/retention`)}getExternalConsultationClients(){return this.getReport(this.programID+"/external_consultation_clients")}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport(`/programs/${this.programID}/reports/pregnant_patients`)}getArchivingCandidates(){return o["a"].getJson(`programs/${this.programID}/reports/archiving_candidates`,{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}}},c5be:function(t,e,n){"use strict";var o=n("7a23");function a(t,e,n,a,r,s){const i=Object(o["resolveComponent"])("apex-chart"),c=Object(o["resolveComponent"])("ion-card-content"),l=Object(o["resolveComponent"])("ion-card");return Object(o["openBlock"])(),Object(o["createBlock"])(l,{class:"his-card",style:{height:"100%"}},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(c,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,{width:"100%",height:t.height,type:"line",options:t.chartOptions,series:t.series,onClick:e[0]||(e[0]=(e,n,o)=>t.$emit("pointSelection",o))},null,8,["height","options","series"])]),_:1})]),_:1})}var r=n("d867"),s=n("ae27"),i=n.n(s),c=Object(o["defineComponent"])({name:"LineChart",props:{series:{type:Array,default:()=>[]},options:{type:Object,default:()=>[]},height:{type:[String,Number],default:560},placeholder:{type:String,default:"Loading data..."}},components:{IonCard:r["IonCard"],IonCardContent:r["IonCardContent"],ApexChart:i.a},emits:["pointSelection"],setup(t){const e=Object(o["computed"])(()=>{const e={chart:{id:"line-chart",type:"line"},xaxis:{type:"datetime",tickAmount:2,labels:{show:!0,rotate:-75}},tooltip:{x:{format:"dd/MMM/yyyy"}},title:{text:"Line Chart",align:"left"},noData:{text:t.placeholder,align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{color:"#a7a7a7",fontSize:"25px",fontFamily:"Helvetica"}}};for(const n in t.options)e[n]={...e[n],...t.options[n]};return e});return{chartOptions:e}}}),l=n("d959"),d=n.n(l);const u=d()(c,[["render",a]]);e["a"]=u},da44:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var o=n("d867");const a={async show(t,e,n="custom-modal",a=!0){const r=await o["modalController"].create({component:t,cssClass:n,backdropDismiss:a,componentProps:e});r.present();const{data:s}=await r.onWillDismiss();if(s)return s},async hide(t){await o["modalController"].dismiss(t)}}}}]);
//# sourceMappingURL=chunk-2e5c7e4b.22fc3b6b.js.map