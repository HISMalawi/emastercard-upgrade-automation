(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8f194e9a"],{1648:function(t,e,n){"use strict";n.r(e);var a=n("7a23");const o={class:"his-card"};function r(t,e,n,r,s,i){const c=Object(a["resolveComponent"])("date-range-picker"),l=Object(a["resolveComponent"])("ion-col"),d=Object(a["resolveComponent"])("ion-label"),u=Object(a["resolveComponent"])("ion-badge"),p=Object(a["resolveComponent"])("ion-item"),b=Object(a["resolveComponent"])("ion-list"),h=Object(a["resolveComponent"])("line-chart"),O=Object(a["resolveComponent"])("ion-row"),m=Object(a["resolveComponent"])("ion-grid"),j=Object(a["resolveComponent"])("layout");return Object(a["openBlock"])(),Object(a["createBlock"])(j,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(m,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(O,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{size:"5",offset:"7",class:"ion-padding"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(c,{range:t.range,onRangeChange:t.fetchData},null,8,["range","onRangeChange"])]),_:1}),Object(a["createVNode"])(l,{size:"2",class:"ion-padding-top"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",o,[Object(a["createVNode"])(b,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,{button:"",onClick:e[0]||(e[0]=e=>t.drilldown(t.totalAttendance,"Total Attendance"))},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Total Attendance ")]),_:1}),Object(a["createVNode"])(u,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(t.totalAttendance.length),1)]),_:1})]),_:1}),Object(a["createVNode"])(p,{button:"",onClick:e[1]||(e[1]=e=>t.drilldown(t.totalPatientVisits,"Total patient visits"))},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Patient Visit ")]),_:1}),Object(a["createVNode"])(u,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(t.totalPatientVisits.length),1)]),_:1})]),_:1}),Object(a["createVNode"])(p,{button:"",onClick:e[2]||(e[2]=e=>t.drilldown(t.totalGuardianVisits,"Total guardian visits"))},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Guardian Visit ")]),_:1}),Object(a["createVNode"])(u,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(t.totalGuardianVisits.length),1)]),_:1})]),_:1})]),_:1})])]),_:1}),Object(a["createVNode"])(l,{size:"10"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(h,{series:t.series,options:t.options,onPointSelection:t.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})]),_:1})}n("14d9");var s=n("8d56"),i=n("c5be"),c=n("d867"),l=n("2ef0"),d=n("7717"),u=n("ad8d"),p=n("b211"),b=n("23e6"),h=n("da44"),O=n("564f"),m=n("6605"),j=n("9283"),g=n("0011"),f=n("3a8c"),w=Object(a["defineComponent"])({components:{Layout:s["a"],LineChart:i["a"],IonGrid:c["IonGrid"],IonRow:c["IonRow"],IonCol:c["IonCol"],DateRangePicker:d["a"]},setup(){const t=Object(m["i"])(),e=Object(a["reactive"])({}),n=Object(a["ref"])([]),o=Object(a["computed"])(()=>{var t;return(null===(t=n.value[0])||void 0===t?void 0:t.raw.flat())||[]}),r=Object(a["computed"])(()=>{var t;return(null===(t=n.value[1])||void 0===t?void 0:t.raw.flat())||[]}),s=Object(a["computed"])(()=>n.value.map(({raw:t})=>t).flat(3)),i={title:{text:"Patient Vists Statistics",align:"left"},yaxis:{title:{text:"Number of clients"},plotAreaHeight:800}},c=t=>{const e={},n={},a={},o=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(t).forEach(([t,r])=>{e[t]=[],n[t]=[],a[t]=[],Object.entries(r).forEach(([o,{patient_present:r,guardian_present:s}])=>{s&&r?a[t].push({patientId:o,date:t}):r?e[t].push({patientId:o,date:t}):s&&n[t].push({patientId:o,date:t})});const s=new Date(t).getTime();o[0].data.push([s,e[t].length]),o[0].raw.push(e[t]),o[1].data.push([s,n[t].length]),o[1].raw.push(n[t]),o[2].data.push([s,a[t].length]),o[2].raw.push(a[t])}),o},d=async t=>{p["a"].show(),Object.assign(e,t);const a=new u["b"];a.setStartDate(t.startDate),a.setEndDate(t.endDate);const o=await a.getPatientVisitTypes();n.value=c(o),p["a"].hide()},w=async t=>{const e=await b["a"].findByID(t),n=new b["a"](e);return{arv_number:n.getArvNumber(),birthdate:n.getBirthdate(),gender:n.getGender(),address:""+n.getCurrentVillage(),...e}},C=async(e,n="Drill down clients")=>{if(Object(l["isEmpty"])(e))return;const o=[{path:"arv_number",label:"ARV Number",initialSort:!0,initialSortOrder:"asc",preSort:f["a"]},{path:"birthdate",label:"Date of Birth",formatter:j["c"].toStandardHisDisplayFormat},{path:"gender",label:"Gender",formatter:g["g"]},{path:"date",label:"Visit Date",formatter:j["c"].toStandardHisDisplayFormat},{path:"address",label:"Address"}],r=Object(a["ref"])([]),s=async()=>{for(const{patientId:t,date:n}of e){const e=await w(t);r.value.push({...e,date:n})}};s();const i=[{label:"Select",action:e=>t.push("/emc/patient/"+e["patient_id"])}];await h["a"].show(O["a"],{title:n,columns:o,rows:r.value,rowActionButtons:i})},y=async(t,e)=>{if(!Object(l["isEmpty"])(n.value))try{await C(n.value[e].raw[t],n.value[e].name+" visits")}catch(a){console.error(a)}};return{range:e,series:n,options:i,totalAttendance:s,totalPatientVisits:o,totalGuardianVisits:r,fetchData:d,pointSelection:y,drilldown:C}}}),C=n("d959"),y=n.n(C);const v=y()(w,[["render",r]]);e["default"]=v},"3a8c":function(t,e,n){"use strict";function a(t){return parseInt(t.split("-")[2])||0}n.d(e,"a",(function(){return a}))},"40e3":function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var a=n("4971"),o=n("2ef0"),r=n("1c74"),s=n("5a0c"),i=n.n(s);function c(t){try{return t.replace(/<(?:.|\n)*?>/gm," ").replace(/\n/g," ").replace(/\t/g," ").replace(/\s{2,}/g," ").replace(/=/g," ").replace(/,/g," ").trim()}catch(e){return t}}function l({columns:t,rows:e,quarter:n,period:s,filters:l}){let d=t.filter(t=>!1!==t.exportable).map(t=>t.label).join(",");return d+="\n",d+=Object(a["sortRows"])(e,(null===l||void 0===l?void 0:l.sort)||[]).map(e=>t.filter(t=>!1!==t.exportable).map(t=>{let n=Object(o["get"])(e,t.path);return"function"===typeof t.formatter&&n&&(n=t.formatter(n,e)),c(t.drillable&&Array.isArray(n)?n.length:n)}).join(",")).join("\n"),d+="\nDate Created:  "+i()().format("DD/MMM/YYYY HH:MM:ss"),n&&(d+="\nQuarter: "+n),s&&(d+="\nQuarter: "+s),d+="\ne-Mastercard Version : "+r["e"].getAppVersion(),d+="\nAPI Version "+r["e"].getApiVersion(),d+="\nSite UUID: "+r["e"].getSiteUUID(),d}function d(t){const e=new Blob([l(t)],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.setAttribute("download",t.filename+".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},"564f":function(t,e,n){"use strict";var a=n("7a23");function o(t,e,n,o,r,s){const i=Object(a["resolveComponent"])("IonIcon"),c=Object(a["resolveComponent"])("IonButton"),l=Object(a["resolveComponent"])("IonButtons"),d=Object(a["resolveComponent"])("IonTitle"),u=Object(a["resolveComponent"])("IonToolbar"),p=Object(a["resolveComponent"])("IonHeader"),b=Object(a["resolveComponent"])("data-table"),h=Object(a["resolveComponent"])("IonContent"),O=Object(a["resolveComponent"])("IonPage");return Object(a["openBlock"])(),Object(a["createBlock"])(O,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{slot:"end"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(c,{slot:"end",onClick:e[0]||(e[0]=e=>t.modal.hide()),"icon-only":""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{icon:t.close},null,8,["icon"])]),_:1})]),_:1}),Object(a["createVNode"])(d,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(t.title),1)]),_:1})]),_:1})]),_:1}),Object(a["createVNode"])(h,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,{rows:t.rows,"async-rows":t.asyncRows,columns:t.columns,"row-actions-buttons":t.rowActionButtons,"actions-buttons":t.actionBtns,color:"custom"},null,8,["rows","async-rows","columns","row-actions-buttons","actions-buttons"])]),_:1})]),_:1})}n("14d9");var r=n("d867"),s=n("4971"),i=n("ff79"),c=n("da44"),l=n("5a0c"),d=n.n(l),u=n("40e3"),p=Object(a["defineComponent"])({name:"DrilldownTable",components:{DataTable:s["DataTable"],IonButton:r["IonButton"],IonPage:r["IonPage"],IonHeader:r["IonHeader"],IonContent:r["IonContent"],IonToolbar:r["IonToolbar"],IonButtons:r["IonButtons"],IonTitle:r["IonTitle"],IonIcon:r["IonIcon"]},props:{title:{type:String,default:"Report"},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},columns:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},actionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},period:{type:String,default:""}},setup(t){const e=Object(a["computed"])(()=>{const e=[...t.actionButtons];return t.canExportCsv&&e.push({label:"CSV",color:"primary",action:async(e,n,a,o)=>Object(u["a"])({rows:n,filters:a,columns:o,period:t.period.includes("Custom")?t.period.substring(6):t.period,filename:`${t.title}-${d()().format("DD-MMM-YYYY")}`})}),e});return{close:i["close"],modal:c["a"],actionBtns:e}}}),b=n("d959"),h=n.n(b);const O=h()(p,[["render",o]]);e["a"]=O},5969:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var a=n("ade3"),o=(n("14d9"),n("1c74")),r=n("9283"),s=n("bef6"),i=n("5a0c"),c=n.n(i);class l extends o["e"]{constructor(){super(),Object(a["a"])(this,"programID",void 0),Object(a["a"])(this,"startDate",void 0),Object(a["a"])(this,"endDate",void 0),Object(a["a"])(this,"date",void 0),Object(a["a"])(this,"quarter",void 0),this.endDate="",this.startDate="",this.quarter="",this.date=o["e"].getSessionDate(),this.programID=o["e"].getProgramID()}getDateIntervalPeriod(){return`${r["c"].toStandardHisDisplayFormat(this.startDate)} - ${r["c"].toStandardHisDisplayFormat(this.endDate)}`}setStartDate(t){this.startDate=t}setEndDate(t){this.endDate=t}setQuarter(t){this.quarter=t}getReport(t,e={}){return o["e"].getJson(t,this.buildRequest(e))}getMaternalStatus(t,e="pepfar"){const n=s["a"].parameterizeObjToString(this.buildRequest({report_definition:e}));return o["e"].postJson("vl_maternal_status?"+n,{patient_ids:t})}buildRequest(t={}){const e={date:this.date,program_id:this.programID};return this.startDate&&this.endDate&&(e["start_date"]=this.startDate,e["end_date"]=this.endDate),this.quarter&&(e["quarter"]=this.quarter),{...e,...t}}static getQuarterBounds(t){const e=e=>c()(`${t}-${e}-01`).daysInMonth(),n=e=>`${t}-${e}-01 00:00`,a=n=>`${t}-${n}-${e(n)} 00:00`;return{Q1:{qtr:1,start:n("01"),end:a("03")},Q2:{qtr:2,start:n("04"),end:a("06")},Q3:{qtr:3,start:n("07"),end:a("09")},Q4:{qtr:4,start:n("10"),end:a("12")}}}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const n in e){const{start:a,end:o}=e[n];if(t>=new Date(a)&&t<=new Date(o))return e[n]}return null}static buildQtrObj(t,e){const n=this.getQuarterBounds(e),{start:a,end:o}=n[t];return{start:a,end:o,name:`${t} ${e}`}}static getReportQuarters(t=5){const e=[];let n=new Date,a=n.getFullYear();const o=a;n=new Date(`${o}-${n.getMonth()+1}-${n.getDate()} 00:00`);const r=this.getQtrByDate(n);let s=r.qtr,i=0;4===s&&e.push(this.buildQtrObj("Q1",a+1));while(i<t)0===i&&s<4&&e.push(this.buildQtrObj("Q"+(s+1),a)),e.push(this.buildQtrObj("Q"+s,a)),s=s>0?s-=1:s,a=0==s?a-1:a,s=0==s?s+=4:s,i++;return e}}},7717:function(t,e,n){"use strict";var a=n("7a23");function o(t,e,n,o,r,s){const i=Object(a["resolveComponent"])("ion-input"),c=Object(a["resolveComponent"])("ion-col"),l=Object(a["resolveComponent"])("ion-icon"),d=Object(a["resolveComponent"])("ion-row"),u=Object(a["resolveComponent"])("ion-grid");return Object(a["openBlock"])(),Object(a["createBlock"])(u,{class:"ion-no-padding ion-no-margin",style:{height:"100%"}},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(c,{size:"6"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{modelValue:t.start,"onUpdate:modelValue":e[0]||(e[0]=e=>t.start=e),type:"date",class:"box",style:{width:"100%",height:"100%"}},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(c,{size:"1",style:{display:"flex","justify-content":"center"}},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{icon:t.arrowForward,style:{fontSize:"24px",padding:".5rem"}},null,8,["icon"])]),_:1}),Object(a["createVNode"])(c,{size:"5"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{modelValue:t.end,"onUpdate:modelValue":e[1]||(e[1]=e=>t.end=e),type:"date",class:"box",style:{width:"100%",height:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})}var r=n("d867"),s=n("ff79"),i=n("5a0c"),c=n.n(i),l=n("b5e4"),d=Object(a["defineComponent"])({name:"DateRangePicker",components:{IonInput:r["IonInput"],IonGrid:r["IonGrid"],IonRow:r["IonRow"],IonCol:r["IonCol"],IonIcon:r["IonIcon"]},props:{range:{type:Object,default:()=>({startDate:"",endDate:""})}},emits:["rangeChange"],setup(t,{emit:e}){const n=Object(a["ref"])(t.range.startDate),o=Object(a["ref"])(t.range.endDate),r=(t,e)=>!(!c()(t).isSame(e)&&!c()(t).isBefore(e))||(Object(l["e"])("Start date must be before or equal to end date"),!1),i=Object(a["computed"])(()=>{if(n.value&&o.value&&r(n.value,o.value))return{startDate:n.value,endDate:o.value}});return Object(a["watch"])(i,t=>{t&&e("rangeChange",t)}),{arrowForward:s["arrowForward"],start:n,end:o}}}),u=n("d959"),p=n.n(u);const b=p()(d,[["render",o]]);e["a"]=b},ad8d:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return r}));var a=n("5969");const o=["<1 year","1-4 years","5-9 years","10-14 years","15-19 years","20-24 years","25-29 years","30-34 years","35-39 years","40-44 years","45-49 years","50-54 years","55-59 years","60-64 years","65-69 years","70-74 years","75-79 years","80-84 years","85-89 years","90 plus years"];class r extends a["a"]{constructor(){super()}getBookedAppointments(t){return a["a"].getJson(`programs/${this.programID}/scheduled_appointments`,{date:t})}getViralLoadResults(t){return this.getReport(`/programs/${this.programID}/reports/high_vl_patients`,{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport(`/programs/${this.programID}/reports/retention`)}getExternalConsultationClients(){return this.getReport(this.programID+"/external_consultation_clients")}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport(`/programs/${this.programID}/reports/pregnant_patients`)}getArchivingCandidates(){return a["a"].getJson(`programs/${this.programID}/reports/archiving_candidates`,{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}}},c5be:function(t,e,n){"use strict";var a=n("7a23");function o(t,e,n,o,r,s){const i=Object(a["resolveComponent"])("apex-chart"),c=Object(a["resolveComponent"])("ion-card-content"),l=Object(a["resolveComponent"])("ion-card");return Object(a["openBlock"])(),Object(a["createBlock"])(l,{class:"his-card",style:{height:"100%"}},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(c,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{width:"100%",height:t.height,type:"line",options:t.chartOptions,series:t.series,onMarkerClick:t.onPointSelection},null,8,["height","options","series","onMarkerClick"])]),_:1})]),_:1})}var r=n("d867"),s=n("ae27"),i=n.n(s),c=Object(a["defineComponent"])({name:"LineChart",props:{series:{type:Array,default:()=>[]},options:{type:Object,default:()=>({})},height:{type:[String,Number],default:560},placeholder:{type:String,default:"Loading data..."}},components:{IonCard:r["IonCard"],IonCardContent:r["IonCardContent"],ApexChart:i.a},emits:["pointSelection"],setup(t,{emit:e}){const n=Object(a["computed"])(()=>{const e={chart:{id:"line-chart",type:"line"},xaxis:{type:"datetime",tickAmount:2,labels:{show:!0,rotate:-75}},markers:{size:8,hover:{sizeOffset:3}},tooltip:{x:{format:"dd/MMM/yyyy"}},title:{text:"Line Chart",align:"left"},noData:{text:t.placeholder,align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{color:"#a7a7a7",fontSize:"25px",fontFamily:"Helvetica"}}};for(const n in t.options)e[n]={...e[n],...t.options[n]};return e}),o=(t,n,{dataPointIndex:a,seriesIndex:o})=>{console.log(t,n),e("pointSelection",a,o<=0?0:o)};return{chartOptions:n,onPointSelection:o}}}),l=n("d959"),d=n.n(l);const u=d()(c,[["render",o]]);e["a"]=u},da44:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var a=n("d867");const o={async show(t,e,n="custom-modal",o=!0){const r=await a["modalController"].create({component:t,cssClass:n,backdropDismiss:o,componentProps:e});r.present();const{data:s}=await r.onWillDismiss();if(s)return s},async hide(t){await a["modalController"].dismiss(t)}}}}]);
//# sourceMappingURL=chunk-8f194e9a.43ed56bb.js.map