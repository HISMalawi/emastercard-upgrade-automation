import{d as E,j as k,k as N,I as O,$ as T,r as y,H as D,ae as W,a6 as w,a2 as q,ai as U,L as m,o as h,c as A,a,w as l,b as c,K as _,y as Y}from"./index-9d5e84a5.js";import{S as I}from"./Date-ea5dfce1.js";import{T as $}from"./TextInput-196eb5a4.js";import{D as B}from"./DateInput-deedffd1.js";import{Y as L}from"./YesNoInput-c0354fb0.js";import{S as P}from"./SelectInput-c163deec.js";import{g as j}from"./location_options-4bffeec6.js";import{d as F}from"./his_date-68cf9d33.js";import{s as M}from"./form-42211d1f.js";import{S as g}from"./HIVReception-91e0d989.js";import{E as H,a as K}from"./emc_event-4721851b.js";import{d as R,v as G,r as J}from"./validations-674ed7bf.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import"./vue-datepicker-7955ae14.js";import"./common-8a0477e8.js";import"./Strs-7ee8a435.js";import"./toasts-a30647ed.js";import"./loader-161c88b9.js";import"./ApiStore-71fb0bde.js";import"./program_service-72175222.js";import"./image-cb93bc3e.js";import"./index-95d3a767.js";import"./user_service-6bb4c9c3.js";import"./patient_service-5e9f10c6.js";import"./patient_identifier_service-38d617de.js";import"./services-f7c3fb9d.js";import"./encounter_types-55fa45e3.js";const X=E({components:{IonRow:k,IonCol:N,IonButton:O,IonTitle:T,TextInput:$,DateInput:B,YesNoInput:L,SelectInput:P},props:{patient:{type:Object,required:!0},isNewPatient:{type:Boolean,default:!0},observations:{type:Object,default:()=>({})},initialVisitDate:{type:String,default:""},artStartDate:{type:String,default:""}},emits:["onValue","onPrevious","onFinish"],setup(t,{emit:n}){const b=y([]),C=y([]),S=F().format(I),V=D(()=>{const o=t.patient.getBirthdate();return o?F(o).format(I):""}),r=new g(t.patient.getID(),t.patient.getAge(),-1),d=D(()=>r.getAllReasonsForART(t.artStartDate||t.initialVisitDate,t.patient.isMale()).map(o=>({label:o.name,value:o.name}))),u=r.getAllWhoStages().filter(o=>o.name.match(/1|2|3|4/i)).map(o=>({label:o.name,value:o.name})),s=W({reasonsForEligibity:{value:t.observations["Reason for ART eligibility"]||"",label:"Reason for Starting",placeholder:"Select Reason for Starting",required:!0,computedValue:o=>({obs:r.buildReasonForArtObs(typeof o=="string"?o:o.label)})},whoStage:{value:t.observations["Who stage"]||"",label:"Select Stage",placeholder:"Select Stage",required:!0,computedValue:o=>({obs:r.buildWhoStageObs(typeof o=="string"?o:o.label)})},cd4countAvailable:{value:t.observations["CD4 count"]?"Yes":"No",label:"Recent CD4 Count results available?",required:!0},cd4CountDate:{value:t.observations["Cd4 count datetime"]||"",label:"CD4 Count date",placeholder:"CD4 Count date",computedValue:o=>({obs:g.buildValueDate("Cd4 count datetime",o)}),validation:async(o,e)=>{var i;return((i=e.cd4countAvailable)==null?void 0:i.value)==="Yes"&&R(o)}},cd4Count:{value:t.observations["CD4 count"]||"",label:"CD4 Count",placeholder:"CD4 Count e.g. <100 or >500",computedValue:o=>{const e=parseInt(o.substring(1)),i=o.substring(0,1);return{modifier:i,count:e,obs:g.buildValueNumber("CD4 count",e,i)}},validation:async(o,e)=>{var i;return((i=e.cd4countAvailable)==null?void 0:i.value)==="Yes"&&G([()=>J(o),()=>r.cd4CountIsValid(o.value.toString())?null:["Please start with a modifier. e.g. >, <, or ="]])}},cd4CountLocation:{value:t.observations["Cd4 count location"]||"",label:"CD4 Count location",computedValue:o=>({obs:g.buildValueText("Cd4 count location",typeof o=="string"?o:o.label)}),validation:async(o,e)=>{var i;return((i=e.cd4countAvailable)==null?void 0:i.value)==="Yes"&&R(o)}},whoConditions:{value:t.observations["Who stages criteria present"]?[{label:t.observations["Who stages criteria present"],value:t.observations["Who stages criteria present"]}]:"",required:!0,label:"Select Staging Conditions",computedValue:o=>({obs:typeof o=="string"?r.buildWhoCriteriaObs(o):o.map(e=>r.buildWhoCriteriaObs(e.label))})}}),f=async()=>{if(await U("Are you sure you want to clear all fields?")){for(const o in s)s[o].value=void 0,s[o].error="";H.emit(K.ON_CLEAR)}},v=async()=>{r.setDate(t.initialVisitDate),await M(s,async(o,e)=>{n("onValue",{type:"staging",data:{formData:o,computedData:e}}),n("onFinish")})},p=o=>{o&&(s.whoConditions.value="");const e=parseInt((o==null?void 0:o.split(" ")[2])||"1");b.value=r.getStagingConditions(e).map(i=>({label:i.name,value:i.name,other:i})).sort((i,z)=>i.label.localeCompare(z.label))};return w(()=>s.whoStage.value,o=>p(o==null?void 0:o.label)),w(()=>s.reasonsForEligibity.value,()=>{s.whoStage.value="",s.whoConditions.value=""}),q(()=>p()),{today:S,patientDob:V,form:s,whoStages:u,stagingCoditions:b,selectedConditions:C,reasonsForArt:d,getFacilities:j,onClear:f,onSubmit:v}}});function Z(t,n,b,C,S,V){const r=m("ion-title"),d=m("SelectInput"),u=m("ion-col"),s=m("yes-no-input"),f=m("DateInput"),v=m("text-input"),p=m("ion-button"),o=m("ion-row");return h(),A(_,null,[a(r,{class:"ion-text-center ion-margin-vertical ion-padding-bottom bold"},{default:l(()=>[c(" Staging ")]),_:1}),a(o,{class:"ion-margin-top ion-margin-bottom"},{default:l(()=>[a(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:l(()=>[a(d,{modelValue:t.form.reasonsForEligibity,"onUpdate:modelValue":n[0]||(n[0]=e=>t.form.reasonsForEligibity=e),options:t.reasonsForArt},null,8,["modelValue","options"])]),_:1}),a(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:l(()=>[a(d,{modelValue:t.form.whoStage,"onUpdate:modelValue":n[1]||(n[1]=e=>t.form.whoStage=e),options:t.whoStages},null,8,["modelValue","options"])]),_:1}),a(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:l(()=>[a(s,{modelValue:t.form.cd4countAvailable,"onUpdate:modelValue":n[2]||(n[2]=e=>t.form.cd4countAvailable=e),inline:""},null,8,["modelValue"])]),_:1}),t.form.cd4countAvailable.value==="Yes"?(h(),A(_,{key:0},[a(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:l(()=>[a(f,{modelValue:t.form.cd4CountDate,"onUpdate:modelValue":n[3]||(n[3]=e=>t.form.cd4CountDate=e),"min-date":t.patientDob,"max-date":t.today},null,8,["modelValue","min-date","max-date"])]),_:1}),a(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:l(()=>[a(v,{modelValue:t.form.cd4Count,"onUpdate:modelValue":n[4]||(n[4]=e=>t.form.cd4Count=e)},null,8,["modelValue"])]),_:1}),a(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:l(()=>[a(d,{modelValue:t.form.cd4CountLocation,"onUpdate:modelValue":n[5]||(n[5]=e=>t.form.cd4CountLocation=e),asyncOptions:t.getFacilities,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1})],64)):Y("",!0),a(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:l(()=>[a(d,{modelValue:t.form.whoConditions,"onUpdate:modelValue":n[6]||(n[6]=e=>t.form.whoConditions=e),options:t.stagingCoditions,multiple:""},null,8,["modelValue","options"])]),_:1}),a(u,{size:"12",class:"ion-margin-top"},{default:l(()=>[a(p,{class:"ion-margin-top ion-float-right",size:"large",onClick:t.onSubmit,color:"success"},{default:l(()=>[c("Finish")]),_:1},8,["onClick"]),a(p,{class:"ion-margin-top ion-float-right",size:"large",color:"warning",onClick:t.onClear},{default:l(()=>[c("Clear")]),_:1},8,["onClick"]),a(p,{class:"ion-margin-top ion-float-right",size:"large",onClick:n[7]||(n[7]=e=>t.$emit("onPrevious")),color:"primary"},{default:l(()=>[c("Previous")]),_:1})]),_:1})]),_:1})],64)}const Io=Q(X,[["render",Z],["__scopeId","data-v-46029383"]]);export{Io as default};
