System.register(["./index-legacy-5fd00317.js","./patient_service-legacy-68412ff5.js","./common-legacy-42ce034b.js","./TextInput-legacy-8725a274.js","./DateInput-legacy-c96b3246.js","./YesNoInput-legacy-244bdac1.js","./HIVReception-legacy-81098a49.js","./SelectInput-legacy-239ac137.js","./location_options-legacy-82bffb9f.js","./regimen_service-legacy-2db95793.js","./DTFormElements-legacy-8934eb68.js","./ApiStore-legacy-c5c69548.js","./validations-legacy-470ac0cd.js","./form-legacy-14cfe3a7.js","./emc_event-legacy-58754a45.js","./his_date-legacy-f511c580.js","./program_service-legacy-a2774ffc.js","./_plugin-vue_export-helper-legacy-762b7923.js","./patient_identifier_service-legacy-c96f3e39.js","./index-legacy-aa705205.js","./vue-datepicker-legacy-672cca54.js","./toasts-legacy-8814bb27.js","./loader-legacy-26a3e1a4.js","./encounter_types-legacy-566983b4.js","./user_service-legacy-e7c827a3.js","./services-legacy-03115b96.js","./Strs-legacy-09248991.js","./Date-legacy-074e72e8.js","./image-legacy-0b5f9ca9.js"],(function(e,t){"use strict";var a,o,i,l,n,r,u,s,m,d,c,v,f,g,p,b,y,V,T,h,D,A,N,R,I,H,_,C,P,S,w,j,x,k,z,U,L,O,B,F,E,Y,Q,$,q,W;return{setters:[e=>{a=e.d,o=e._,i=e.$,l=e.N,n=e.S,r=e.g,u=e.a8,s=e.Z,m=e.T,d=e.O,c=e.ac,v=e.r,f=e.o,g=e.c,p=e.a,b=e.w,y=e.b,V=e.F,T=e.j,h=e.h},e=>{D=e.P},e=>{A=e.i},e=>{N=e.T},e=>{R=e.D},e=>{I=e.Y},e=>{H=e.C,_=e.P},e=>{C=e.S},e=>{P=e.g},e=>{S=e.N,w=e.R},e=>{j=e.i,x=e.b,k=e.H},e=>{z=e.C,U=e.V},e=>{L=e.e,O=e.d,B=e.v,F=e.r},e=>{E=e.s},e=>{Y=e.E,Q=e.a},e=>{$=e.a},e=>{q=e.P},e=>{W=e._},null,null,null,null,null,null,null,null,null,null,null],execute:function(){const t=a({components:{IonRow:o,IonCol:i,IonTitle:l,TextInput:N,DateInput:R,YesNoInput:I,SelectInput:C,NumberInput:S},props:{patient:{type:Object,required:!0},isNewPatient:{type:Boolean,default:!0},observations:{type:Object,default:()=>({})},initialVisitDate:{type:String,default:""}},emits:["onValue","onNext"],setup(e,{emit:t}){const a=n([]),o=new H(e.patient.getID(),-1),i=new z(e.patient.getID(),-1),l=new U(e.patient.getID(),-1),v=new _(e.patient.getID(),-1),{facility:f}=d(),g=n(""),p=r((()=>e.patient.getBirthdate())),b=u({arvNumber:{value:"",label:"ARV Number",placeholder:"Enter ARV Number",required:!0,validation:async(e,t)=>{if(t.arvNumber.disabled)return null;const a=L(e,"POSITIVE_INTEGERS");if(null!==a)return a;const o=await D.findByOtherID(4,`${f.code}-ARV-${e.value}`);return A(o.data)?null:["ARV Number already exists"]}},arvNumberAtPreviousLocation:{value:"",label:"ART Number at previous Location",computedValue:e=>({tag:"registration",obs:o.buildValueText("ART number at previous location",e)})},initialVisitDate:{value:e.initialVisitDate,label:"Registration Date",required:!0},shouldFollowUp:{value:e.observations["Agrees to followup"]?e.observations["Agrees to followup"].match(/yes|home visit/i)?"Yes":"No":"",label:"Agrees to follow up ?",computedValue:e=>({tag:"registration",obs:[o.buildGroupValueCoded("Agrees to followup","Home visit",e),o.buildGroupValueCoded("Agrees to followup","Phone",e)]}),required:!0},receivedArvTreatmentBefore:{value:e.observations["Ever received ART"]||"",label:"Ever received ARVs for treatment or prophylaxis?",computedValue:e=>({tag:"registration",obs:o.buildValueCoded("Ever received ART",e)}),required:!0},dateLastTakenArvs:{value:e.observations["Date ART last taken"]||"",label:"Date last taken ARVs",computedValue:e=>({tag:"registration",obs:o.buildValueDate("Date ART last taken",e)}),validation:async(e,t)=>"Yes"===t.receivedArvTreatmentBefore.value&&O(e)},everRegisteredAtClinic:{value:e.observations["Ever registered at ART clinic"]||"",label:"Ever registred at an ART clinic",computedValue:e=>({tag:"registration",obs:o.buildValueCoded("Ever registered at ART clinic",e)}),validation:async(e,t)=>"Yes"===t.receivedArvTreatmentBefore.value&&O(e)},artInitiationLocation:{value:e.observations["Location of ART initiation"]||"",label:"Location of ART Initiation",computedValue:e=>({tag:"registration",obs:i.buildValueText("Location of ART initiation","string"==typeof e?e:e.label)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&O(e)},artStartDate:{value:e.observations["Date ART started"]||"",label:"Date started ART",computedValue:e=>({tag:"registration",obs:o.buildValueDate("Date ART started",e)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&O(e)},initialWeight:{value:e.observations.weight||"",label:"Initial Weight",placeholder:"Enter weight",computedValue:e=>({tag:"vitals",obs:l.buildValueNumber("weight",e)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&"Unknown"!==e.value&&B([()=>F(e),()=>l.validator({...e,label:"Weight"})])},initialHeight:{value:e.observations.Height||"",label:"Initial Height",placeholder:"Enter height",computedValue:e=>({tag:"vitals",obs:o.buildValueNumber("Height",e)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&"Unknown"!==e.value&&B([()=>F(e),()=>l.validator({...e,label:"Height"})])},initialTBStatus:{value:e.observations["TB Status at Initiation"]||"",label:"Initial TB Status",placeholder:"select TB status",computedValue:e=>({tag:"registration",obs:o.buildValueCoded("TB Status at Initiation","string"==typeof e?e:e.label)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&O(e)},tptHistory:{value:e.observations["Previous TB treatment history"]||"",label:"TPT History",placeholder:"Select TPT history",computedValue:e=>({tag:"consultation",obs:i.buildValueText("Previous TB treatment history","string"==typeof e?e:e.label)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&O(e)},tptStartDate:{value:e.observations["TPT Drugs Received"]||"",label:"Date started TPT",validation:async(e,t)=>{var a;return(null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a||null===(a=a.label)||void 0===a?void 0:a.match(/currently/i))&&O(e)}},inhQty:{value:"",label:"INH Amount Received",validation:async(e,t)=>{var a;const o=null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.label;return(null==o?void 0:o.match(/currently/i))&&(o.match(/ipt/i)||o.includes("3HP (RFP + INH)"))&&F(e)},computedValue:(e,t)=>{var o;return{tag:"consultation",obs:i.buildObs("TPT Drugs Received",{value_drug:(null===(o=a.value.find((e=>"INH or H (Isoniazid 300mg tablet)"===e.name)))||void 0===o?void 0:o.drug_id)||0,value_datetime:(null==t?void 0:t.tptStartDate.value)||null,value_numeric:e||0})}}},rifapentineQty:{value:"",label:"Rifapentine Amount Received",validation:async(e,t)=>{var a;const o=null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.label;return(null==o?void 0:o.match(/currently/i))&&o.includes("3HP (RFP + INH)")&&F(e)},computedValue:(e,t)=>{var o;return{tag:"consultation",obs:i.buildObs("TPT Drugs Received",{value_drug:(null===(o=a.value.find((e=>"Rifapentine (150mg)"===e.name)))||void 0===o?void 0:o.drug_id)||0,value_datetime:(null==t?void 0:t.tptStartDate.value)||null,value_numeric:e||0})}}},threeHPQty:{value:"",label:"INH / RFP Amount Received",validation:async(e,t)=>{var a;const o=null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.label;return(null==o?void 0:o.match(/currently/i))&&o.includes("INH 300 / RFP 300 (3HP)")&&F(e)},computedValue:(e,t)=>{var o;return{tag:"consultation",obs:i.buildObs("TPT Drugs Received",{value_drug:(null===(o=a.value.find((e=>"INH 300 / RFP 300 (3HP)"===e.name)))||void 0===o?void 0:o.drug_id)||0,value_datetime:(null==t?void 0:t.tptStartDate.value)||null,value_numeric:e||0})}}},tptStartLocation:{value:e.observations["Location TPT Last Received"]||"",label:"TPT Transfer From",validation:async(e,t)=>{var a;return(null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a||null===(a=a.label)||void 0===a?void 0:a.match(/currently/i))&&F(e)},computedValue:e=>({tag:"consultation",obs:i.buildValueText("Location TPT Last Received","string"==typeof e?e:e.label)})},confirmatoryTest:{value:e.observations["Confirmatory hiv test type"]||"",label:"Confirmatory Test",placeholder:"Select confirmatory test",required:!0,computedValue:e=>({tag:"registration",obs:o.buildValueCoded("Confirmatory hiv test type","string"==typeof e?e:e.value)})},confirmatoryTestLocation:{value:e.observations["Confirmatory HIV test location"]||"",label:"Location of Confirmatory",placeholder:"Select location",validation:async(e,t)=>!("Not done"===t.confirmatoryTest.value.label||"Not done"===t.confirmatoryTest.value)&&O(e),computedValue:e=>({tag:"registration",obs:o.buildValueText("Confirmatory HIV test location","string"==typeof e?e:e.label)})},confirmatoryTestDate:{value:e.observations["Confirmatory HIV test date"]||"",label:"Confirmatory HIV Test Date",validation:async(e,t)=>!("Not done"===t.confirmatoryTest.value.label||"Not done"===t.confirmatoryTest.value)&&O(e),computedValue:e=>({tag:"registration",obs:o.buildValueDate("Confirmatory HIV test date",e)})},patientType:{value:"New patient",computedValue:e=>({tag:"patient type",obs:v.buildValueCoded("Type of patient",e)})}}),y=r((()=>{var e;return!("Not done"===(null===(e=b.confirmatoryTest.value)||void 0===e?void 0:e.label)||"Not done"===b.confirmatoryTest.value)}));s(b.receivedArvTreatmentBefore,(e=>{"No"===e.value&&(b.everRegisteredAtClinic.value="")})),s(b.initialVisitDate,(e=>{Y.emit(Q.ON_INITIAL_VISIT_DATE,e.value)})),s((()=>b.artStartDate.value),(e=>Y.emit(Q.ON_ART_START_DATE,e)),{immediate:!0});const V=r((()=>{var e;const t="string"==typeof b.tptHistory.value?b.tptHistory.value:null===(e=b.tptHistory.value)||void 0===e?void 0:e.label;if(null!=t&&t.match(/currently/i)){if(t.match(/ipt/i))return["INH or H (Isoniazid 300mg tablet)"];if(t.includes("3HP (RFP + INH)"))return["INH or H (Isoniazid 300mg tablet)","Rifapentine (150mg)"];if(t.includes("INH 300 / RFP 300 (3HP)"))return["INH 300 / RFP 300 (3HP)"]}return[]}));return m((()=>{const t=e.patient.getArvNumber();t&&"Unknown"!==t?(b.arvNumber.value=t.split("-")[2],b.arvNumber.disabled=!0):q.getNextSuggestedARVNumber().then((e=>{g.value=e,g.value&&(b.arvNumber.label=`Arv Number (Suggested Number: ${g.value})`)})),w.getCustomIngridients().then((e=>{e.ok&&(a.value=e.data)}))})),{today:$,form:b,isConfirmatoryTestDone:y,initialTbStatusOptions:j,tptHistoryOptions:x,HIVTestOptions:k,tptDrugs:V,facility:f,birthdate:p,getFacilities:P,onClear:async()=>{if(await c("Are you sure you want to clear all fields?"))for(const e in b)"patientType"!==e&&(b[e].value=void 0,b[e].error="");Y.emit(Q.ON_CLEAR)},onSubmit:async()=>{await w.setSessionDate(b.initialVisitDate.value),v.setDate(b.initialVisitDate.value),o.setDate(b.initialVisitDate.value),l.setDate(b.initialVisitDate.value),i.setDate(b.initialVisitDate.value),await E(b,(async(e,a)=>{t("onValue",{type:"registration",data:{formData:{...e,arvNumber:e.arvNumber?`${f.code}-ARV-${e.arvNumber}`:""},computedData:a,arvNumberEditable:!b.arvNumber.disabled}}),t("onNext")}))}}}});e("default",W(t,[["render",function(e,t,a,o,i,l){const n=v("ion-title"),r=v("text-input"),u=v("ion-col"),s=v("DateInput"),m=v("yes-no-input"),d=v("SelectInput"),c=v("NumberInput"),D=v("ion-button"),A=v("ion-row");return f(),g(V,null,[p(n,{class:"ion-text-center ion-margin-vertical ion-padding-bottom bold"},{default:b((()=>[y(" HIV Clinic Registration ")])),_:1}),p(A,{class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(u,{size:"5",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(r,{modelValue:e.form.arvNumber,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.arvNumber=t),form:e.form,prefix:`${e.facility.code}-ARV-`,disabled:!e.isNewPatient},null,8,["modelValue","form","prefix","disabled"])])),_:1}),p(u,{size:"7",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(s,{modelValue:e.form.initialVisitDate,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.initialVisitDate=t),"min-date":e.birthdate,"max-date":e.today,form:e.form},null,8,["modelValue","min-date","max-date","form"])])),_:1}),p(u,{size:"5",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(m,{modelValue:e.form.shouldFollowUp,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.shouldFollowUp=t),inline:""},null,8,["modelValue"])])),_:1}),p(u,{size:"7",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(m,{modelValue:e.form.receivedArvTreatmentBefore,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.receivedArvTreatmentBefore=t),inline:""},null,8,["modelValue"])])),_:1}),"Yes"===e.form.receivedArvTreatmentBefore.value?(f(),g(V,{key:0},[p(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(s,{modelValue:e.form.dateLastTakenArvs,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.dateLastTakenArvs=t),form:e.form,"min-date":e.birthdate,"max-date":e.today},null,8,["modelValue","form","min-date","max-date"])])),_:1}),p(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(m,{modelValue:e.form.everRegisteredAtClinic,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.everRegisteredAtClinic=t),inline:""},null,8,["modelValue"])])),_:1})],64)):T("",!0),"Yes"===e.form.everRegisteredAtClinic.value?(f(),g(V,{key:1},[p(u,{size:"9",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(d,{modelValue:e.form.artInitiationLocation,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.artInitiationLocation=t),form:e.form,asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])])),_:1}),p(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(r,{modelValue:e.form.arvNumberAtPreviousLocation,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.arvNumberAtPreviousLocation=t),form:e.form},null,8,["modelValue","form"])])),_:1}),p(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(s,{modelValue:e.form.artStartDate,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.artStartDate=t),form:e.form,"min-date":e.birthdate,"max-date":e.today},null,8,["modelValue","form","min-date","max-date"])])),_:1}),p(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(c,{modelValue:e.form.initialWeight,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.initialWeight=t),form:e.form,min:1,allowUnknown:""},null,8,["modelValue","form"])])),_:1}),p(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(c,{modelValue:e.form.initialHeight,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.initialHeight=t),form:e.form,min:1,allowUnknown:""},null,8,["modelValue","form"])])),_:1}),p(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(d,{modelValue:e.form.initialTBStatus,"onUpdate:modelValue":t[11]||(t[11]=t=>e.form.initialTBStatus=t),form:e.form,options:e.initialTbStatusOptions},null,8,["modelValue","form","options"])])),_:1}),p(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(d,{modelValue:e.form.tptHistory,"onUpdate:modelValue":t[12]||(t[12]=t=>e.form.tptHistory=t),form:e.form,options:e.tptHistoryOptions},null,8,["modelValue","form","options"])])),_:1}),e.tptDrugs.length?(f(),g(V,{key:0},[p(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(s,{modelValue:e.form.tptStartDate,"onUpdate:modelValue":t[13]||(t[13]=t=>e.form.tptStartDate=t),"min-date":e.birthdate,"max-date":e.today,form:e.form},null,8,["modelValue","min-date","max-date","form"])])),_:1}),e.tptDrugs.includes("INH or H (Isoniazid 300mg tablet)")?(f(),h(u,{key:0,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(c,{modelValue:e.form.inhQty,"onUpdate:modelValue":t[14]||(t[14]=t=>e.form.inhQty=t),form:e.form,min:1},null,8,["modelValue","form"])])),_:1})):T("",!0),e.tptDrugs.includes("Rifapentine (150mg)")?(f(),h(u,{key:1,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(c,{modelValue:e.form.rifapentineQty,"onUpdate:modelValue":t[15]||(t[15]=t=>e.form.rifapentineQty=t),form:e.form,min:1},null,8,["modelValue","form"])])),_:1})):T("",!0),e.tptDrugs.includes("INH 300 / RFP 300 (3HP)")?(f(),h(u,{key:2,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(c,{modelValue:e.form.threeHPQty,"onUpdate:modelValue":t[16]||(t[16]=t=>e.form.threeHPQty=t),form:e.form,min:1},null,8,["modelValue","form"])])),_:1})):T("",!0),p(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(d,{modelValue:e.form.tptStartLocation,"onUpdate:modelValue":t[17]||(t[17]=t=>e.form.tptStartLocation=t),form:e.form,asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])])),_:1})],64)):T("",!0)],64)):T("",!0),p(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(d,{modelValue:e.form.confirmatoryTest,"onUpdate:modelValue":t[18]||(t[18]=t=>e.form.confirmatoryTest=t),form:e.form,options:e.HIVTestOptions},null,8,["modelValue","form","options"])])),_:1}),e.isConfirmatoryTestDone?(f(),g(V,{key:2},[p(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(d,{modelValue:e.form.confirmatoryTestLocation,"onUpdate:modelValue":t[19]||(t[19]=t=>e.form.confirmatoryTestLocation=t),form:e.form,asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])])),_:1}),p(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:b((()=>[p(s,{modelValue:e.form.confirmatoryTestDate,"onUpdate:modelValue":t[20]||(t[20]=t=>e.form.confirmatoryTestDate=t),form:e.form,"min-date":e.birthdate,"max-date":e.today},null,8,["modelValue","form","min-date","max-date"])])),_:1})],64)):T("",!0),p(u,{size:"12",class:"ion-margin-top"},{default:b((()=>[p(D,{class:"ion-margin-top ion-float-right",size:"large",onClick:e.onSubmit,color:"success"},{default:b((()=>[y("Next")])),_:1},8,["onClick"]),p(D,{class:"ion-margin-top ion-float-right",size:"large",color:"warning",onClick:e.onClear},{default:b((()=>[y("Clear")])),_:1},8,["onClick"]),e.isNewPatient?T("",!0):(f(),h(D,{key:0,class:"ion-margin-top ion-float-right",size:"large",onClick:t[21]||(t[21]=t=>e.$router.back()),color:"primary"},{default:b((()=>[y("Back")])),_:1}))])),_:1})])),_:1})],64)}]]))}}}));
