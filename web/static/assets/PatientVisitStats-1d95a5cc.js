import{K as G}from"./vue-datepicker-84c8be8c.js";import{_ as E}from"./LineChart.vue_vue_type_script_setup_true_lang-6184cb2b.js";import{G as V,d as I,i as N,j as O,k as B,g as L,r as k,H as P,L as l,h as j,w as a,o as z,a as s,f as T,b as u,t as R}from"./index-21426f3d.js";import{i as F}from"./common-abc2f84d.js";import{P as c}from"./index-95d3a767.js";import{R as J}from"./report_service-4819ba19.js";import{l as A}from"./loader-45976e18.js";import{m as M,D as H}from"./DrilldownTable-11058d4d.js";import{c as K}from"./his_date-4cde48c7.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import"./arrays-31d2d38b.js";import"./url-ffe761c9.js";import"./index-5eeb8e2a.js";class W extends J{constructor(){super()}static getLocationName(){return sessionStorage.getItem("locationName")}getBookedAppointments(t){return V.getJson("programs/".concat(c,"/scheduled_appointments"),{date:t})}getViralLoadResults(t){return this.getReport("/programs/".concat(c,"/reports/high_vl_patients"),{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport("/programs/".concat(c,"/reports/retention"))}getExternalConsultationClients(){return this.getReport("".concat(c,"/external_consultation_clients"))}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport("/programs/".concat(c,"/reports/pregnant_patients"))}getArchivingCandidates(){return V.getJson("programs/".concat(c,"/reports/archiving_candidates"),{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}getVisitStats(){return V.getJson("programs/".concat(c,"/reports/visits"),{name:"visits",start_date:this.startDate,end_date:this.endDate})}}const q=I({components:{LineChart:E,IonGrid:N,IonRow:O,IonCol:B,VueDatePicker:G},setup(){L();const e=k(["",""]),t=k([]),y=P(()=>{var n;return((n=t.value[0])==null?void 0:n.raw.flat())||[]}),b=P(()=>{var n;return((n=t.value[1])==null?void 0:n.raw.flat())||[]}),S=P(()=>t.value.map(({raw:n})=>n).flat(3)),D={title:{text:"Patient Vists Statistics",align:"left"},yaxis:{title:{text:"Number of clients"},plotAreaHeight:800}},f=n=>{const i={},r={},m={},p=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(n).forEach(([o,g])=>{i[o]=[],r[o]=[],m[o]=[],Object.entries(g).forEach(([w,{patient_present:C,guardian_present:$}])=>{$&&C?m[o].push({patientId:w,date:o}):C?i[o].push({patientId:w,date:o}):$&&r[o].push({patientId:w,date:o})});const v=new Date(o).getTime();p[0].data.push([v,i[o].length]),p[0].raw.push(i[o]),p[1].data.push([v,r[o].length]),p[1].raw.push(r[o]),p[2].data.push([v,m[o].length]),p[2].raw.push(m[o])}),p},h=async()=>{A.show();const n=new W;n.setStartDate(e.value[0]),n.setEndDate(e.value[1]);const i=await n.getPatientVisitTypes();t.value=f(i),A.hide()},d=async(n,i="Drill down clients")=>{await M.show(H,{patientIds:n.map(({patientId:r})=>r),title:i})};return{range:e,series:t,options:D,totalAttendance:S,totalPatientVisits:y,totalGuardianVisits:b,fetchData:h,pointSelection:async(n,i)=>{if(!F(t.value))try{await d(t.value[i].raw[n],"".concat(t.value[i].name," visits"))}catch(r){console.error(r)}},drilldown:d,toDisplayRangeFmt:K}}}),Q={style:{display:"flex","justify-content":"flex-start"}},X={class:"his-card"};function Y(e,t,y,b,S,D){const f=l("vue-date-picker"),h=l("ion-button"),d=l("ion-col"),_=l("ion-label"),n=l("ion-badge"),i=l("ion-item"),r=l("ion-list"),m=l("line-chart"),p=l("ion-row"),o=l("ion-grid");return z(),j(o,null,{default:a(()=>[s(p,null,{default:a(()=>[s(d,{size:"5",offset:"7",class:"ion-padding"},{default:a(()=>[T("div",Q,[s(f,{modelValue:e.range,"onUpdate:modelValue":t[0]||(t[0]=g=>e.range=g),placeholder:"Select date range","partial-range":!0,"enable-time-picker":!1,format:e.toDisplayRangeFmt,"multi-calendars":"","auto-apply":"","text-input":"",range:"",class:"ion-margin-end",style:{padding:"5px"}},null,8,["modelValue","format"]),s(h,{color:"primary",onClick:e.fetchData,style:{height:"44px"}},{default:a(()=>[u("Submit")]),_:1},8,["onClick"])])]),_:1}),s(d,{size:"2",class:"ion-padding-top"},{default:a(()=>[T("div",X,[s(r,null,{default:a(()=>[s(i,{button:"",onClick:t[1]||(t[1]=g=>e.drilldown(e.totalAttendance,"Total Attendance"))},{default:a(()=>[s(_,null,{default:a(()=>[u(" Total Attendance ")]),_:1}),s(n,null,{default:a(()=>[u(R(e.totalAttendance.length),1)]),_:1})]),_:1}),s(i,{button:"",onClick:t[2]||(t[2]=g=>e.drilldown(e.totalPatientVisits,"Total patient visits"))},{default:a(()=>[s(_,null,{default:a(()=>[u(" Patient Visit ")]),_:1}),s(n,null,{default:a(()=>[u(R(e.totalPatientVisits.length),1)]),_:1})]),_:1}),s(i,{button:"",onClick:t[3]||(t[3]=g=>e.drilldown(e.totalGuardianVisits,"Total guardian visits"))},{default:a(()=>[s(_,null,{default:a(()=>[u(" Guardian Visit ")]),_:1}),s(n,null,{default:a(()=>[u(R(e.totalGuardianVisits.length),1)]),_:1})]),_:1})]),_:1})])]),_:1}),s(d,{size:"10"},{default:a(()=>[s(m,{series:e.series,options:e.options,onPointSelection:e.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})}const ct=U(q,[["render",Y]]);export{ct as default};
