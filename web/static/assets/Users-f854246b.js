import{_ as z}from"./ReportTable.vue_vue_type_script_setup_true_lang-18fee1ca.js";import{U as f}from"./user_service-6565a8e9.js";import{d as h,I as E,R as O,A as j,D as L,y as M,L as G,am as J,N as W,i as K,S as $,g as Q,a8 as X,T as B,aF as Y,r as l,o as C,h as N,w as s,a as n,b as y,t as Z,aG as x,aH as ee,ac as oe,aI as ae}from"./index-1c16650e.js";import{m as I}from"./DrilldownTable-d5470f91.js";import{T as ne}from"./TextInput-9a09c3ed.js";import{S as te}from"./SelectInput-61d8e31d.js";import{i as re,r as se}from"./form-c5c112ea.js";import{i as p,g}from"./common-94ac9539.js";import{t as b,a as le}from"./toasts-926a2fd9.js";import{R as ie}from"./services-f7c3fb9d.js";import{a as U}from"./validations-11aef89d.js";import{_ as S}from"./_plugin-vue_export-helper-c27b6911.js";import{H as me}from"./Date-c63183ce.js";import"./exports-300de8ff.js";import"./index-e903e9ca.js";import"./his_date-3ca53c6f.js";import"./vue-datepicker-312099be.js";import"./arrays-7f14d286.js";import"./index-95d3a767.js";import"./Strs-7ee8a435.js";import"./loader-1441845f.js";const ue=h({name:"UserModal",components:{IonButton:E,IonPage:O,IonHeader:j,IonContent:L,IonToolbar:M,IonButtons:G,IonFooter:J,IonTitle:W,IonIcon:K,TextInput:ne,SelectInput:te},props:{user:{type:Object,default:()=>({})}},setup(e){var a,r;const t=$([]),c=Q(()=>p(e.user)?"Add New User":"Edit User"),d=X({givenName:{value:g(e.user,"person.names[0].given_name",""),label:"First Name",required:!0,validation:o=>U(o)},familyName:{validation:o=>U(o),value:g(e.user,"person.names[0].family_name",""),label:"Last Name",required:!0},username:{value:g(e.user,"username",""),label:"Username",required:!0,disabled:!p(e.user),validation:async o=>"".concat(o.value).length<4?["Username must be at least 4 characters long"]:null},password:{value:"",label:"Password",required:p(e.user),validation:async({value:o})=>o&&"".concat(o).length<6?["Password must be at least 6 characters long"]:null},confirmPassword:{value:"",label:"Confirm Password",required:p(e.user),validation:async({value:o},i)=>o&&o!==i.password.value?["Passwords not matching"]:null},roles:{value:((r=(a=e.user)==null?void 0:a.roles)==null?void 0:r.map(o=>({label:o.role,value:o.role,other:o})))||[],label:"Roles",placeholder:"Select Roles",required:!0}}),v=async()=>{if(!await re(d))return;const{formData:o}=se(d,!0);let i={...o,roles:o.roles.map(u=>u.label)};try{p(e.user)?i=await f.createUser(i):i=await f.updateUser(e.user.user_id,i),I.hide(i)}catch(u){if(u instanceof ie)return d.username.error="Username already exists";b(JSON.stringify(u),2e3)}};return B(()=>{f.getAllRoles().then(o=>{const i=Array.isArray(o.data)?o.data:[];t.value=i==null?void 0:i.map(u=>({value:u.role,label:u.role,other:u}))})}),{form:d,close:Y,modal:I,roles:t,title:c,submit:v}}});function de(e,t,c,d,v,a){const r=l("IonIcon"),o=l("IonButton"),i=l("IonButtons"),u=l("IonTitle"),A=l("IonToolbar"),T=l("IonHeader"),F=l("text-input"),_=l("ion-col"),w=l("TextInput"),D=l("SelectInput"),P=l("ion-row"),R=l("ion-grid"),k=l("IonContent"),H=l("IonFooter"),q=l("IonPage");return C(),N(q,null,{default:s(()=>[n(T,null,{default:s(()=>[n(A,null,{default:s(()=>[n(i,{slot:"end"},{default:s(()=>[n(o,{slot:"end",onClick:t[0]||(t[0]=m=>e.modal.hide()),"icon-only":""},{default:s(()=>[n(r,{icon:e.close},null,8,["icon"])]),_:1})]),_:1}),n(u,null,{default:s(()=>[y(Z(e.title),1)]),_:1})]),_:1})]),_:1}),n(k,null,{default:s(()=>[n(R,null,{default:s(()=>[n(P,null,{default:s(()=>[n(_,{size:"12",class:"ion-margin-vertical"},{default:s(()=>[n(F,{modelValue:e.form.username,"onUpdate:modelValue":t[1]||(t[1]=m=>e.form.username=m)},null,8,["modelValue"])]),_:1}),n(_,{size:"6",class:"ion-margin-vertical"},{default:s(()=>[n(w,{modelValue:e.form.password,"onUpdate:modelValue":t[2]||(t[2]=m=>e.form.password=m),password:""},null,8,["modelValue"])]),_:1}),n(_,{size:"6",class:"ion-margin-vertical"},{default:s(()=>[n(w,{modelValue:e.form.confirmPassword,"onUpdate:modelValue":t[3]||(t[3]=m=>e.form.confirmPassword=m),form:e.form,password:""},null,8,["modelValue","form"])]),_:1}),n(_,{size:"12",class:"ion-margin-vertical"},{default:s(()=>[n(D,{modelValue:e.form.roles,"onUpdate:modelValue":t[4]||(t[4]=m=>e.form.roles=m),options:e.roles,multiple:""},null,8,["modelValue","options"])]),_:1}),n(_,{size:"12",class:"ion-margin-vertical"},{default:s(()=>[n(w,{modelValue:e.form.givenName,"onUpdate:modelValue":t[5]||(t[5]=m=>e.form.givenName=m)},null,8,["modelValue"])]),_:1}),n(_,{size:"12",class:"ion-margin-vertical"},{default:s(()=>[n(w,{modelValue:e.form.familyName,"onUpdate:modelValue":t[6]||(t[6]=m=>e.form.familyName=m)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),n(H,null,{default:s(()=>[n(o,{class:"ion-margin-end ion-margin-vertical ion-float-right",onClick:e.submit},{default:s(()=>[y("Save")]),_:1},8,["onClick"]),n(o,{class:"ion-margin-vertical ion-float-right",color:"light",onClick:t[7]||(t[7]=m=>e.modal.hide())},{default:s(()=>[y("Close")]),_:1})]),_:1})]),_:1})}const V=S(ue,[["render",de]]),ce=h({name:"Users",components:{BaseReportTable:z},setup(){const e=$([]),t=[{path:"username",label:"Username",initialSort:!0,initialSortOrder:"asc"},{path:"given_name",label:"First name"},{path:"family_name",label:"Last name"},{path:"role",label:"Roles"},{path:"deactivated_on",label:"Deactivated On",formatter:me.toStandardHisDisplayFormat}],c=a=>{try{return{given_name:g(a,"person.names[0].given_name","Unknown"),family_name:g(a,"person.names[0].family_name","Unknown"),role:a.roles.map(o=>o.role).join(", "),...a}}catch(r){return console.error("Error occurred while processing user details:",r),null}},d=[{icon:x,action:async a=>{const r=await I.show(V,{user:a});p(r)||Object.assign(a,c(r.data))}},{color:"danger",icon:ee,condition:a=>a.deactivated_on===null,action:async a=>{if(await oe("Are you sure you want to deactivate this user?"))try{const{user:r}=await(await f.deactivateUser(a.user_id)).data;a.deactivated_on=r.deactivated_on,le("User deactivated")}catch(r){b("Deactivation Failed: ".concat(r))}}},{color:"warning",icon:ae,condition:a=>a.deactivated_on!==null,action:async a=>{try{await f.activateUser(a.user_id),a.deactivated_on=null}catch(r){b("Activation Failed: ".concat(r))}}}],v=[{label:"Add New User",action:async()=>{const a=await I.show(V);p(a==null?void 0:a.user)||e.value.push(c(a.user))}}];return B(async()=>{const a=(await f.getAllUsers({paginate:!1})).data,r=await f.getCurrentUser();e.value=a.filter(o=>o.person_id!==(r==null?void 0:r.person_id)).map(o=>c(o))}),{rows:e,columns:t,rowActionBtns:d,actionBtns:v}}});function pe(e,t,c,d,v,a){const r=l("base-report-table");return C(),N(r,{title:"Users","report-icon":"patient-type.png",columns:e.columns,rows:e.rows,rowActionButtons:e.rowActionBtns,"action-buttons":e.actionBtns,canExportCsv:!1,canExportPDF:!1,showRefreshButton:!1},null,8,["columns","rows","rowActionButtons","action-buttons"])}const Re=S(ce,[["render",pe]]);export{Re as default};
