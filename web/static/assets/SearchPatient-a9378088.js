import{d as K,i as O,j as W,k as x,I as L,ah as U,g as j,r as v,ae as q,H as C,a2 as z,G as H,F as Q,aD as R,L as l,h as Y,w as i,o as J,a as r,A as $,f as k,b as S}from"./index-67d679d3.js";import{t as N,b as X}from"./toasts-2ce27f65.js";import{g as Z}from"./DTFormElements-a1199b88.js";import{S as ee}from"./SelectInput-282515a1.js";import{D as ae}from"./index-2380d2dc.js";import{p as te}from"./VoidReason-b0092f7f.js";import{t as ne}from"./Strs-7ee8a435.js";import{M as P,A as M}from"./index-95d3a767.js";import{t as oe,e as re}from"./his_date-1f6a8082.js";import{r as se,a as ie,i as le,b as ce}from"./dde-a9097c86.js";import{b as ue}from"./validations-b9fbcec4.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";import"./common-abc2f84d.js";const me=K({components:{IonGrid:O,IonRow:W,IonCol:x,SelectInput:ee,IonButton:L,IonSearchbar:U,DataTable:ae},setup(){const n=j(),{facility:c}=Q(),o=v(""),A=v(document.getElementById("selectInput")),_=q({value:"",placeholder:"select gender"}),d=v(!1),u=v([]),I=C(()=>c.code+"-ARV-");z(()=>se());const m=[{label:"ARV Number",path:"arv_number"},{label:"MW National ID",path:"national_id"},{path:"given_name",label:"First name"},{path:"family_name",label:"Last name"},{path:"gender",label:"Gender",formatter:ne},{path:"birthdate",label:"Date of Birth (AGE)",formatter:a=>"".concat(oe(a)," (").concat(re(a),")")},{path:"source",label:"Source"}],p={showSearchField:!1,showSubmitButton:!1},g=async a=>{var t;const e=await R.searchByOtherID(P,a);return e.ok?e.data:(N((t=e.errorMessage)!=null?t:"Searching client by Malawi National ID returned error: ".concat(e.clientErrorType)),[])},b=async a=>{var t;const e=await R.searchByOtherID(M,a);return e.ok?e.data:(N((t=e.errorMessage)!=null?t:"Searching client by ARV Number returned error: ".concat(e.clientErrorType)),[])},D=(a,e)=>{const t={},s=a.split(" ").filter(y=>/\S/.test(y));return e&&(t.gender=e),s.length>0&&(t.given_name=s[0],t.family_name=s[2]||s[1]||"",t.middle_name=s[2]?s[1]:""),ce(t)},h=a=>a.split(" ").length===1&&(a.length>=6||a.length===13),f=a=>{d.value&&(d.value=!1),a==null||a.map(e=>{var t,s,y,V,B;return u.value.push({arv_number:(t=e.patient_identifiers.find(w=>w.identifier_type==M))==null?void 0:t.identifier,national_id:(s=e.patient_identifiers.find(w=>w.identifier_type==P))==null?void 0:s.identifier,given_name:e.person.names[0].given_name,family_name:e.person.names[0].family_name,gender:e.person.gender,birthdate:e.person.birthdate,personId:e.patient_id,source:(y=e.source)!=null?y:"locals",docID:(V=e.docID)!=null?V:"",ddeClientRequiresImport:(B=e==null?void 0:e.ddeClientRequiresImport)!=null?B:!1})})},T=async()=>{if(o.value&&!d.value)try{d.value=!0,u.value=[],o.value.match(/^(\w+-ARV-\w+)$/)&&b(o.value).then(f),ue({value:o.value,label:o.value})===null&&g(o.value).then(f),h(o.value)&&ie(o.value).then(f),o.value.match(/^(\d+)$/)?b("".concat(I.value).concat(o.value)).then(f):D(o.value,_.value.value).then(f)}catch(a){N("Unable to search patients"),console.error(a)}},E=()=>{o.value="",_.value="",u.value=[]},F=()=>({label:"void",color:"danger",action:async a=>{te(async e=>{try{await R.void(a.personId,e),await T()}catch(t){X("".concat(t))}},"void-modal")}}),G=C(()=>{const a=[{label:"Select",action:e=>{e.ddeClientRequiresImport?le(e.docID).then(t=>{t&&n.push("/patient/".concat(t.patient_id))}):n.push("/patient/".concat(e.personId))}}];return H.userHasRoles(["Program Manager","Superuser","System Developer"])&&a.push(F()),a});return{searchText:o,gender:_,tableRows:u,tableColumns:m,tableConfig:p,genderOptions:Z,selectInput:A,TableRowActions:G,searchPatient:T,resetQuery:E}}});const pe={style:{"max-width":"250px"},class:"ion-margin-end ion-margin-vertical"},he=k("h1",{class:"ion-margin"},"Patients Search Results",-1);function fe(n,c,o,A,_,d){const u=l("ion-searchbar"),I=l("SelectInput"),m=l("ion-button"),p=l("ion-col"),g=l("ion-row"),b=l("data-table"),D=l("ion-grid");return J(),Y(D,null,{default:i(()=>[r(g,{class:"his-card"},{default:i(()=>[r(p,{size:"10",style:{display:"flex","justify-content":"flex-start"}},{default:i(()=>[r(u,{style:{width:"350px",height:"2.75rem"},class:"box-input ion-no-padding ion-margin-end ion-margin-vertical",placeholder:"Search by Name or ARV Number or MW National ID",modelValue:n.searchText,"onUpdate:modelValue":c[0]||(c[0]=h=>n.searchText=h),onKeyup:$(n.searchPatient,["enter"])},null,8,["modelValue","onKeyup"]),k("div",pe,[r(I,{modelValue:n.gender,"onUpdate:modelValue":c[1]||(c[1]=h=>n.gender=h),options:n.genderOptions,onKeyup:$(n.searchPatient,["enter"])},null,8,["modelValue","options","onKeyup"])]),r(m,{class:"ion-margin-vertical",onClick:n.searchPatient},{default:i(()=>[S("Search")]),_:1},8,["onClick"]),r(m,{class:"ion-margin-vertical",onClick:n.resetQuery,color:"secondary"},{default:i(()=>[S("Reset")]),_:1},8,["onClick"])]),_:1}),r(p,null,{default:i(()=>[r(m,{class:"ion-margin-vertical",href:"/patient/registration",color:"success",style:{float:"right"}},{default:i(()=>[S(" Add New Patient ")]),_:1})]),_:1})]),_:1}),r(g,{class:"his-card ion-margin-top",style:{padding:"0 !important"}},{default:i(()=>[r(p,{size:"12",style:{"min-height":"320px"},class:"ion-no-padding"},{default:i(()=>[he,r(b,{rows:n.tableRows,columns:n.tableColumns,config:n.tableConfig,"row-actions-buttons":n.TableRowActions,color:"light"},null,8,["rows","columns","config","row-actions-buttons"])]),_:1})]),_:1})]),_:1})}const Ve=de(me,[["render",fe]]);export{Ve as default};
