import{d as Y,m as $,n as Q,a0 as q,I as W,r as E,h as k,ah as j,aS as G,a6 as U,i as M,k as J,ao as K,H as h,_ as X,L as b,o as g,c as I,e as n,w as r,b as S,K as D,A as y,j as P}from"./index-2ad1f2cc.js";import{P as Z}from"./patient_service-8845cad6.js";import{i as _}from"./common-abc2f84d.js";import{T as x}from"./TextInput-1b9f7d94.js";import{_ as ee}from"./DateInput.vue_vue_type_style_index_0_lang-16c41bdd.js";import{Y as te}from"./YesNoInput-64b37069.js";import{C as ae,P as oe}from"./HIVReception-529c36b3.js";import{S as ie}from"./SelectInput-6b348daa.js";import{g as ne}from"./location_options-a9c48172.js";import{N as le,R as re}from"./regimen_service-75b1c9d9.js";import{i as se,a as ue,H as me}from"./DTFormElements-9dbc03af.js";import{C as de,V as fe}from"./consultation_service-fb762918.js";import{e as z,r as d,v as O,f as F}from"./validations-6f974720.js";import{s as ve}from"./form-9d7f0797.js";import{E as L,a as B}from"./emc_event-4721851b.js";import{a as pe}from"./his_date-d43cc0fa.js";import"./patient_identifier_service-42ef7541.js";import"./Date-ba961800.js";import"./vue-datepicker-d131b19a.js";import"./toasts-4c6a636f.js";import"./loader-0a050b3f.js";import"./encounter_types-1e88a09d.js";import"./arrays-1b521787.js";import"./Strs-0c962638.js";const be=Y({components:{IonRow:$,IonCol:Q,IonTitle:q,IonButton:W,TextInput:x,DateInput:ee,YesNoInput:te,SelectInput:ie,NumberInput:le},props:{patient:{type:Object,required:!0},isNewPatient:{type:Boolean,default:!0},observations:{type:Object,default:()=>({})},initialVisitDate:{type:String,default:""}},emits:["onValue","onNext"],setup(t,{emit:o}){const{facility:H}=J(),C=E(""),R=E([]),f=new ae(t.patient.getID(),t.initialVisitDate),p=new de(t.patient.getID(),t.initialVisitDate),N=new fe(t.patient.getID(),t.initialVisitDate),u=new oe(t.patient.getID(),t.initialVisitDate),c=k(()=>t.patient.getBirthdate()),s=j({arvNumber:{value:"",label:"ARV Number",placeholder:"Enter ARV Number",required:!0,validation:async(e,a)=>{if(a.arvNumber.disabled)return null;const l=z(e,"POSITIVE_INTEGERS");if(l!==null)return l;const m=await Z.findByOtherID(G,"".concat(H.code,"-ARV-").concat(e.value));return _(m.data)?null:["ARV Number already exists"]}},arvNumberAtPreviousLocation:{value:"",label:"ART Number at previous Location",computedValue:e=>({tag:"registration",obs:f.buildValueText("ART number at previous location",e)})},initialVisitDate:{value:t.initialVisitDate,label:"Registration Date",required:!0},shouldFollowUp:{value:t.observations["Agrees to followup"]?t.observations["Agrees to followup"].match(/yes|home visit/i)?"Yes":"No":"",label:"Agrees to follow up ?",computedValue:e=>({tag:"registration",obs:[f.buildGroupValueCoded("Agrees to followup","Home visit",e),f.buildGroupValueCoded("Agrees to followup","Phone",e)]}),required:!0},receivedArvTreatmentBefore:{value:t.observations["Ever received ART"]||"",label:"Ever received ARVs for treatment or prophylaxis?",computedValue:e=>({tag:"registration",obs:f.buildValueCoded("Ever received ART",e)}),required:!0},dateLastTakenArvs:{value:t.observations["Date ART last taken"]||"",label:"Date last taken ARVs",computedValue:e=>({tag:"registration",obs:f.buildValueDate("Date ART last taken",e)}),validation:async(e,a)=>a.receivedArvTreatmentBefore.value==="Yes"&&d(e)},everRegisteredAtClinic:{value:t.observations["Ever registered at ART clinic"]||"",label:"Ever registred at an ART clinic",computedValue:e=>({tag:"registration",obs:f.buildValueCoded("Ever registered at ART clinic",e)}),validation:async(e,a)=>a.receivedArvTreatmentBefore.value==="Yes"&&d(e)},artInitiationLocation:{value:t.observations["Location of ART initiation"]||"",label:"Location of ART Initiation",computedValue:e=>({tag:"registration",obs:p.buildValueText("Location of ART initiation",typeof e=="string"?e:e.label)}),validation:async(e,a)=>a.everRegisteredAtClinic.value==="Yes"&&d(e)},artStartDate:{value:t.observations["Date ART started"]||"",label:"Date started ART",computedValue:e=>({tag:"registration",obs:f.buildValueDate("Date ART started",e)}),validation:async(e,a)=>a.everRegisteredAtClinic.value==="Yes"&&d(e)},initialWeight:{value:t.observations.weight||"",label:"Initial Weight",placeholder:"Enter weight",computedValue:e=>({tag:"vitals",obs:N.buildValueNumber("weight",e)}),validation:async(e,a)=>a.everRegisteredAtClinic.value==="Yes"&&e.value!=="Unknown"&&O([()=>d(e),()=>z(e,"DECIMALS"),()=>F(e,2,250)])},initialHeight:{value:t.observations.Height||"",label:"Initial Height",placeholder:"Enter height",computedValue:e=>({tag:"vitals",obs:f.buildValueNumber("Height",e)}),validation:async(e,a)=>a.everRegisteredAtClinic.value==="Yes"&&e.value!=="Unknown"&&O([()=>d(e),()=>z(e),()=>F(e,20,220)])},initialTBStatus:{value:t.observations["TB Status at Initiation"]||"",label:"Initial TB Status",placeholder:"select TB status",computedValue:e=>({tag:"registration",obs:f.buildValueCoded("TB Status at Initiation",typeof e=="string"?e:e.label)}),validation:async(e,a)=>a.everRegisteredAtClinic.value==="Yes"&&d(e)},tptHistory:{value:t.observations["Previous TB treatment history"]||"",label:"TPT History",placeholder:"Select TPT history",computedValue:e=>({tag:"consultation",obs:p.buildValueText("Previous TB treatment history",typeof e=="string"?e:e.label)}),validation:async(e,a)=>a.everRegisteredAtClinic.value==="Yes"&&d(e)},tptStartDate:{value:t.observations["TPT Drugs Received"]||"",label:"Date started TPT",validation:async(e,a)=>{var l,m,v;return((v=(m=(l=a.tptHistory)==null?void 0:l.value)==null?void 0:m.label)==null?void 0:v.match(/currently/i))&&d(e)}},inhQty:{value:"",label:"INH Amount Received",validation:async(e,a)=>{var m,v;const l=(v=(m=a.tptHistory)==null?void 0:m.value)==null?void 0:v.label;return(l==null?void 0:l.match(/currently/i))&&(l.match(/ipt/i)||l.includes("3HP (RFP + INH)"))&&d(e)},computedValue:(e,a)=>{var l;return{tag:"consultation",obs:p.buildObs("TPT Drugs Received",{value_drug:((l=R.value.find(m=>m.name==="INH or H (Isoniazid 300mg tablet)"))==null?void 0:l.drug_id)||0,value_datetime:(a==null?void 0:a.tptStartDate.value)||null,value_numeric:e||0})}}},rifapentineQty:{value:"",label:"Rifapentine Amount Received",validation:async(e,a)=>{var m,v;const l=(v=(m=a.tptHistory)==null?void 0:m.value)==null?void 0:v.label;return(l==null?void 0:l.match(/currently/i))&&l.includes("3HP (RFP + INH)")&&d(e)},computedValue:(e,a)=>{var l;return{tag:"consultation",obs:p.buildObs("TPT Drugs Received",{value_drug:((l=R.value.find(m=>m.name==="Rifapentine (150mg)"))==null?void 0:l.drug_id)||0,value_datetime:(a==null?void 0:a.tptStartDate.value)||null,value_numeric:e||0})}}},threeHPQty:{value:"",label:"INH / RFP Amount Received",validation:async(e,a)=>{var m,v;const l=(v=(m=a.tptHistory)==null?void 0:m.value)==null?void 0:v.label;return(l==null?void 0:l.match(/currently/i))&&l.includes("INH 300 / RFP 300 (3HP)")&&d(e)},computedValue:(e,a)=>{var l;return{tag:"consultation",obs:p.buildObs("TPT Drugs Received",{value_drug:((l=R.value.find(m=>m.name==="INH 300 / RFP 300 (3HP)"))==null?void 0:l.drug_id)||0,value_datetime:(a==null?void 0:a.tptStartDate.value)||null,value_numeric:e||0})}}},tptStartLocation:{value:t.observations["Location TPT Last Received"]||"",label:"TPT Transfer From",validation:async(e,a)=>{var l,m,v;return((v=(m=(l=a.tptHistory)==null?void 0:l.value)==null?void 0:m.label)==null?void 0:v.match(/currently/i))&&d(e)},computedValue:e=>({tag:"consultation",obs:p.buildValueText("Location TPT Last Received",typeof e=="string"?e:e.label)})},confirmatoryTest:{value:t.observations["Confirmatory hiv test type"]||"",label:"Confirmatory Test",placeholder:"Select confirmatory test",required:!0,computedValue(e){return{tag:"registration",obs:f.buildValueCoded("Confirmatory hiv test type",typeof e=="string"?e:e.value)}}},confirmatoryTestLocation:{value:t.observations["Confirmatory HIV test location"]||"",label:"Location of Confirmatory",placeholder:"Select location",validation:async(e,a)=>!(a.confirmatoryTest.value.label==="Not done"||a.confirmatoryTest.value==="Not done")&&d(e),computedValue(e){return{tag:"registration",obs:f.buildValueText("Confirmatory HIV test location",typeof e=="string"?e:e.label)}}},confirmatoryTestDate:{value:t.observations["Confirmatory HIV test date"]||"",label:"Confirmatory HIV Test Date",validation:async(e,a)=>!(a.confirmatoryTest.value.label==="Not done"||a.confirmatoryTest.value==="Not done")&&d(e),computedValue:e=>({tag:"registration",obs:f.buildValueDate("Confirmatory HIV test date",e)})},patientType:{value:"New patient",computedValue:e=>({tag:"patient type",obs:u.buildValueCoded("Type of patient",e)})}}),V=k(()=>{var e;return!(((e=s.confirmatoryTest.value)==null?void 0:e.label)==="Not done"||s.confirmatoryTest.value==="Not done")});U(s.receivedArvTreatmentBefore,e=>{e.value==="No"&&(s.everRegisteredAtClinic.value="")}),U(s.initialVisitDate,e=>{L.emit(B.ON_INITIAL_VISIT_DATE,e.value)}),U(()=>s.artStartDate.value,e=>L.emit(B.ON_ART_START_DATE,e),{immediate:!0});const T=k(()=>{var a;const e=typeof s.tptHistory.value=="string"?s.tptHistory.value:(a=s.tptHistory.value)==null?void 0:a.label;if(e!=null&&e.match(/currently/i)){if(e.match(/ipt/i))return["INH or H (Isoniazid 300mg tablet)"];if(e.includes("3HP (RFP + INH)"))return["INH or H (Isoniazid 300mg tablet)","Rifapentine (150mg)"];if(e.includes("INH 300 / RFP 300 (3HP)"))return["INH 300 / RFP 300 (3HP)"]}return[]}),A=async()=>{if(await K("Are you sure you want to clear all fields?"))for(const e in s)e!=="patientType"&&(s[e].value=void 0,s[e].error="");L.emit(B.ON_CLEAR)},w=async()=>{u.setDate(s.initialVisitDate.value),f.setDate(s.initialVisitDate.value),N.setDate(s.initialVisitDate.value),p.setDate(s.initialVisitDate.value),await ve(s,async(e,a)=>{o("onValue",{type:"registration",data:{formData:{...e,arvNumber:e.arvNumber?"".concat(H.code,"-ARV-").concat(e.arvNumber):""},computedData:a,arvNumberEditable:!s.arvNumber.disabled}}),o("onNext")})},i=async()=>{var a;const e=await h.getJson("/programs/1/next_available_arv_number");e.ok&&(C.value=(a=e.data)==null?void 0:a.arv_number.replace(/^\D+|\s/g,""),C.value&&(s.arvNumber.label="Arv Number (Suggested Number: ".concat(C.value,")")))};return M(()=>{const e=t.patient.getArvNumber();e&&e!=="Unknown"?(s.arvNumber.value=e.split("-")[2],s.arvNumber.disabled=!0):i(),re.getCustomIngridients().then(a=>{a.ok&&(R.value=a.data)})}),{today:pe,form:s,isConfirmatoryTestDone:V,initialTbStatusOptions:se,tptHistoryOptions:ue,HIVTestOptions:me,tptDrugs:T,facility:H,birthdate:c,getFacilities:ne,onClear:A,onSubmit:w}}});function ge(t,o,H,C,R,f){const p=b("ion-title"),N=b("text-input"),u=b("ion-col"),c=b("DateInput"),s=b("yes-no-input"),V=b("SelectInput"),T=b("NumberInput"),A=b("ion-button"),w=b("ion-row");return g(),I(D,null,[n(p,{class:"ion-text-center ion-margin-vertical ion-padding-bottom bold"},{default:r(()=>o[22]||(o[22]=[S(" HIV Clinic Registration ")])),_:1}),n(w,{class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(u,{size:"5",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(N,{modelValue:t.form.arvNumber,"onUpdate:modelValue":o[0]||(o[0]=i=>t.form.arvNumber=i),form:t.form,prefix:"".concat(t.facility.code,"-ARV-"),disabled:!t.isNewPatient},null,8,["modelValue","form","prefix","disabled"])]),_:1}),n(u,{size:"7",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(c,{modelValue:t.form.initialVisitDate,"onUpdate:modelValue":o[1]||(o[1]=i=>t.form.initialVisitDate=i),"min-date":t.birthdate,"max-date":t.today,form:t.form},null,8,["modelValue","min-date","max-date","form"])]),_:1}),n(u,{size:"5",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(s,{modelValue:t.form.shouldFollowUp,"onUpdate:modelValue":o[2]||(o[2]=i=>t.form.shouldFollowUp=i),inline:""},null,8,["modelValue"])]),_:1}),n(u,{size:"7",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(s,{modelValue:t.form.receivedArvTreatmentBefore,"onUpdate:modelValue":o[3]||(o[3]=i=>t.form.receivedArvTreatmentBefore=i),inline:""},null,8,["modelValue"])]),_:1}),t.form.receivedArvTreatmentBefore.value==="Yes"?(g(),I(D,{key:0},[n(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(c,{modelValue:t.form.dateLastTakenArvs,"onUpdate:modelValue":o[4]||(o[4]=i=>t.form.dateLastTakenArvs=i),form:t.form,"min-date":t.birthdate,"max-date":t.today},null,8,["modelValue","form","min-date","max-date"])]),_:1}),n(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(s,{modelValue:t.form.everRegisteredAtClinic,"onUpdate:modelValue":o[5]||(o[5]=i=>t.form.everRegisteredAtClinic=i),inline:""},null,8,["modelValue"])]),_:1})],64)):y("",!0),t.form.everRegisteredAtClinic.value==="Yes"?(g(),I(D,{key:1},[n(u,{size:"9",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(V,{modelValue:t.form.artInitiationLocation,"onUpdate:modelValue":o[6]||(o[6]=i=>t.form.artInitiationLocation=i),form:t.form,asyncOptions:t.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])]),_:1}),n(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(N,{modelValue:t.form.arvNumberAtPreviousLocation,"onUpdate:modelValue":o[7]||(o[7]=i=>t.form.arvNumberAtPreviousLocation=i),form:t.form},null,8,["modelValue","form"])]),_:1}),n(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(c,{modelValue:t.form.artStartDate,"onUpdate:modelValue":o[8]||(o[8]=i=>t.form.artStartDate=i),form:t.form,"min-date":t.birthdate,"max-date":t.today},null,8,["modelValue","form","min-date","max-date"])]),_:1}),n(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(T,{modelValue:t.form.initialWeight,"onUpdate:modelValue":o[9]||(o[9]=i=>t.form.initialWeight=i),form:t.form,min:1,allowUnknown:""},null,8,["modelValue","form"])]),_:1}),n(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(T,{modelValue:t.form.initialHeight,"onUpdate:modelValue":o[10]||(o[10]=i=>t.form.initialHeight=i),form:t.form,min:1,allowUnknown:""},null,8,["modelValue","form"])]),_:1}),n(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(V,{modelValue:t.form.initialTBStatus,"onUpdate:modelValue":o[11]||(o[11]=i=>t.form.initialTBStatus=i),form:t.form,options:t.initialTbStatusOptions},null,8,["modelValue","form","options"])]),_:1}),n(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(V,{modelValue:t.form.tptHistory,"onUpdate:modelValue":o[12]||(o[12]=i=>t.form.tptHistory=i),form:t.form,options:t.tptHistoryOptions},null,8,["modelValue","form","options"])]),_:1}),t.tptDrugs.length?(g(),I(D,{key:0},[n(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(c,{modelValue:t.form.tptStartDate,"onUpdate:modelValue":o[13]||(o[13]=i=>t.form.tptStartDate=i),"min-date":t.birthdate,"max-date":t.today,form:t.form},null,8,["modelValue","min-date","max-date","form"])]),_:1}),t.tptDrugs.includes("INH or H (Isoniazid 300mg tablet)")?(g(),P(u,{key:0,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(T,{modelValue:t.form.inhQty,"onUpdate:modelValue":o[14]||(o[14]=i=>t.form.inhQty=i),form:t.form,min:1},null,8,["modelValue","form"])]),_:1})):y("",!0),t.tptDrugs.includes("Rifapentine (150mg)")?(g(),P(u,{key:1,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(T,{modelValue:t.form.rifapentineQty,"onUpdate:modelValue":o[15]||(o[15]=i=>t.form.rifapentineQty=i),form:t.form,min:1},null,8,["modelValue","form"])]),_:1})):y("",!0),t.tptDrugs.includes("INH 300 / RFP 300 (3HP)")?(g(),P(u,{key:2,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(T,{modelValue:t.form.threeHPQty,"onUpdate:modelValue":o[16]||(o[16]=i=>t.form.threeHPQty=i),form:t.form,min:1},null,8,["modelValue","form"])]),_:1})):y("",!0),n(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(V,{modelValue:t.form.tptStartLocation,"onUpdate:modelValue":o[17]||(o[17]=i=>t.form.tptStartLocation=i),form:t.form,asyncOptions:t.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])]),_:1})],64)):y("",!0)],64)):y("",!0),n(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(V,{modelValue:t.form.confirmatoryTest,"onUpdate:modelValue":o[18]||(o[18]=i=>t.form.confirmatoryTest=i),form:t.form,options:t.HIVTestOptions},null,8,["modelValue","form","options"])]),_:1}),t.isConfirmatoryTestDone?(g(),I(D,{key:2},[n(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(V,{modelValue:t.form.confirmatoryTestLocation,"onUpdate:modelValue":o[19]||(o[19]=i=>t.form.confirmatoryTestLocation=i),form:t.form,asyncOptions:t.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])]),_:1}),n(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[n(c,{modelValue:t.form.confirmatoryTestDate,"onUpdate:modelValue":o[20]||(o[20]=i=>t.form.confirmatoryTestDate=i),form:t.form,"min-date":t.birthdate,"max-date":t.today},null,8,["modelValue","form","min-date","max-date"])]),_:1})],64)):y("",!0),n(u,{size:"12",class:"ion-margin-top"},{default:r(()=>[n(A,{class:"ion-margin-top ion-float-right",size:"large",onClick:t.onSubmit,color:"success"},{default:r(()=>o[23]||(o[23]=[S("Next")])),_:1},8,["onClick"]),n(A,{class:"ion-margin-top ion-float-right",size:"large",color:"warning",onClick:t.onClear},{default:r(()=>o[24]||(o[24]=[S("Clear")])),_:1},8,["onClick"]),t.isNewPatient?y("",!0):(g(),P(A,{key:0,class:"ion-margin-top ion-float-right",size:"large",onClick:o[21]||(o[21]=i=>t.$router.back()),color:"primary"},{default:r(()=>o[25]||(o[25]=[S("Back")])),_:1}))]),_:1})]),_:1})],64)}const Qe=X(be,[["render",ge]]);export{Qe as default};
