!function(){function e(e,a,l){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var l=e[Symbol.toPrimitive];if(void 0!==l){var n=l.call(e,a||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[a]=l,e}System.register(["./ReportTable.vue_vue_type_style_index_0_lang-legacy-68c74ebf.js","./user_service-legacy-311cac10.js","./index-legacy-084a8278.js","./DrilldownTable-legacy-e4e75503.js","./TextInput-legacy-61891fbc.js","./SelectInput-legacy-c35392c7.js","./form-legacy-5a5cbfdd.js","./common-legacy-0d7df615.js","./toasts-legacy-35f2c029.js","./validations-legacy-d0f46810.js","./_plugin-vue_export-helper-legacy-762b7923.js","./Date-legacy-d1585fa3.js","./exports-legacy-ab860f03.js","./index-legacy-a5979f3c.js","./his_date-legacy-31ba5787.js","./vue-datepicker-legacy-828e9dbd.js","./arrays-legacy-e3b1d86b.js","./Strs-legacy-09248991.js","./loader-legacy-1ef95e57.js"],(function(a,l){"use strict";var n,t,o,r,s,i,u,c,d,m,f,v,p,g,y,_,w,b,h,I,j,U,V,x,S,A,B,P,N,T,C,F,k,R,q,z,D,E,O,H,$,J,L;return{setters:[e=>{n=e._},e=>{t=e.U},e=>{o=e.d,r=e.I,s=e.B,i=e.Q,u=e.A,c=e.n,d=e.X,m=e.m,f=e.Z,v=e.q,p=e.h,g=e.i,y=e.j,_=e.r,w=e.F,b=e.ac,h=e.a0,I=e.aI,j=e.J,U=e.o,V=e.g,x=e.w,S=e.e,A=e.b,B=e.t,P=e.aJ,N=e.aK,T=e.ag,C=e.aL},e=>{F=e.m},e=>{k=e.T},e=>{R=e.S},e=>{q=e.i,z=e.r},e=>{D=e.i,E=e.g},e=>{O=e.t,H=e.a},e=>{$=e.a},e=>{J=e._},e=>{L=e.H},null,null,null,null,null,null,null],execute:function(){class l extends Error{constructor(a,l){super(a),e(this,"errors",void 0),this.errors=l}}const G=o({name:"UserModal",components:{IonButton:r,IonPage:s,IonHeader:i,IonContent:u,IonToolbar:c,IonButtons:d,IonFooter:m,IonTitle:f,IonIcon:v,TextInput:k,SelectInput:R,IonGrid:p,IonRow:g,IonCol:y},props:{user:{type:Object,default:()=>({})}},setup(e){var a;const n=_([]),o=w((()=>D(e.user)?"Add New User":"Edit User")),r=b({givenName:{value:E(e.user,"person.names[0].given_name",""),label:"First Name",required:!0,validation:e=>$(e)},familyName:{validation:e=>$(e),value:E(e.user,"person.names[0].family_name",""),label:"Last Name",required:!0},username:{value:E(e.user,"username",""),label:"Username",required:!0,disabled:!D(e.user),validation:async e=>`${e.value}`.length<4?["Username must be at least 4 characters long"]:null},password:{value:"",label:"Password",required:D(e.user),validation:async({value:e})=>e&&`${e}`.length<6?["Password must be at least 6 characters long"]:null},confirmPassword:{value:"",label:"Confirm Password",required:D(e.user),validation:async({value:e},a)=>e&&e!==a.password.value?["Passwords not matching"]:null},roles:{value:(null===(a=e.user)||void 0===a||null===(a=a.roles)||void 0===a?void 0:a.map((e=>({label:e.role,value:e.role,other:e}))))||[],label:"Roles",placeholder:"Select Roles",required:!0}});return h((()=>{t.getAllRoles().then((e=>{const a=Array.isArray(e.data)?e.data:[];n.value=null==a?void 0:a.map((e=>({value:e.role,label:e.role,other:e})))}))})),{form:r,close:I,modal:F,roles:n,title:o,submit:async()=>{if(!(await q(r)))return;const{formData:a}=z(r,!0);let n={...a,roles:a.roles.map((e=>e.label))};try{n=D(e.user)?await t.createUser(n):await t.updateUser(e.user.user_id,n),F.hide(n)}catch(o){if(o instanceof l)return r.username.error="Username already exists";O(JSON.stringify(o),2e3)}}}}});const K=J(G,[["render",function(e,a,l,n,t,o){const r=j("IonIcon"),s=j("IonButton"),i=j("IonButtons"),u=j("IonTitle"),c=j("IonToolbar"),d=j("IonHeader"),m=j("text-input"),f=j("ion-col"),v=j("TextInput"),p=j("SelectInput"),g=j("ion-row"),y=j("ion-grid"),_=j("IonContent"),w=j("IonFooter"),b=j("IonPage");return U(),V(b,null,{default:x((()=>[S(d,null,{default:x((()=>[S(c,null,{default:x((()=>[S(i,{slot:"end"},{default:x((()=>[S(s,{slot:"end",onClick:a[0]||(a[0]=a=>e.modal.hide()),"icon-only":""},{default:x((()=>[S(r,{icon:e.close},null,8,["icon"])])),_:1})])),_:1}),S(u,null,{default:x((()=>[A(B(e.title),1)])),_:1})])),_:1})])),_:1}),S(_,null,{default:x((()=>[S(y,null,{default:x((()=>[S(g,null,{default:x((()=>[S(f,{size:"12",class:"ion-margin-vertical"},{default:x((()=>[S(m,{modelValue:e.form.username,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.username=a)},null,8,["modelValue"])])),_:1}),S(f,{size:"6",class:"ion-margin-vertical"},{default:x((()=>[S(v,{modelValue:e.form.password,"onUpdate:modelValue":a[2]||(a[2]=a=>e.form.password=a),password:""},null,8,["modelValue"])])),_:1}),S(f,{size:"6",class:"ion-margin-vertical"},{default:x((()=>[S(v,{modelValue:e.form.confirmPassword,"onUpdate:modelValue":a[3]||(a[3]=a=>e.form.confirmPassword=a),form:e.form,password:""},null,8,["modelValue","form"])])),_:1}),S(f,{size:"12",class:"ion-margin-vertical"},{default:x((()=>[S(p,{modelValue:e.form.roles,"onUpdate:modelValue":a[4]||(a[4]=a=>e.form.roles=a),options:e.roles,multiple:""},null,8,["modelValue","options"])])),_:1}),S(f,{size:"12",class:"ion-margin-vertical"},{default:x((()=>[S(v,{modelValue:e.form.givenName,"onUpdate:modelValue":a[5]||(a[5]=a=>e.form.givenName=a)},null,8,["modelValue"])])),_:1}),S(f,{size:"12",class:"ion-margin-vertical"},{default:x((()=>[S(v,{modelValue:e.form.familyName,"onUpdate:modelValue":a[6]||(a[6]=a=>e.form.familyName=a)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),S(w,null,{default:x((()=>[S(s,{class:"ion-margin-end ion-margin-vertical ion-float-right",onClick:e.submit},{default:x((()=>a[8]||(a[8]=[A("Save")]))),_:1},8,["onClick"]),S(s,{class:"ion-margin-vertical ion-float-right",color:"light",onClick:a[7]||(a[7]=a=>e.modal.hide())},{default:x((()=>a[9]||(a[9]=[A("Close")]))),_:1})])),_:1})])),_:1})}]]),M=o({name:"Users",components:{BaseReportTable:n},setup(){const e=_([]),a=[{path:"username",label:"Username",initialSort:!0,initialSortOrder:"asc"},{path:"given_name",label:"First name"},{path:"family_name",label:"Last name"},{path:"role",label:"Roles"},{path:"deactivated_on",label:"Deactivated On",formatter:L.toStandardHisDisplayFormat}],l=e=>{try{return{given_name:E(e,"person.names[0].given_name","Unknown"),family_name:E(e,"person.names[0].family_name","Unknown"),role:e.roles.map((e=>e.role)).join(", "),...e}}catch(a){return console.error("Error occurred while processing user details:",a),null}},n=[{icon:P,action:async e=>{const a=await F.show(K,{user:e});D(a)||Object.assign(e,l(a.data))}},{color:"danger",icon:N,condition:e=>null===e.deactivated_on,action:async e=>{if(await T("Are you sure you want to deactivate this user?"))try{const{user:a}=await(await t.deactivateUser(e.user_id)).data;e.deactivated_on=a.deactivated_on,H("User deactivated")}catch(a){O(`Deactivation Failed: ${a}`)}}},{color:"warning",icon:C,condition:e=>null!==e.deactivated_on,action:async e=>{try{await t.activateUser(e.user_id),e.deactivated_on=null}catch(a){O(`Activation Failed: ${a}`)}}}],o=[{label:"Add New User",action:async()=>{const a=await F.show(K);D(null==a?void 0:a.user)||e.value.push(l(a.user))}}];return h((async()=>{const a=(await t.getAllUsers({paginate:!1})).data,n=await t.getCurrentUser();e.value=a.filter((e=>e.person_id!==(null==n?void 0:n.person_id))).map((e=>l(e)))})),{rows:e,columns:a,rowActionBtns:n,actionBtns:o}}});a("default",J(M,[["render",function(e,a,l,n,t,o){const r=j("base-report-table");return U(),V(r,{title:"Users","report-icon":"patient-type.png",columns:e.columns,rows:e.rows,rowActionButtons:e.rowActionBtns,"action-buttons":e.actionBtns,canExportCsv:!1,canExportPDF:!1,showRefreshButton:!1},null,8,["columns","rows","rowActionButtons","action-buttons"])}]]))}}}))}();
