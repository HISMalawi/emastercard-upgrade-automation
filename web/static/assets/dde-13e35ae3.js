import{t as i,a as f}from"./toasts-3b992a75.js";import{r as D,aD as b,aq as v,aU as g,ap as w}from"./index-984efe82.js";import{t as _}from"./his_date-57c4722b.js";const n=new b(v),o=D(!1),l=D([]);function p(a){return a.patient_identifiers.reduce((e,t)=>({...e,[t.type.name]:t.identifier}),{})["DDE person document ID"]}async function k(a){var t;if(o.value)return m(await n.findByNpid(a));const e=await g.searchByNpid(a);return e.ok?e.data:(i((t=e.errorMessage)!=null?t:"Searching client by NPID returned error: ".concat(e.clientErrorType)),[])}async function R(a){var t;if(o.value)return m(await n.findByDemographics(a));const e=await g.searchBy(a);return e.ok?e.data:(i((t=e.errorMessage)!=null?t:"Searching client by Demographics returned error: ".concat(e.clientErrorType)),[])}async function I(a){var t;if(!await w("Are you sure you want to import client?"))return;const e=await n.importPatient(a);if(e.ok)return f("Client imported to local database"),e.data;i((t=e.errorMessage)!=null?t:"Error importing with error: ".concat(e.clientErrorType))}async function U(){o.value=await n.isDDeEnabled(),o.value&&await E()}async function $(a){var t;const e=await(a?n.enableDDe():n.disableDDe());e.ok?(o.value=a,f("DDE status updated")):i((t=e.errorMessage)!=null?t:"Unable to change status because ".concat(e.clientErrorType))}async function E(){var e,t,s,r;const a=await n.getRemainingNpids();if(a.ok&&a.data){const d=a.data.npid_status[0],c=(e=d.unassigned)!=null?e:0,u=(t=d.avg_consumption_rate_per_day)!=null?t:0,y=Math.floor(c/(u||1)),h=_(d.date_last_updated);l.value=[{label:"Assigned",value:(s=d.assigned)!=null?s:0},{label:"Unassigned",value:c},{label:"Average consumption per day",value:u},{label:"Estimated days left",value:y},{label:"Last Updated",value:h}],console.log("Npid status refreshed",l.value)}else i((r=a.errorMessage)!=null?r:"Unable to get NPID status because ".concat(a.clientErrorType))}async function A(a){var t;const e=await n.getLocalAndRemoteDiffs(a);if(e.ok){const{local:s,remote:r}=e.data.diff.npid;return console.log("Local and remote npid",s,r),s!==r}i((t=e.errorMessage)!=null?t:"Unable to get diffs because ".concat(e.clientErrorType))}function m(a){var e;return a.ok&&a.data?Object.keys(a.data).reduce((t,s)=>[...t,...a.data[s].map(r=>({...r,source:s,docID:p(r),ddeClientRequiresImport:p(r)&&s==="remotes"&&!r.patient_id}))],[]):(i((e=a.errorMessage)!=null?e:"An error happened with status code: ".concat(a.httpStatusResponse)),[])}export{k as a,R as b,o as d,E as g,A as h,I as i,l as n,U as r,$ as s};
