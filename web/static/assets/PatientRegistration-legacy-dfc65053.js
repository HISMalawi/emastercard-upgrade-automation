System.register(["./index-legacy-27718e38.js","./relations_service-legacy-9534774b.js","./TextInput-legacy-d777b8a7.js","./DateInput.vue_vue_type_style_index_0_lang-legacy-09579fb6.js","./SelectInput-legacy-fa3f851b.js","./location_options-legacy-49200e02.js","./form-legacy-cd3f8599.js","./Strs-legacy-b5721578.js","./loader-legacy-41f05d42.js","./emc_event-legacy-0252f26c.js","./validations-legacy-de95e1f0.js","./his_date-legacy-88679395.js","./toasts-legacy-9b206dea.js","./patient_identifier_service-legacy-4eca5930.js","./common-legacy-e8d6ba88.js","./index-legacy-d17d54e7.js","./vue-datepicker-legacy-b4d8c74f.js"],function(e,a){"use strict";var l,t,n,i,o,r,d,u,s,m,c,p,g,h,v,b,_,f,N,y,V,w,k,P,I,U,D,j,A,C,E,x,z,q,S,B,F,L,M,G,$,O,R,T,H,Y,J,K,Q,W,X,Z,ee,ae,le,te,ne;return{setters:[e=>{l=e.d,t=e.h,n=e.am,i=e.o,o=e.c,r=e.e,d=e.w,u=e.u,s=e.v,m=e.a2,c=e.b,p=e.t,g=e.U,h=e.G,v=e.I,b=e.s,_=e.M,f=e.l,N=e.m,y=e.n,V=e.aB,w=e.f,k=e.r,P=e.aj,I=e.a8,U=e.aq,D=e.aC,j=e.aD,A=e.aE,C=e.ar,E=e._,x=e.N,z=e.j,q=e.a},e=>{S=e.P,B=e.R},e=>{F=e.T},e=>{L=e._},e=>{M=e.S},e=>{G=e.a,$=e.b},e=>{O=e.i,R=e.r},e=>{T=e.a},e=>{H=e.l},e=>{Y=e.E,J=e.a},e=>{K=e.a,Q=e.b,W=e.c},e=>{X=e.t,Z=e.a},e=>{ee=e.t},e=>{ae=e.P},e=>{le=e.t,te=e.i},e=>{ne=e.D},null],execute:function(){const a=l({__name:"PatientMatch",props:{matchedPatients:{type:Array,required:!0},person:{type:Object,required:!0}},setup(e){const a=e,l=t(()=>`Possible Matches Found (${a.matchedPatients.length}) for ${a.person.given_name} ${a.person.family_name}`),f=t(()=>a.matchedPatients.map(({score:e,person:a})=>({name:`${a.given_name} ${a.family_name}`,...a,score:Number(100*e)+"%"}))),N=[{path:"name",label:"Name"},{path:"score",label:"Score"},{path:"gender",label:"Gender",formatter:le},{path:"birthdate",label:"Birthdate",formatter:X},{path:"home_village",label:"Home Village"},{path:"home_traditional_authority",label:"Home T/A"},{path:"home_district",label:"Home District"}],y=[{label:"Select",color:"primary",action:n.hide}];function V(){return n.hide()}return(e,a)=>(i(),o(_,null,[r(u(g),null,{default:d(()=>[r(u(s),null,{default:d(()=>[r(u(m),null,{default:d(()=>[c(p(l.value),1)]),_:1})]),_:1})]),_:1}),r(u(h),{class:"ion-padding-top"},{default:d(()=>[r(u(ne),{color:"light",rows:f.value,columns:N,"row-actions-buttons":y,config:{showSearchField:!1,showSubmitButton:!1}},null,8,["rows"])]),_:1}),r(u(b),null,{default:d(()=>[r(u(s),null,{default:d(()=>[r(u(v),{slot:"end",onClick:V,color:"primary"},{default:d(()=>[...a[0]||(a[0]=[c(" Register as New Patient ",-1)])]),_:1})]),_:1})]),_:1})],64))}}),ie=l({components:{IonGrid:f,IonRow:N,IonCol:y,TextInput:F,DateInput:L,SelectInput:M,IonCheckbox:V},setup(){const e=w(),l=k(!1),t=k(!1),i=G(),o=P({givenName:{label:"First Name",value:"",placeholder:"Enter First Name",required:!0,validation:e=>K(e)},familyName:{label:"Last Name",value:"",placeholder:"Enter Last Name",required:!0,validation:e=>K(e)},middleName:{label:"Middle Name",value:"",placeholder:"Enter middle Name",validation:e=>e&&e.label?K(e):null},nationalId:{label:"Malawi National ID Number",value:"",placeholder:"Enter Malawi National ID Number",validation:e=>e&&e.label?Q(e):null},gender:{value:"",required:!0,label:"Gender",placeholder:"select gender"},birthdate:{value:"",label:"Date of Birth",required:!0},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",placeholder:"Enter cellphone number e.g. 0991234567",validation:async e=>"Unknown"!==e.value&&W(e)},homeVillage:{value:"",label:"Home Village",placeholder:"Home Village",required:!0},landmark:{value:"",label:"Landmark",placeholder:"Closest Landmark or Plot Number",required:!0}}),r=P({givenName:{label:"First Name",value:"",placeholder:"Enter First Name",required:!0,validation:e=>K(e)},familyName:{label:"Last Name",value:"",placeholder:"Enter Last Name",required:!0,validation:e=>K(e)},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",placeholder:"Enter cellphone number e.g. 0991234567",validation:async e=>"Unknown"!==e.value&&W(e)}});I(t,e=>{e?(r.givenName.value="Unknown",r.familyName.value="Unknown",r.cellPhoneNumber.value="Unknown",r.givenName.disabled=!0,r.familyName.disabled=!0,r.givenName.error="",r.familyName.error="",r.cellPhoneNumber.error=""):(r.givenName.value="",r.familyName.value="",r.cellPhoneNumber.value="",r.givenName.disabled=!1,r.familyName.disabled=!1)});const d=(e,a={})=>{const l={facility_name:null,occupation:null};for(const t in e)l[T(t)]=e[t];return{...l,...a}},u=async e=>{var a,l,t,n,i,o,r,d;let u,s;try{var m;null!=e&&null!==(m=e.other)&&void 0!==m&&m.traditional_authority_id&&(u=await j.getTraditionalAuthorityById(e.other.traditional_authority_id)),u&&(s=await j.getDistrictByID(u.district_id))}catch(c){ee("Unable to resolve client address. Saving using default address"),console.error(c)}return{home_district:null!==(a=null===(l=s)||void 0===l?void 0:l.name)&&void 0!==a?a:"N/A",home_traditional_authority:null!==(t=null===(n=u)||void 0===n?void 0:n.name)&&void 0!==t?t:"N/A",home_village:(null==e?void 0:e.label)||"N/A",current_district:null!==(i=null===(o=s)||void 0===o?void 0:o.name)&&void 0!==i?i:"N/A",current_traditional_authority:null!==(r=null===(d=u)||void 0===d?void 0:d.name)&&void 0!==r?r:"N/A",current_village:(null==e?void 0:e.label)||"N/A"}};return{today:Z,patient:o,guardian:r,landmarks:i,genderOptions:[{label:"Male",value:"M"},{label:"Female",value:"F"}],guardianAbsent:t,isBirthdateEstimated:l,onClear:async()=>{if(await U("Are you sure you want to clear all fields?")){for(const e in o)o[e].value=void 0,o[e].error="";for(const e in r)r[e].value=void 0,r[e].error="";Y.emit(J.ON_CLEAR)}},onFinish:async()=>{const i=await O(o),s=!!t.value||await O(r);if(i&&s)try{H.show("Checking for possible duplicates...");const i=R(o).formData,m=new S,c=await u(i.homeVillage),p=d(i,{...c,isPatient:!0,patient_type:null,gender:i.gender.value,landmark:i.landmark.value,birthdate_estimated:l.value?"Yes":"No",relationship:t.value?"No":"Yes"});H.hide();const g=await(async e=>{const l=new A(C);try{var t;const i=await l.checkPotentialDuplicates(e);if(i.ok&&(null===(t=i.data)||void 0===t?void 0:t.length)>0)return n.show(a,{matchedPatients:i.data,person:e},"custom-summary-modal",!1)}catch(i){console.error(i)}})(p);if(!te(g))return e.push(`/patient/${g.patient_id}`);await H.show("Saving..."),await m.createPerson(p),await m.createPatient();const h=m.getPersonID();if(i.nationalId&&await ae.create(h,D,i.nationalId),!t.value&&s){const{formData:e}=R(r),a=await u(),l=d(e,{...a,middle_name:"",gender:"N/A",birthdate:"N/A",birthdate_estimated:"N/A",landmark:"N/A",relationship:"N/A",patient_type:"",isPatient:!1,patient_id:h});await m.registerGuardian(l);const t=m.getPersonID();await B.createRelation(h,t,13)}e.push(`/patient/reception/${h}/true`),H.hide()}catch(m){console.log(m),H.hide()}},getVillagesByName:$}}}),oe={class:"ion-margin-start checkbox-label"};e("default",E(ie,[["render",function(e,a,l,t,n,o){const u=x("ion-col"),s=x("ion-row"),m=x("ion-title"),p=x("TextInput"),g=x("SelectInput"),h=x("DateInput"),v=x("ion-checkbox"),b=x("ion-button"),_=x("ion-grid"),f=x("Layout");return i(),z(f,null,{default:d(()=>[r(_,null,{default:d(()=>[r(s,null,{default:d(()=>[r(u,{class:"ion-margin-bottom"},{default:d(()=>[...a[14]||(a[14]=[q("h1",null,"New Patient Registration",-1)])]),_:1})]),_:1}),r(s,{class:"his-card"},{default:d(()=>[r(u,{size:"12"},{default:d(()=>[r(m,{class:"ion-text-center ion-margin-vertical"},{default:d(()=>[...a[15]||(a[15]=[q("b",null,"Personal Details",-1)])]),_:1}),r(s,{class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.patient.givenName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.patient.givenName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.patient.middleName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.patient.middleName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.patient.familyName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.patient.familyName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.patient.nationalId,"onUpdate:modelValue":a[3]||(a[3]=a=>e.patient.nationalId=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.patient.gender,"onUpdate:modelValue":a[4]||(a[4]=a=>e.patient.gender=a),options:e.genderOptions},null,8,["modelValue","options"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.patient.cellPhoneNumber,"onUpdate:modelValue":a[5]||(a[5]=a=>e.patient.cellPhoneNumber=a),allowUnknown:""},null,8,["modelValue"])]),_:1}),r(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(h,{modelValue:e.patient.birthdate,"onUpdate:modelValue":a[6]||(a[6]=a=>e.patient.birthdate=a),allowEstimation:!0,estimationLabel:"Estimate Age",minDate:"1920-01-01",maxDate:e.today(),onIsEstimated:a[7]||(a[7]=a=>e.isBirthdateEstimated=a)},null,8,["modelValue","maxDate"])]),_:1}),r(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.patient.homeVillage,"onUpdate:modelValue":a[8]||(a[8]=a=>e.patient.homeVillage=a),asyncOptions:e.getVillagesByName,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1}),r(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.patient.landmark,"onUpdate:modelValue":a[9]||(a[9]=a=>e.patient.landmark=a),options:e.landmarks,allowCustom:""},null,8,["modelValue","options"])]),_:1})]),_:1}),r(m,{class:"ion-text-center ion-margin-vertical ion-padding-top"},{default:d(()=>[a[17]||(a[17]=q("b",null,"Guardian details",-1)),q("span",oe,[a[16]||(a[16]=c(" Guardian Details Unknown? ",-1)),r(v,{modelValue:e.guardianAbsent,"onUpdate:modelValue":a[10]||(a[10]=a=>e.guardianAbsent=a)},null,8,["modelValue"])])]),_:1}),r(s,{class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.guardian.givenName,"onUpdate:modelValue":a[11]||(a[11]=a=>e.guardian.givenName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.guardian.familyName,"onUpdate:modelValue":a[12]||(a[12]=a=>e.guardian.familyName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.guardian.cellPhoneNumber,"onUpdate:modelValue":a[13]||(a[13]=a=>e.guardian.cellPhoneNumber=a),allowUnknown:""},null,8,["modelValue"])]),_:1})]),_:1}),r(b,{class:"ion-margin-top ion-float-right",onClick:e.onFinish,size:"large",color:"success"},{default:d(()=>[...a[18]||(a[18]=[c("Finish",-1)])]),_:1},8,["onClick"]),r(b,{class:"ion-margin-top ion-float-right",onClick:e.onClear,size:"large",color:"warning"},{default:d(()=>[...a[19]||(a[19]=[c("Clear",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})}]]))}}});
