!function(){function e(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var l=t.call(e,a||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}System.register(["./index-legacy-a3ed4133.js","./patient_service-legacy-2479eb91.js","./common-legacy-0d7df615.js","./consultation_service-legacy-5c8da417.js","./VoidReason-legacy-1a4c6144.js","./his_date-legacy-0bc670a8.js","./DateInput.vue_vue_type_style_index_0_lang-legacy-c968a3a8.js","./SelectInput-legacy-99fb41c2.js","./regimen_service-legacy-21c3f1a7.js","./encounter_types-legacy-aef9fff0.js","./arrays-legacy-4be31994.js","./form-legacy-dec90092.js","./emc_event-legacy-58754a45.js","./toasts-legacy-14f1e720.js","./Date-legacy-809f13ef.js","./index-legacy-d4a0fad1.js","./loader-legacy-805839f7.js","./TextInput-legacy-975c25ba.js","./location_options-legacy-d08c7bd9.js","./DTFormElements-legacy-eba3db0f.js","./validations-legacy-0fc7cb15.js","./YesNoInput-legacy-092cec29.js","./DrilldownTable-legacy-640fced2.js","./Strs-legacy-eacc8505.js","./relations_service-legacy-186efaa8.js","./dde-legacy-525bb543.js","./patient_identifier_service-legacy-e8ba9992.js","./vue-datepicker-legacy-fdf7a164.js"],(function(a,t){"use strict";var l,n,i,o,u,r,d,s,c,m,v,p,f,g,b,h,_,y,w,D,V,I,N,A,R,C,P,T,S,E,O,k,x,U,L,B,q,G,z,F,M,H,$,j,W,Y,J,Q,K,X,Z,ee,ae,te,le,ne,ie,oe,ue,re,de,se,ce,me,ve,pe,fe,ge,be,he,_e,ye,we,De,Ve,Ie,Ne,Ae,Re,Ce,Pe,Te,Se,Ee,Oe,ke,xe,Ue,Le,Be,qe,Ge,ze,Fe,Me,He,$e,je,We,Ye,Je,Qe,Ke,Xe,Ze,ea,aa,ta,la,na,ia,oa,ua,ra,da,sa;return{setters:[e=>{l=e.H,n=e.k,i=e.d,o=e.r,u=e.ah,r=e.a6,d=e.i,s=e.c,c=e.e,m=e.w,v=e.u,p=e.K,f=e.o,g=e.v,b=e.a0,h=e.b,_=e.S,y=e.l,w=e.m,D=e.n,V=e.J,I=e.x,N=e.az,A=e.E,R=e.I,C=e.ak,P=e.s,T=e.ao,S=e.h,E=e._,O=e.L,k=e.a,x=e.j,U=e.A,L=e.U,B=e.N,q=e.t,G=e.W,z=e.aD,F=e.aE,M=e.aF,H=e.aG,$=e.aH,j=e.aI,W=e.a5,Y=e.aJ,J=e.p,Q=e.a4,K=e.aK,X=e.aL,Z=e.ai,ee=e.aB,ae=e.ap,te=e.aM},e=>{le=e.g,ne=e.D,ie=e.C,oe=e.P,ue=e.O},e=>{re=e.g,de=e.i},e=>{se=e.A,ce=e.u,me=e.V,ve=e.C,pe=e.E},e=>{fe=e.p},e=>{ge=e.a,be=e.t,he=e.d,_e=e.e,ye=e.f},e=>{we=e._},e=>{De=e.S},e=>{Ve=e.N,Ie=e.R},e=>{Ne=e.e},e=>{Ae=e.s,Re=e.a,Ce=e.c,Pe=e.u},e=>{Te=e.s,Se=e.i,Ee=e.r,Oe=e.a},e=>{ke=e.E,xe=e.a},e=>{Ue=e.a,Le=e.t},e=>{Be=e.D},e=>{qe=e.D},e=>{Ge=e.l},e=>{ze=e.T},e=>{Fe=e.g,Me=e.a,He=e.b},e=>{$e=e.t,je=e.g},e=>{We=e.r,Ye=e.v,Je=e.d,Qe=e.e,Ke=e.f,Xe=e.a,Ze=e.b,ea=e.c},e=>{aa=e.Y},e=>{ta=e.D},e=>{la=e.t,na=e.i},e=>{ia=e.P,oa=e.R},e=>{ua=e.r,ra=e.d,da=e.h,sa=e.a},null,null],execute:function(){var t=document.createElement("style");t.textContent="ion-label[data-v-20e46410]{font-weight:700}ion-checkbox[data-v-20e46410]{--size: 20px !important}.title[data-v-824715c1]{font-weight:700}ion-list[data-v-1195e33c]{height:100%}\n",document.head.appendChild(t);const ca=e=>{const a=e.given_name,t=e.family_name;return`${a} ${e.middle_name?e.middle_name:""} ${t}`};class ma{static getRelationships(e){return l.getJson(`/people/${e}/relationships`).then((e=>e.data))}static async getGuardianDetails(e){return await this.getRelationships(e).then((e=>e.map((e=>{const a=re(e,"relation.names[0]");return{id:e.relationship_id,name:a?ca(a):"",relationshipType:re(e,"type.b_is_to_a",""),phoneNumber:le(re(e,"relation.person_attributes",[]),12),names:a}}))))}}class va extends se{constructor(e){super(e,Ne.LAB_ORDERS,ge())}async loadConcepts(){va.conceptID=await se.getConceptID("HIV Viral Load")}createLabOrder(e,a){const t=l.getUsername(),i=n().facility.name,o=se.getCachedConceptID(a,!0);return l.postJson("/lab/orders",{encounter_id:this.encounterID,orders:[{requesting_clinician:t,target_lab:i,reason_for_test_id:o,encounter_id:this.encounterID,tests:[{concept_id:va.conceptID}],date:this.date,specimen:{concept_id:e}}]})}createLabResult(e,a,t,n="numeric"){return l.postJson(`lab/tests/${e}/results`,{encounter_id:this.encounterID,date:this.date,measures:[{indicator:{concept_id:va.conceptID},value:a,value_modifier:t,value_type:n}]})}static getSpecimens(e){return l.getJson("/lab/specimen_types",{test_type:e})}static async getOrders(e,a={}){var t;return null!==(t=(await l.getJson("/lab/orders",{patient_id:e,...a})).data)&&void 0!==t?t:[]}static async getViralLoadResultTrail(e,a={}){return(await this.getOrders(e,a)).reduce(((e,a)=>(a.tests.forEach((t=>t.result.forEach((l=>e.push({...a,test:t.name,result:`${l.value_modifier} ${l.value}`,result_date:l.date}))))),e)),[])}static async getlatestViralLoadResult(e,a={}){const t=(await this.getOrders(e,a)).flatMap((e=>e.tests.flatMap((e=>e.result)))).filter(Boolean);if(de(t))return"N/A";const l=Ae(t,"date","desc")[0];return`${l.value_modifier}${l.value} (${be(l.date)})`}}e(va,"conceptID",-1);const pa=i({__name:"ViralLoadResult",props:{patient:{type:Object,required:!0}},setup(e){const a=e,t=o(!1),l=Re(["=",">","<",">=","<="]),n=Re(["Routine","Targeted","Confirmatory","Stat","Repeat / Missing","Follow up after Low Level Viremia","Follow up after High Viral Load"]),i=o([]),S=a.patient.getBirthdate(),E=u({orderDate:{value:"",label:"Order Date",required:!0,validation:async e=>he(e.value).isValid()?new Date(e.value)>new Date(ge())?["Order date cannot be in the future"]:new Date(e.value)<new Date(S)?["Order date cannot be before patient's date of birth"]:null:["Invalid date"]},resultDate:{value:"",label:"Result Date",required:!0,validation:async(e,a)=>he(e.value).isValid()?new Date(e.value)>new Date(ge())?["Result date cannot be in the future"]:new Date(e.value)<new Date(a.orderDate.value)?["Result date cannot be before order date"]:null:["Invalid date"]},specimen:{value:"",label:"Specimen",placeholder:"Select a specimen",required:!0},modifier:{value:"",label:"Modifier",placeholder:"Select a modifier",required:!0},reason:{value:"",label:"Reason",placeholder:"Select a reason",required:!0},result:{value:"",label:"Result Value",placeholder:"Enter a result value",required:!0}});async function O(){Te(E,(async e=>{const l=new va(a.patient.getID());await l.loadConcepts(),l.setDate(e.orderDate);if(!(await l.createEncounter()))throw new Error("Unable to create lab order encounter");const n=await l.createLabOrder(e.specimen.value,e.reason.value);if(!n.ok||!n.data)throw new Error("Unable to save lab orders");const i=new va(a.patient.getID());i.setDate(e.resultDate);if(!(await i.createEncounter()))throw new Error("Unable to create lab result encounter");const o=t.value?"LDL":parseInt(e.result),u=t.value?"=":e.modifier.value,r=t.value?"text":"numeric",d=n.data[0].tests[0].id;await i.createLabResult(d,o,u,r),await C.hide(),ke.emit(xe.RELOAD_LATEST_VL_RESULT),ke.emit(xe.RELOAD_PATIENT_VISIT_DATA)}))}async function k(){if(await T("Are you sure you want to clear all fields?")){t.value=!1;for(const e in E)E[e].value="",E[e].error="";ke.emit(xe.ON_CLEAR)}}return r(t,(e=>{e&&(E.modifier.value="",E.result.value=void 0,E.modifier.error="",E.result.error=""),E.modifier.disabled=e,E.modifier.required=!e,E.result.disabled=e,E.result.required=!e})),d((async()=>{i.value=(await va.getSpecimens("HIV viral load")).data.map((e=>({label:e.name,value:e.concept_id})))})),(e,a)=>(f(),s(p,null,[c(v(_),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(b),null,{default:m((()=>a[8]||(a[8]=[h("Viral Load Results")]))),_:1})])),_:1})])),_:1}),c(v(A),{class:"ion-padding"},{default:m((()=>[c(v(y),{style:{width:"100%"}},{default:m((()=>[c(v(w),null,{default:m((()=>[c(v(D),{size:"12",class:"ion-margin-vertical"},{default:m((()=>[c(we,{modelValue:E.orderDate,"onUpdate:modelValue":a[0]||(a[0]=e=>E.orderDate=e),form:E,minDate:v(S),maxDate:v(ge)},null,8,["modelValue","form","minDate","maxDate"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(De,{modelValue:E.reason,"onUpdate:modelValue":a[1]||(a[1]=e=>E.reason=e),options:v(n)},null,8,["modelValue","options"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(De,{modelValue:E.specimen,"onUpdate:modelValue":a[2]||(a[2]=e=>E.specimen=e),options:i.value},null,8,["modelValue","options"])])),_:1}),c(v(D),{size:"12",class:"ion-margin-vertical"},{default:m((()=>[c(we,{modelValue:E.resultDate,"onUpdate:modelValue":a[3]||(a[3]=e=>E.resultDate=e),form:E,minDate:E.orderDate.value,"max-date":v(ge)},null,8,["modelValue","form","minDate","max-date"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(De,{modelValue:E.modifier,"onUpdate:modelValue":a[4]||(a[4]=e=>E.modifier=e),options:v(l)},null,8,["modelValue","options"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:E.result,"onUpdate:modelValue":a[5]||(a[5]=e=>E.result=e),form:E,min:1},null,8,["modelValue","form"])])),_:1})])),_:1}),c(v(w),{class:"ion-margin-top"},{default:m((()=>[c(v(D),{size:"12"},{default:m((()=>[c(v(V),{class:"ion-padding-vertical bold"},{default:m((()=>a[9]||(a[9]=[h(" Other Results Options: ")]))),_:1}),c(v(I),null,{default:m((()=>[c(v(V),null,{default:m((()=>a[10]||(a[10]=[h("LDL")]))),_:1}),c(v(N),{slot:"start",modelValue:t.value,"onUpdate:modelValue":a[6]||(a[6]=e=>t.value=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),c(v(P),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(R),{color:"primary",onClick:a[7]||(a[7]=e=>v(C).hide()),slot:"end"},{default:m((()=>a[11]||(a[11]=[h(" Close ")]))),_:1}),c(v(R),{color:"warning",onClick:k,slot:"end"},{default:m((()=>a[12]||(a[12]=[h(" Reset ")]))),_:1}),c(v(R),{color:"success",onClick:O,slot:"end"},{default:m((()=>a[13]||(a[13]=[h(" Save ")]))),_:1})])),_:1})])),_:1})],64))}}),fa=i({name:"OutcomesTable",props:{patientStates:{type:Array,required:!0}},components:{DataTable:qe},emits:["voidOutcome"],setup(e,{emit:a}){const t=[{path:"name",label:"Outcome"},{path:"start_date",label:"Start Date",formatter:e=>he(e).format(Be)},{path:"end_date",label:"End Date",formatter:e=>he(e).format(Be)}];return{rows:S((()=>e.patientStates.map(((e,a)=>({...e,index:a}))))),columns:t,tableConfig:{showSearchField:!1,showSubmitButton:!1},TableRowActions:[{label:"void",color:"danger",action:async e=>{await T("Are you sure you want to void this outcome?")&&a("voidOutcome",{stateId:e.patient_state_id,index:e.index})}}]}}});const ga=E(fa,[["render",function(e,a,t,l,n,i){const o=O("data-table");return f(),s(p,null,[a[0]||(a[0]=k("p",{class:"ion-padding-horizontal ion-margin-vertical bold ion-margin-top"},"Previous Outcomes",-1)),c(o,{rows:e.rows,columns:e.columns,config:e.tableConfig,"row-actions-buttons":e.TableRowActions,color:"light"},null,8,["rows","columns","config","row-actions-buttons"])],64)}]]),ba=i({name:"EnrollmentForm",components:{DateInput:we,IonGrid:y,IonRow:w,IonCol:D,IonButton:R},props:["birthdate","patientId"],setup(e){const a=u({programId:{label:"Select program",required:!0,value:""},date:{value:"",label:"Date of Enrollment",required:!0}}),{enrollPatient:t,fetchPatientPrograms:l}=ce(e.patientId);return{form:a,today:ge,onReset:async()=>{await T("Are you sure you want to clear all fields")&&(a.date.value="",a.date.error="",ke.emit(xe.ON_CLEAR))},enrollProgram:async function(){await Se(a)&&Ge.show(),await t(a.date.value),await Ue("Program enrolled successfully"),await C.hide(),l().catch(console.error)}}}});const ha=E(ba,[["render",function(e,a,t,l,n,i){const o=O("DateInput"),u=O("ion-col"),r=O("ion-button"),d=O("ion-row"),s=O("ion-grid");return f(),x(s,null,{default:m((()=>[c(d,null,{default:m((()=>[c(u,{size:"12"},{default:m((()=>[c(o,{modelValue:e.form.date,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.date=a),form:e.form,minDate:e.birthdate,"max-date":e.today},null,8,["modelValue","form","minDate","max-date"])])),_:1}),c(u,null,{default:m((()=>[c(r,{color:"warning",onClick:e.onReset},{default:m((()=>a[1]||(a[1]=[h("Reset")]))),_:1},8,["onClick"]),c(r,{color:"success",onClick:e.enrollProgram},{default:m((()=>a[2]||(a[2]=[h("Enroll")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}]]),_a=i({name:"OutcomeForm",props:{outcomes:{type:Array,required:!0},dateEnrolled:{type:String,required:!0},birthdate:{type:String,required:!0}},components:{DateInput:we,IonGrid:y,IonRow:w,IonCol:D,IonButton:R,SelectInput:De,TextInput:ze},emits:["saveOutcome"],setup(e,{emit:a}){const t=he().format("YYYY-MM-DD"),l=u({date:{value:"",label:"Outcome Date",required:!0,validation:async a=>new Date(a.value)<new Date(e.birthdate)?[`Outcome date cannot be before date of birth - ${he(e.birthdate).format(Be)}`]:new Date(a.value)<new Date(e.dateEnrolled)?[`Outcome date cannot be before enrollment date- ${he(e.dateEnrolled).format(Be)}`]:null},status:{value:"",label:"Outcome",required:!0},nextFacility:{value:"",label:"Next Facility",validation:async(e,a)=>"Patient transferred out"===a.status.value.label&&We(e)},reason:{value:"",label:"Reason for transfer out",validation:async(e,a)=>"Patient transferred out"===a.status.value.label&&We(e)},otherReason:{value:"",label:"Other reason for transfer out",placeholder:"Specify other reason for transfer out",validation:async(e,a)=>{var t,l;return"Patient transferred out"===(null===(t=a.status)||void 0===t||null===(t=t.value)||void 0===t?void 0:t.label)&&"Other"===(null===(l=a.reason)||void 0===l||null===(l=l.value)||void 0===l?void 0:l.label)&&We(e)}}}),n=S((()=>{var e;return"Patient transferred out"===(null===(e=l.status.value)||void 0===e?void 0:e.label)})),i=S((()=>{var e;return"Other"===(null===(e=l.reason)||void 0===e||null===(e=e.value)||void 0===e?void 0:e.label)}));return{form:l,today:t,isTransferredOut:n,specifyOther:i,onSave:()=>Te(l,(e=>a("saveOutcome",{...e,isTransferredOut:n.value}))),onReset:async()=>{if(await T("are you sure you want to clear all fields")){for(const e in l)l[e].value="",l[e].error="";ke.emit(xe.ON_CLEAR)}},getFacilities:Fe,transferOutReasons:$e}}});const ya=E(_a,[["render",function(e,a,t,l,n,i){const o=O("ion-col"),u=O("DateInput"),r=O("SelectInput"),d=O("text-input"),v=O("ion-button"),g=O("ion-row"),b=O("ion-grid");return f(),x(b,null,{default:m((()=>[c(g,null,{default:m((()=>[c(o,{size:"12"},{default:m((()=>a[5]||(a[5]=[k("p",null,"Add New Outcome",-1)]))),_:1}),c(o,{size:"6",class:"ion-margin-top-vertical"},{default:m((()=>[c(u,{modelValue:e.form.date,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.date=a),form:e.form,minDate:e.dateEnrolled,"max-date":e.today},null,8,["modelValue","form","minDate","max-date"])])),_:1}),c(o,{size:"6",class:"ion-margin-top-vertical"},{default:m((()=>[c(r,{modelValue:e.form.status,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.status=a),form:e.form,options:e.outcomes},null,8,["modelValue","form","options"])])),_:1}),e.isTransferredOut?(f(),s(p,{key:0},[c(o,{size:"6",class:"ion-margin-top-vertical"},{default:m((()=>[c(r,{modelValue:e.form.nextFacility,"onUpdate:modelValue":a[2]||(a[2]=a=>e.form.nextFacility=a),form:e.form,asyncOptions:e.getFacilities},null,8,["modelValue","form","asyncOptions"])])),_:1}),c(o,{size:"6",class:"ion-margin-top-vertical"},{default:m((()=>[c(r,{modelValue:e.form.reason,"onUpdate:modelValue":a[3]||(a[3]=a=>e.form.reason=a),form:e.form,options:e.transferOutReasons},null,8,["modelValue","form","options"])])),_:1}),e.specifyOther?(f(),x(o,{key:0,size:"12",class:"ion-margin-top-vertical"},{default:m((()=>[c(d,{modelValue:e.form.otherReason,"onUpdate:modelValue":a[4]||(a[4]=a=>e.form.otherReason=a),form:e.form},null,8,["modelValue","form"])])),_:1})):U("",!0)],64)):U("",!0),c(o,{size:"12",class:"ion-margin-top"},{default:m((()=>[c(v,{color:"warning",onClick:e.onReset},{default:m((()=>a[6]||(a[6]=[h("Reset")]))),_:1},8,["onClick"]),c(v,{color:"success",onClick:e.onSave},{default:m((()=>a[7]||(a[7]=[h("Save")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}]]),wa={class:"ion-page",id:"main"},Da={class:"ion-margin-start"},Va=i({__name:"OutcomeStatus",props:{patient:{type:Object,required:!0}},setup(e){const a=e,t=o(),l=S((()=>a.patient.getID())),n=S((()=>{var e;return null===(e=t.value)||void 0===e||null===(e=e.other)||void 0===e?void 0:e.date_enrolled})),i=S((()=>_e(a.patient.getBirthdate()))),u=S((()=>{var e;return T.value.get(null===(e=t.value)||void 0===e?void 0:e.value)})),r=S((()=>{var e,a;return null!==(e=null===(a=t.value)||void 0===a||null===(a=a.other)||void 0===a||null===(a=a.patient_states)||void 0===a?void 0:a.length)&&void 0!==e?e:0})),{patientPrograms:N,programStates:T,hasArtProgram:E,updateState:H,voidProgram:$,voidState:j,fetchPatientPrograms:W}=ce(l.value);async function Y(e){var a;const{date:n,status:i,nextFacility:o,reason:u,otherReason:r,isTransferredOut:d}=e;if(d){const e="Other"!==u.value?u.value:r;await async function(e,a,t=""){const n=new se(l.value,Ne.EXIT_FROM_HIV_CARE,a);if(!(await n.createEncounter()))throw"Unable to transfer out encounter";return t&&await n.saveValueTextObs("Reason for transfer out",t),n.saveValueTextObs("Transfer to",e.name)}(o.other,n,e)}await H(i.value,n,null===(a=t.value)||void 0===a?void 0:a.value),await Ue("Outcome saved successfully",1e3),await C.hide(),ke.emit(xe.RELOAD_PATIENT_VISIT_DATA)}async function J(){var e,a;await $(null!==(e=null===(a=t.value)||void 0===a||null===(a=a.other)||void 0===a?void 0:a.patient_program_id)&&void 0!==e?e:-1,"duplicate / system error"),await Ue("Patient voided from program successfully",1e3),await C.hide(),ke.emit(xe.RELOAD_PATIENT_VISIT_DATA)}async function Q({stateId:e,index:a}){var l,n;await j(e,"duplicate / system error",null===(l=t.value)||void 0===l?void 0:l.value),Ue("Outcome voided successfully"),null===(n=t.value)||void 0===n||null===(n=n.other)||void 0===n||n.patient_states.splice(a,1),ke.emit(xe.RELOAD_PATIENT_VISIT_DATA)}async function K(){await C.show(ha,{birthdate:i.value,patientId:l.value},"custom-modal custom-modal-backdrop")}return d(W),(e,a)=>{const l=O("ion-icon"),o=O("ion-buttons");return f(),x(v(M),{when:"xs",contentId:"main"},{default:m((()=>[c(v(G),{contentId:"main"},{default:m((()=>[c(v(_),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(b),null,{default:m((()=>a[0]||(a[0]=[h("Patient Programs")]))),_:1})])),_:1})])),_:1}),c(v(A),{class:"ion-no-padding"},{default:m((()=>[c(v(L),null,{default:m((()=>[(f(!0),s(p,null,B(v(N),(e=>{var a;return f(),x(v(I),{button:"",key:e.value,color:e.value===(null===(a=t.value)||void 0===a?void 0:a.value)?"secondary":"light",onClick:a=>function(e){t.value=e}(e)},{default:m((()=>[c(v(V),null,{default:m((()=>[h(q(e.label),1)])),_:2},1024)])),_:2},1032,["color","onClick"])})),128))])),_:1})])),_:1}),c(v(P),null,{default:m((()=>[c(v(g),{class:"ion-padding-start"},{default:m((()=>[t.value?(f(),x(v(R),{key:0,color:"danger",onClick:J,slot:"start"},{default:m((()=>a[1]||(a[1]=[h("Void Program")]))),_:1})):U("",!0),v(E)?U("",!0):(f(),x(v(R),{key:1,onClick:K,slot:"start"},{default:m((()=>a[2]||(a[2]=[h("Enroll HIV Program")]))),_:1}))])),_:1})])),_:1})])),_:1}),k("div",wa,[c(v(_),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(o,{slot:"end"},{default:m((()=>[c(v(R),{onClick:v(C).hide,color:"danger",size:"large"},{default:m((()=>[c(l,{size:"large",icon:v(z)},null,8,["icon"])])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),c(v(A),{class:"ion-padding"},{default:m((()=>[t.value?(f(),x(v(y),{key:0,style:{width:"100%"}},{default:m((()=>[c(v(w),{class:"his-card",style:F({minHeight:r.value?"0":"30vh"})},{default:m((()=>[c(v(D),{size:"12",class:"ion-no-padding"},{default:m((()=>{var e,a;return[k("h5",Da," Enrollment Date: "+q(n.value?v(be)(n.value):"Unknown"),1),c(ga,{patientStates:null!==(e=null===(a=t.value)||void 0===a||null===(a=a.other)||void 0===a?void 0:a.patient_states)&&void 0!==e?e:[],onVoidOutcome:Q},null,8,["patientStates"])]})),_:1})])),_:1},8,["style"]),u.value?(f(),x(v(w),{key:0,class:"his-card ion-margin-top",style:{"margin-bottom":"0.4rem"}},{default:m((()=>[c(ya,{"date-enrolled":n.value,birthdate:i.value,outcomes:u.value,onSaveOutcome:Y},null,8,["date-enrolled","birthdate","outcomes"])])),_:1})):U("",!0)])),_:1})):U("",!0)])),_:1}),c(v(P),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(R),{slot:"end",color:"warning"},{default:m((()=>a[3]||(a[3]=[h(" Reset ")]))),_:1}),c(v(R),{slot:"end",color:"primary"},{default:m((()=>a[4]||(a[4]=[h(" Submit ")]))),_:1})])),_:1})])),_:1})])])),_:1})}}}),Ia=i({name:"MultiColumnView",components:{IonGrid:y,IonRow:w,IonCol:D},props:{items:{type:Object,required:!0},numberOfColumns:{type:Number,default:1}},setup:e=>({computedItems:S((()=>Ce(e.items,Math.ceil(e.items.length/e.numberOfColumns)))),grid:{1:"12",2:"6",3:"4",4:"3",6:"2"}})});const Na=E(Ia,[["render",function(e,a,t,l,n,i){const o=O("ion-col"),u=O("ion-row"),r=O("ion-grid");return f(),x(r,null,{default:m((()=>[c(u,null,{default:m((()=>[(f(!0),s(p,null,B(e.computedItems,((a,t)=>(f(),x(o,{key:t,size:e.grid[e.numberOfColumns]},{default:m((()=>[H(e.$slots,"default",{entries:a})])),_:2},1032,["size"])))),128))])),_:3})])),_:3})}]]);class Aa extends se{constructor(e,a=ge()){super(e,Ne.HIV_RECEPTION,a)}}class Ra extends se{constructor(e,a=ge()){super(e,Ne.ART_ADHERENCE,a)}buildPillCountObs(e,a){return this.buildValueNumber("Number of tablets brought to clinic",a,null,e)}async buildAdherenceObs(e,a,t){return{concept_id:await se.getConceptID("Drug adherence",!0),value_numeric:t,value_drug:a,value_modifier:"%",order_id:e,person_id:this.patientID,obs_datetime:this.date}}calculateAdherence(e,a,t){return Math.round(100*(e-a)/(e-t))}calculateExpected(e,a,t,l){const n="QW"===l?"week":"day";return e-this.calcTimeElapsed(t,n)*parseFloat(a.toString())}calcTimeElapsed(e,a){return he(this.date).diff(e,a)+1}}class Ca extends se{constructor(e,a=ge()){super(e,Ne.APPOINTMENT,a)}}class Pa extends se{constructor(e,a=ge()){super(e,Ne.TREATMENT,a)}calculateDosage(e,a){let t=0;return 0===a&&(t=e),0==e&&(t=a),e>0&&a>0&&(t=(e+a)/2),t}calculateEquivalentDosage(e,a){return e+a}calculateDrugRunOutDate(e,a){return _e(he(a).add(e,"days"))}getInstructions(e,a,t,l){return`${e} :- Morning: ${a} ${l}, Evening: ${t} ${l}`}toDrugOrder(e,a,t,l){return{drug_inventory_id:e.drug_id,equivalent_daily_dose:this.calculateEquivalentDosage(e.am,e.pm),start_date:l,auto_expire_date:this.calculateDrugRunOutDate(t,l),units:e.units,instructions:this.getInstructions(e.drug_name,e.am,e.pm,e.units),dose:this.calculateDosage(e.am,e.pm),frequency:e.frequency,qty:a}}async createDrugOrder(e){return ne.create({encounter_id:this.encounterID,drug_orders:e})}}class Ta{static async getBMIData(){return(await fetch("/bmi.json")).json()}static async getBMIResult(e,a,t){let l={result:"",color:"",index:t};if(t<=0)return l.index=0,l;if(a<5&&a>0)l.result="Use MUAC to calculate nutrition status",l.color="red";else{a>18&&(a=19);const n=await this.getBMIData(),i=n[e][a];i&&(l=this.buildBounds(Object.keys(i),i,t,n.colors))}return l}static buildBounds(e,a,t,l){const n={result:"",color:"",index:t};return e.forEach((e=>{if(e.indexOf("-")>=0){const i=e.split("-");t>=parseFloat(i[0])&&t<=parseFloat(i[1])&&(n.result=a[e],n.color=l[a[e]])}else if(e.indexOf("<")>=0){const i=e.replace("<","");t<parseFloat(i)&&(n.result=a[e],n.color=l[a[e]])}else if(e.indexOf(">=")>=0){const i=e.replace(">=","");t>=parseFloat(i)&&(n.result=a[e],n.color=l[a[e]])}})),n}static getBMI(e,a,t,l){const n=this.calculateBMI(e,a);return this.getBMIResult(t,l,n)}static calculateBMI(e,a){if(0==a||0==e)return 0;let t=e/a/a*1e4;return Math.round(10*t)/10}}class Sa extends se{constructor(e,a=ge()){super(e,Ne.DISPENSING,a)}buildDispensations(e,a,t){const l=[];for(let n=0;n<t;n++)l.push({drug_order_id:e,date:this.date,quantity:a/t});return l}saveDispensations(e){return l.postJson("/dispensations",{dispensations:e,program_id:this.programID})}}const Ea=E(i({__name:"PatientVisit",props:{patient:{type:Object,required:!0}},setup(e){const a=e,t=S((()=>a.patient.getID())),l=new me(t.value),i=new ve(t.value),E=new Pa(t.value),O=new Sa(t.value),k=new Aa(t.value),L=new Ra(t.value),G=new Ca(t.value),z=o(),F=o(),M=o([]),H=o([]),W=o([]),Y=o([]),J=S((()=>a.patient.isFemale())),Q=o(""),K=a.patient.getBirthdate(),X=o(!1),Z=u({}),ee=S((()=>!(z.value&&a.patient.getAge()>18))),{isDICSite:ae,refreshDICStatus:te}=n(),{enrollPatient:le,fetchPatientPrograms:oe,hasProgram:ue,updateState:re}=ce(t.value),se=u({visitDate:{value:he().format("YYYY-MM-DD"),label:"Visit Date",required:!0,validation:async e=>new Date(e.value)>new Date(ge())?["Visit date cannot be after today's date"]:new Date(e.value)<new Date(K)?["Visit date cannot be before patient's birth date"]:null},weight:{value:void 0,label:"Weight",required:!0,computedValue:e=>({tag:"vitals",obs:l.buildValueNumber("Weight",e)}),validation:(e,a)=>!de(e)&&e.value||"No"!==a.patientPresent.value?Ye([()=>We(e),()=>Qe(e,"DECIMALS"),()=>Ke(e,2,250)]):null},bp:{value:"",label:"Blood Pressure (mmHG)",placeholder:"Enter Blood Pressure e.g 120/80",validation:e=>de(e)||!e.value?null:Je(e),computedValue:e=>{if(de(e))return null;const[a,t]=e.split("/").map(Number);return{tag:"vitals",obs:[l.buildValueNumber("Systolic",a),l.buildValueNumber("Diastolic",t)]}}},height:{value:void 0,label:"Height (cm)",computedValue:e=>({tag:"vitals",obs:l.buildValueNumber("Height",e)}),validation:e=>ee.value&&(!de(e)&&e.value||"No"!==se.patientPresent.value)?Ye([()=>We(e),()=>Qe(e),()=>Ke(e,20,220)]):null},isPregnant:{value:void 0,label:"Is the patient pregnant?",required:J.value,computedValue:e=>({tag:"consultation",obs:i.buildValueCoded("Is patient pregnant",e)}),validation:async e=>J.value&&We(e)},isBreastfeeding:{value:void 0,label:"Is the patient breastfeeding?",required:J.value,computedValue:e=>({tag:"consultation",obs:i.buildValueCoded("Is patient breast feeding",e)}),validation:async e=>J.value&&We(e)},nextAppointmentDate:{value:void 0,label:"Next Appointment Date",required:!0,computedValue:e=>({tag:"appointment",obs:G.buildValueDate("Appointment date",e)}),validation:async(e,a)=>new Date(e.value)<new Date(a.visitDate.value)?["Appointment date cannot be before visit date"]:new Date(e.value)>new Date(Q.value)?["Appointment date cannot be after drug run out date"]:null},patientPresent:{value:void 0,label:"Is the patient present?",required:!0,computedValue:e=>({tag:"reception",obs:k.buildValueCoded("Patient present",e)})},guardianPresent:{value:void 0,label:"Is the guardian present?",required:!0,computedValue:e=>({tag:"reception",obs:k.buildValueCoded("Guardian present",e)})},pillCount:{value:void 0,label:"Pill Count",required:Y.value.length>0,validation:async e=>Y.value.length>0&&Qe(e)},regimen:{value:void 0,label:"Regimen",placeholder:"Select a regimen",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","Antiretroviral drugs")})},totalCPTGiven:{value:void 0,label:"Total CPT Given",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","CPT")})},totalIPTGiven:{value:void 0,label:"Total IPT Given",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","INH")}),validation:async(e,a)=>{var t,l;return("6H"===(null===(t=a.tbMed.value)||void 0===t?void 0:t.label)||"3HP (RFP + INH)"===(null===(l=a.tbMed.value)||void 0===l?void 0:l.label))&&Qe(e)}},totalRFPGiven:{value:void 0,label:"Total RFP Given",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","3HP (RFP + INH)")}),validation:async(e,a)=>{var t;return"3HP (RFP + INH)"===(null===(t=a.tbMed.value)||void 0===t?void 0:t.label)&&Qe(e)}},total3HPGiven:{value:void 0,label:"Total 3HP Given",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","INH 300 / RFP 300 (3HP)")}),validation:async(e,a)=>{var t;return"3HP (INH 300 / RFP 300)"===(null===(t=a.tbMed.value)||void 0===t?void 0:t.label)&&Qe(e)}},totalPyridoxineGiven:{value:void 0,label:"Total Pyridoxine Given",validation:async(e,a)=>{var t;return(null===(t=a.tbMed.value)||void 0===t?void 0:t.label)&&Qe(e)}},tbMed:{value:void 0,label:"TPT Medication",placeholder:"Select a TPT medication"},hasContraindications:{value:"No",label:"Has Side Effects / Contraindications ?",validation:async e=>Ye([()=>We(e),()=>"No"===e.value||H.value.some((e=>e.isChecked))?null:["Please select at least one side effect"]])},hasSideEffects:{value:"No",label:"Has Other Side Effects ?",validation:async e=>Ye([()=>We(e),()=>"No"===e.value||W.value.some((e=>e.isChecked))?null:["Please select at least one side effect"]])},tbStatus:{value:void 0,label:"TB Status",required:!0,computedValue:e=>({tag:"consultation",obs:i.buildValueCoded("TB Status",e.value)})},tbTreatmentStartDate:{value:"",label:"TB treatment start date",validation:async e=>{if(!X.value){if(new Date(e.value)>new Date(ge()))return["TB treatment start date cannot be after today's date"];if(new Date(e.value)<new Date(K))return["TB treatment start date cannot be before patient's birth date"]}return null},computedValue:e=>({tag:"consultation",obs:i.buildValueDate("TB treatment start date",e)})},tbTreatmentPeriod:{value:void 0,label:"TB treatment period (months)",computedValue:e=>({tag:"consultation",obs:i.buildValueNumber("TB treatment period",e)})},cxrResult:{value:"",label:"CXR (Chest X-ray) Screening method Result",computedValue:e=>({tag:"consultation",obs:i.buildGroupValueCoded("TB screening method used","chest xray",e)})},mwrdResult:{value:"",label:"mWRD (Molecular WHO Recommended Rapid Diagnostic test) Screening method Result",computedValue:e=>({tag:"consultation",obs:i.buildGroupValueCoded("TB screening method used","Molecular WHO Recommended Rapid Diagnostic test",e)})}});r((()=>se.regimen.value),(e=>{var a;(Ze(),e)&&(null==e||null===(a=e.other)||void 0===a||a.forEach((e=>{var a;Z[e.drug_name]={label:`${null!==(a=e.alternative_drug_name)&&void 0!==a?a:e.drug_name} given`,value:0,required:!0,validation:e=>Qe(e,"POSITIVE_INTEGERS")}})))})),r(se.patientPresent,(e=>{"No"===e.value?(se.weight.required=!1,se.weight.error="",se.guardianPresent.value="Yes"):se.weight.required=!0})),r(se.guardianPresent,(e=>{"No"===e.value&&(se.patientPresent.value="Yes")})),r([()=>se.weight.value,()=>se.tbStatus.value],(async([e,a])=>{var t;se.regimen.value=void 0,Ze();const l=X.value||/confirmed/i.test(null!==(t=null==a?void 0:a.label)&&void 0!==t?t:"");e?(M.value=await Ie.getRegimensByWeight(se.weight.value,l),se.patientPresent.value="Yes",se.patientPresent.disabled=!0):!e&&se.weight.required&&(se.patientPresent.value=void 0,se.patientPresent.disabled=!1),se.tbMed.disabled=l}));const pe=()=>{var e;return de(Z)?1/0:Math.min(...null===(e=se.regimen.value)||void 0===e||null===(e=e.other)||void 0===e?void 0:e.map((e=>{var a,t,l,n,i;return(null!==(a=null===(t=Z[e.drug_name])||void 0===t?void 0:t.value)&&void 0!==a?a:0)/((null!==(l=e.am)&&void 0!==l?l:0)+(null!==(n=e.noon)&&void 0!==n?n:0)+(null!==(i=e.pm)&&void 0!==i?i:0))||1})))};r([()=>Z,()=>se.pillCount.value,()=>se.visitDate.value],(()=>{const e=parseInt(se.pillCount.value)||0,a=pe();a!==1/0&&(Q.value=E.calculateDrugRunOutDate(a+e,se.visitDate.value),se.nextAppointmentDate.label=`Next Appointment Date (Drug run out date: ${be(Q.value)})`,se.nextAppointmentDate.value=Q.value)}),{deep:!0}),r((()=>se.visitDate.value),(()=>$e()));const fe=S((()=>{var e;return"3HP (INH 300 / RFP 300)"===(null===(e=se.tbMed.value)||void 0===e?void 0:e.label)})),_e=S((()=>{var e;return"3HP (RFP + INH)"===(null===(e=se.tbMed.value)||void 0===e?void 0:e.label)})),ye=S((()=>{var e;return"6H"===(null===(e=se.tbMed.value)||void 0===e?void 0:e.label)})),Ne=S((()=>"Yes"===se.hasContraindications.value)),Ae=S((()=>"Yes"===se.hasSideEffects.value)),Ce=S((()=>{var e;return/Confirmed TB on treatment/i.test(null===(e=se.tbStatus.value)||void 0===e?void 0:e.label)})),Be=S((()=>{var e;return/Suspected/i.test(null===(e=se.tbStatus.value)||void 0===e?void 0:e.label)})),qe=[{label:"Normal",value:"Negative"},{label:"Abnormal",value:"Positive"},{label:"Unknown/Not done",value:"Unknown"}],Fe=[{label:"Negative",value:"Negative"},{label:"Positive",value:"Positive"},{label:"Unknown/Not done",value:"Unknown"}],Me=Re(["6H","3HP (RFP + INH)","3HP (INH 300 / RFP 300)"]),He=Re(["Confirmed TB Not on treatment","Confirmed TB on treatment","TB Not Suspected","TB Suspected"]),$e=async()=>{i.setDate(se.visitDate.value),X.value=!1;const e=await i.getFirstValueCoded("TB status");if(/Confirmed TB on treatment/i.test(e)){const e=await i.getFirstValueDatetime("TB treatment start date"),a=await i.getFirstValueNumber("TB treatment period")||6;if(e){const t=he(se.visitDate.value).diff(e,"months");X.value=t<=a}}se.tbStatus.required=!X.value},je=async()=>{l.setDate(se.visitDate.value),i.setDate(se.visitDate.value),E.setDate(se.visitDate.value),k.setDate(se.visitDate.value),L.setDate(se.visitDate.value),G.setDate(se.visitDate.value),O.setDate(se.visitDate.value),await Te(se,(async(e,a)=>{var t;const n=[];let o=0;if(!de(e.regimen)&&await Se(Z)){const a=e.regimen.other,t=Ee(Z).formData;o=pe(),a.forEach((a=>n.push(E.toDrugOrder(a,t[a.drug_name],o,e.visitDate))))}else{if(!(await T("Are you sure you want to continue without dispensing ART drugs?")))return}var u;(Ge.show("Saving patient visit..."),e.totalCPTGiven)&&Pe((await Ie.getRegimenExtras("Cotrimoxazole",null!==(u=e.weight)&&void 0!==u?u:F.value)).data,"concept_name").filter((e=>"Daily (QOD)"===e.frequency)).forEach((a=>n.push(E.toDrugOrder(a,e.totalCPTGiven,o,e.visitDate))));if(null!==(t=e.tbMed)&&void 0!==t&&t.value){var r;const a=Pe((await Ie.getRegimenExtras("INH",null!==(r=e.weight)&&void 0!==r?r:F.value)).data,["concept_name","frequency"]),t=a.find((e=>"Pyridoxine"===e.concept_name));if(t&&e.totalPyridoxineGiven&&n.push(E.toDrugOrder(t,e.totalPyridoxineGiven,o,e.visitDate)),e.totalIPTGiven){const t=a.find((e=>"Isoniazid"===e.concept_name&&(ye.value&&"Daily (QOD)"===e.frequency||_e.value&&"Weekly (QW)"===e.frequency)));n.push(E.toDrugOrder(t,e.totalIPTGiven,o,e.visitDate))}if(e.totalRFPGiven&&_e.value){var d;const a=(await Ie.getRegimenExtras("Rifapentine",null!==(d=e.weight)&&void 0!==d?d:F.value)).data;a.length&&n.push(E.toDrugOrder(a[0],e.totalRFPGiven,o,e.visitDate))}if(e.total3HPGiven&&fe.value){var s;const a=(await Ie.getRegimenExtras("INH / RFP",null!==(s=e.weight)&&void 0!==s?s:F.value)).data;n.push(E.toDrugOrder(a[0],e.total3HPGiven,o,e.visitDate))}}if(!de(n)){await E.createEncounter();const e=(await E.createDrugOrder(n)).data.map((e=>{const a=n.find((a=>a.drug_inventory_id===e.drug_inventory_id));return O.buildDispensations(e.order_id,a.qty,1)}));await O.saveDispensations(e.flat(1))}const c=await Oe(a,"vitals");if(!de(c)){await l.createEncounter();const a=await(async e=>{const a=e.height||z.value,t=Ta.calculateBMI(e.weight,a);return l.buildValueNumber("BMI",t)})(e);await l.saveObservationList([...c,a])}await i.createEncounter();const m=await Oe(a,"consultation");m.push(...await i.buildOptionsGroupObs("Malawi ART side effects",H.value)),m.push(...await(async()=>Promise.all(ie.getConceptsByCategory("tb_symptom",!0).map((async e=>i.buildGroupValueCoded(e.name,e.name,"No")))))()),Ae.value&&m.push(...await i.buildOptionsGroupObs("Other side effect",W.value)),J.value&&m.push(...await(async()=>{const e=[await i.buildValueCoded("Patient using family planning","No")];return i.getFamilyPlanningMethods().forEach((async a=>{e.push(await i.buildValueCoded(a,"No"))})),e})()),await i.saveObservationList(m),await k.createEncounter();const v=await Oe(a,"reception");if(await k.saveObservationList(v),Y.value.length>0){await L.createEncounter();const a=await Promise.all(Y.value.map((async a=>{const t=L.calculateExpected(a.quantity,a.equivalent_daily_dose,a.order.start_date,a.frequency),l=L.calculateAdherence(a.quantity,e.pillCount,t);return[await L.buildAdherenceObs(a.order_id,a.drug_inventory_id,l),await L.buildPillCountObs(a.order_id,e.pillCount)]})));await L.saveObservationList(a.flat(1))}await G.createEncounter();const p=await Oe(a,"appointment");await G.saveObservationList(p),await Ue("Patient visit saved successfully"),ae.value&&!ue($)&&(await le(e.visitDate,$),await re(j,e.visitDate,$)),await C.hide(),Ge.hide(),ke.emit(xe.RELOAD_PATIENT_VISIT_DATA),ke.emit(xe.RELOAD_STAGING_INFORMATION)}),{showloader:!1})},Xe=async()=>{if(await T("Are you sure you want to clear all fields?")){for(const e in se)se[e].value="",se[e].error="",se[e].disabled=!1;Ze(),ke.emit(xe.ON_CLEAR)}},Ze=()=>{for(const e in Z)delete Z[e]};return d((async()=>{try{await $e(),z.value=await a.patient.getRecentHeight(),F.value=await a.patient.getRecentWeight(),F.value&&(M.value=await Ie.getRegimensByWeight(F.value)),Y.value=await ne.getLastDrugsReceived(a.patient.getID()),se.pillCount.required=Y.value.length>0,H.value=ie.getConceptsByCategory("contraindication",!0).map((e=>({value:e.concept_id,label:e.name,other:e}))),W.value=ie.getConceptsByCategory("side_effect",!0).map((e=>({value:e.concept_id,label:e.name,other:e})))}catch(e){Le("Form initialization failed. Try to refresh the page"),console.error(e)}te().catch(console.error),oe().catch(console.error)})),(e,a)=>(f(),s(p,null,[c(v(_),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(b),null,{default:m((()=>a[25]||(a[25]=[h("Patient Visit")]))),_:1})])),_:1})])),_:1}),c(v(A),{class:"ion-padding"},{default:m((()=>[c(v(y),{style:{width:"100%"}},{default:m((()=>[c(v(w),null,{default:m((()=>[c(v(D),{size:"12",class:"ion-margin-vertical"},{default:m((()=>[c(we,{modelValue:se.visitDate,"onUpdate:modelValue":a[0]||(a[0]=e=>se.visitDate=e),form:se,minDate:v(K),maxDate:v(ge)},null,8,["modelValue","form","minDate","maxDate"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(aa,{modelValue:se.patientPresent,"onUpdate:modelValue":a[1]||(a[1]=e=>se.patientPresent=e),inline:"",disabled:se.patientPresent.disabled},null,8,["modelValue","disabled"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(aa,{modelValue:se.guardianPresent,"onUpdate:modelValue":a[2]||(a[2]=e=>se.guardianPresent=e),inline:""},null,8,["modelValue"])])),_:1}),J.value?(f(),s(p,{key:0},[c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(aa,{modelValue:se.isPregnant,"onUpdate:modelValue":a[3]||(a[3]=e=>se.isPregnant=e),inline:""},null,8,["modelValue"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(aa,{modelValue:se.isBreastfeeding,"onUpdate:modelValue":a[4]||(a[4]=e=>se.isBreastfeeding=e),inline:""},null,8,["modelValue"])])),_:1})],64)):U("",!0),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(aa,{modelValue:se.hasContraindications,"onUpdate:modelValue":a[5]||(a[5]=e=>se.hasContraindications=e),inline:""},null,8,["modelValue"]),Ne.value?(f(),x(Na,{key:0,items:H.value,numberOfColumns:2},{default:m((({entries:e})=>[(f(!0),s(p,null,B(e,(e=>(f(),x(v(I),{lines:"none",key:e.value},{default:m((()=>[c(v(V),null,{default:m((()=>[h(q(e.label),1)])),_:2},1024),c(v(N),{slot:"start",modelValue:e.isChecked,"onUpdate:modelValue":a=>e.isChecked=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)))),128))])),_:1},8,["items"])):U("",!0)])),_:1}),c(v(D),{class:"ion-margin-vertical",size:"6"},{default:m((()=>[c(aa,{modelValue:se.hasSideEffects,"onUpdate:modelValue":a[6]||(a[6]=e=>se.hasSideEffects=e),inline:""},null,8,["modelValue"]),Ae.value?(f(),x(Na,{key:0,items:W.value,numberOfColumns:2},{default:m((({entries:e})=>[(f(!0),s(p,null,B(e,(e=>(f(),x(v(I),{lines:"none",key:e.value},{default:m((()=>[c(v(V),null,{default:m((()=>[h(q(e.label),1)])),_:2},1024),c(v(N),{slot:"start",modelValue:e.isChecked,"onUpdate:modelValue":a=>e.isChecked=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)))),128))])),_:1},8,["items"])):U("",!0)])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:se.weight,"onUpdate:modelValue":a[7]||(a[7]=e=>se.weight=e),form:se,min:1},null,8,["modelValue","form"])])),_:1}),ee.value?(f(),x(v(D),{key:1,size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:se.height,"onUpdate:modelValue":a[8]||(a[8]=e=>se.height=e),form:se,min:1},null,8,["modelValue","form"])])),_:1})):U("",!0),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(ze,{modelValue:se.bp,"onUpdate:modelValue":a[9]||(a[9]=e=>se.bp=e),form:se},null,8,["modelValue","form"])])),_:1}),X.value?U("",!0):(f(),x(v(D),{key:2,class:"ion-margin-vertical",size:ee.value?"6":"12"},{default:m((()=>[c(De,{modelValue:se.tbStatus,"onUpdate:modelValue":a[10]||(a[10]=e=>se.tbStatus=e),options:v(He)},null,8,["modelValue","options"])])),_:1},8,["size"])),Ce.value?(f(),s(p,{key:3},[c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(we,{modelValue:se.tbTreatmentStartDate,"onUpdate:modelValue":a[11]||(a[11]=e=>se.tbTreatmentStartDate=e),form:se,minDate:v(K),maxDate:v(ge)},null,8,["modelValue","form","minDate","maxDate"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:se.tbTreatmentPeriod,"onUpdate:modelValue":a[12]||(a[12]=e=>se.tbTreatmentPeriod=e),form:se,min:1},null,8,["modelValue","form"])])),_:1})],64)):Be.value?(f(),s(p,{key:4},[c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(aa,{modelValue:se.cxrResult,"onUpdate:modelValue":a[13]||(a[13]=e=>se.cxrResult=e),"custom-options":qe},null,8,["modelValue"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(aa,{modelValue:se.mwrdResult,"onUpdate:modelValue":a[14]||(a[14]=e=>se.mwrdResult=e),"custom-options":Fe},null,8,["modelValue"])])),_:1})],64)):U("",!0),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(De,{modelValue:se.regimen,"onUpdate:modelValue":a[15]||(a[15]=e=>se.regimen=e),options:M.value},null,8,["modelValue","options"])])),_:1}),v(de)(Z)?U("",!0):(f(!0),s(p,{key:5},B(Object.values(Z),((e,a)=>(f(),x(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{"model-value":e,form:Z,min:1},null,8,["model-value","form"])])),_:2},1024)))),256)),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:se.totalCPTGiven,"onUpdate:modelValue":a[16]||(a[16]=e=>se.totalCPTGiven=e),form:se,min:1},null,8,["modelValue","form"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(De,{modelValue:se.tbMed,"onUpdate:modelValue":a[17]||(a[17]=e=>se.tbMed=e),options:v(Me)},null,8,["modelValue","options"])])),_:1}),ye.value||_e.value?(f(),x(v(D),{key:6,size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:se.totalIPTGiven,"onUpdate:modelValue":a[18]||(a[18]=e=>se.totalIPTGiven=e),form:se,min:1},null,8,["modelValue","form"])])),_:1})):U("",!0),_e.value?(f(),x(v(D),{key:7,size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:se.totalRFPGiven,"onUpdate:modelValue":a[19]||(a[19]=e=>se.totalRFPGiven=e),form:se,min:1},null,8,["modelValue","form"])])),_:1})):U("",!0),fe.value?(f(),x(v(D),{key:8,size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:se.total3HPGiven,"onUpdate:modelValue":a[20]||(a[20]=e=>se.total3HPGiven=e),form:se,min:1},null,8,["modelValue","form"])])),_:1})):U("",!0),fe.value||_e.value||ye.value?(f(),x(v(D),{key:9,size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:se.totalPyridoxineGiven,"onUpdate:modelValue":a[21]||(a[21]=e=>se.totalPyridoxineGiven=e),form:se,min:1},null,8,["modelValue","form"])])),_:1})):U("",!0),Y.value.length>0?(f(),x(v(D),{key:10,size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{modelValue:se.pillCount,"onUpdate:modelValue":a[22]||(a[22]=e=>se.pillCount=e),form:se,min:1},null,8,["modelValue","form"])])),_:1})):U("",!0),c(v(D),{size:Y.value.length>0?"6":"12",class:"ion-margin-vertical"},{default:m((()=>[c(we,{modelValue:se.nextAppointmentDate,"onUpdate:modelValue":a[23]||(a[23]=e=>se.nextAppointmentDate=e),form:se,minDate:se.visitDate.value,maxDate:Q.value},null,8,["modelValue","form","minDate","maxDate"])])),_:1},8,["size"])])),_:1})])),_:1})])),_:1}),c(v(P),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(R),{color:"primary",onClick:a[24]||(a[24]=e=>v(C).hide()),slot:"end"},{default:m((()=>a[26]||(a[26]=[h(" Close ")]))),_:1}),c(v(R),{color:"warning",onClick:Xe,slot:"end"},{default:m((()=>a[27]||(a[27]=[h(" Reset ")]))),_:1}),c(v(R),{color:"success",onClick:je,slot:"end"},{default:m((()=>a[28]||(a[28]=[h(" Save ")]))),_:1})])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-20e46410"]]),Oa=i({__name:"EmergencyRefill",props:{patient:{type:Object,required:!0}},setup(e){const a=e,t=S((()=>a.patient.getID())),l=new Ra(t.value),n=o(),i=o([]),V=o([]),I=S((()=>{var e;return null===(e=V.value[0])||void 0===e?void 0:e.order.start_date})),N=o(""),E=a.patient.getBirthdate(),O=o({}),k=u({date:{value:ge(),label:"Date of emergency refill",required:!0,computedValue:e=>({obs:l.buildValueDate("Prescription refill date",e)})},facility:{value:void 0,label:"Facility where emergency refill was collected",required:!0,placeholder:"Select a facility",computedValue:e=>({obs:l.buildValueText("Health facility name",e.label)})},nextAppointmentDate:{value:void 0,label:"Next Appointment Date",required:!0,computedValue:e=>({obs:l.buildValueDate("Appointment date",e)})}});async function U(){if(await T("Are you sure you want to clear all fields?")){for(const e in k)k[e].value="",k[e].error="",k[e].disabled=!1;!function(){for(const e in O.value)delete O.value[e]}(),ke.emit(xe.ON_CLEAR)}}function L(e){return e.regimen?`${e.regimen} - ${e.drug.name}`:e.drug.name}async function q(){if(await Se(k)&&await Se(O.value))try{Ge.show(),l.setDate(k.date.value);const e=await Oe({...Ee(k).computedFormData,...Ee(O.value).computedFormData}),a=new se(t.value,Ne.EMERGENCY_DRUG_REFILL,k.date.value);await a.createEncounter(),await a.saveObservationList(e),Ue("Emergency refill saved successfully"),C.hide(),ke.emit(xe.RELOAD_PATIENT_VISIT_DATA),ke.emit(xe.RELOAD_STAGING_INFORMATION)}catch(e){console.error(e),Le("Failed to save emergency refill")}finally{Ge.hide()}}function G(){V.value.forEach((e=>{const a=L(e);O.value[`${a}_brought`]={label:`${a} brought`,value:void 0,required:!0,placeholder:"Enter the number of pills brought",validation:e=>Qe(e,"POSITIVE_INTEGERS")},O.value[`${a}_given`]={label:`${a} given`,value:void 0,required:!0,placeholder:"Enter the number of pills given",validation:e=>Qe(e,"POSITIVE_INTEGERS"),computedValue:(t,n)=>async function(e,a,t){const n=l.calculateExpected(e.quantity,e.equivalent_daily_dose,e.order.start_date,e.frequency),i=l.calculateAdherence(e.quantity,t,n);return{...await l.buildValueCoded("Medications dispensed",e.drug.concept_id),child:[await l.buildAdherenceObs(e.order_id,e.drug_inventory_id,i),await l.buildPillCountObs(e.order_id,t),,await l.buildValueNumber("Amount of drug dispensed",a)]}}(e,t,n[`${a}_brought`].value)}}))}return r([()=>O,()=>k.date.value],(function(){const e=de(V.value)?1/0:Math.min(...V.value.map((e=>{var a,t,l,n;const i=L(e);return(Number(null!==(a=null===(t=O.value[`${i}_given`])||void 0===t?void 0:t.value)&&void 0!==a?a:0)+Number(null!==(l=null===(n=O.value[`${i}_brought`])||void 0===n?void 0:n.value)&&void 0!==l?l:0))/Number(e.equivalent_daily_dose)})));e!==1/0&&(N.value=ye(k.date.value,e,"days"),k.nextAppointmentDate.label=`Next Appointment Date (Drug run out date: ${be(N.value)})`,k.nextAppointmentDate.value=N.value)}),{deep:!0,immediate:!0}),d((async()=>{try{Ge.show(),n.value=await a.patient.getRecentWeight(),i.value=await Ie.getRegimensByWeight(n.value),V.value=await ne.getLastDrugsReceived(t.value),G()}catch(e){Le("Form initialization failed. Try to refresh the page"),console.error(e)}finally{Ge.hide()}})),(e,a)=>(f(),s(p,null,[c(v(_),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(b),null,{default:m((()=>a[4]||(a[4]=[h("Emergency Drug Refill")]))),_:1})])),_:1})])),_:1}),c(v(A),{class:"ion-padding"},{default:m((()=>[c(v(y),{style:{width:"100%"}},{default:m((()=>[c(v(w),null,{default:m((()=>[c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(we,{modelValue:k.date,"onUpdate:modelValue":a[0]||(a[0]=e=>k.date=e),form:k,minDate:I.value||v(E),maxDate:v(ge)},null,8,["modelValue","form","minDate","maxDate"])])),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(De,{modelValue:k.facility,"onUpdate:modelValue":a[1]||(a[1]=e=>k.facility=e),form:k,asyncOptions:v(Fe)},null,8,["modelValue","form","asyncOptions"])])),_:1}),(f(!0),s(p,null,B(Object.values(O.value),(e=>(f(),x(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(Ve,{"model-value":e,form:O.value,min:1},null,8,["model-value","form"])])),_:2},1024)))),256)),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m((()=>[c(we,{modelValue:k.nextAppointmentDate,"onUpdate:modelValue":a[2]||(a[2]=e=>k.nextAppointmentDate=e),form:k,minDate:k.date.value,maxDate:N.value},null,8,["modelValue","form","minDate","maxDate"])])),_:1})])),_:1})])),_:1})])),_:1}),c(v(P),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(R),{color:"primary",onClick:a[3]||(a[3]=e=>v(C).hide()),slot:"end"},{default:m((()=>a[5]||(a[5]=[h(" Close ")]))),_:1}),c(v(R),{color:"warning",onClick:U,slot:"end"},{default:m((()=>a[6]||(a[6]=[h(" Reset ")]))),_:1}),c(v(R),{color:"success",onClick:q,slot:"end"},{default:m((()=>a[7]||(a[7]=[h(" Save ")]))),_:1})])),_:1})])),_:1})],64))}}),ka=i({props:{patient:{type:Object,required:!0},startDate:{type:String,required:!0}},components:{DataTable:qe,IonCard:W,IonCardHeader:Y,IonCardTitle:J,IonCardContent:Q,IonButton:R},setup(e){const a=o([]),t=S((()=>e.patient.getID())),l=u({showIndex:!1,tableCssTheme:"emc-datatable-theme"}),n=o([{label:"Add Visit",action:async()=>{await C.show(Ea,{patient:e.patient})}},{label:"Emegency Refill",action:async()=>{await C.show(Oa,{patient:e.patient})}},{label:"Update Outcome",action:async()=>C.show(Va,{patient:e.patient})},{label:"Enter VL Results",action:async()=>C.show(pa,{patient:e.patient})}]),i=a=>{const t="N/A"!==e.startDate?"("+he(a).diff(e.startDate,"months")+"M)":"";return`${be(a)} ${t}`},r={minWidth:"68px !important"},s=o([{path:"visitDate",label:"Visit Date"},{path:"visitBy",label:"Given To",sortable:!1,thStyles:r},{path:"vitals",label:"Vitals",sortable:!1,thStyles:r},...e.patient.isFemale()?[{path:"pregnant",label:"Preg",sortable:!1,thStyles:r},{path:"breastfeeding",label:"B/F",sortable:!1,thStyles:r}]:[],{path:"tbStatus",label:"TB Status",sortable:!1},{path:"sideEffects",label:"Side Effects",drillable:!0,formatter:e=>e.length>0?"Yes":"No",sortable:!1,thStyles:r},{path:"regimen",label:"ART Regimen",drillable:!0,sortable:!1,thStyles:r},{path:"nextAppointment",label:"Next Appointment",sortable:!1},{path:"outcome",label:"Outcome",sortable:!1,thStyles:r},{path:"vlResult",label:"Viral Load",sortable:!1}]),c=[{label:"void",icon:K,color:"danger",action(e,l){fe((async n=>{const i=await pe.getEncounters(t.value,{date:e.date});var o;i.ok?(null===(o=i.data)||void 0===o||o.forEach((async e=>{await pe.voidEncounter(e.encounter_id,n)})),a.value.splice(l,1)):Le(i.errorMessage||"Failed to void encounters")}),"small-modal")}}],m=async e=>e.tb_status.match(/Unknown/i)||"Defaulted"===e.outcome?"":ie.getCachedConceptName(e.tb_status),v=e=>[e.weight?`Wt: ${e.weight}kg`:"",e.height?`Ht: ${e.height}cm`:"",e.bmi?`BMI: ${e.bmi}`:"",e.bp?`BP: ${e.bp}`:""].filter(Boolean).join(", "),p=()=>{const{getProgramInfo:e}=ce(t.value);oe.getPatientVisits(t.value,!0).then((async l=>{a.value=[];for(const n of l){const l=await e(n);let o="",u="",r="",d="";if("Defaulted"!==l.outcome){const e=await ue.getFirstValueDatetime(t.value,"appointment date",n);if(e&&(o=be(e)),u=await ue.getFirstValueCoded(t.value,"Is patient pregnant",n),r=await ue.getFirstValueCoded(t.value,"Is patient breast feeding",n),"N/A"===l.viral_load){const e=await ue.getFirstObs(t.value,"HIV viral load",n);e&&e.value_text&&e.value_numeric&&(d=1===e.value_numeric?"LDL":e.value_text+e.value_numeric.toString())}else d=l.viral_load}l&&a.value.push({visitDate:i(n),visitBy:l.visit_by.match(/Unk/i)?"":l.visit_by,vitals:v(l),pregnant:u,breastfeeding:r,tbStatus:await m(l),sideEffects:"Defaulted"===l.outcome?"":l.side_effects,regimen:"Defaulted"===l.outcome?"":l.regimen,nextAppointment:o,outcome:l.outcome.match(/Unk/i)?"":l.outcome,vlResult:d,drugs:l.pills_dispensed,date:n})}}))};return ke.on(xe.RELOAD_PATIENT_VISIT_DATA,(()=>p())),d((()=>{p()})),{actionButtons:n,tableConfig:l,rowButtons:c,columns:s,rows:a,onDrilldownHandler:async e=>{const a=/regimen/i.test(e.column.path)?(e=>({title:`Drugs dispensed on ${e.row.visitDate}`,columns:[{path:"name",label:"Drug Name"},{path:"quantity",label:"Quantity"},{path:"units",label:"Units"}],rows:e.row.drugs.map((e=>({name:e[0],quantity:e[1],units:"tab (s)"})))}))(e):(e=>({title:`Side effects noted on ${e.row.visitDate}`,rows:e.row.sideEffects.map((e=>({sideEffect:e}))),columns:[{path:"sideEffect",label:"Name of Side Effect"}]}))(e);de(a.rows)||await C.show(ta,a)}}}}),xa={class:"ion-float-right ion-margin-end ion-margin-bottom"};const Ua=E(ka,[["render",function(e,a,t,l,n,i){const o=O("ion-icon"),u=O("ion-button"),r=O("ion-card-title"),d=O("ion-card-header"),v=O("data-table"),g=O("ion-card-content"),b=O("ion-card");return f(),x(b,{class:"his-card",style:{padding:"0 !important"}},{default:m((()=>[c(d,null,{default:m((()=>[c(r,null,{default:m((()=>[a[0]||(a[0]=k("span",{class:"title"},"Summary of Visits",-1)),k("span",xa,[(f(!0),s(p,null,B(e.actionButtons,(e=>(f(),x(u,{key:e.label,onClick:e.action,color:e.color||"primary"},{default:m((()=>[e.icon?(f(),x(o,{key:0,icon:e.icon,class:"ion-margin-right"},null,8,["icon"])):U("",!0),h(" "+q(e.label),1)])),_:2},1032,["onClick","color"])))),128))])])),_:1})])),_:1}),c(g,{class:"ion-no-padding",style:{"min-height":"45vh"}},{default:m((()=>[c(v,{rows:e.rows,columns:e.columns,"row-actions-buttons":e.rowButtons,config:{showSearchField:!1},color:"light",onDrilldown:e.onDrilldownHandler},null,8,["rows","columns","row-actions-buttons","onDrilldown"])])),_:1})])),_:1})}],["__scopeId","data-v-824715c1"]]),La=i({__name:"ViralLoadTrail",props:{patient:{}},setup(e){const a=e,t=S((()=>`Viral Load Results Trail for ${a.patient.getFullName()}`)),l=o([]),n=[{path:"accession_number",label:"Accession"},{path:"test",label:"Test Name"},{path:"specimen.name",label:"Specimen"},{path:"order_date",label:"Order Date",formatter:be},{path:"result",label:"Result"},{path:"result_date",label:"Result Date",formatter:be}],i={label:"X",color:"danger",action({encounter_id:e}){fe((async a=>{try{await X.void(e,a),C.hide(),ke.emit(xe.RELOAD_LATEST_VL_RESULT),ke.emit(xe.RELOAD_PATIENT_VISIT_DATA)}catch(t){console.error(t)}}),"small-modal custom-modal-backdrop")}};return d((async()=>{l.value=await va.getViralLoadResultTrail(a.patient.getID())})),(e,a)=>(f(),s(p,null,[c(v(_),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(b),null,{default:m((()=>[h(q(t.value),1)])),_:1})])),_:1})])),_:1}),c(v(A),null,{default:m((()=>[c(v(y),{style:{width:"100%"}},{default:m((()=>[c(v(w),{style:F([{padding:"0 !important"},{minHeight:l.value.length?"0":"30vh"}])},{default:m((()=>[c(v(D),{size:"12",class:"ion-no-padding"},{default:m((()=>[c(v(qe),{rows:l.value,columns:n,"row-actions-buttons":[i],config:{showSearchField:!1},color:"custom"},null,8,["rows","row-actions-buttons"])])),_:1})])),_:1},8,["style"])])),_:1})])),_:1}),c(v(P),null,{default:m((()=>[c(v(g),null,{default:m((()=>[c(v(R),{color:"primary",onClick:a[0]||(a[0]=e=>v(C).hide()),slot:"end"},{default:m((()=>a[1]||(a[1]=[h(" Close ")]))),_:1})])),_:1})])),_:1})],64))}}),Ba=i({components:{MultiColumnView:Na,IonList:L,IonItem:I},props:{patient:{type:Object,required:!0},artStartDate:{type:String,required:!0},guardians:{type:Array,default:()=>[]}},emits:["updatePatient","updateARVNumber","updateGuardian"],setup(e,{emit:a}){const t=o(0),l=o(0),n=o(0),i=o(""),u=o(""),r=o(""),s=o(""),c=o(""),m=o(""),v=o(""),p=o(""),f=o(""),g=o(""),b=o(""),h=e=>e.other&&"function"==typeof e.other.onClickHandler,_=S((()=>!de(e.guardians))),y=()=>{const a=e.patient.getBirthdate(),t="N/A"!==e.artStartDate?he(e.artStartDate).diff(a,"years"):"";return`${be(a)} (${t})`},w=()=>{va.getlatestViralLoadResult(e.patient.getID()).then((e=>g.value=e))},D=()=>({onClickHandler(){Z.push(`/patient/reception/${e.patient.getID()}/false`)}}),V=()=>({onClickHandler:()=>a("updatePatient")}),I=S((()=>[{label:"ARV Number",value:e.patient.getArvNumber(),other:{onClickHandler:()=>a("updateARVNumber")}},{label:"NPID",value:e.patient.getNationalID()},{label:"MW National ID",value:e.patient.getMWNationalID(),other:V()},{label:"Name",value:e.patient.getGivenName()+" "+e.patient.getFamilyName(),other:V()},{label:"DOB and Age at Initiation",value:y(),other:V()},{label:"Sex",value:la(e.patient.getGender()),other:V()},{label:"Location",value:e.patient.getCurrentVillage(),other:V()},{label:"Landmark",value:e.patient.getClosestLandmark(),other:V()},{label:"Phone Number",value:e.patient.getPhoneNumber(),other:V()},{label:"Guardian",value:_.value?e.guardians.map((e=>`${e.name} (${e.relationshipType})`)).join(","):"Add",other:{onClickHandler:()=>a("updateGuardian")}},{label:"Agrees to follow up",value:c.value,other:D()},{label:"Date of starting first line ARV Regimen",value:e.artStartDate,other:D()},{label:"Initial Weight and Height",value:`${t.value}Kg, ${l.value}cm`,other:D()},{label:"Initial BMI",value:n.value,other:D()},{label:"Initial TB Status",value:i.value,other:D()},{label:"Pregnant at Initiation",value:r.value,other:D()},{label:"Breastfeeding at Initiation",value:u.value,other:D()},{label:"Latest VL Result and Result Date",value:g.value,other:{onClickHandler:()=>C.show(La,{patient:e.patient})}},{label:"TI",value:s.value,other:D()},{label:"HIV test place",value:p.value,other:D()},{label:"HIV test date",value:v.value,other:D()},{label:"WHO stage",value:b.value,other:D()},{label:"Reason for starting ART",value:m.value,other:D()},{label:"Staging codition",value:f.value,other:D()}])),N=()=>{e.patient.getInitialWeight().then((e=>t.value=e)),e.patient.getInitialHeight().then((e=>l.value=e)),e.patient.getInitialBMI().then((e=>n.value=e)),e.patient.getInitialTBStatus().then((e=>i.value=e)),e.patient.hasPregnancyAtARTInitiation().then((e=>r.value=e)),e.patient.breastFeedingAtARTInitiation().then((e=>u.value=e)),e.patient.everReceivedART().then((e=>s.value=e)),e.patient.agreesToFollowUp().then((e=>c.value=e)),e.patient.getReasonForStartingART().then((e=>m.value=e)),e.patient.getHIVTestLocation().then((e=>p.value=e)),e.patient.getStagingCondition().then((e=>f.value=e)),e.patient.getWhoStage().then((e=>b.value=e)),(async()=>{const a=await e.patient.getHIVTestDate();a&&(v.value=be(a))})()};return d((()=>{N(),w(),ke.on(xe.RELOAD_LATEST_VL_RESULT,(()=>w())),ke.on(xe.RELOAD_STAGING_INFORMATION,(()=>N()))})),{patientInfo:I,onClickHandler:async e=>{var a;h(e)&&await(null===(a=e.other)||void 0===a?void 0:a.onClickHandler())},clickable:h}}}),qa={style:{width:"100%",display:"flex",justifyContent:"space-between"}},Ga={key:0},za={key:1},Fa={key:2},Ma={key:3};const Ha=E(Ba,[["render",function(e,a,t,l,n,i){const o=O("ion-item"),u=O("ion-list"),r=O("multi-column-view");return f(),x(r,{items:e.patientInfo,numberOfColumns:3},{default:m((({entries:a})=>[c(u,{class:"his-card ion-margin-end"},{default:m((()=>[(f(!0),s(p,null,B(a,((t,l)=>(f(),x(o,{key:l,lines:l===a.length-1?"none":void 0,button:e.clickable(t),onClick:a=>e.onClickHandler(t)},{default:m((()=>[k("div",qa,[t.label?(f(),s("span",Ga,q(t.label)+": ",1)):(f(),s("span",za)),e.clickable(t)?(f(),s("span",Fa,[k("a",null,[k("b",null,q(t.value||"N/A"),1)])])):(f(),s("span",Ma,[k("b",null,q(t.value||"N/A"),1)]))])])),_:2},1032,["lines","button","onClick"])))),128))])),_:2},1024)])),_:1},8,["items"])}],["__scopeId","data-v-1195e33c"]]),$a=i({components:{IonGrid:y,IonRow:w,IonCol:D,TextInput:ze,DateInput:we,SelectInput:De},props:{patientService:{type:Object,required:!0}},setup(e){const a=o(!1),t=S((()=>/Unknown/i.test(e.patientService.getMWNationalID())?"":e.patientService.getMWNationalID())),l=u({givenName:{label:"First Name",value:e.patientService.getGivenName(),placeholder:"First Name",required:!0,validation:e=>Xe(e)},familyName:{label:"last Name",value:e.patientService.getFamilyName(),placeholder:"Last Name",required:!0,validation:e=>Xe(e)},middleName:{label:"middle Name",value:e.patientService.getMiddleName(),placeholder:"middle Name",validation:e=>!!e&&Xe(e)},nationalId:{label:"Malawi National ID Number",value:t.value,placeholder:"Enter Malawi National ID Number",validation:e=>e&&e.label?Ze(e):null},gender:{value:e.patientService.getGender(),required:!0,label:"Gender",placeholder:"select gender"},birthdate:{value:e.patientService.getBirthdate(),label:"Date of Birth",placeholder:"Date of Birth",required:!0},cellPhoneNumber:{value:e.patientService.getPhoneNumber(),required:!0,label:"Cellphone Number",placeholder:"cellphone number e.g. 0991234567",validation:async e=>!("Unknown"===e.value||"N/A"===e.value)&&ea(e)},homeVillage:{value:e.patientService.getCurrentVillage(),label:"Home Village",placeholder:"Home Village",required:!0},landmark:{value:e.patientService.getClosestLandmark(),label:"Landmark",placeholder:"Closest Landmark or Plot Number",required:!0}}),n=async e=>{var a,t,l,n,i,o,u,r;let d,s;try{var c;null!=e&&null!==(c=e.other)&&void 0!==c&&c.traditional_authority_id&&(d=await ee.getTraditionalAuthorityById(e.other.traditional_authority_id)),d&&(s=await ee.getDistrictByID(d.district_id))}catch(m){Le("Unable to resolve patient address. Saving using default address"),console.error(m)}return{home_district:null!==(a=null===(t=s)||void 0===t?void 0:t.name)&&void 0!==a?a:"N/A",home_traditional_authority:null!==(l=null===(n=d)||void 0===n?void 0:n.name)&&void 0!==l?l:"N/A",home_village:(null==e?void 0:e.label)||"N/A",current_district:null!==(i=null===(o=s)||void 0===o?void 0:o.name)&&void 0!==i?i:"N/A",current_traditional_authority:null!==(u=null===(r=d)||void 0===r?void 0:r.name)&&void 0!==u?u:"N/A",current_village:(null==e?void 0:e.label)||"N/A"}};return{today:ge,patient:l,getLandmarks:Me,genderOptions:je,isBirthdateEstimated:a,modal:C,onFinish:async()=>Te(l,(async a=>{const l={};if(a.givenName!==e.patientService.getGivenName()&&(l.given_name=a.givenName),a.familyName!==e.patientService.getFamilyName()&&(l.family_name=a.familyName),a.middleName!==e.patientService.getMiddleName()&&(l.middle_name=a.middleName),a.birthdate!==e.patientService.getBirthdate()&&(l.birthdate=a.birthdate),a.gender.value!==e.patientService.getGender()&&(l.gender=a.gender.value),a.cellPhoneNumber!==e.patientService.getPhoneNumber()&&(l.cell_phone_number=a.cellPhoneNumber),a.landmark.label!==e.patientService.getClosestLandmark()&&(l.landmark=a.landmark.label),a.homeVillage!==e.patientService.getCurrentVillage()&&Object.assign(l,{...l,...await n(a.homeVillage)}),!de(l)){const a=new ia;a.setPersonID(e.patientService.getID()),await a.updatePerson(l)}a.nationalId!==t.value&&await e.patientService.updateMWNationalId(a.nationalId),await C.hide(),ke.emit(xe.RELOAD_PATIENT_DATA)})),getVillagesByName:He}}});const ja=E($a,[["render",function(e,a,t,l,n,i){const o=O("ion-title"),u=O("ion-icon"),r=O("ion-button"),d=O("ion-buttons"),v=O("ion-toolbar"),g=O("ion-header"),b=O("TextInput"),_=O("ion-col"),y=O("SelectInput"),w=O("DateInput"),D=O("ion-row"),V=O("ion-grid"),I=O("ion-content"),N=O("ion-footer");return f(),s(p,null,[c(g,null,{default:m((()=>[c(v,null,{default:m((()=>[c(o,null,{default:m((()=>a[12]||(a[12]=[h("Edit Patient Demographics")]))),_:1}),c(d,{slot:"end"},{default:m((()=>[c(r,{onClick:a[0]||(a[0]=a=>e.modal.hide())},{default:m((()=>[c(u,{slot:"icon-only",name:"close"})])),_:1})])),_:1})])),_:1})])),_:1}),c(I,{class:"ion-padding"},{default:m((()=>[c(V,null,{default:m((()=>[c(D,null,{default:m((()=>[c(_,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(b,{modelValue:e.patient.givenName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.patient.givenName=a)},null,8,["modelValue"])])),_:1}),c(_,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(b,{modelValue:e.patient.middleName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.patient.middleName=a)},null,8,["modelValue"])])),_:1}),c(_,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(b,{modelValue:e.patient.familyName,"onUpdate:modelValue":a[3]||(a[3]=a=>e.patient.familyName=a)},null,8,["modelValue"])])),_:1}),c(_,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(b,{modelValue:e.patient.nationalId,"onUpdate:modelValue":a[4]||(a[4]=a=>e.patient.nationalId=a)},null,8,["modelValue"])])),_:1}),c(_,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(y,{modelValue:e.patient.gender,"onUpdate:modelValue":a[5]||(a[5]=a=>e.patient.gender=a),options:e.genderOptions},null,8,["modelValue","options"])])),_:1}),c(_,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(w,{modelValue:e.patient.birthdate,"onUpdate:modelValue":a[6]||(a[6]=a=>e.patient.birthdate=a),allowEstimation:!0,estimationLabel:"Estimate Age",minDate:"1900-01-01",maxDate:e.today,onIsEstimated:a[7]||(a[7]=a=>e.isBirthdateEstimated=a)},null,8,["modelValue","maxDate"])])),_:1}),c(_,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(b,{modelValue:e.patient.cellPhoneNumber,"onUpdate:modelValue":a[8]||(a[8]=a=>e.patient.cellPhoneNumber=a),allowUnknown:""},null,8,["modelValue"])])),_:1}),c(_,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(y,{modelValue:e.patient.homeVillage,"onUpdate:modelValue":a[9]||(a[9]=a=>e.patient.homeVillage=a),asyncOptions:e.getVillagesByName,allowCustom:""},null,8,["modelValue","asyncOptions"])])),_:1}),c(_,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(y,{modelValue:e.patient.landmark,"onUpdate:modelValue":a[10]||(a[10]=a=>e.patient.landmark=a),asyncOptions:e.getLandmarks,allowCustom:""},null,8,["modelValue","asyncOptions"])])),_:1})])),_:1})])),_:1})])),_:1}),c(N,null,{default:m((()=>[c(v,null,{default:m((()=>[c(r,{color:"primary",onClick:a[11]||(a[11]=a=>e.modal.hide()),slot:"end"},{default:m((()=>a[13]||(a[13]=[h("Close")]))),_:1}),c(r,{class:"ion-margin-end",color:"success",onClick:e.onFinish,slot:"end"},{default:m((()=>a[14]||(a[14]=[h("Save")]))),_:1},8,["onClick"])])),_:1})])),_:1})],64)}]]),Wa=i({__name:"GuardianDemographics",props:{patientId:{},guardians:{}},setup(e){var a,t;const l=new ia,n=e,i=o(de(n.guardians)),g=S((()=>(i.value?"Add":"Edit")+" Guardian Demographics")),b=S((()=>(i.value?"Edit":"Add")+" Guardian")),_=o([]),V=null!==(a=null===(t=n.guardians)||void 0===t?void 0:t.map((e=>({label:`${e.name} (${e.relationshipType})`,value:e.name,other:e}))))&&void 0!==a?a:[],I=u({guardian:{label:"Select Guardian",placeholder:"Select guardian to be edited",value:""}}),N=u({givenName:{label:"First Name",value:"",placeholder:"First Name",required:!0,validation:e=>Xe(e)},familyName:{label:"Last Name",value:"",placeholder:"Last Name",required:!0,validation:e=>Xe(e)},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",validation:async e=>"Unknown"!==e.value&&ea(e)},relation:{label:"Select Relationship",placeholder:"Select the relationship between guardian and patient",value:""}});function A(){i.value=!i.value,I.guardian.value=""}r((()=>I.guardian.value),(e=>{var a,t,l,n,i,o,u,r;N.givenName.value=null!==(a=null==e||null===(t=e.other)||void 0===t?void 0:t.names.given_name)&&void 0!==a?a:"",N.familyName.value=null!==(l=null==e||null===(n=e.other)||void 0===n?void 0:n.names.family_name)&&void 0!==l?l:"",N.cellPhoneNumber.value=null!==(i=null==e||null===(o=e.other)||void 0===o?void 0:o.phoneNumber)&&void 0!==i?i:"",N.relation.value=null!==(u=null==e||null===(r=e.other)||void 0===r?void 0:r.relationshipType)&&void 0!==u?u:""}),{deep:!0,immediate:!0});const R=async()=>Te(N,(async e=>{i.value||de(I.guardian.value)?await async function(e){var a,t;await l.registerGuardian({home_district:"N/A",home_traditional_authority:"N/A",home_village:"N/A",current_district:"N/A",current_traditional_authority:"N/A",current_village:"N/A",middle_name:"",gender:"N/A",birthdate:"N/A",birthdate_estimated:"N/A",landmark:"N/A",relationship:"N/A",patient_type:"",isPatient:!1,patient_id:n.patientId,...e}),await oa.createRelation(n.patientId,l.getPersonID(),null!==(a=null===(t=e.relation)||void 0===t?void 0:t.value)&&void 0!==a?a:13)}(e):await async function(e,a){const t=a.names.person_id,l={};if(a.names.given_name!==e.given_name&&(l.given_name=e.given_name),a.names.family_name!==e.family_name&&(l.family_name=e.family_name),a.phoneNumber!==e.cell_phone_number&&(l.cell_phone_number=e.cell_phone_number),!de(l)){const e=new ia;e.setPersonID(t),await e.updatePerson(l)}var i,o;a.relationshipType!==e.relation.label&&await oa.amendRelation(n.patientId,t,a.id,null!==(i=null===(o=e.relation)||void 0===o?void 0:o.value)&&void 0!==i?i:13)}(e,I.guardian.value.other),await C.hide(),ke.emit(xe.RELOAD_GUARDIAN_DATA)}),{underscoreKeys:!0});return d((async()=>{const e=(await oa.getRelations()).data;_.value=e.map((e=>({label:e.b_is_to_a,value:e.relationship_type_id,other:e})))})),(e,a)=>{const t=O("ion-title"),l=O("ion-icon"),o=O("ion-button"),u=O("ion-buttons"),r=O("ion-toolbar"),d=O("ion-header"),P=O("ion-content"),T=O("ion-footer");return f(),s(p,null,[c(d,null,{default:m((()=>[c(r,null,{default:m((()=>[c(t,null,{default:m((()=>[h(q(g.value),1)])),_:1}),c(u,{slot:"end"},{default:m((()=>[c(o,{onClick:a[0]||(a[0]=e=>v(C).hide())},{default:m((()=>[c(l,{slot:"icon-only",name:"close"})])),_:1})])),_:1})])),_:1})])),_:1}),c(P,{class:"ion-padding"},{default:m((()=>[c(v(y),null,{default:m((()=>[c(v(w),null,{default:m((()=>[i.value?U("",!0):(f(),x(v(D),{key:0,size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(De,{modelValue:I.guardian,"onUpdate:modelValue":a[1]||(a[1]=e=>I.guardian=e),options:v(V)},null,8,["modelValue","options"])])),_:1})),I.guardian.value||i.value?(f(),s(p,{key:1},[c(v(D),{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(ze,{modelValue:N.givenName,"onUpdate:modelValue":a[2]||(a[2]=e=>N.givenName=e)},null,8,["modelValue"])])),_:1}),c(v(D),{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(ze,{modelValue:N.familyName,"onUpdate:modelValue":a[3]||(a[3]=e=>N.familyName=e)},null,8,["modelValue"])])),_:1}),c(v(D),{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(ze,{modelValue:N.cellPhoneNumber,"onUpdate:modelValue":a[4]||(a[4]=e=>N.cellPhoneNumber=e),allowUnknown:""},null,8,["modelValue"])])),_:1}),c(v(D),{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m((()=>[c(De,{modelValue:N.relation,"onUpdate:modelValue":a[5]||(a[5]=e=>N.relation=e),options:_.value},null,8,["modelValue","options"])])),_:1})],64)):U("",!0)])),_:1})])),_:1})])),_:1}),c(T,null,{default:m((()=>[c(r,null,{default:m((()=>[v(de)(n.guardians)?U("",!0):(f(),x(o,{key:0,color:"primary",onClick:A,slot:"start"},{default:m((()=>[h(q(b.value),1)])),_:1})),c(o,{color:"primary",onClick:a[6]||(a[6]=e=>v(C).hide()),slot:"end"},{default:m((()=>a[7]||(a[7]=[h("Close")]))),_:1}),c(o,{class:"ion-margin-end",color:"success",onClick:R,slot:"end"},{default:m((()=>a[8]||(a[8]=[h("Save")]))),_:1})])),_:1})])),_:1})],64)}}}),Ya=i({components:{IonGrid:y,IonRow:w,IonCol:D,TextInput:ze},props:{patient:{type:Object,required:!0}},setup(e){const{facility:a}=n(),t=S((()=>e.patient.getArvNumber())),i=S((()=>!de(t.value)&&"Unknown"!==t.value)),o=u({arvNumber:{value:i.value?t.value.split("-")[2]:"",label:(i.value?"Edit":"Add New")+" ARV Number",placeholder:"Enter ARV Number",required:!0,validation:async e=>{const l=Qe(e,"POSITIVE_INTEGERS");if(null!==l)return l;if(e.value===t.value.split("-")[2])return null;const n=await oe.findByOtherID(4,`${a.code}-ARV-${e.value}`);return n.ok?de(n.data)?null:["ARV Number already taken"]:[n.errorMessage||n.clientErrorType||`Unable to determine ARV number with status: ${n.httpStatusResponse}`]}}});return{form:o,modal:C,arvNumber:t,facility:a,hasValidARVNumber:i,onFinish:async()=>Te(o,(async l=>{l.arvNumber!==t.value.split("-")[2]&&(i.value?await e.patient.updateARVNumber(`${a.code}-ARV-${l.arvNumber}`):await e.patient.createArvNumber(`${a.code}-ARV-${l.arvNumber}`),ke.emit(xe.RELOAD_PATIENT_DATA)),await C.hide()})),voidARV:async()=>{if(await T(`Are you sure you want to void this ARV Number ${t.value}?`)){await Ge.show("Voiding ARV Number...");try{await l.postJson(`/programs/${ae}/void_arv_number/${t}`,{}),await Ge.hide(),await C.hide(),ke.emit(xe.RELOAD_PATIENT_DATA)}catch(e){await Ge.hide(),console.log(e)}}}}}});const Ja=E(Ya,[["render",function(e,a,t,l,n,i){const o=O("ion-title"),u=O("ion-icon"),r=O("ion-button"),d=O("ion-buttons"),v=O("ion-toolbar"),g=O("ion-header"),b=O("text-input"),_=O("ion-col"),y=O("ion-row"),w=O("ion-grid"),D=O("ion-content"),V=O("ion-footer");return f(),s(p,null,[c(g,null,{default:m((()=>[c(v,null,{default:m((()=>[c(o,null,{default:m((()=>a[3]||(a[3]=[h("ARV NUMBER")]))),_:1}),c(d,{slot:"end"},{default:m((()=>[c(r,{onClick:a[0]||(a[0]=a=>e.modal.hide())},{default:m((()=>[c(u,{slot:"icon-only",name:"close"})])),_:1})])),_:1})])),_:1})])),_:1}),c(D,{class:"ion-padding"},{default:m((()=>[c(w,null,{default:m((()=>[c(y,null,{default:m((()=>[c(_,null,{default:m((()=>[c(b,{modelValue:e.form.arvNumber,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.arvNumber=a),form:e.form,prefix:`${e.facility.code}-ARV-`},null,8,["modelValue","form","prefix"])])),_:1})])),_:1})])),_:1})])),_:1}),c(V,{class:"ion-padding-horizontal"},{default:m((()=>[c(v,null,{default:m((()=>[c(r,{color:"primary",onClick:a[2]||(a[2]=a=>e.modal.hide()),slot:"end"},{default:m((()=>a[4]||(a[4]=[h("Close")]))),_:1}),e.hasValidARVNumber?(f(),x(r,{key:0,color:"danger",onClick:e.voidARV,slot:"start"},{default:m((()=>a[5]||(a[5]=[h("Void ARV Number")]))),_:1},8,["onClick"])):U("",!0),c(r,{color:"success",onClick:e.onFinish,slot:"end"},{default:m((()=>a[6]||(a[6]=[h("Save")]))),_:1},8,["onClick"])])),_:1})])),_:1})],64)}]]),Qa=i({components:{VisitsSummary:Ua,InformationHeader:Ha},setup(){const e=te(),a=parseInt(e.params.patientId.toString())||0,t=o(),l=o(""),n=o([]),i=S((()=>!de(t.value))),u=S((()=>{var e;return null===(e=t.value)||void 0===e?void 0:e.getNationalID()})),r=async()=>{if(a){const e=(await oe.findByID(a)).data;e&&(t.value=new oe(e))}},s=async()=>{n.value=await ma.getGuardianDetails(a)},c=async()=>{let e=!1;if(ra.value){var l;e=!(null===(l=t.value)||void 0===l?void 0:l.getDocID())||na(u.value)||await da(a)}else{const a=await sa(u.value);e=!a||a.length>1}e&&await(async()=>{await Ge.show("Client has Invalid NPID. Assigning NPID...");const e=await oe.assignNPID(a);var t;e.ok?(await r(),await Ge.hide()):(await Ge.hide(),Le(null!==(t=e.errorMessage)&&void 0!==t?t:"Failed to assign NPID"))})()};return ke.on(xe.RELOAD_PATIENT_DATA,(async()=>{await r()})),ke.on(xe.RELOAD_GUARDIAN_DATA,(async()=>{await s()})),d((async()=>{var e;await ua(),await r(),await c();const a=await(null===(e=t.value)||void 0===e?void 0:e.getARTStartDate());l.value=a?be(a):"N/A",s()})),{patient:t,artStartDate:l,guardians:n,isReady:i,updateDemographics:async e=>{await C.show(ja,{patientService:t.value,attribute:e})},updateGuardian:async()=>{await C.show(Wa,{patientId:a,guardians:n.value})},updateARVNumber:async()=>{await C.show(Ja,{patient:t.value})}}}});a("default",E(Qa,[["render",function(e,a,t,l,n,i){const o=O("information-header"),u=O("ion-col"),r=O("ion-row"),d=O("visits-summary"),s=O("ion-grid");return e.isReady?(f(),x(s,{key:0,class:"ion-no-margin ion-no-padding"},{default:m((()=>[c(r,null,{default:m((()=>[c(u,{size:"12"},{default:m((()=>[e.patient?(f(),x(o,{key:0,patient:e.patient,guardians:e.guardians,artStartDate:e.artStartDate,onUpdateARVNumber:e.updateARVNumber,onUpdateGuardian:e.updateGuardian,onUpdatePatient:e.updateDemographics},null,8,["patient","guardians","artStartDate","onUpdateARVNumber","onUpdateGuardian","onUpdatePatient"])):U("",!0)])),_:1})])),_:1}),c(r,null,{default:m((()=>[c(u,null,{default:m((()=>[e.patient?(f(),x(d,{key:0,patient:e.patient,startDate:e.artStartDate},null,8,["patient","startDate"])):U("",!0)])),_:1})])),_:1})])),_:1})):U("",!0)}]]))}}}))}();
