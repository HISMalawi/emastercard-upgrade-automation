import{K as B}from"./vue-datepicker-bce64927.js";import{_ as I}from"./LineChart.vue_vue_type_script_setup_true_lang-f17feb68.js";import{E as b,d as N,h as O,i as j,j as J,r as R,F as V,J as u,g as L,w as a,o as z,e as o,a as A,b as d,t as w}from"./index-b34da4cb.js";import{i as U}from"./common-abc2f84d.js";import{P as c}from"./index-95d3a767.js";import{R as F}from"./report_service-c1a7a175.js";import{l as E}from"./loader-d835876b.js";import{m as K,D as W}from"./DrilldownTable-7a34763e.js";import{i as q}from"./his_date-3774cb27.js";import{t as G}from"./toasts-5a6b8805.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";import"./arrays-31d2d38b.js";import"./url-ffe761c9.js";import"./index-07ada3e1.js";class Q extends F{constructor(){super()}static getLocationName(){return sessionStorage.getItem("locationName")}getBookedAppointments(t){return b.getJson("programs/".concat(c,"/scheduled_appointments"),{date:t})}getViralLoadResults(t){return this.getReport("/programs/".concat(c,"/reports/high_vl_patients"),{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport("/programs/".concat(c,"/reports/retention"))}getExternalConsultationClients(){return this.getReport("".concat(c,"/external_consultation_clients"))}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport("/programs/".concat(c,"/reports/pregnant_patients"))}getArchivingCandidates(){return b.getJson("programs/".concat(c,"/reports/archiving_candidates"),{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}getVisitStats(){return b.getJson("programs/".concat(c,"/reports/visits"),{name:"visits",start_date:this.startDate,end_date:this.endDate})}}const X=N({components:{LineChart:I,IonGrid:O,IonRow:j,IonCol:J,VueDatePicker:B},setup(){const e=R(""),t=R(""),l=R([]),C=V(()=>{var n;return((n=l.value[0])==null?void 0:n.raw.flat())||[]}),S=V(()=>{var n;return((n=l.value[1])==null?void 0:n.raw.flat())||[]}),$=V(()=>{var n;return((n=l.value[2])==null?void 0:n.raw.flat())||[]}),v=V(()=>l.value.map(({raw:n})=>n).flat(3)),y={title:{text:"Patient Visits Statistics",align:"left"},yaxis:{title:{text:"Number of clients"}}},_=n=>{const r={},p={},f={},s=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(n).forEach(([i,M])=>{r[i]=[],p[i]=[],f[i]=[],Object.entries(M).forEach(([P,{patient_present:k,guardian_present:T}])=>{T&&k?f[i].push({patientId:P,date:i}):k?r[i].push({patientId:P,date:i}):T&&p[i].push({patientId:P,date:i})});const D=new Date(i).getTime();s[0].data.push([D,r[i].length]),s[0].raw.push(r[i]),s[1].data.push([D,p[i].length]),s[1].raw.push(p[i]),s[2].data.push([D,f[i].length]),s[2].raw.push(f[i])}),s},g=async()=>{if(!q(e.value,t.value))return G("Invalid date range");try{E.show();const n=new Q;n.setStartDate(e.value),n.setEndDate(t.value);const r=await n.getPatientVisitTypes();l.value=_(r)}catch(n){console.error(n),G("Unable to generate patient visits data")}E.hide()},m=async(n,r="Drill down clients")=>{await K.show(W,{patientIds:n.map(({patientId:p})=>p),title:r})};return{startDate:e,endDate:t,series:l,options:y,totalAttendance:v,totalPatientVisits:C,totalGuardianVisits:S,totalBothVisits:$,fetchData:g,pointSelection:async(n,r)=>{if(!U(l.value))try{await m(l.value[r].raw[n],"".concat(l.value[r].name," visits"))}catch(p){console.error(p)}},drilldown:m}}}),Y={style:{display:"flex","justify-content":"flex-start"}},Z={class:"his-card"};function x(e,t,l,C,S,$){const v=u("vue-date-picker"),y=u("ion-button"),_=u("ion-col"),g=u("ion-label"),m=u("ion-badge"),h=u("ion-item"),n=u("ion-list"),r=u("line-chart"),p=u("ion-row"),f=u("ion-grid");return z(),L(f,null,{default:a(()=>[o(p,null,{default:a(()=>[o(_,{size:"6",offset:"6",class:"ion-padding"},{default:a(()=>[A("div",Y,[o(v,{modelValue:e.startDate,"onUpdate:modelValue":t[0]||(t[0]=s=>e.startDate=s),placeholder:"Start Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),o(v,{modelValue:e.endDate,"onUpdate:modelValue":t[1]||(t[1]=s=>e.endDate=s),placeholder:"End Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),o(y,{color:"primary",class:"ion-no-margin",onClick:e.fetchData},{default:a(()=>t[6]||(t[6]=[d("Generate")])),_:1},8,["onClick"])])]),_:1}),o(_,{size:"3",class:"ion-padding-top"},{default:a(()=>[A("div",Z,[o(n,null,{default:a(()=>[o(h,{button:"",onClick:t[2]||(t[2]=s=>e.drilldown(e.totalAttendance,"Total Attendance"))},{default:a(()=>[o(g,null,{default:a(()=>t[7]||(t[7]=[d("Total Attendance ")])),_:1}),o(m,null,{default:a(()=>[d(w(e.totalAttendance.length),1)]),_:1})]),_:1}),o(h,{button:"",onClick:t[3]||(t[3]=s=>e.drilldown(e.totalPatientVisits,"Total patient visits"))},{default:a(()=>[o(g,null,{default:a(()=>t[8]||(t[8]=[d("Patient Visit ")])),_:1}),o(m,null,{default:a(()=>[d(w(e.totalPatientVisits.length),1)]),_:1})]),_:1}),o(h,{button:"",onClick:t[4]||(t[4]=s=>e.drilldown(e.totalGuardianVisits,"Total guardian visits"))},{default:a(()=>[o(g,null,{default:a(()=>t[9]||(t[9]=[d("Guardian Visit ")])),_:1}),o(m,null,{default:a(()=>[d(w(e.totalGuardianVisits.length),1)]),_:1})]),_:1}),o(h,{button:"",onClick:t[5]||(t[5]=s=>e.drilldown(e.totalBothVisits,"Total patient and guardian visits"))},{default:a(()=>[o(g,null,{default:a(()=>t[10]||(t[10]=[d("Patient and Guardian Visit ")])),_:1}),o(m,null,{default:a(()=>[d(w(e.totalBothVisits.length),1)]),_:1})]),_:1})]),_:1})])]),_:1}),o(_,{size:"9"},{default:a(()=>[o(r,{style:{height:"600px"},series:e.series,options:e.options,onPointSelection:e.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})}const gt=H(X,[["render",x]]);export{gt as default};
