System.register(["./index-legacy-6c3f95dd.js","./patient_service-legacy-053fccbb.js","./common-legacy-e8d6ba88.js","./TextInput-legacy-422192c4.js","./DateInput.vue_vue_type_style_index_0_lang-legacy-99acbc48.js","./YesNoInput-legacy-0e5fb5f6.js","./HIVReception-legacy-297e1386.js","./SelectInput-legacy-92514672.js","./location_options-legacy-8032fb94.js","./regimen_service-legacy-5dd6519d.js","./DTFormElements-legacy-6f485257.js","./consultation_service-legacy-d7298d18.js","./validations-legacy-24794e7c.js","./form-legacy-e4715703.js","./emc_event-legacy-0252f26c.js","./his_date-legacy-c9384e90.js","./patient_identifier_service-legacy-e3019117.js","./Date-legacy-113b55e2.js","./vue-datepicker-legacy-07f8a78f.js","./toasts-legacy-9f1b551e.js","./loader-legacy-072f0b06.js","./encounter_types-legacy-4fed5cb0.js","./arrays-legacy-86abe4a8.js","./Strs-legacy-b5721578.js"],function(e,t){"use strict";var a,o,i,l,n,r,u,s,m,d,c,v,f,p,g,b,y,V,T,D,I,_,A,R,N,h,H,C,P,w,S,k,x,z,U,L,j,O,B,E,F,Y,Q,q,$,G,W,J,M;return{setters:[e=>{a=e.d,o=e.n,i=e.p,l=e.a3,n=e.I,r=e.r,u=e.i,s=e.ak,m=e.aZ,d=e.a9,c=e.j,v=e.l,f=e.aq,p=e.L,g=e._,b=e.O,y=e.o,V=e.c,T=e.e,D=e.w,I=e.b,_=e.N,A=e.B,R=e.k},e=>{N=e.P},e=>{h=e.i},e=>{H=e.T},e=>{C=e._},e=>{P=e.Y},e=>{w=e.C,S=e.P},e=>{k=e.S},e=>{x=e.g},e=>{z=e.N,U=e.R},e=>{L=e.i,j=e.a,O=e.H},e=>{B=e.C,E=e.V},e=>{F=e.f,Y=e.d,Q=e.v,q=e.r,$=e.g},e=>{G=e.s},e=>{W=e.E,J=e.a},e=>{M=e.a},null,null,null,null,null,null,null,null],execute:function(){const t=a({components:{IonRow:o,IonCol:i,IonTitle:l,IonButton:n,TextInput:H,DateInput:C,YesNoInput:P,SelectInput:k,NumberInput:z},props:{patient:{type:Object,required:!0},isNewPatient:{type:Boolean,default:!0},observations:{type:Object,default:()=>({})},initialVisitDate:{type:String,default:""}},emits:["onValue","onNext"],setup(e,{emit:t}){const{facility:a}=v(),o=r(""),i=r([]),l=new w(e.patient.getID(),e.initialVisitDate),n=new B(e.patient.getID(),e.initialVisitDate),g=new E(e.patient.getID(),e.initialVisitDate),b=new S(e.patient.getID(),e.initialVisitDate),y=u(()=>e.patient.getBirthdate()),V=s({arvNumber:{value:"",label:"ARV Number",placeholder:"Enter ARV Number",required:!0,validation:async(e,t)=>{if(t.arvNumber.disabled)return null;const o=F(e,"POSITIVE_INTEGERS");if(null!==o)return o;const i=await N.findByOtherID(m,`${a.code}-ARV-${e.value}`);return h(i.data)?null:["ARV Number already exists"]}},arvNumberAtPreviousLocation:{value:"",label:"ART Number at previous Location",computedValue:e=>({tag:"registration",obs:l.buildValueText("ART number at previous location",e)})},initialVisitDate:{value:e.initialVisitDate,label:"Registration Date",required:!0,validation:async e=>Y(e,y.value)},shouldFollowUp:{value:e.observations["Agrees to followup"]?e.observations["Agrees to followup"].match(/yes|home visit/i)?"Yes":"No":"",label:"Agrees to follow up ?",computedValue:e=>({tag:"registration",obs:[l.buildGroupValueCoded("Agrees to followup","Home visit",e),l.buildGroupValueCoded("Agrees to followup","Phone",e)]}),required:!0},receivedArvTreatmentBefore:{value:e.observations["Ever received ART"]||"",label:"Ever received ARVs for treatment or prophylaxis?",computedValue:e=>({tag:"registration",obs:l.buildValueCoded("Ever received ART",e)}),required:!0},dateLastTakenArvs:{value:e.observations["Date ART last taken"]||"",label:"Date last taken ARVs",computedValue:e=>({tag:"registration",obs:l.buildValueDate("Date ART last taken",e)}),validation:async(e,t)=>"Yes"===t.receivedArvTreatmentBefore.value?Q([()=>q(e),()=>Y(e,y.value)]):null},everRegisteredAtClinic:{value:e.observations["Ever registered at ART clinic"]||"",label:"Ever registred at an ART clinic",computedValue:e=>({tag:"registration",obs:l.buildValueCoded("Ever registered at ART clinic",e)}),validation:async(e,t)=>"Yes"===t.receivedArvTreatmentBefore.value&&q(e)},artInitiationLocation:{value:e.observations["Location of ART initiation"]||"",label:"Location of ART Initiation",computedValue:e=>({tag:"registration",obs:n.buildValueText("Location of ART initiation","string"==typeof e?e:e.label)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&q(e)},artStartDate:{value:e.observations["Date ART started"]||"",label:"Date started ART",computedValue:e=>({tag:"registration",obs:l.buildValueDate("Date ART started",e)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value?Q([()=>q(e),()=>Y(e,y.value)]):null},initialWeight:{value:e.observations.weight||"",label:"Initial Weight",placeholder:"Enter weight",computedValue:e=>({tag:"vitals",obs:g.buildValueNumber("weight",e)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&"Unknown"!==e.value&&Q([()=>q(e),()=>F(e,"DECIMALS"),()=>$(e,2,250)])},initialHeight:{value:e.observations.Height||"",label:"Initial Height",placeholder:"Enter height",computedValue:e=>({tag:"vitals",obs:l.buildValueNumber("Height",e)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&"Unknown"!==e.value&&Q([()=>q(e),()=>F(e),()=>$(e,20,220)])},initialTBStatus:{value:e.observations["TB Status at Initiation"]||"",label:"Initial TB Status",placeholder:"select TB status",computedValue:e=>({tag:"registration",obs:l.buildValueCoded("TB Status at Initiation","string"==typeof e?e:e.label)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&q(e)},tptHistory:{value:e.observations["Previous TB treatment history"]||"",label:"TPT History",placeholder:"Select TPT history",computedValue:e=>({tag:"consultation",obs:n.buildValueText("Previous TB treatment history","string"==typeof e?e:e.label)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&q(e)},tptStartDate:{value:e.observations["TPT Drugs Received"]||"",label:"Date started TPT",validation:async(e,t)=>{var a;return(null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a||null===(a=a.label)||void 0===a?void 0:a.match(/currently/i))&&q(e)}},inhQty:{value:"",label:"INH Amount Received",validation:async(e,t)=>{var a;const o=null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.label;return(null==o?void 0:o.match(/currently/i))&&(o.match(/ipt/i)||o.includes("3HP (RFP + INH)"))&&q(e)},computedValue:(e,t)=>{var a;return{tag:"consultation",obs:n.buildObs("TPT Drugs Received",{value_drug:(null===(a=i.value.find(e=>"INH or H (Isoniazid 300mg tablet)"===e.name))||void 0===a?void 0:a.drug_id)||0,value_datetime:(null==t?void 0:t.tptStartDate.value)||null,value_numeric:e||0})}}},rifapentineQty:{value:"",label:"Rifapentine Amount Received",validation:async(e,t)=>{var a;const o=null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.label;return(null==o?void 0:o.match(/currently/i))&&o.includes("3HP (RFP + INH)")&&q(e)},computedValue:(e,t)=>{var a;return{tag:"consultation",obs:n.buildObs("TPT Drugs Received",{value_drug:(null===(a=i.value.find(e=>"Rifapentine (150mg)"===e.name))||void 0===a?void 0:a.drug_id)||0,value_datetime:(null==t?void 0:t.tptStartDate.value)||null,value_numeric:e||0})}}},threeHPQty:{value:"",label:"INH / RFP Amount Received",validation:async(e,t)=>{var a;const o=null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.label;return(null==o?void 0:o.match(/currently/i))&&o.includes("INH 300 / RFP 300 (3HP)")&&q(e)},computedValue:(e,t)=>{var a;return{tag:"consultation",obs:n.buildObs("TPT Drugs Received",{value_drug:(null===(a=i.value.find(e=>"INH 300 / RFP 300 (3HP)"===e.name))||void 0===a?void 0:a.drug_id)||0,value_datetime:(null==t?void 0:t.tptStartDate.value)||null,value_numeric:e||0})}}},tptStartLocation:{value:e.observations["Location TPT Last Received"]||"",label:"TPT Transfer From",validation:async(e,t)=>{var a;return(null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a||null===(a=a.label)||void 0===a?void 0:a.match(/currently/i))&&q(e)},computedValue:e=>({tag:"consultation",obs:n.buildValueText("Location TPT Last Received","string"==typeof e?e:e.label)})},confirmatoryTest:{value:e.observations["Confirmatory hiv test type"]||"",label:"Confirmatory Test",placeholder:"Select confirmatory test",required:!0,computedValue:e=>({tag:"registration",obs:l.buildValueCoded("Confirmatory hiv test type","string"==typeof e?e:e.value)})},confirmatoryTestLocation:{value:e.observations["Confirmatory HIV test location"]||"",label:"Location of Confirmatory",placeholder:"Select location",validation:async(e,t)=>!("Not done"===t.confirmatoryTest.value.label||"Not done"===t.confirmatoryTest.value)&&q(e),computedValue:e=>({tag:"registration",obs:l.buildValueText("Confirmatory HIV test location","string"==typeof e?e:e.label)})},confirmatoryTestDate:{value:e.observations["Confirmatory HIV test date"]||"",label:"Confirmatory HIV Test Date",validation:async(e,t)=>!("Not done"===t.confirmatoryTest.value.label||"Not done"===t.confirmatoryTest.value)&&q(e),computedValue:e=>({tag:"registration",obs:l.buildValueDate("Confirmatory HIV test date",e)})},patientType:{value:"New patient",computedValue:e=>({tag:"patient type",obs:b.buildValueCoded("Type of patient",e)})}}),T=u(()=>{var e;return!("Not done"===(null===(e=V.confirmatoryTest.value)||void 0===e?void 0:e.label)||"Not done"===V.confirmatoryTest.value)});d(V.receivedArvTreatmentBefore,e=>{"No"===e.value&&(V.everRegisteredAtClinic.value="")}),d(V.initialVisitDate,e=>{W.emit(J.ON_INITIAL_VISIT_DATE,e.value)}),d(()=>V.artStartDate.value,e=>W.emit(J.ON_ART_START_DATE,e),{immediate:!0});const D=u(()=>{var e;const t="string"==typeof V.tptHistory.value?V.tptHistory.value:null===(e=V.tptHistory.value)||void 0===e?void 0:e.label;if(null!=t&&t.match(/currently/i)){if(t.match(/ipt/i))return["INH or H (Isoniazid 300mg tablet)"];if(t.includes("3HP (RFP + INH)"))return["INH or H (Isoniazid 300mg tablet)","Rifapentine (150mg)"];if(t.includes("INH 300 / RFP 300 (3HP)"))return["INH 300 / RFP 300 (3HP)"]}return[]});return c(()=>{const t=e.patient.getArvNumber();t&&"Unknown"!==t?(V.arvNumber.value=t.split("-")[2],V.arvNumber.disabled=!0):(async()=>{const e=await p.getJson("/programs/1/next_available_arv_number");var t;e.ok&&(o.value=null===(t=e.data)||void 0===t?void 0:t.arv_number.replace(/^\D+|\s/g,""),o.value&&(V.arvNumber.label=`Arv Number (Suggested Number: ${o.value})`))})(),U.getCustomIngridients().then(e=>{e.ok&&(i.value=e.data)})}),{today:M,form:V,isConfirmatoryTestDone:T,initialTbStatusOptions:L,tptHistoryOptions:j,HIVTestOptions:O,tptDrugs:D,facility:a,birthdate:y,getFacilities:x,onClear:async()=>{if(await f("Are you sure you want to clear all fields?"))for(const e in V)"patientType"!==e&&(V[e].value=void 0,V[e].error="");W.emit(J.ON_CLEAR)},onSubmit:async()=>{b.setDate(V.initialVisitDate.value),l.setDate(V.initialVisitDate.value),g.setDate(V.initialVisitDate.value),n.setDate(V.initialVisitDate.value),await G(V,async(e,o)=>{t("onValue",{type:"registration",data:{formData:{...e,arvNumber:e.arvNumber?`${a.code}-ARV-${e.arvNumber}`:""},computedData:o,arvNumberEditable:!V.arvNumber.disabled}}),t("onNext")})}}}});e("default",g(t,[["render",function(e,t,a,o,i,l){const n=b("ion-title"),r=b("text-input"),u=b("ion-col"),s=b("DateInput"),m=b("yes-no-input"),d=b("SelectInput"),c=b("NumberInput"),v=b("ion-button"),f=b("ion-row");return y(),V(_,null,[T(n,{class:"ion-text-center ion-margin-vertical ion-padding-bottom bold"},{default:D(()=>[...t[22]||(t[22]=[I(" HIV Clinic Registration ",-1)])]),_:1}),T(f,{class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(u,{size:"5",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(r,{modelValue:e.form.arvNumber,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.arvNumber=t),form:e.form,prefix:`${e.facility.code}-ARV-`,disabled:!e.isNewPatient},null,8,["modelValue","form","prefix","disabled"])]),_:1}),T(u,{size:"7",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(s,{modelValue:e.form.initialVisitDate,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.initialVisitDate=t),"min-date":e.birthdate,"max-date":e.today,form:e.form},null,8,["modelValue","min-date","max-date","form"])]),_:1}),T(u,{size:"5",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(m,{modelValue:e.form.shouldFollowUp,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.shouldFollowUp=t),inline:""},null,8,["modelValue"])]),_:1}),T(u,{size:"7",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(m,{modelValue:e.form.receivedArvTreatmentBefore,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.receivedArvTreatmentBefore=t),inline:""},null,8,["modelValue"])]),_:1}),"Yes"===e.form.receivedArvTreatmentBefore.value?(y(),V(_,{key:0},[T(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(s,{modelValue:e.form.dateLastTakenArvs,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.dateLastTakenArvs=t),form:e.form,"min-date":e.birthdate,"max-date":e.today},null,8,["modelValue","form","min-date","max-date"])]),_:1}),T(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(m,{modelValue:e.form.everRegisteredAtClinic,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.everRegisteredAtClinic=t),inline:""},null,8,["modelValue"])]),_:1})],64)):A("",!0),"Yes"===e.form.everRegisteredAtClinic.value?(y(),V(_,{key:1},[T(u,{size:"9",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(d,{modelValue:e.form.artInitiationLocation,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.artInitiationLocation=t),form:e.form,asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])]),_:1}),T(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(r,{modelValue:e.form.arvNumberAtPreviousLocation,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.arvNumberAtPreviousLocation=t),form:e.form},null,8,["modelValue","form"])]),_:1}),T(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(s,{modelValue:e.form.artStartDate,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.artStartDate=t),form:e.form,"min-date":e.birthdate,"max-date":e.today},null,8,["modelValue","form","min-date","max-date"])]),_:1}),T(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(c,{modelValue:e.form.initialWeight,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.initialWeight=t),form:e.form,min:1,allowUnknown:""},null,8,["modelValue","form"])]),_:1}),T(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(c,{modelValue:e.form.initialHeight,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.initialHeight=t),form:e.form,min:1,allowUnknown:""},null,8,["modelValue","form"])]),_:1}),T(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(d,{modelValue:e.form.initialTBStatus,"onUpdate:modelValue":t[11]||(t[11]=t=>e.form.initialTBStatus=t),form:e.form,options:e.initialTbStatusOptions},null,8,["modelValue","form","options"])]),_:1}),T(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(d,{modelValue:e.form.tptHistory,"onUpdate:modelValue":t[12]||(t[12]=t=>e.form.tptHistory=t),form:e.form,options:e.tptHistoryOptions},null,8,["modelValue","form","options"])]),_:1}),e.tptDrugs.length?(y(),V(_,{key:0},[T(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(s,{modelValue:e.form.tptStartDate,"onUpdate:modelValue":t[13]||(t[13]=t=>e.form.tptStartDate=t),"min-date":e.birthdate,"max-date":e.today,form:e.form},null,8,["modelValue","min-date","max-date","form"])]),_:1}),e.tptDrugs.includes("INH or H (Isoniazid 300mg tablet)")?(y(),R(u,{key:0,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(c,{modelValue:e.form.inhQty,"onUpdate:modelValue":t[14]||(t[14]=t=>e.form.inhQty=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):A("",!0),e.tptDrugs.includes("Rifapentine (150mg)")?(y(),R(u,{key:1,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(c,{modelValue:e.form.rifapentineQty,"onUpdate:modelValue":t[15]||(t[15]=t=>e.form.rifapentineQty=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):A("",!0),e.tptDrugs.includes("INH 300 / RFP 300 (3HP)")?(y(),R(u,{key:2,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(c,{modelValue:e.form.threeHPQty,"onUpdate:modelValue":t[16]||(t[16]=t=>e.form.threeHPQty=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):A("",!0),T(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(d,{modelValue:e.form.tptStartLocation,"onUpdate:modelValue":t[17]||(t[17]=t=>e.form.tptStartLocation=t),form:e.form,asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])]),_:1})],64)):A("",!0)],64)):A("",!0),T(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(d,{modelValue:e.form.confirmatoryTest,"onUpdate:modelValue":t[18]||(t[18]=t=>e.form.confirmatoryTest=t),form:e.form,options:e.HIVTestOptions},null,8,["modelValue","form","options"])]),_:1}),e.isConfirmatoryTestDone?(y(),V(_,{key:2},[T(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(d,{modelValue:e.form.confirmatoryTestLocation,"onUpdate:modelValue":t[19]||(t[19]=t=>e.form.confirmatoryTestLocation=t),form:e.form,asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])]),_:1}),T(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:D(()=>[T(s,{modelValue:e.form.confirmatoryTestDate,"onUpdate:modelValue":t[20]||(t[20]=t=>e.form.confirmatoryTestDate=t),form:e.form,"min-date":e.birthdate,"max-date":e.today},null,8,["modelValue","form","min-date","max-date"])]),_:1})],64)):A("",!0),T(u,{size:"12",class:"ion-margin-top"},{default:D(()=>[T(v,{class:"ion-margin-top ion-float-right",size:"large",onClick:e.onSubmit,color:"success"},{default:D(()=>[...t[23]||(t[23]=[I("Next",-1)])]),_:1},8,["onClick"]),T(v,{class:"ion-margin-top ion-float-right",size:"large",color:"warning",onClick:e.onClear},{default:D(()=>[...t[24]||(t[24]=[I("Clear",-1)])]),_:1},8,["onClick"]),e.isNewPatient?A("",!0):(y(),R(v,{key:0,class:"ion-margin-top ion-float-right",size:"large",onClick:t[21]||(t[21]=t=>e.$router.back()),color:"primary"},{default:D(()=>[...t[25]||(t[25]=[I("Back",-1)])]),_:1}))]),_:1})]),_:1})],64)}]]))}}});
