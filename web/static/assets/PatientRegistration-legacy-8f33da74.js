System.register(["./index-legacy-c5b3ee2e.js","./relations_service-legacy-58bb7a2e.js","./TextInput-legacy-72a36b9a.js","./DateInput.vue_vue_type_style_index_0_lang-legacy-8561393a.js","./SelectInput-legacy-e78e87d5.js","./location_options-legacy-579ec5ce.js","./form-legacy-e4bdf62a.js","./Strs-legacy-b5721578.js","./loader-legacy-6ec05884.js","./emc_event-legacy-0252f26c.js","./validations-legacy-a487012a.js","./his_date-legacy-5e1e6c30.js","./toasts-legacy-337d818a.js","./patient_identifier_service-legacy-64277f0d.js","./common-legacy-e8d6ba88.js","./index-legacy-06c0c4ca.js","./vue-datepicker-legacy-7f3df87e.js"],function(e,a){"use strict";var l,t,n,i,o,r,d,u,s,m,c,g,p,h,b,v,_,f,y,N,w,V,k,P,I,A,D,U,C,j,E,z,q,x,F,S,B,L,R,T,$,G,M,O,H,Y,J,W,K,Q,X,Z,ee,ae,le,te,ne,ie;return{setters:[e=>{l=e.d,t=e.i,n=e.am,i=e.o,o=e.c,r=e.e,d=e.w,u=e.u,s=e.v,m=e.a3,c=e.b,g=e.t,p=e.V,h=e.G,b=e.I,v=e.s,_=e.N,f=e.m,y=e.n,N=e.p,w=e.aA,V=e.g,k=e.a9,P=e.aq,I=e.J,A=e.ak,D=e.aB,U=e.aC,C=e.aD,j=e.ar,E=e._,z=e.O,q=e.k,x=e.a},e=>{F=e.P,S=e.R},e=>{B=e.T},e=>{L=e._},e=>{R=e.S},e=>{T=e.a,$=e.b},e=>{G=e.i,M=e.r},e=>{O=e.a},e=>{H=e.l},e=>{Y=e.E,J=e.a},e=>{W=e.a,K=e.b,Q=e.c},e=>{X=e.t,Z=e.d,ee=e.a},e=>{ae=e.t},e=>{le=e.P},e=>{te=e.t,ne=e.i},e=>{ie=e.D},null],execute:function(){const a=l({__name:"PatientMatch",props:{matchedPatients:{type:Array,required:!0},person:{type:Object,required:!0}},setup(e){const a=e,l=t(()=>`Possible Matches Found (${a.matchedPatients.length}) for ${a.person.given_name} ${a.person.family_name}`),f=t(()=>a.matchedPatients.map(({score:e,person:a})=>({name:`${a.given_name} ${a.family_name}`,...a,score:Number(100*e)+"%"}))),y=[{path:"name",label:"Name"},{path:"score",label:"Score"},{path:"gender",label:"Gender",formatter:te},{path:"birthdate",label:"Birthdate",formatter:X},{path:"home_village",label:"Home Village"},{path:"home_traditional_authority",label:"Home T/A"},{path:"home_district",label:"Home District"}],N=[{label:"Select",color:"primary",action:n.hide}];function w(){return n.hide()}return(e,a)=>(i(),o(_,null,[r(u(p),null,{default:d(()=>[r(u(s),null,{default:d(()=>[r(u(m),null,{default:d(()=>[c(g(l.value),1)]),_:1})]),_:1})]),_:1}),r(u(h),{class:"ion-padding-top"},{default:d(()=>[r(u(ie),{color:"light",rows:f.value,columns:y,"row-actions-buttons":N,config:{showSearchField:!1,showSubmitButton:!1}},null,8,["rows"])]),_:1}),r(u(v),null,{default:d(()=>[r(u(s),null,{default:d(()=>[r(u(b),{slot:"end",onClick:w,color:"primary"},{default:d(()=>[...a[0]||(a[0]=[c(" Register as New Patient ",-1)])]),_:1})]),_:1})]),_:1})],64))}}),oe=l({components:{IonGrid:f,IonRow:y,IonCol:N,TextInput:B,DateInput:L,SelectInput:R,IonCheckbox:w},setup(){const e=V(),l=I(!1),t=I(!1),i=T(),o=A({givenName:{label:"First Name",value:"",placeholder:"Enter First Name",required:!0,validation:e=>W(e)},familyName:{label:"Last Name",value:"",placeholder:"Enter Last Name",required:!0,validation:e=>W(e)},middleName:{label:"Middle Name",value:"",placeholder:"Enter middle Name",validation:e=>e&&e.label?W(e):null},nationalId:{label:"Malawi National ID Number",value:"",placeholder:"Enter Malawi National ID Number",validation:e=>e&&e.label?K(e):null},gender:{value:"",required:!0,label:"Gender",placeholder:"select gender"},birthdate:{value:"",label:"Date of Birth",required:!0},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",placeholder:"Enter cellphone number e.g. 0991234567",validation:async e=>"Unknown"!==e.value&&Q(e)},homeVillage:{value:"",label:"Home Village",placeholder:"Home Village",required:!0},landmark:{value:"",label:"Landmark",placeholder:"Closest Landmark or Plot Number",required:!0}}),r=A({givenName:{label:"First Name",value:"",placeholder:"Enter First Name",required:!0,validation:e=>W(e)},familyName:{label:"Last Name",value:"",placeholder:"Enter Last Name",required:!0,validation:e=>W(e)},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",placeholder:"Enter cellphone number e.g. 0991234567",validation:async e=>"Unknown"!==e.value&&Q(e)}});k(t,e=>{e?(r.givenName.value="Unknown",r.familyName.value="Unknown",r.cellPhoneNumber.value="Unknown",r.givenName.disabled=!0,r.familyName.disabled=!0,r.givenName.error="",r.familyName.error="",r.cellPhoneNumber.error=""):(r.givenName.value="",r.familyName.value="",r.cellPhoneNumber.value="",r.givenName.disabled=!1,r.familyName.disabled=!1)}),k(()=>o.birthdate.value,async a=>{const l=Z().diff(a,"weeks");if(l<6&&!(await P(`Patient is only ${l} weeks old. \n          Patient should be at least 6 weeks old to enroll in ART. \n          Are you sure you want to proceed?\n        `,{header:"ART Enrollment Warning",color:"warning"})))return e.back()});const d=(e,a={})=>{const l={facility_name:null,occupation:null};for(const t in e)l[O(t)]=e[t];return{...l,...a}},u=async e=>{var a,l,t,n,i,o,r,d;let u,s;try{var m;null!=e&&null!==(m=e.other)&&void 0!==m&&m.traditional_authority_id&&(u=await U.getTraditionalAuthorityById(e.other.traditional_authority_id)),u&&(s=await U.getDistrictByID(u.district_id))}catch(c){ae("Unable to resolve client address. Saving using default address"),console.error(c)}return{home_district:null!==(a=null===(l=s)||void 0===l?void 0:l.name)&&void 0!==a?a:"N/A",home_traditional_authority:null!==(t=null===(n=u)||void 0===n?void 0:n.name)&&void 0!==t?t:"N/A",home_village:(null==e?void 0:e.label)||"N/A",current_district:null!==(i=null===(o=s)||void 0===o?void 0:o.name)&&void 0!==i?i:"N/A",current_traditional_authority:null!==(r=null===(d=u)||void 0===d?void 0:d.name)&&void 0!==r?r:"N/A",current_village:(null==e?void 0:e.label)||"N/A"}};return{today:ee,patient:o,guardian:r,landmarks:i,genderOptions:[{label:"Male",value:"M"},{label:"Female",value:"F"}],guardianAbsent:t,isBirthdateEstimated:l,onClear:async()=>{if(await P("Are you sure you want to clear all fields?")){for(const e in o)o[e].value=void 0,o[e].error="";for(const e in r)r[e].value=void 0,r[e].error="";Y.emit(J.ON_CLEAR)}},onFinish:async()=>{const i=await G(o),s=!!t.value||await G(r);if(i&&s)try{H.show("Checking for possible duplicates...");const i=M(o).formData,m=new F,c=await u(i.homeVillage),g=d(i,{...c,isPatient:!0,patient_type:null,gender:i.gender.value,landmark:i.landmark.value,birthdate_estimated:l.value?"Yes":"No",relationship:t.value?"No":"Yes"});H.hide();const p=await(async e=>{const l=new C(j);try{var t;const i=await l.checkPotentialDuplicates(e);if(i.ok&&(null===(t=i.data)||void 0===t?void 0:t.length)>0)return n.show(a,{matchedPatients:i.data,person:e},"custom-summary-modal",!1)}catch(i){console.error(i)}})(g);if(!ne(p))return e.push(`/patient/${p.patient_id}`);await H.show("Saving..."),await m.createPerson(g),await m.createPatient();const h=m.getPersonID();if(i.nationalId&&await le.create(h,D,i.nationalId),!t.value&&s){const{formData:e}=M(r),a=await u(),l=d(e,{...a,middle_name:"",gender:"N/A",birthdate:"N/A",birthdate_estimated:"N/A",landmark:"N/A",relationship:"N/A",patient_type:"",isPatient:!1,patient_id:h});await m.registerGuardian(l);const t=m.getPersonID();await S.createRelation(h,t,13)}e.push(`/patient/reception/${h}/true`),H.hide()}catch(m){console.log(m),H.hide()}},getVillagesByName:$}}}),re={class:"ion-margin-start checkbox-label"};e("default",E(oe,[["render",function(e,a,l,t,n,o){const u=z("ion-col"),s=z("ion-row"),m=z("ion-title"),g=z("TextInput"),p=z("SelectInput"),h=z("DateInput"),b=z("ion-checkbox"),v=z("ion-button"),_=z("ion-grid"),f=z("Layout");return i(),q(f,null,{default:d(()=>[r(_,null,{default:d(()=>[r(s,null,{default:d(()=>[r(u,{class:"ion-margin-bottom"},{default:d(()=>[...a[14]||(a[14]=[x("h1",null,"New Patient Registration",-1)])]),_:1})]),_:1}),r(s,{class:"his-card"},{default:d(()=>[r(u,{size:"12"},{default:d(()=>[r(m,{class:"ion-text-center ion-margin-vertical"},{default:d(()=>[...a[15]||(a[15]=[x("b",null,"Personal Details",-1)])]),_:1}),r(s,{class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.patient.givenName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.patient.givenName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.patient.middleName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.patient.middleName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.patient.familyName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.patient.familyName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.patient.nationalId,"onUpdate:modelValue":a[3]||(a[3]=a=>e.patient.nationalId=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.patient.gender,"onUpdate:modelValue":a[4]||(a[4]=a=>e.patient.gender=a),options:e.genderOptions},null,8,["modelValue","options"])]),_:1}),r(u,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.patient.cellPhoneNumber,"onUpdate:modelValue":a[5]||(a[5]=a=>e.patient.cellPhoneNumber=a),allowUnknown:""},null,8,["modelValue"])]),_:1}),r(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(h,{modelValue:e.patient.birthdate,"onUpdate:modelValue":a[6]||(a[6]=a=>e.patient.birthdate=a),allowEstimation:!0,estimationLabel:"Estimate Age",minDate:"1920-01-01",maxDate:e.today(),onIsEstimated:a[7]||(a[7]=a=>e.isBirthdateEstimated=a)},null,8,["modelValue","maxDate"])]),_:1}),r(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.patient.homeVillage,"onUpdate:modelValue":a[8]||(a[8]=a=>e.patient.homeVillage=a),asyncOptions:e.getVillagesByName,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1}),r(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(p,{modelValue:e.patient.landmark,"onUpdate:modelValue":a[9]||(a[9]=a=>e.patient.landmark=a),options:e.landmarks,allowCustom:""},null,8,["modelValue","options"])]),_:1})]),_:1}),r(m,{class:"ion-text-center ion-margin-vertical ion-padding-top"},{default:d(()=>[a[17]||(a[17]=x("b",null,"Guardian details",-1)),x("span",re,[a[16]||(a[16]=c(" Guardian Details Unknown? ",-1)),r(b,{modelValue:e.guardianAbsent,"onUpdate:modelValue":a[10]||(a[10]=a=>e.guardianAbsent=a)},null,8,["modelValue"])])]),_:1}),r(s,{class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.guardian.givenName,"onUpdate:modelValue":a[11]||(a[11]=a=>e.guardian.givenName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.guardian.familyName,"onUpdate:modelValue":a[12]||(a[12]=a=>e.guardian.familyName=a)},null,8,["modelValue"])]),_:1}),r(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:d(()=>[r(g,{modelValue:e.guardian.cellPhoneNumber,"onUpdate:modelValue":a[13]||(a[13]=a=>e.guardian.cellPhoneNumber=a),allowUnknown:""},null,8,["modelValue"])]),_:1})]),_:1}),r(v,{class:"ion-margin-top ion-float-right",onClick:e.onFinish,size:"large",color:"success"},{default:d(()=>[...a[18]||(a[18]=[c("Finish",-1)])]),_:1},8,["onClick"]),r(v,{class:"ion-margin-top ion-float-right",onClick:e.onClear,size:"large",color:"warning"},{default:d(()=>[...a[19]||(a[19]=[c("Clear",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})}]]))}}});
