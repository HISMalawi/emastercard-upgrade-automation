System.register(["./index-legacy-084a8278.js","./patient_service-legacy-395b48b7.js","./_plugin-vue_export-helper-legacy-762b7923.js","./toasts-legacy-35f2c029.js","./patient_identifier_service-legacy-d759aa69.js","./his_date-legacy-31ba5787.js","./index-legacy-aa705205.js","./Date-legacy-d1585fa3.js","./common-legacy-0d7df615.js"],(function(e,t){"use strict";var a,n,i,l,r,s,o,d,c,u,g,m,h,p,y,b,v,f,_,C,k,D,w,V,I,x;return{setters:[e=>{a=e.d,n=e.c,i=e.a,l=e.b,r=e.t,s=e.ae,o=e.o,d=e.h,c=e.i,u=e.j,g=e.af,m=e.f,h=e.ac,p=e.F,y=e.ag,b=e.D,v=e.J,f=e.g,_=e.w,C=e.e,k=e.L,D=e.y,w=e.H},e=>{V=e.P},e=>{I=e._},e=>{x=e.b},null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent=".his-card[data-v-db98b469]{padding:0;margin:3%}li[data-v-db98b469]{padding:0;margin:0;list-style:none}.box{border-color:#a3a3a3;border-width:thin;border-style:solid;border-radius:3px}.searchBtn{height:50px!important;margin-top:0;margin-bottom:0;margin-right:.5rem}.sc-ion-searchbar-md-h{--box-shadow: none !important}\n",document.head.appendChild(t);const j=a({props:{patient:{type:Object,required:!0},isActive:{type:Boolean}},computed:{stateClass(){return{"active-card-color":this.isActive,"inactive-card-color":!this.isActive}}}}),A=a({components:{IonGrid:d,IonRow:c,IonCol:u,PatientCard:I(j,[["render",function(e,t,a,d,c,u){return o(),n("div",{class:s(["his-card clickable",e.stateClass])},[i("li",null,[i("ul",null,[t[0]||(t[0]=l(" NPID : ")),i("b",null,r(e.patient.npid),1)]),i("ul",null,[t[1]||(t[1]=l(" Arv# : ")),i("b",null,r(e.patient.arvNum),1)]),i("ul",null,[t[2]||(t[2]=l(" Name : ")),i("b",null,r(e.patient.name),1)]),i("ul",null,[t[3]||(t[3]=l(" Birth date : ")),i("b",null,r(e.patient.birthdate),1)]),i("ul",null,[t[4]||(t[4]=l(" Gender : ")),i("b",null,r(e.patient.gender),1)]),i("ul",null,[t[5]||(t[5]=l(" Home District : ")),i("b",null,r(e.patient.homeDistrict),1)]),i("ul",null,[t[6]||(t[6]=l(" Home Village : ")),i("b",null,r(e.patient.homeVillage),1)]),i("ul",null,[t[7]||(t[7]=l(" Current District : ")),i("b",null,r(e.patient.currentDistrict),1)]),i("ul",null,[t[8]||(t[8]=l(" Current Village : ")),i("b",null,r(e.patient.currentVillage),1)])])],2)}],["__scopeId","data-v-db98b469"]]),IonSearchbar:g},setup(){const e=m(),{facility:t}=b(),a=h([{category:"primary",query:"",results:[]},{category:"secondary",query:"",results:[]}]),n=p((()=>a.every((e=>e.results.length>0&&e.results.some((e=>e.isChecked))))));return{patients:a,enableMergeBtn:n,searchPatient:async e=>{if(e.query)try{const{type:a,value:n}=await(async e=>e.match(/^(\w+-ARV-\w+)$/)?{type:"arv_number",value:e}:e.match(/^(\d+)$/)?{type:"arv_number",value:`${t.code}-ARV-${e}`}:{type:"name",value:e})(e.query);let i;i="name"===a?(await V.search((e=>{const t={},a=e.split(" ").filter((e=>/\S/.test(e)));return a.length>0&&(t.given_name=a[0],a[1]&&(t.family_name=a[1]),a[2]&&(t.middle_name=a[1],t.family_name=a[2])),t})(n))).data:"arv_number"===a?(await V.findByOtherID(4,n)).data:[],e.results=i.map(((e,t)=>{const a=new V(e);return{index:t,id:a.getID(),name:a.getFullName(),docID:a.getDocID(),birthdate:a.getBirthdate(),arvNum:a.getArvNumber(),npid:a.getNationalID(),gender:a.getGender(),homeDistrict:a.getHomeDistrict(),homeVillage:a.getHomeVillage(),currentDistrict:a.getCurrentDistrict(),currentVillage:a.getCurrentVillage(),isChecked:!1}}))}catch(a){console.log(`${a}`)}},onPatient:(e,t)=>{if("primary"===t)a[0].results.forEach((t=>{t.id===e.id?t.isChecked=!t.isChecked:t.isChecked=!1})),e.isChecked&&a[1].results.forEach((t=>{t.id===e.id&&(t.isChecked=!1)}));else{if(e.isChecked)return e.isChecked=!1;e.isChecked=!a[0].results.some((t=>t.isChecked&&t.id===e.id))}},merge:async()=>{if(await y("Are you sure you want to merge these patients?"))try{var t;const n=a[0].results.find((e=>e.isChecked)),i=await V.mergePatients({primary:{patient_id:n.id,doc_id:n.docID},secondary:a[1].results.filter((e=>e.isChecked)).map((e=>({patient_id:e.id,doc_id:e.docID})))});if(!i.ok)throw new Error("Unable to merge Patients");const l=null===(t=i.data)||void 0===t?void 0:t.patient_id;e.push(`/patient/${l}`)}catch(n){x(`${n}`)}}}}}),P={class:"ion-margin-start"};e("default",I(A,[["render",function(e,t,a,s,d,c){const u=v("ion-button"),g=v("ion-col"),m=v("ion-card-title"),h=v("ion-searchbar"),p=v("ion-card-header"),y=v("patient-card"),b=v("ion-card-content"),V=v("ion-card"),I=v("ion-row"),x=v("ion-grid");return o(),f(x,null,{default:_((()=>[C(I,null,{default:_((()=>[C(g,{size:"12",class:"padding"},{default:_((()=>[i("h2",P,[t[1]||(t[1]=l(" Patient Merging ")),C(u,{class:"ion-float-right ion-margin-end",disabled:!e.enableMergeBtn,onClick:e.merge},{default:_((()=>t[0]||(t[0]=[l(" Merge Selected Patients ")]))),_:1},8,["disabled","onClick"])])])),_:1}),(o(!0),n(w,null,k(e.patients,(t=>(o(),f(g,{size:"6",key:t.category},{default:_((()=>[C(V,null,{default:_((()=>[C(p,{color:"light"},{default:_((()=>[C(m,{class:"ion-margin-bottom"},{default:_((()=>[l(r(t.category)+" patients ",1)])),_:2},1024),C(h,{style:{width:"100%",height:"45px"},class:"box-input ion-no-padding ion-margin-end",placeholder:"Type Name or ARV Number and press enter",modelValue:t.query,"onUpdate:modelValue":e=>t.query=e,onKeyup:D((a=>e.searchPatient(t)),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1024),C(b,{color:"light",style:{height:"70vh","overflow-y":"auto"}},{default:_((()=>[(o(!0),n(w,null,k(t.results,((a,n)=>(o(),f(y,{onClick:n=>e.onPatient(a,t.category),key:n,patient:a,isActive:a.isChecked},null,8,["onClick","patient","isActive"])))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})}]]))}}}));
