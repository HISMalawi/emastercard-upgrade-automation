System.register(["./index-legacy-79e582e4.js","./toasts-legacy-70b925e2.js","./DTFormElements-legacy-6f485257.js","./SelectInput-legacy-89cba976.js","./index-legacy-0f93fd1f.js","./VoidReason-legacy-e63cbb24.js","./Strs-legacy-b5721578.js","./his_date-legacy-95d4aa02.js","./dde-legacy-51a06bfd.js","./validations-legacy-609558df.js","./arrays-legacy-86abe4a8.js","./common-legacy-e8d6ba88.js"],function(e,a){"use strict";var t,n,l,r,i,o,s,c,d,u,m,h,p,v,g,y,b,f,_,I,w,S,R,C,j,x,D,V,$,A,N,T,P,k,E,B,M,K,O;return{setters:[e=>{t=e.d,n=e.l,l=e.m,r=e.n,i=e.I,o=e.ap,s=e.f,c=e.r,d=e.h,u=e.aj,m=e.i,h=e.K,p=e.k,v=e.aP,g=e.aC,y=e.aU,b=e._,f=e.N,_=e.j,I=e.w,w=e.o,S=e.e,R=e.C,C=e.a,j=e.b},e=>{x=e.t,D=e.b},e=>{V=e.g},e=>{$=e.S},e=>{A=e.D},e=>{N=e.p},e=>{T=e.t},e=>{P=e.t,k=e.h},e=>{E=e.r,B=e.a,M=e.i,K=e.b},e=>{O=e.b},null,null],execute:function(){var a=document.createElement("style");a.textContent=".sc-ion-searchbar-md-h{--box-shadow: none !important}\n",document.head.appendChild(a);const U=t({components:{IonGrid:n,IonRow:l,IonCol:r,SelectInput:$,IonButton:i,IonSearchbar:o,DataTable:A},setup(){const e=s(),{facility:a}=p(),t=c(""),n=c(document.getElementById("selectInput")),l=c(!1),r=c([]),i=d(()=>a.code+"-ARV-"),o=u({value:void 0,placeholder:"select gender"});m(()=>E());const b=[{label:"ARV Number",path:"arv_number"},{label:"MW National ID",path:"national_id"},{path:"given_name",label:"First name"},{path:"family_name",label:"Last name"},{path:"gender",label:"Gender",formatter:T},{path:"birthdate",label:"Date of Birth (AGE)",formatter:e=>`${P(e)} (${k(e)})`},{path:"source",label:"Source"}],f=async e=>{var a;const t=await v.searchByOtherID(y,e);return t.ok?t.data:(x(null!==(a=t.errorMessage)&&void 0!==a?a:`Searching client by ARV Number returned error: ${t.clientErrorType}`),[])},_=e=>{l.value&&(l.value=!1),null==e||e.map(e=>{var a,t,n,l,i;return r.value.push({arv_number:null===(a=e.patient_identifiers.find(e=>e.identifier_type==y))||void 0===a?void 0:a.identifier,national_id:null===(t=e.patient_identifiers.find(e=>e.identifier_type==g))||void 0===t?void 0:t.identifier,given_name:e.person.names[0].given_name,family_name:e.person.names[0].family_name,gender:e.person.gender,birthdate:e.person.birthdate,personId:e.patient_id,source:null!==(n=e.source)&&void 0!==n?n:"locals",docID:null!==(l=e.docID)&&void 0!==l?l:"",ddeClientRequiresImport:null!==(i=null==e?void 0:e.ddeClientRequiresImport)&&void 0!==i&&i})})},I=async()=>{if(t.value&&!l.value)try{var e;l.value=!0,r.value=[],t.value.match(/^(\w+-ARV-\w+)$/)&&f(t.value).then(_),null===O({value:t.value,label:t.value})&&(async e=>{var a;const t=await v.searchByOtherID(g,e);return t.ok?t.data:(x(null!==(a=t.errorMessage)&&void 0!==a?a:`Searching client by Malawi National ID returned error: ${t.clientErrorType}`),[])})(t.value).then(_),1===(a=t.value).split(" ").length&&(a.length>=6||13===a.length)&&B(t.value).then(_),t.value.match(/^(\d+)$/)?f(`${i.value}${t.value}`).then(_):((e,a)=>{const t={},n=e.split(" ").filter(e=>/\S/.test(e));return a&&(t.gender=a),n.length>0&&(t.given_name=n[0],t.family_name=n[2]||n[1]||"",t.middle_name=n[2]?n[1]:""),K(t)})(t.value,null===(e=o.value)||void 0===e?void 0:e.value).then(_)}catch(n){x("Unable to search patients"),console.error(n)}var a},w=d(()=>{const a=[{label:"Select",action:a=>{a.ddeClientRequiresImport?M(a.docID).then(a=>{a&&e.push(`/patient/${a.patient_id}`)}):e.push(`/patient/${a.personId}`)}}];return h.userHasRoles(["Program Manager","Superuser","System Developer"])&&a.push({label:"void",color:"danger",action:async e=>{N(async a=>{try{await v.void(e.personId,a),await I()}catch(t){D(`${t}`)}},"void-modal")}}),a});return{searchText:t,gender:o,tableRows:r,tableColumns:b,tableConfig:{showSearchField:!1,showSubmitButton:!1},genderOptions:V,selectInput:n,TableRowActions:w,searchPatient:I,resetQuery:()=>{t.value="",r.value=[],o.value=void 0}}}}),q={style:{"max-width":"250px"},class:"ion-margin-end ion-margin-vertical"};e("default",b(U,[["render",function(e,a,t,n,l,r){const i=f("ion-searchbar"),o=f("SelectInput"),s=f("ion-button"),c=f("ion-col"),d=f("ion-row"),u=f("data-table"),m=f("ion-grid");return w(),_(m,null,{default:I(()=>[S(d,{class:"his-card"},{default:I(()=>[S(c,{size:"10",style:{display:"flex","justify-content":"flex-start"}},{default:I(()=>[S(i,{style:{width:"350px",height:"2.75rem"},class:"box-input ion-no-padding ion-margin-end ion-margin-vertical",placeholder:"Search by Name or ARV Number or MW National ID",modelValue:e.searchText,"onUpdate:modelValue":a[0]||(a[0]=a=>e.searchText=a),onKeyup:R(e.searchPatient,["enter"])},null,8,["modelValue","onKeyup"]),C("div",q,[S(o,{modelValue:e.gender,"onUpdate:modelValue":a[1]||(a[1]=a=>e.gender=a),options:e.genderOptions,onKeyup:R(e.searchPatient,["enter"])},null,8,["modelValue","options","onKeyup"])]),S(s,{class:"ion-margin-vertical",onClick:e.searchPatient},{default:I(()=>a[2]||(a[2]=[j("Search")])),_:1,__:[2]},8,["onClick"]),S(s,{class:"ion-margin-vertical",onClick:e.resetQuery,color:"secondary"},{default:I(()=>a[3]||(a[3]=[j("Reset")])),_:1,__:[3]},8,["onClick"])]),_:1}),S(c,null,{default:I(()=>[S(s,{class:"ion-margin-vertical",href:"/patient/registration",color:"success",style:{float:"right"}},{default:I(()=>a[4]||(a[4]=[j(" Add New Patient ")])),_:1,__:[4]})]),_:1})]),_:1}),S(d,{class:"his-card ion-margin-top",style:{padding:"0 !important"}},{default:I(()=>[S(c,{size:"12",style:{"min-height":"320px"},class:"ion-no-padding"},{default:I(()=>[a[5]||(a[5]=C("h1",{class:"ion-margin"},"Patients Search Results",-1)),S(u,{rows:e.tableRows,columns:e.tableColumns,config:e.tableConfig,"row-actions-buttons":e.TableRowActions,color:"light"},null,8,["rows","columns","config","row-actions-buttons"])]),_:1,__:[5]})]),_:1})]),_:1})}]]))}}});
