System.register(["./index-legacy-b3d9e99f.js","./patient_service-legacy-8ecf55d1.js","./common-legacy-0d7df615.js","./TextInput-legacy-6c467ad6.js","./DateInput.vue_vue_type_style_index_0_lang-legacy-ce20409c.js","./YesNoInput-legacy-7b08331a.js","./HIVReception-legacy-62c5af87.js","./SelectInput-legacy-a6d48ea8.js","./location_options-legacy-b88e35fd.js","./regimen_service-legacy-853d1e4c.js","./DTFormElements-legacy-8934eb68.js","./consultation_service-legacy-d1326e30.js","./validations-legacy-d0f46810.js","./form-legacy-ee7d8d81.js","./emc_event-legacy-58754a45.js","./his_date-legacy-f64a549a.js","./program_service-legacy-84ed4264.js","./index-legacy-aa705205.js","./_plugin-vue_export-helper-legacy-762b7923.js","./patient_identifier_service-legacy-8657eaa1.js","./Date-legacy-fdff51f2.js","./vue-datepicker-legacy-5928f51a.js","./toasts-legacy-f5a15cc4.js","./loader-legacy-bf01395f.js","./encounter_types-legacy-dd9af3d0.js","./Strs-legacy-09248991.js"],(function(e,t){"use strict";var a,o,i,l,n,r,u,s,m,d,c,v,f,p,g,b,y,V,T,D,I,_,A,R,h,N,H,C,P,S,w,x,k,j,z,U,L,O,B,E,F,Y,Q,$,q,W,G,K;return{setters:[e=>{a=e.d,o=e.j,i=e.k,l=e.$,n=e.I,r=e.r,u=e.H,s=e.ae,m=e.a6,d=e.a2,c=e.F,v=e.ai,f=e.L,p=e.o,g=e.c,b=e.a,y=e.w,V=e.b,T=e.K,D=e.y,I=e.h},e=>{_=e.P},e=>{A=e.i},e=>{R=e.T},e=>{h=e._},e=>{N=e.Y},e=>{H=e.C,C=e.P},e=>{P=e.S},e=>{S=e.g},e=>{w=e.N,x=e.R},e=>{k=e.i,j=e.b,z=e.H},e=>{U=e.C,L=e.V},e=>{O=e.d,B=e.r,E=e.v,F=e.e},e=>{Y=e.s},e=>{Q=e.E,$=e.a},e=>{q=e.a},e=>{W=e.P},e=>{G=e.A},e=>{K=e._},null,null,null,null,null,null,null],execute:function(){const t=a({components:{IonRow:o,IonCol:i,IonTitle:l,IonButton:n,TextInput:R,DateInput:h,YesNoInput:N,SelectInput:P,NumberInput:w},props:{patient:{type:Object,required:!0},isNewPatient:{type:Boolean,default:!0},observations:{type:Object,default:()=>({})},initialVisitDate:{type:String,default:""}},emits:["onValue","onNext"],setup(e,{emit:t}){const{facility:a}=c(),o=r(""),i=r([]),l=new H(e.patient.getID(),e.initialVisitDate),n=new U(e.patient.getID(),e.initialVisitDate),f=new L(e.patient.getID(),e.initialVisitDate),p=new C(e.patient.getID(),e.initialVisitDate),g=u((()=>e.patient.getBirthdate())),b=s({arvNumber:{value:"",label:"ARV Number",placeholder:"Enter ARV Number",required:!0,validation:async(e,t)=>{if(t.arvNumber.disabled)return null;const o=O(e,"POSITIVE_INTEGERS");if(null!==o)return o;const i=await _.findByOtherID(G,`${a.code}-ARV-${e.value}`);return A(i.data)?null:["ARV Number already exists"]}},arvNumberAtPreviousLocation:{value:"",label:"ART Number at previous Location",computedValue:e=>({tag:"registration",obs:l.buildValueText("ART number at previous location",e)})},initialVisitDate:{value:e.initialVisitDate,label:"Registration Date",required:!0},shouldFollowUp:{value:e.observations["Agrees to followup"]?e.observations["Agrees to followup"].match(/yes|home visit/i)?"Yes":"No":"",label:"Agrees to follow up ?",computedValue:e=>({tag:"registration",obs:[l.buildGroupValueCoded("Agrees to followup","Home visit",e),l.buildGroupValueCoded("Agrees to followup","Phone",e)]}),required:!0},receivedArvTreatmentBefore:{value:e.observations["Ever received ART"]||"",label:"Ever received ARVs for treatment or prophylaxis?",computedValue:e=>({tag:"registration",obs:l.buildValueCoded("Ever received ART",e)}),required:!0},dateLastTakenArvs:{value:e.observations["Date ART last taken"]||"",label:"Date last taken ARVs",computedValue:e=>({tag:"registration",obs:l.buildValueDate("Date ART last taken",e)}),validation:async(e,t)=>"Yes"===t.receivedArvTreatmentBefore.value&&B(e)},everRegisteredAtClinic:{value:e.observations["Ever registered at ART clinic"]||"",label:"Ever registred at an ART clinic",computedValue:e=>({tag:"registration",obs:l.buildValueCoded("Ever registered at ART clinic",e)}),validation:async(e,t)=>"Yes"===t.receivedArvTreatmentBefore.value&&B(e)},artInitiationLocation:{value:e.observations["Location of ART initiation"]||"",label:"Location of ART Initiation",computedValue:e=>({tag:"registration",obs:n.buildValueText("Location of ART initiation","string"==typeof e?e:e.label)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&B(e)},artStartDate:{value:e.observations["Date ART started"]||"",label:"Date started ART",computedValue:e=>({tag:"registration",obs:l.buildValueDate("Date ART started",e)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&B(e)},initialWeight:{value:e.observations.weight||"",label:"Initial Weight",placeholder:"Enter weight",computedValue:e=>({tag:"vitals",obs:f.buildValueNumber("weight",e)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&"Unknown"!==e.value&&E([()=>B(e),()=>O(e,"DECIMALS"),()=>F(e,2,250)])},initialHeight:{value:e.observations.Height||"",label:"Initial Height",placeholder:"Enter height",computedValue:e=>({tag:"vitals",obs:l.buildValueNumber("Height",e)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&"Unknown"!==e.value&&E([()=>B(e),()=>O(e),()=>F(e,20,220)])},initialTBStatus:{value:e.observations["TB Status at Initiation"]||"",label:"Initial TB Status",placeholder:"select TB status",computedValue:e=>({tag:"registration",obs:l.buildValueCoded("TB Status at Initiation","string"==typeof e?e:e.label)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&B(e)},tptHistory:{value:e.observations["Previous TB treatment history"]||"",label:"TPT History",placeholder:"Select TPT history",computedValue:e=>({tag:"consultation",obs:n.buildValueText("Previous TB treatment history","string"==typeof e?e:e.label)}),validation:async(e,t)=>"Yes"===t.everRegisteredAtClinic.value&&B(e)},tptStartDate:{value:e.observations["TPT Drugs Received"]||"",label:"Date started TPT",validation:async(e,t)=>{var a;return(null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a||null===(a=a.label)||void 0===a?void 0:a.match(/currently/i))&&B(e)}},inhQty:{value:"",label:"INH Amount Received",validation:async(e,t)=>{var a;const o=null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.label;return(null==o?void 0:o.match(/currently/i))&&(o.match(/ipt/i)||o.includes("3HP (RFP + INH)"))&&B(e)},computedValue:(e,t)=>{var a;return{tag:"consultation",obs:n.buildObs("TPT Drugs Received",{value_drug:(null===(a=i.value.find((e=>"INH or H (Isoniazid 300mg tablet)"===e.name)))||void 0===a?void 0:a.drug_id)||0,value_datetime:(null==t?void 0:t.tptStartDate.value)||null,value_numeric:e||0})}}},rifapentineQty:{value:"",label:"Rifapentine Amount Received",validation:async(e,t)=>{var a;const o=null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.label;return(null==o?void 0:o.match(/currently/i))&&o.includes("3HP (RFP + INH)")&&B(e)},computedValue:(e,t)=>{var a;return{tag:"consultation",obs:n.buildObs("TPT Drugs Received",{value_drug:(null===(a=i.value.find((e=>"Rifapentine (150mg)"===e.name)))||void 0===a?void 0:a.drug_id)||0,value_datetime:(null==t?void 0:t.tptStartDate.value)||null,value_numeric:e||0})}}},threeHPQty:{value:"",label:"INH / RFP Amount Received",validation:async(e,t)=>{var a;const o=null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.label;return(null==o?void 0:o.match(/currently/i))&&o.includes("INH 300 / RFP 300 (3HP)")&&B(e)},computedValue:(e,t)=>{var a;return{tag:"consultation",obs:n.buildObs("TPT Drugs Received",{value_drug:(null===(a=i.value.find((e=>"INH 300 / RFP 300 (3HP)"===e.name)))||void 0===a?void 0:a.drug_id)||0,value_datetime:(null==t?void 0:t.tptStartDate.value)||null,value_numeric:e||0})}}},tptStartLocation:{value:e.observations["Location TPT Last Received"]||"",label:"TPT Transfer From",validation:async(e,t)=>{var a;return(null===(a=t.tptHistory)||void 0===a||null===(a=a.value)||void 0===a||null===(a=a.label)||void 0===a?void 0:a.match(/currently/i))&&B(e)},computedValue:e=>({tag:"consultation",obs:n.buildValueText("Location TPT Last Received","string"==typeof e?e:e.label)})},confirmatoryTest:{value:e.observations["Confirmatory hiv test type"]||"",label:"Confirmatory Test",placeholder:"Select confirmatory test",required:!0,computedValue:e=>({tag:"registration",obs:l.buildValueCoded("Confirmatory hiv test type","string"==typeof e?e:e.value)})},confirmatoryTestLocation:{value:e.observations["Confirmatory HIV test location"]||"",label:"Location of Confirmatory",placeholder:"Select location",validation:async(e,t)=>!("Not done"===t.confirmatoryTest.value.label||"Not done"===t.confirmatoryTest.value)&&B(e),computedValue:e=>({tag:"registration",obs:l.buildValueText("Confirmatory HIV test location","string"==typeof e?e:e.label)})},confirmatoryTestDate:{value:e.observations["Confirmatory HIV test date"]||"",label:"Confirmatory HIV Test Date",validation:async(e,t)=>!("Not done"===t.confirmatoryTest.value.label||"Not done"===t.confirmatoryTest.value)&&B(e),computedValue:e=>({tag:"registration",obs:l.buildValueDate("Confirmatory HIV test date",e)})},patientType:{value:"New patient",computedValue:e=>({tag:"patient type",obs:p.buildValueCoded("Type of patient",e)})}}),y=u((()=>{var e;return!("Not done"===(null===(e=b.confirmatoryTest.value)||void 0===e?void 0:e.label)||"Not done"===b.confirmatoryTest.value)}));m(b.receivedArvTreatmentBefore,(e=>{"No"===e.value&&(b.everRegisteredAtClinic.value="")})),m(b.initialVisitDate,(e=>{Q.emit($.ON_INITIAL_VISIT_DATE,e.value)})),m((()=>b.artStartDate.value),(e=>Q.emit($.ON_ART_START_DATE,e)),{immediate:!0});const V=u((()=>{var e;const t="string"==typeof b.tptHistory.value?b.tptHistory.value:null===(e=b.tptHistory.value)||void 0===e?void 0:e.label;if(null!=t&&t.match(/currently/i)){if(t.match(/ipt/i))return["INH or H (Isoniazid 300mg tablet)"];if(t.includes("3HP (RFP + INH)"))return["INH or H (Isoniazid 300mg tablet)","Rifapentine (150mg)"];if(t.includes("INH 300 / RFP 300 (3HP)"))return["INH 300 / RFP 300 (3HP)"]}return[]}));return d((()=>{const t=e.patient.getArvNumber();t&&"Unknown"!==t?(b.arvNumber.value=t.split("-")[2],b.arvNumber.disabled=!0):W.getNextSuggestedARVNumber().then((e=>{o.value=e,o.value&&(b.arvNumber.label=`Arv Number (Suggested Number: ${o.value})`)})),x.getCustomIngridients().then((e=>{e.ok&&(i.value=e.data)}))})),{today:q,form:b,isConfirmatoryTestDone:y,initialTbStatusOptions:k,tptHistoryOptions:j,HIVTestOptions:z,tptDrugs:V,facility:a,birthdate:g,getFacilities:S,onClear:async()=>{if(await v("Are you sure you want to clear all fields?"))for(const e in b)"patientType"!==e&&(b[e].value=void 0,b[e].error="");Q.emit($.ON_CLEAR)},onSubmit:async()=>{p.setDate(b.initialVisitDate.value),l.setDate(b.initialVisitDate.value),f.setDate(b.initialVisitDate.value),n.setDate(b.initialVisitDate.value),await Y(b,(async(e,o)=>{t("onValue",{type:"registration",data:{formData:{...e,arvNumber:e.arvNumber?`${a.code}-ARV-${e.arvNumber}`:""},computedData:o,arvNumberEditable:!b.arvNumber.disabled}}),t("onNext")}))}}}});e("default",K(t,[["render",function(e,t,a,o,i,l){const n=f("ion-title"),r=f("text-input"),u=f("ion-col"),s=f("DateInput"),m=f("yes-no-input"),d=f("SelectInput"),c=f("NumberInput"),v=f("ion-button"),_=f("ion-row");return p(),g(T,null,[b(n,{class:"ion-text-center ion-margin-vertical ion-padding-bottom bold"},{default:y((()=>[V(" HIV Clinic Registration ")])),_:1}),b(_,{class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(u,{size:"5",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(r,{modelValue:e.form.arvNumber,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.arvNumber=t),form:e.form,prefix:`${e.facility.code}-ARV-`,disabled:!e.isNewPatient},null,8,["modelValue","form","prefix","disabled"])])),_:1}),b(u,{size:"7",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(s,{modelValue:e.form.initialVisitDate,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.initialVisitDate=t),"min-date":e.birthdate,"max-date":e.today,form:e.form},null,8,["modelValue","min-date","max-date","form"])])),_:1}),b(u,{size:"5",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(m,{modelValue:e.form.shouldFollowUp,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.shouldFollowUp=t),inline:""},null,8,["modelValue"])])),_:1}),b(u,{size:"7",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(m,{modelValue:e.form.receivedArvTreatmentBefore,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.receivedArvTreatmentBefore=t),inline:""},null,8,["modelValue"])])),_:1}),"Yes"===e.form.receivedArvTreatmentBefore.value?(p(),g(T,{key:0},[b(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(s,{modelValue:e.form.dateLastTakenArvs,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.dateLastTakenArvs=t),form:e.form,"min-date":e.birthdate,"max-date":e.today},null,8,["modelValue","form","min-date","max-date"])])),_:1}),b(u,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(m,{modelValue:e.form.everRegisteredAtClinic,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.everRegisteredAtClinic=t),inline:""},null,8,["modelValue"])])),_:1})],64)):D("",!0),"Yes"===e.form.everRegisteredAtClinic.value?(p(),g(T,{key:1},[b(u,{size:"9",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(d,{modelValue:e.form.artInitiationLocation,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.artInitiationLocation=t),form:e.form,asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])])),_:1}),b(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(r,{modelValue:e.form.arvNumberAtPreviousLocation,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.arvNumberAtPreviousLocation=t),form:e.form},null,8,["modelValue","form"])])),_:1}),b(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(s,{modelValue:e.form.artStartDate,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.artStartDate=t),form:e.form,"min-date":e.birthdate,"max-date":e.today},null,8,["modelValue","form","min-date","max-date"])])),_:1}),b(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(c,{modelValue:e.form.initialWeight,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.initialWeight=t),form:e.form,min:1,allowUnknown:""},null,8,["modelValue","form"])])),_:1}),b(u,{size:"3",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(c,{modelValue:e.form.initialHeight,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.initialHeight=t),form:e.form,min:1,allowUnknown:""},null,8,["modelValue","form"])])),_:1}),b(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(d,{modelValue:e.form.initialTBStatus,"onUpdate:modelValue":t[11]||(t[11]=t=>e.form.initialTBStatus=t),form:e.form,options:e.initialTbStatusOptions},null,8,["modelValue","form","options"])])),_:1}),b(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(d,{modelValue:e.form.tptHistory,"onUpdate:modelValue":t[12]||(t[12]=t=>e.form.tptHistory=t),form:e.form,options:e.tptHistoryOptions},null,8,["modelValue","form","options"])])),_:1}),e.tptDrugs.length?(p(),g(T,{key:0},[b(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(s,{modelValue:e.form.tptStartDate,"onUpdate:modelValue":t[13]||(t[13]=t=>e.form.tptStartDate=t),"min-date":e.birthdate,"max-date":e.today,form:e.form},null,8,["modelValue","min-date","max-date","form"])])),_:1}),e.tptDrugs.includes("INH or H (Isoniazid 300mg tablet)")?(p(),I(u,{key:0,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(c,{modelValue:e.form.inhQty,"onUpdate:modelValue":t[14]||(t[14]=t=>e.form.inhQty=t),form:e.form,min:1},null,8,["modelValue","form"])])),_:1})):D("",!0),e.tptDrugs.includes("Rifapentine (150mg)")?(p(),I(u,{key:1,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(c,{modelValue:e.form.rifapentineQty,"onUpdate:modelValue":t[15]||(t[15]=t=>e.form.rifapentineQty=t),form:e.form,min:1},null,8,["modelValue","form"])])),_:1})):D("",!0),e.tptDrugs.includes("INH 300 / RFP 300 (3HP)")?(p(),I(u,{key:2,size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(c,{modelValue:e.form.threeHPQty,"onUpdate:modelValue":t[16]||(t[16]=t=>e.form.threeHPQty=t),form:e.form,min:1},null,8,["modelValue","form"])])),_:1})):D("",!0),b(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(d,{modelValue:e.form.tptStartLocation,"onUpdate:modelValue":t[17]||(t[17]=t=>e.form.tptStartLocation=t),form:e.form,asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])])),_:1})],64)):D("",!0)],64)):D("",!0),b(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(d,{modelValue:e.form.confirmatoryTest,"onUpdate:modelValue":t[18]||(t[18]=t=>e.form.confirmatoryTest=t),form:e.form,options:e.HIVTestOptions},null,8,["modelValue","form","options"])])),_:1}),e.isConfirmatoryTestDone?(p(),g(T,{key:2},[b(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(d,{modelValue:e.form.confirmatoryTestLocation,"onUpdate:modelValue":t[19]||(t[19]=t=>e.form.confirmatoryTestLocation=t),form:e.form,asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","form","asyncOptions"])])),_:1}),b(u,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:y((()=>[b(s,{modelValue:e.form.confirmatoryTestDate,"onUpdate:modelValue":t[20]||(t[20]=t=>e.form.confirmatoryTestDate=t),form:e.form,"min-date":e.birthdate,"max-date":e.today},null,8,["modelValue","form","min-date","max-date"])])),_:1})],64)):D("",!0),b(u,{size:"12",class:"ion-margin-top"},{default:y((()=>[b(v,{class:"ion-margin-top ion-float-right",size:"large",onClick:e.onSubmit,color:"success"},{default:y((()=>[V("Next")])),_:1},8,["onClick"]),b(v,{class:"ion-margin-top ion-float-right",size:"large",color:"warning",onClick:e.onClear},{default:y((()=>[V("Clear")])),_:1},8,["onClick"]),e.isNewPatient?D("",!0):(p(),I(v,{key:0,class:"ion-margin-top ion-float-right",size:"large",onClick:t[21]||(t[21]=t=>e.$router.back()),color:"primary"},{default:y((()=>[V("Back")])),_:1}))])),_:1})])),_:1})],64)}]]))}}}));
