import{l as c}from"./loader-1441845f.js";import{_ as P}from"./ReportTable.vue_vue_type_script_setup_true_lang-18fee1ca.js";import{g,t as m}from"./common-94ac9539.js";import{t as b}from"./toasts-926a2fd9.js";import{A as v}from"./age_groups-8203d13f.js";import{R as w}from"./report_service-1011140c.js";import{a as R}from"./arrays-7f14d286.js";import{d as A,S as h,o as H,h as y}from"./index-1c16650e.js";import"./exports-300de8ff.js";import"./index-e903e9ca.js";import"./his_date-3ca53c6f.js";import"./vue-datepicker-312099be.js";import"./DrilldownTable-d5470f91.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./index-95d3a767.js";import"./url-ffe761c9.js";const u=["started_new_on_art","started_previously_on_art","completed_new_on_art","completed_previously_on_art"];class F extends w{constructor(){super()}getTBPrevReport(){return this.getReport("/programs/".concat(this.programId,"/reports/tb_prev2"))}buildReportData(o){const t=[];return["F","M"].forEach(s=>{v.forEach(p=>{const r={gender:s,ageGroup:p};u.forEach(e=>{r["3hp_".concat(e)]=g(o[p][s],"3HP.".concat(e),[]),r["6h_".concat(e)]=g(o[p][s],"6H.".concat(e),[])}),t.push(r)})}),t}aggregate(o,t,n,s){return Object.values(o).reduce((p,r)=>[...r[t][n][s],...p],[])}getAggregatedMaleData(o){const t={gender:"Male",ageGroup:"All"};for(const n of u)t["3hp_".concat(n)]=this.aggregate(o,"M","3HP",n),t["6h_".concat(n)]=this.aggregate(o,"M","6H",n);return t}async getAggregatedMaternalStatus(o){const t=u.reduce((a,l)=>[...a,{group:"3HP",indicator:l,data:this.aggregate(o,"F","3HP",l)},{group:"6H",indicator:l,data:this.aggregate(o,"F","6H",l)}],[]),n=R(t.reduce((a,l)=>[...a,...l.data],[]).map(a=>a.patient_id)),s=await this.getMaternalStatus(n),p=s.FBf.concat(s.FP),r=[],e=(a,l,i)=>t.reduce((d,_)=>_.indicator===a&&l===_.group?[...d,..._.data]:d,[]).filter(d=>i==="FNP"?!p.includes(d.patient_id):s[i].includes(d.patient_id));for(const a of["FP","FNP","FBf"]){const l={gender:a,ageGroup:"All"};for(const i of u)l["3hp_".concat(i)]=e(i,"3HP",a),l["6h_".concat(i)]=e(i,"6H",a);r.push(l)}return r}}const q=A({__name:"TbPrev",setup(f){const o=h("-"),t=h([]),n=[{path:"ageGroup",label:"Age group"},{path:"gender",label:"Gender",formatter:m},{path:"3hp_started_new_on_art",label:"3HP Started New on ART",drillable:!0},{path:"6h_started_new_on_art",label:"6H Started New on ART",drillable:!0},{path:"3hp_started_previously_on_art",label:"3HP Started Previously on ART",drillable:!0},{path:"6h_started_previously_on_art",label:"6H Started Previously on ART",drillable:!0},{path:"3hp_completed_new_on_art",label:"3HP Completed New on ART",drillable:!0},{path:"6h_completed_new_on_art",label:"6H Completed New on ART",drillable:!0},{path:"3hp_completed_previously_on_art",label:"3HP Completed Previously on ART",drillable:!0},{path:"6h_completed_previously_on_art",label:"6H Completed Previously on ART",drillable:!0}];async function s({dateRange:r}){try{await c.show();const e=new F;e.setStartDate(r.startDate),e.setEndDate(r.endDate),o.value=e.getDateIntervalPeriod();const a=await e.getTBPrevReport();t.value=e.buildReportData(a),t.value.push(e.getAggregatedMaleData(a)),t.value.push(...await e.getAggregatedMaternalStatus(a))}catch(e){b("ERROR! Unable to load report data"),console.error(e)}await c.hide()}function p(r){return"".concat(r.column.label," | ").concat(r.row.ageGroup," | ").concat(m(r.row.gender),"s")}return(r,e)=>(H(),y(P,{title:"PEPFAR TB Prev Report","report-type":"PEPFAR",columns:n,rows:t.value,period:o.value,"drill-title":p,useDateRangeFilter:"",showIndices:"",onGenerate:s},null,8,["rows","period"]))}});export{q as default};
