import{d as M,a7 as k,_ as O,$ as E,I as K,ab as W,J as F,S as R,a8 as G,g as U,l as x,aA as b,O as z,r as i,h as L,w as r,o as Q,a as s,ad as B,f as $,b as S}from"./index-1c16650e.js";import{t as Y,b as j}from"./toasts-926a2fd9.js";import{g as H}from"./DTFormElements-a1199b88.js";import{S as J}from"./SelectInput-61d8e31d.js";import{l as A}from"./loader-1441845f.js";import{D as X}from"./index-e903e9ca.js";import{p as Z}from"./VoidReason-f7c11b2e.js";import{t as q}from"./Strs-7ee8a435.js";import{A as T,M as D}from"./index-95d3a767.js";import{t as ee,f as te}from"./his_date-3ca53c6f.js";import{b as ae}from"./validations-11aef89d.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";import"./common-94ac9539.js";const oe=M({components:{IonGrid:k,IonRow:O,IonCol:E,SelectInput:J,IonButton:K,IonSearchbar:W,DataTable:X},setup(){const t=F(),{facility:l}=z(),d=R(""),N=R(document.getElementById("selectInput")),u=G({value:"",placeholder:"select gender"}),f=R([]),y=[{label:"ARV Number",path:"arv_number"},{label:"MW National ID",path:"national_id"},{path:"given_name",label:"First name"},{path:"family_name",label:"Last name"},{path:"gender",label:"Gender",formatter:q},{path:"birthdate",label:"Date of Birth (AGE)",formatter:e=>"".concat(ee(e)," (").concat(te(e),")")}],v={showSearchField:!1,showSubmitButton:!1},m=e=>b.searchByOtherID(D,e),c=e=>b.searchByOtherID(T,e),h=(e,o)=>{const n={},a=e.split(" ").filter(g=>/\S/.test(g));return o&&(n.gender=o),a.length>0&&(n.given_name=a[0],n.family_name=a[2]||a[1]||"",n.middle_name=a[2]?a[1]:""),b.searchBy(n)},w=async(e,o)=>ae({value:e,label:e})===null?m(e):e.match(/^(\w+-ARV-\w+)$/)?c(e):e.match(/^(\d+)$/)?c("".concat(l.code,"-ARV-").concat(e)):h(e,o),_=async()=>{var e,o;if(d.value){A.show();try{const n=await w(d.value,u.value.value);await A.hide(),f.value=(o=(e=n==null?void 0:n.data)==null?void 0:e.map(a=>{var g,V;return{arv_number:(g=a.patient_identifiers.find(I=>I.identifier_type==T))==null?void 0:g.identifier,national_id:(V=a.patient_identifiers.find(I=>I.identifier_type==D))==null?void 0:V.identifier,given_name:a.person.names[0].given_name,family_name:a.person.names[0].family_name,gender:a.person.gender,birthdate:a.person.birthdate,personId:a.patient_id}}))!=null?o:[]}catch(n){Y("Unable to search patients"),console.error(n),await A.hide()}}},p=()=>{d.value="",u.value="",f.value=[]},C=()=>({label:"void",color:"danger",action:async e=>{Z(async o=>{try{await b.void(e.personId,o),await _()}catch(n){j("".concat(n))}},"void-modal")}}),P=U(()=>{const e=[{label:"Select",action:o=>t.push("/patient/".concat(o.personId))}];return x.userHasRoles(["Program Manager","Superuser","System Developer"])&&e.push(C()),e});return{searchText:d,gender:u,tableRows:f,tableColumns:y,tableConfig:v,genderOptions:H,selectInput:N,TableRowActions:P,searchPatient:_,resetQuery:p}}});const se={style:{"max-width":"250px"},class:"ion-margin-end ion-margin-vertical"},re=$("h1",{class:"ion-margin"},"Patients Search Results",-1);function ie(t,l,d,N,u,f){const y=i("ion-searchbar"),v=i("SelectInput"),m=i("ion-button"),c=i("ion-col"),h=i("ion-row"),w=i("data-table"),_=i("ion-grid");return Q(),L(_,null,{default:r(()=>[s(h,{class:"his-card"},{default:r(()=>[s(c,{size:"10",style:{display:"flex","justify-content":"flex-start"}},{default:r(()=>[s(y,{style:{width:"350px",height:"2.75rem"},class:"box-input ion-no-padding ion-margin-end ion-margin-vertical",placeholder:"Search by Name or ARV Number or MW National ID",modelValue:t.searchText,"onUpdate:modelValue":l[0]||(l[0]=p=>t.searchText=p),onKeyup:B(t.searchPatient,["enter"])},null,8,["modelValue","onKeyup"]),$("div",se,[s(v,{modelValue:t.gender,"onUpdate:modelValue":l[1]||(l[1]=p=>t.gender=p),options:t.genderOptions,onKeyup:B(t.searchPatient,["enter"])},null,8,["modelValue","options","onKeyup"])]),s(m,{class:"ion-margin-vertical",onClick:t.searchPatient},{default:r(()=>[S("Search")]),_:1},8,["onClick"]),s(m,{class:"ion-margin-vertical",onClick:t.resetQuery,color:"secondary"},{default:r(()=>[S("Reset")]),_:1},8,["onClick"])]),_:1}),s(c,null,{default:r(()=>[s(m,{class:"ion-margin-vertical",href:"/patient/registration",color:"success",style:{float:"right"}},{default:r(()=>[S(" Add New Patient ")]),_:1})]),_:1})]),_:1}),s(h,{class:"his-card ion-margin-top",style:{padding:"0 !important"}},{default:r(()=>[s(c,{size:"12",style:{"min-height":"320px"},class:"ion-no-padding"},{default:r(()=>[re,s(w,{rows:t.tableRows,columns:t.tableColumns,config:t.tableConfig,"row-actions-buttons":t.TableRowActions,color:"light"},null,8,["rows","columns","config","row-actions-buttons"])]),_:1})]),_:1})]),_:1})}const we=ne(oe,[["render",ie]]);export{we as default};
