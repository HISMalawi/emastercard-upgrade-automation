System.register(["./vue-datepicker-legacy-6c53f021.js","./LineChart.vue_vue_type_script_setup_true_lang-legacy-30dc744f.js","./index-legacy-4899e382.js","./common-legacy-e8d6ba88.js","./report_service-legacy-3a3452a3.js","./loader-legacy-6d203f84.js","./DrilldownTable-legacy-ee509dcc.js","./his_date-legacy-e1b082b7.js","./toasts-legacy-469ad8d1.js","./arrays-legacy-86abe4a8.js","./url-legacy-3a6801d5.js","./index-legacy-f05e42a8.js"],function(t,e){"use strict";var a,n,i,l,s,r,o,d,u,c,p,g,h,m,_,v,f,y,w,V,D,j,b,x,C,k;return{setters:[t=>{a=t.K},t=>{n=t._},t=>{i=t.L,l=t.ar,s=t.d,r=t.m,o=t.n,d=t.p,u=t.i,c=t.J,p=t.am,g=t._,h=t.O,m=t.k,_=t.w,v=t.o,f=t.e,y=t.a,w=t.b,V=t.t},t=>{D=t.i},t=>{j=t.R},t=>{b=t.l},t=>{x=t.D},t=>{C=t.i},t=>{k=t.t},null,null,null],execute:function(){class e extends j{constructor(){super()}static getLocationName(){return sessionStorage.getItem("locationName")}getBookedAppointments(t){return i.getJson(`programs/${l}/scheduled_appointments`,{date:t})}getViralLoadResults(t){return this.getReport(`/programs/${l}/reports/high_vl_patients`,{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport(`/programs/${l}/reports/retention`)}getExternalConsultationClients(){return this.getReport(`${l}/external_consultation_clients`)}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport(`/programs/${l}/reports/pregnant_patients`)}getArchivingCandidates(){return i.getJson(`programs/${l}/reports/archiving_candidates`,{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}getVisitStats(){return i.getJson(`programs/${l}/reports/visits`,{name:"visits",start_date:this.startDate,end_date:this.endDate})}}const I=s({components:{LineChart:n,IonGrid:r,IonRow:o,IonCol:d,VueDatePicker:a},setup(){const t=c(""),a=c(""),n=c([]),i=u(()=>{var t;return(null===(t=n.value[0])||void 0===t?void 0:t.raw.flat())||[]}),l=u(()=>{var t;return(null===(t=n.value[1])||void 0===t?void 0:t.raw.flat())||[]}),s=u(()=>{var t;return(null===(t=n.value[2])||void 0===t?void 0:t.raw.flat())||[]}),r=u(()=>n.value.map(({raw:t})=>t).flat(3)),o=async(t,e="Drill down clients")=>{await p.show(x,{patientIds:t.map(({patientId:t})=>t),title:e})};return{startDate:t,endDate:a,series:n,options:{title:{text:"Patient Visits Statistics",align:"left"},yaxis:{title:{text:"Number of clients"}}},totalAttendance:r,totalPatientVisits:i,totalGuardianVisits:l,totalBothVisits:s,fetchData:async()=>{if(!C(t.value,a.value))return k("Invalid date range");try{b.show();const i=new e;i.setStartDate(t.value),i.setEndDate(a.value);const l=await i.getPatientVisitTypes();n.value=(t=>{const e={},a={},n={},i=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(t).forEach(([t,l])=>{e[t]=[],a[t]=[],n[t]=[],Object.entries(l).forEach(([i,{patient_present:l,guardian_present:s}])=>{s&&l?n[t].push({patientId:i,date:t}):l?e[t].push({patientId:i,date:t}):s&&a[t].push({patientId:i,date:t})});const s=new Date(t).getTime();i[0].data.push([s,e[t].length]),i[0].raw.push(e[t]),i[1].data.push([s,a[t].length]),i[1].raw.push(a[t]),i[2].data.push([s,n[t].length]),i[2].raw.push(n[t])}),i})(l)}catch(i){console.error(i),k("Unable to generate patient visits data")}b.hide()},pointSelection:async(t,e)=>{if(!D(n.value))try{await o(n.value[e].raw[t],`${n.value[e].name} visits`)}catch(a){console.error(a)}},drilldown:o}}}),P={style:{display:"flex","justify-content":"flex-start"}},R={class:"his-card"};t("default",g(I,[["render",function(t,e,a,n,i,l){const s=h("vue-date-picker"),r=h("ion-button"),o=h("ion-col"),d=h("ion-label"),u=h("ion-badge"),c=h("ion-item"),p=h("ion-list"),g=h("line-chart"),D=h("ion-row"),j=h("ion-grid");return v(),m(j,null,{default:_(()=>[f(D,null,{default:_(()=>[f(o,{size:"6",offset:"6",class:"ion-padding"},{default:_(()=>[y("div",P,[f(s,{modelValue:t.startDate,"onUpdate:modelValue":e[0]||(e[0]=e=>t.startDate=e),placeholder:"Start Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),f(s,{modelValue:t.endDate,"onUpdate:modelValue":e[1]||(e[1]=e=>t.endDate=e),placeholder:"End Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),f(r,{color:"primary",class:"ion-no-margin",onClick:t.fetchData},{default:_(()=>[...e[6]||(e[6]=[w("Generate",-1)])]),_:1},8,["onClick"])])]),_:1}),f(o,{size:"3",class:"ion-padding-top"},{default:_(()=>[y("div",R,[f(p,null,{default:_(()=>[f(c,{button:"",onClick:e[2]||(e[2]=e=>t.drilldown(t.totalAttendance,"Total Attendance"))},{default:_(()=>[f(d,null,{default:_(()=>[...e[7]||(e[7]=[w("Total Attendance ",-1)])]),_:1}),f(u,null,{default:_(()=>[w(V(t.totalAttendance.length),1)]),_:1})]),_:1}),f(c,{button:"",onClick:e[3]||(e[3]=e=>t.drilldown(t.totalPatientVisits,"Total patient visits"))},{default:_(()=>[f(d,null,{default:_(()=>[...e[8]||(e[8]=[w("Patient Visit ",-1)])]),_:1}),f(u,null,{default:_(()=>[w(V(t.totalPatientVisits.length),1)]),_:1})]),_:1}),f(c,{button:"",onClick:e[4]||(e[4]=e=>t.drilldown(t.totalGuardianVisits,"Total guardian visits"))},{default:_(()=>[f(d,null,{default:_(()=>[...e[9]||(e[9]=[w("Guardian Visit ",-1)])]),_:1}),f(u,null,{default:_(()=>[w(V(t.totalGuardianVisits.length),1)]),_:1})]),_:1}),f(c,{button:"",onClick:e[5]||(e[5]=e=>t.drilldown(t.totalBothVisits,"Total patient and guardian visits"))},{default:_(()=>[f(d,null,{default:_(()=>[...e[10]||(e[10]=[w("Patient and Guardian Visit ",-1)])]),_:1}),f(u,null,{default:_(()=>[w(V(t.totalBothVisits.length),1)]),_:1})]),_:1})]),_:1})])]),_:1}),f(o,{size:"9"},{default:_(()=>[f(g,{style:{height:"600px"},series:t.series,options:t.options,onPointSelection:t.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})}]]))}}});
