System.register(["./index-legacy-5705a9b7.js","./TextInput-legacy-e955883b.js","./SelectInput-legacy-145559fd.js","./common-legacy-2d845b1c.js","./user_service-legacy-65d523f2.js","./form-legacy-8b805202.js","./toasts-legacy-ac0a9e63.js","./_plugin-vue_export-helper-legacy-762b7923.js","./index-legacy-aa705205.js","./his_date-legacy-df0799d6.js","./Strs-legacy-09248991.js","./Date-legacy-61e414e0.js","./loader-legacy-5e05219c.js"],(function(e,a){"use strict";var l,s,r,o,n,t,u,i,d,m,c,p,f,v,g,w,y,_,h,F,V,b,j;return{setters:[e=>{l=e.d,s=e.I,r=e.i,o=e.j,n=e.k,t=e.r,u=e.ae,i=e.a2,d=e.L,m=e.h,c=e.w,p=e.o,f=e.a,v=e.f,g=e.b},e=>{w=e.T},e=>{y=e.S},e=>{_=e.g},e=>{h=e.U},e=>{F=e.s},e=>{V=e.a,b=e.b},e=>{j=e._},null,null,null,null,null],execute:function(){const a=l({name:"UserModal",components:{IonButton:s,IonGrid:r,IonRow:o,IonCol:n,TextInput:w,SelectInput:y},setup(){const e=t([]),a=t(-1),l=t(1),s=u({password:{value:"",label:"New Password",required:!0,validation:async({value:e})=>e&&`${e}`.length<6?["Password must be at least 6 characters long"]:null},confirmPassword:{value:"",label:"Confirm New Password",required:!0,validation:async({value:e},a)=>e&&e!==a.password.value?["Passwords do not match"]:null}}),r=u({givenName:{value:"",label:"First Name",required:!0},familyName:{value:"",label:"Last Name",required:!0},username:{value:"",label:"Username",disabled:!0},roles:{value:[],label:"Roles",required:!0}}),o=async()=>{const e=await h.getCurrentUser();e&&(a.value=e.user_id,r.username.value=e.username,r.givenName.value=_(e,"person.names[0].given_name",""),r.familyName.value=_(e,"person.names[0].family_name",""),r.roles.value=e.roles.map((e=>({value:e.role,label:e.role,other:e}))))};return i((async()=>{await h.getAllRoles().then((a=>{const l=Array.isArray(a.data)?a.data:[];e.value=l.map((e=>({value:e.role,label:e.role,other:e})))})),await o(),l.value++})),{userForm:r,passwordForm:s,roles:e,refreshRoles:l,updateProfile:()=>F(r,(async e=>{try{const l=await h.updateUser(a.value,{...e,roles:e.roles.map((e=>e.label))});if(!l||!l.data)throw new Error("Failed to update user profile");{const e=l.data;sessionStorage.setItem("username",e.username),sessionStorage.setItem("userRoles",JSON.stringify(e.roles)),V("User profile has been updated successfully",3e3),o()}}catch(l){b("Failed to update user profile")}})),updatePassword:()=>F(s,(async e=>{await h.updateUser(a.value,e),V("Password updated successfully",3e3);for(const a in s)s[a].value=""}))}}}),I={class:"his-card"},P=v("h2",null,"User Profile",-1),U={class:"his-card"},N=v("h2",null,"Change Password",-1);e("default",j(a,[["render",function(e,a,l,s,r,o){const n=d("ion-col"),t=d("text-input"),u=d("SelectInput"),i=d("TextInput"),w=d("IonButton"),y=d("ion-row"),_=d("ion-grid");return p(),m(_,null,{default:c((()=>[f(y,null,{default:c((()=>[f(n,{size:"8"},{default:c((()=>[v("div",I,[f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[P])),_:1}),f(y,null,{default:c((()=>[f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[f(t,{modelValue:e.userForm.username,"onUpdate:modelValue":a[0]||(a[0]=a=>e.userForm.username=a)},null,8,["modelValue"])])),_:1}),f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[(p(),m(u,{modelValue:e.userForm.roles,"onUpdate:modelValue":a[1]||(a[1]=a=>e.userForm.roles=a),options:e.roles,multiple:"",key:e.refreshRoles},null,8,["modelValue","options"]))])),_:1}),f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[f(i,{modelValue:e.userForm.givenName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.userForm.givenName=a)},null,8,["modelValue"])])),_:1}),f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[f(i,{modelValue:e.userForm.familyName,"onUpdate:modelValue":a[3]||(a[3]=a=>e.userForm.familyName=a)},null,8,["modelValue"])])),_:1}),f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[f(w,{class:"ion-margin-end ion-margin-vertical ion-float-right",onClick:e.updateProfile},{default:c((()=>[g("Save")])),_:1},8,["onClick"])])),_:1})])),_:1})])])),_:1}),f(n,{size:"4"},{default:c((()=>[v("div",U,[f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[N])),_:1}),f(y,null,{default:c((()=>[f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[f(i,{modelValue:e.passwordForm.password,"onUpdate:modelValue":a[4]||(a[4]=a=>e.passwordForm.password=a),password:""},null,8,["modelValue"])])),_:1}),f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[f(i,{modelValue:e.passwordForm.confirmPassword,"onUpdate:modelValue":a[5]||(a[5]=a=>e.passwordForm.confirmPassword=a),form:e.passwordForm,password:""},null,8,["modelValue","form"])])),_:1}),f(n,{size:"12",class:"ion-margin-vertical"},{default:c((()=>[f(w,{class:"ion-margin-end ion-margin-vertical ion-float-right",onClick:e.updatePassword},{default:c((()=>[g("Save")])),_:1},8,["onClick"])])),_:1})])),_:1})])])),_:1})])),_:1})])),_:1})}]]))}}}));
