System.register(["./exports-legacy-c6cd98d8.js","./common-legacy-0d7df615.js","./index-legacy-63d88c8f.js","./his_date-legacy-c17b58f4.js","./vue-datepicker-legacy-ebc9c406.js","./index-legacy-1461de81.js","./toasts-legacy-518b05de.js","./DrilldownTable-legacy-6cc8bf35.js","./arrays-legacy-4be31994.js"],(function(e,t){"use strict";var l,a,r,o,n,i,u,s,d,c,p,y,f,m,v,h,b,g,D,w,B,S,A,F,R,j,x,C,k,T,M,P,_,q,E,I,H,$,L,V,N,O;return{setters:[e=>{l=e.g,a=e.a},e=>{r=e.s,o=e.p,n=e.t,i=e.i,u=e.g},e=>{s=e.E,d=e.f,c=e.d,p=e.r,y=e.h,f=e.k,m=e.dD,v=e.j,h=e.w,b=e.u,g=e.o,D=e.e,w=e.p,B=e.q,S=e.A,A=e.b,F=e.a,R=e.t,j=e.aL,x=e.bW,C=e.P,k=e.aI,T=e.a6,M=e.a7,P=e.am,_=e.ak,q=e.aP},e=>{E=e.k,I=e.t,H=e.i},e=>{$=e.K},e=>{L=e.D},e=>{V=e.t},e=>{N=e.D},e=>{O=e.c}],execute:function(){var t=document.createElement("style");function Q(e="person_id",t=d()){return{label:"view client",icon:s,color:"light",action:l=>t.push(`/patient/${l[e]}`)}}t.textContent=".no-data-table{height:55vh!important}\n",document.head.appendChild(t),e({g:Q,t:function(e,t={}){return Array.isArray(e)?e.map((e=>({label:e,path:e,drillable:!0,sortable:!0,...t}))):Object.entries(e).map((([e,l])=>({path:e,label:l,drillable:!0,sortable:!1,...t})))}}),e("_",c({__name:"ReportTable",props:{title:{type:String,default:"Report"},subtitle:{type:String,default:""},period:{type:String,default:""},date:{type:String,default:""},quarter:{type:Object,default:()=>({})},totalClients:{type:Array},columns:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},actionButtons:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},canExportPDF:{type:Boolean,default:!0},useSecureExport:{type:Boolean,default:!1},showRefreshButton:{type:Boolean,default:!0},useDateRangeFilter:{type:Boolean,default:!1},useQuarterFilter:{type:Boolean,default:!1},useDateFilter:{type:Boolean,default:!1},customFilters:{type:Array,default:()=>[]},showIndices:{type:Boolean,default:!1},filename:{type:String,default:""},reportType:{type:String,default:""},drillTitle:{type:Function,default:()=>"Drill-down table"},customDrillColumns:{type:Array},drillRowParser:{type:Function},customDrillHandler:{type:Function},showDrillSelectButton:{type:Boolean,default:!0}},emits:["generate"],setup(e,{emit:t}){const s=t,d=e,c=p({}),U=p({}),G=y((()=>r(`\n  ${d.reportType} \n  ${f().facility.name} \n  ${(d.filename||d.title).replace(d.reportType,"")} \n  ${d.period?d.period:d.date}\n`))),K=y((()=>{const e=[...d.customFilters];return d.useDateRangeFilter?(e.push({id:"startDate",label:"Start Date",type:"date",placeholder:"Start Date",slotName:"datePicker",value:d.period.split("-")[0]}),e.push({id:"endDate",label:"End Date",placeholder:"End Date",type:"date",slotName:"datePicker",value:d.period.split("-")[1]})):d.useQuarterFilter?e.push({id:"quarter",label:"Quarter:",type:"select",value:d.quarter,options:E(10).map((e=>({label:e.name,value:e.name,other:e})))}):d.useDateFilter&&e.push({id:"date",label:"Date",type:"date",slotName:"datePicker",value:d.date}),e})),W=y((()=>{var e,t;const r=[...d.actionButtons];return d.canExportCsv&&r.push(l(G.value,null===(e=d.quarter)||void 0===e?void 0:e.label,d.period)),d.canExportPDF&&r.push(a(G.value,d.useSecureExport,null===(t=d.quarter)||void 0===t?void 0:t.label,d.period)),d.showRefreshButton&&r.push({label:"Refresh/Rebuild",icon:m,color:"primary",action:()=>{if(i(U.value))return V("Invalid filters");s("generate",U.value,!0)}}),r})),z=y((()=>{var e;return null!==(e=d.customDrillColumns)&&void 0!==e?e:[{path:"identifier",label:"ARV Number",preSort:o,initialSort:!0},{path:"birthdate",label:"Date of Birth",formatter:I},{path:"gender",label:"Gender",formatter:n}]}));function J(e){if("startDate"in e&&"endDate"in e){const{startDate:t,endDate:l}=c.value;if(!H(t,l))return V("Invalid date range");e.startDate=t,e.endDate=l,e.dateRange={startDate:t,endDate:l}}if("date"in e){if(i(c.value.date))return V("Invalid date");e.date=c.value.date}if(function(e){return K.value.every((t=>!1===t.required||!i(e[t.id])&&("object"!=typeof e[t.id]||Object.values(e[t.id]).every(Boolean))))}(e))return U.value=e,s("generate",e,!1);V("Invalid filters")}function X(e){return e.preventDefault(),Y({row:{clients:d.totalClients},column:{path:"clients",label:"Total Clients"}})}async function Y(e){var t,r;if("function"==typeof d.customDrillHandler)return d.customDrillHandler(e);const o=d.drillTitle(e),n=p([]);return async function(e,t){if("function"==typeof d.drillRowParser)t.push(...await d.drillRowParser(e));else{const r=u(e.row,e.column.path,[]);for(const e of O(r,100)){var l,a;const r=await q.getAll(e);if(!r.ok)return V(null!==(l=r.errorMessage)&&void 0!==l?l:"Unable to load patient data");t.push(...null!==(a=r.data)&&void 0!==a?a:[])}}}(e,n.value),P.show(N,{title:o,columns:z.value,rows:n.value,rowActionButtons:d.showDrillSelectButton?[Q("person_id",_)]:[],actionButtons:[l(o,null===(t=d.quarter)||void 0===t?void 0:t.label,d.period),a(o,!1,null===(r=d.quarter)||void 0===r?void 0:r.label,d.period)]})}return(t,l)=>(g(),v(b(M),{style:{padding:"0 !important"}},{default:h((()=>[D(b(j),{style:{"border-bottom":"1px solid #c2c2c2","font-weight":"500",color:"#000"}},{default:h((()=>{var t;return[D(b(w),{innerHTML:e.title},null,8,["innerHTML"]),e.subtitle?(g(),v(b(B),{key:0,innerHTML:e.subtitle,style:{color:"#818181"}},null,8,["innerHTML"])):S("",!0),null!==(t=e.totalClients)&&void 0!==t&&t.length?(g(),v(b(B),{key:1},{default:h((()=>[l[0]||(l[0]=A(" Total Clients: ")),F("a",{href:"#",onClick:X},R(e.totalClients.length),1)])),_:1})):S("",!0)]})),_:1}),D(b(T),{class:"ion-no-padding",style:{"padding-bottom":"30px","min-height":"55vh"}},{default:h((()=>[D(b(L),{rows:e.rows,"async-rows":e.asyncRows,columns:e.columns,"actions-buttons":W.value,"row-actions-buttons":e.rowActionButtons,"custom-filters":K.value,config:{showIndices:e.showIndices},onCustomFilter:J,onDrilldown:Y,color:"light"},x({datePicker:h((({filter:e})=>{var t,l;return[D(b($),{modelValue:c.value[e.id],"onUpdate:modelValue":t=>c.value[e.id]=t,"enable-time-picker":!1,"model-type":"dd/MMM/yyyy",format:"dd/MMM/yyyy",placeholder:null!==(t=null!==(l=e.placeholder)&&void 0!==l?l:e.label)&&void 0!==t?t:"Select Date","auto-apply":"","text-input":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])]})),_:2},[C(t.$slots,((e,l)=>({name:l,fn:h((({filter:e})=>[k(t.$slots,l,{filter:{filter:e}})]))})))]),1032,["rows","async-rows","columns","actions-buttons","row-actions-buttons","custom-filters","config"])])),_:3})])),_:3}))}}))}}}));
