System.register(["./vue-datepicker-legacy-bae3aa7f.js","./LineChart.vue_vue_type_script_setup_true_lang-legacy-726809b5.js","./index-legacy-6e8cabae.js","./toasts-legacy-68a34a42.js","./report_service-legacy-667f4cb8.js","./loader-legacy-fc6eecd3.js","./DrilldownTable-legacy-3fae1961.js","./his_date-legacy-c70e97bf.js","./arrays-legacy-668eb666.js","./url-legacy-2d97b2db.js","./index-legacy-038370c4.js"],(function(t,e){"use strict";var a,n,i,l,s,r,o,d,u,p,c,g,h,_,m,v,f,y,w,V,D,j,b,C,k,x;return{setters:[t=>{a=t.K},t=>{n=t._},t=>{i=t.F,l=t.aj,s=t.d,r=t.i,o=t.j,d=t.k,u=t.r,p=t.G,c=t.ak,g=t._,h=t.K,_=t.h,m=t.w,v=t.o,f=t.e,y=t.a,w=t.b,V=t.t},t=>{D=t.t,j=t.i},t=>{b=t.R},t=>{C=t.l},t=>{k=t.D},t=>{x=t.i},null,null,null],execute:function(){class e extends b{constructor(){super()}static getLocationName(){return sessionStorage.getItem("locationName")}getBookedAppointments(t){return i.getJson(`programs/${l}/scheduled_appointments`,{date:t})}getViralLoadResults(t){return this.getReport(`/programs/${l}/reports/high_vl_patients`,{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport(`/programs/${l}/reports/retention`)}getExternalConsultationClients(){return this.getReport(`${l}/external_consultation_clients`)}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport(`/programs/${l}/reports/pregnant_patients`)}getArchivingCandidates(){return i.getJson(`programs/${l}/reports/archiving_candidates`,{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}getVisitStats(){return i.getJson(`programs/${l}/reports/visits`,{name:"visits",start_date:this.startDate,end_date:this.endDate})}}const I=s({components:{LineChart:n,IonGrid:r,IonRow:o,IonCol:d,VueDatePicker:a},setup(){const t=u(""),a=u(""),n=u([]),i=p((()=>{var t;return(null===(t=n.value[0])||void 0===t?void 0:t.raw.flat())||[]})),l=p((()=>{var t;return(null===(t=n.value[1])||void 0===t?void 0:t.raw.flat())||[]})),s=p((()=>{var t;return(null===(t=n.value[2])||void 0===t?void 0:t.raw.flat())||[]})),r=p((()=>n.value.map((({raw:t})=>t)).flat(3))),o=async(t,e="Drill down clients")=>{await c.show(k,{patientIds:t.map((({patientId:t})=>t)),title:e})};return{startDate:t,endDate:a,series:n,options:{title:{text:"Patient Visits Statistics",align:"left"},yaxis:{title:{text:"Number of clients"}}},totalAttendance:r,totalPatientVisits:i,totalGuardianVisits:l,totalBothVisits:s,fetchData:async()=>{if(!x(t.value,a.value))return D("Invalid date range");try{C.show();const i=new e;i.setStartDate(t.value),i.setEndDate(a.value);const l=await i.getPatientVisitTypes();n.value=(t=>{const e={},a={},n={},i=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(t).forEach((([t,l])=>{e[t]=[],a[t]=[],n[t]=[],Object.entries(l).forEach((([i,{patient_present:l,guardian_present:s}])=>{s&&l?n[t].push({patientId:i,date:t}):l?e[t].push({patientId:i,date:t}):s&&a[t].push({patientId:i,date:t})}));const s=new Date(t).getTime();i[0].data.push([s,e[t].length]),i[0].raw.push(e[t]),i[1].data.push([s,a[t].length]),i[1].raw.push(a[t]),i[2].data.push([s,n[t].length]),i[2].raw.push(n[t])})),i})(l)}catch(i){console.error(i),D("Unable to generate patient visits data")}C.hide()},pointSelection:async(t,e)=>{if(!j(n.value))try{await o(n.value[e].raw[t],`${n.value[e].name} visits`)}catch(a){console.error(a)}},drilldown:o}}}),P={style:{display:"flex","justify-content":"flex-start"}},R={class:"his-card"};t("default",g(I,[["render",function(t,e,a,n,i,l){const s=h("vue-date-picker"),r=h("ion-button"),o=h("ion-col"),d=h("ion-label"),u=h("ion-badge"),p=h("ion-item"),c=h("ion-list"),g=h("line-chart"),D=h("ion-row"),j=h("ion-grid");return v(),_(j,null,{default:m((()=>[f(D,null,{default:m((()=>[f(o,{size:"6",offset:"6",class:"ion-padding"},{default:m((()=>[y("div",P,[f(s,{modelValue:t.startDate,"onUpdate:modelValue":e[0]||(e[0]=e=>t.startDate=e),placeholder:"Start Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),f(s,{modelValue:t.endDate,"onUpdate:modelValue":e[1]||(e[1]=e=>t.endDate=e),placeholder:"End Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),f(r,{color:"primary",class:"ion-no-margin",onClick:t.fetchData},{default:m((()=>e[6]||(e[6]=[w("Generate")]))),_:1},8,["onClick"])])])),_:1}),f(o,{size:"3",class:"ion-padding-top"},{default:m((()=>[y("div",R,[f(c,null,{default:m((()=>[f(p,{button:"",onClick:e[2]||(e[2]=e=>t.drilldown(t.totalAttendance,"Total Attendance"))},{default:m((()=>[f(d,null,{default:m((()=>e[7]||(e[7]=[w("Total Attendance ")]))),_:1}),f(u,null,{default:m((()=>[w(V(t.totalAttendance.length),1)])),_:1})])),_:1}),f(p,{button:"",onClick:e[3]||(e[3]=e=>t.drilldown(t.totalPatientVisits,"Total patient visits"))},{default:m((()=>[f(d,null,{default:m((()=>e[8]||(e[8]=[w("Patient Visit ")]))),_:1}),f(u,null,{default:m((()=>[w(V(t.totalPatientVisits.length),1)])),_:1})])),_:1}),f(p,{button:"",onClick:e[4]||(e[4]=e=>t.drilldown(t.totalGuardianVisits,"Total guardian visits"))},{default:m((()=>[f(d,null,{default:m((()=>e[9]||(e[9]=[w("Guardian Visit ")]))),_:1}),f(u,null,{default:m((()=>[w(V(t.totalGuardianVisits.length),1)])),_:1})])),_:1}),f(p,{button:"",onClick:e[5]||(e[5]=e=>t.drilldown(t.totalBothVisits,"Total patient and guardian visits"))},{default:m((()=>[f(d,null,{default:m((()=>e[10]||(e[10]=[w("Patient and Guardian Visit ")]))),_:1}),f(u,null,{default:m((()=>[w(V(t.totalBothVisits.length),1)])),_:1})])),_:1})])),_:1})])])),_:1}),f(o,{size:"9"},{default:m((()=>[f(g,{style:{height:"600px"},series:t.series,options:t.options,onPointSelection:t.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])])),_:1})])),_:1})])),_:1})}]]))}}}));
