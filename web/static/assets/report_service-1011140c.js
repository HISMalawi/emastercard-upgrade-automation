var m=Object.defineProperty;var g=(i,t,e)=>t in i?m(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>(g(i,typeof t!="symbol"?t+"":t,e),e);import{P as Q}from"./index-95d3a767.js";import{a as b}from"./arrays-7f14d286.js";import{H as u,d as F}from"./his_date-3ca53c6f.js";import{p as D}from"./url-ffe761c9.js";import{l as f}from"./index-1c16650e.js";class w{constructor(){o(this,"date");o(this,"startDate");o(this,"endDate");o(this,"programId");o(this,"useDefaultParams");this.programId=Q,this.date=u.today(),this.endDate="",this.startDate="",this.useDefaultParams=!0}setDate(t){this.date=u.toStandardFmt(t)}setStartDate(t){this.startDate=u.toStandardFmt(t)}setEndDate(t){this.endDate=u.toStandardFmt(t)}getDateIntervalPeriod(){return this.startDate&&this.endDate?"".concat(u.toDisplayFmt(this.startDate)," - ").concat(u.toDisplayFmt(this.endDate)):"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),t&&(e={...e,...t}),e}async getReport(t,e){const a=await f.getJson(D(t,this.buildParams(e)));if(a.ok)return a.data}static getReportQuarters(t=5){const e=[];let a=new Date,s=a.getFullYear();const n=s;a=new Date("".concat(n,"-").concat(a.getMonth()+1,"-").concat(a.getDate()," 00:00"));let r=this.getQtrByDate(a).qtr,d=0;for(r===4&&e.push(this.buildQtrObj("Q1",s+1));d<t;)d===0&&r<4&&e.push(this.buildQtrObj("Q".concat(r+1),s)),e.push(this.buildQtrObj("Q".concat(r),s)),r=r>0?r-=1:r,s=r==0?s-1:s,r=r==0?r+=4:r,d++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const a in e){const{start:s,end:n}=e[a];if(t>=new Date(s)&&t<=new Date(n))return e[a]}return null}static buildQtrObj(t,e){const a=this.getQuarterBounds(e),{start:s,end:n}=a[t];return{start:s,end:n,name:"".concat(t," ").concat(e)}}static getQuarterBounds(t){const e=n=>F("".concat(t,"-").concat(n,"-01")).daysInMonth(),a=n=>"".concat(t,"-").concat(n,"-01 00:00"),s=n=>"".concat(t,"-").concat(n,"-").concat(e(n)," 00:00");return{Q1:{qtr:1,start:a("01"),end:s("03")},Q2:{qtr:2,start:a("04"),end:s("06")},Q3:{qtr:3,start:a("07"),end:s("09")},Q4:{qtr:4,start:a("10"),end:s("12")}}}async getMaternalStatus(t,e="pepfar"){var n;const a=D("vl_maternal_status",this.buildParams({report_definition:e}));return(n=(await f.postJson(a,{patient_ids:t})).data)!=null?n:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const a=b(Object.values(t).flat(1).map(r=>r instanceof Object?r.patient_id:r)),s=Object.keys(t),n=await this.getMaternalStatus(a,e),l=n.FBf.concat(n.FP);return["FP","FNP","FBf"].map(r=>s.reduce((d,h)=>({[h]:t[h].filter(c=>{const p=c instanceof Object?c.patient_id:c;return r==="FNP"?!l.includes(p):n[r].includes(p)}),...d}),{ageGroup:"All",gender:r}))}}export{w as R};
