System.register(["./index-legacy-f8d71896.js","./patient_service-legacy-209f46d1.js","./_plugin-vue_export-helper-legacy-762b7923.js","./toasts-legacy-f5cd9c9b.js","./patient_identifier_service-legacy-4a509042.js","./his_date-legacy-fa5a22a7.js","./index-legacy-aa705205.js","./Date-legacy-d9d8cd0f.js","./common-legacy-0d7df615.js"],(function(e,t){"use strict";var a,i,n,l,r,s,o,d,c,u,g,m,h,p,y,b,v,f,_,C,k,w,D,V,I,x;return{setters:[e=>{a=e.d,i=e.c,n=e.f,l=e.b,r=e.t,s=e.ag,o=e.o,d=e.i,c=e.j,u=e.k,g=e.ah,m=e.g,h=e.ae,p=e.H,y=e.ai,b=e.F,v=e.L,f=e.h,_=e.w,C=e.a,k=e.N,w=e.A,D=e.K},e=>{V=e.P},e=>{I=e._},e=>{x=e.b},null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent=".his-card[data-v-db98b469]{padding:0;margin:3%}li[data-v-db98b469]{padding:0;margin:0;list-style:none}.box{border-color:#a3a3a3;border-width:thin;border-style:solid;border-radius:3px}.searchBtn{height:50px!important;margin-top:0;margin-bottom:0;margin-right:.5rem}.sc-ion-searchbar-md-h{--box-shadow: none !important}\n",document.head.appendChild(t);const A=a({props:{patient:{type:Object,required:!0},isActive:{type:Boolean}},computed:{stateClass(){return{"active-card-color":this.isActive,"inactive-card-color":!this.isActive}}}}),j=a({components:{IonGrid:d,IonRow:c,IonCol:u,PatientCard:I(A,[["render",function(e,t,a,d,c,u){return o(),i("div",{class:s(["his-card clickable",e.stateClass])},[n("li",null,[n("ul",null,[l(" NPID : "),n("b",null,r(e.patient.npid),1)]),n("ul",null,[l(" Arv# : "),n("b",null,r(e.patient.arvNum),1)]),n("ul",null,[l(" Name : "),n("b",null,r(e.patient.name),1)]),n("ul",null,[l(" Birth date : "),n("b",null,r(e.patient.birthdate),1)]),n("ul",null,[l(" Gender : "),n("b",null,r(e.patient.gender),1)]),n("ul",null,[l(" Home District : "),n("b",null,r(e.patient.homeDistrict),1)]),n("ul",null,[l(" Home Village : "),n("b",null,r(e.patient.homeVillage),1)]),n("ul",null,[l(" Current District : "),n("b",null,r(e.patient.currentDistrict),1)]),n("ul",null,[l(" Current Village : "),n("b",null,r(e.patient.currentVillage),1)])])],2)}],["__scopeId","data-v-db98b469"]]),IonSearchbar:g},setup(){const e=m(),{facility:t}=b(),a=h([{category:"primary",query:"",results:[]},{category:"secondary",query:"",results:[]}]),i=p((()=>a.every((e=>e.results.length>0&&e.results.some((e=>e.isChecked))))));return{patients:a,enableMergeBtn:i,searchPatient:async e=>{if(e.query)try{const{type:a,value:i}=await(async e=>e.match(/^(\w+-ARV-\w+)$/)?{type:"arv_number",value:e}:e.match(/^(\d+)$/)?{type:"arv_number",value:`${t.code}-ARV-${e}`}:{type:"name",value:e})(e.query);let n;n="name"===a?(await V.search((e=>{const t={},a=e.split(" ").filter((e=>/\S/.test(e)));return a.length>0&&(t.given_name=a[0],a[1]&&(t.family_name=a[1]),a[2]&&(t.middle_name=a[1],t.family_name=a[2])),t})(i))).data:"arv_number"===a?(await V.findByOtherID(4,i)).data:[],e.results=n.map(((e,t)=>{const a=new V(e);return{index:t,id:a.getID(),name:a.getFullName(),docID:a.getDocID(),birthdate:a.getBirthdate(),arvNum:a.getArvNumber(),npid:a.getNationalID(),gender:a.getGender(),homeDistrict:a.getHomeDistrict(),homeVillage:a.getHomeVillage(),currentDistrict:a.getCurrentDistrict(),currentVillage:a.getCurrentVillage(),isChecked:!1}}))}catch(a){console.log(`${a}`)}},onPatient:(e,t)=>{if("primary"===t)a[0].results.forEach((t=>{t.id===e.id?t.isChecked=!t.isChecked:t.isChecked=!1})),e.isChecked&&a[1].results.forEach((t=>{t.id===e.id&&(t.isChecked=!1)}));else{if(e.isChecked)return e.isChecked=!1;e.isChecked=!a[0].results.some((t=>t.isChecked&&t.id===e.id))}},merge:async()=>{if(await y("Are you sure you want to merge these patients?"))try{var t;const i=a[0].results.find((e=>e.isChecked)),n=await V.mergePatients({primary:{patient_id:i.id,doc_id:i.docID},secondary:a[1].results.filter((e=>e.isChecked)).map((e=>({patient_id:e.id,doc_id:e.docID})))});if(!n.ok)throw new Error("Unable to merge Patients");const l=null===(t=n.data)||void 0===t?void 0:t.patient_id;e.push({name:"EMC Mastercard",params:{patientId:l}})}catch(i){x(`${i}`)}}}}}),P={class:"ion-margin-start"};e("default",I(j,[["render",function(e,t,a,s,d,c){const u=v("ion-button"),g=v("ion-col"),m=v("ion-card-title"),h=v("ion-searchbar"),p=v("ion-card-header"),y=v("patient-card"),b=v("ion-card-content"),V=v("ion-card"),I=v("ion-row"),x=v("ion-grid");return o(),f(x,null,{default:_((()=>[C(I,null,{default:_((()=>[C(g,{size:"12",class:"padding"},{default:_((()=>[n("h2",P,[l(" Patient Merging "),C(u,{class:"ion-float-right ion-margin-end",disabled:!e.enableMergeBtn,onClick:e.merge},{default:_((()=>[l(" Merge Selected Patients ")])),_:1},8,["disabled","onClick"])])])),_:1}),(o(!0),i(D,null,k(e.patients,(t=>(o(),f(g,{size:"6",key:t.category},{default:_((()=>[C(V,null,{default:_((()=>[C(p,{color:"light"},{default:_((()=>[C(m,{class:"ion-margin-bottom"},{default:_((()=>[l(r(t.category)+" patients ",1)])),_:2},1024),C(h,{style:{width:"100%",height:"45px"},class:"box-input ion-no-padding ion-margin-end",placeholder:"Type Name or ARV Number and press enter",modelValue:t.query,"onUpdate:modelValue":e=>t.query=e,onKeyup:w((a=>e.searchPatient(t)),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1024),C(b,{color:"light",style:{height:"70vh","overflow-y":"auto"}},{default:_((()=>[(o(!0),i(D,null,k(t.results,((a,i)=>(o(),f(y,{onClick:i=>e.onPatient(a,t.category),key:i,patient:a,isActive:a.isChecked},null,8,["onClick","patient","isActive"])))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})}]]))}}}));
