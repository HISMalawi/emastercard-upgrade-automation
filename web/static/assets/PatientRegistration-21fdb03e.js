import{d as R,i as A,am as C,o as $,c as O,e as t,w as i,u as b,x as E,a3 as H,b as _,t as W,V as Y,H as j,I as J,v as K,N as Q,m as X,n as Z,p as x,aB as ee,g as ae,r as F,ak as B,a9 as te,aq as oe,aC as ne,aD as z,aE as le,ar as ie,_ as re,O as p,k as se,a as P}from"./index-7e67e09a.js";import{P as me,R as de}from"./relations_service-e77cd65b.js";import{T as ue}from"./TextInput-75cc79e7.js";import{_ as pe}from"./DateInput.vue_vue_type_style_index_0_lang-94985f2a.js";import{S as ce}from"./SelectInput-5352ce6f.js";import{a as fe,b as ge}from"./location_options-b7c05298.js";import{i as S,r as T}from"./form-29a73a0f.js";import{a as be}from"./Strs-0c962638.js";import{l as y}from"./loader-821d5697.js";import{E as Ne,a as he}from"./emc_event-4721851b.js";import{a as w,b as ve,c as q}from"./validations-a519297e.js";import{t as Ve,a as ye}from"./his_date-dee67c99.js";import{t as we}from"./toasts-a957f433.js";import{P as _e}from"./patient_identifier_service-876099fa.js";import{t as ke,i as Ie}from"./common-abc2f84d.js";import{D as Pe}from"./index-1c16c848.js";import"./vue-datepicker-5f312013.js";const De=R({__name:"PatientMatch",props:{matchedPatients:{type:Array,required:!0},person:{type:Object,required:!0}},setup(o){const a=o,g=A(()=>"Possible Matches Found (".concat(a.matchedPatients.length,") for ").concat(a.person.given_name," ").concat(a.person.family_name)),k=A(()=>a.matchedPatients.map(({score:f,person:d})=>({name:"".concat(d.given_name," ").concat(d.family_name),...d,score:Number(f*100)+"%"}))),I=[{path:"name",label:"Name"},{path:"score",label:"Score"},{path:"gender",label:"Gender",formatter:ke},{path:"birthdate",label:"Birthdate",formatter:Ve},{path:"home_village",label:"Home Village"},{path:"home_traditional_authority",label:"Home T/A"},{path:"home_district",label:"Home District"}],c=[{label:"Select",color:"primary",action:C.hide}];function n(){return C.hide()}return(f,d)=>($(),O(Q,null,[t(b(Y),null,{default:i(()=>[t(b(E),null,{default:i(()=>[t(b(H),null,{default:i(()=>[_(W(g.value),1)]),_:1})]),_:1})]),_:1}),t(b(j),{class:"ion-padding-top"},{default:i(()=>[t(b(Pe),{color:"light",rows:k.value,columns:I,"row-actions-buttons":c,config:{showSearchField:!1,showSubmitButton:!1}},null,8,["rows"])]),_:1}),t(b(K),null,{default:i(()=>[t(b(E),null,{default:i(()=>[t(b(J),{slot:"end",onClick:n,color:"primary"},{default:i(()=>[...d[0]||(d[0]=[_(" Register as New Patient ",-1)])]),_:1})]),_:1})]),_:1})],64))}}),Ce=R({components:{IonGrid:X,IonRow:Z,IonCol:x,TextInput:ue,DateInput:pe,SelectInput:ce,IonCheckbox:ee},setup(){const o=ae(),a=F(!1),g=F(!1),k=fe(),I=[{label:"Male",value:"M"},{label:"Female",value:"F"}],c=B({givenName:{label:"First Name",value:"",placeholder:"Enter First Name",required:!0,validation:e=>w(e)},familyName:{label:"Last Name",value:"",placeholder:"Enter Last Name",required:!0,validation:e=>w(e)},middleName:{label:"Middle Name",value:"",placeholder:"Enter middle Name",validation:e=>e&&e.label?w(e):null},nationalId:{label:"Malawi National ID Number",value:"",placeholder:"Enter Malawi National ID Number",validation:e=>e&&e.label?ve(e):null},gender:{value:"",required:!0,label:"Gender",placeholder:"select gender"},birthdate:{value:"",label:"Date of Birth",required:!0},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",placeholder:"Enter cellphone number e.g. 0991234567",validation:async e=>e.value!=="Unknown"&&q(e)},homeVillage:{value:"",label:"Home Village",placeholder:"Home Village",required:!0},landmark:{value:"",label:"Landmark",placeholder:"Closest Landmark or Plot Number",required:!0}}),n=B({givenName:{label:"First Name",value:"",placeholder:"Enter First Name",required:!0,validation:e=>w(e)},familyName:{label:"Last Name",value:"",placeholder:"Enter Last Name",required:!0,validation:e=>w(e)},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",placeholder:"Enter cellphone number e.g. 0991234567",validation:async e=>e.value!=="Unknown"&&q(e)}});te(g,e=>{e?(n.givenName.value="Unknown",n.familyName.value="Unknown",n.cellPhoneNumber.value="Unknown",n.givenName.disabled=!0,n.familyName.disabled=!0,n.givenName.error="",n.familyName.error="",n.cellPhoneNumber.error=""):(n.givenName.value="",n.familyName.value="",n.cellPhoneNumber.value="",n.givenName.disabled=!1,n.familyName.disabled=!1)});const f=async()=>{if(await oe("Are you sure you want to clear all fields?")){for(const e in c)c[e].value=void 0,c[e].error="";for(const e in n)n[e].value=void 0,n[e].error="";Ne.emit(he.ON_CLEAR)}},d=(e,s={})=>{const r={facility_name:null,occupation:null};for(const m in e)r[be(m)]=e[m];return{...r,...s}},u=async e=>{var m,l,v,V,N;let s,r;try{(m=e==null?void 0:e.other)!=null&&m.traditional_authority_id&&(s=await z.getTraditionalAuthorityById(e.other.traditional_authority_id)),s&&(r=await z.getDistrictByID(s.district_id))}catch(D){we("Unable to resolve client address. Saving using default address"),console.error(D)}return{home_district:(l=r==null?void 0:r.name)!=null?l:"N/A",home_traditional_authority:(v=s==null?void 0:s.name)!=null?v:"N/A",home_village:(e==null?void 0:e.label)||"N/A",current_district:(V=r==null?void 0:r.name)!=null?V:"N/A",current_traditional_authority:(N=s==null?void 0:s.name)!=null?N:"N/A",current_village:(e==null?void 0:e.label)||"N/A"}},h=async e=>{var r;const s=new le(ie);try{const m=await s.checkPotentialDuplicates(e);if(m.ok&&((r=m.data)==null?void 0:r.length)>0)return C.show(De,{matchedPatients:m.data,person:e},"custom-summary-modal",!1)}catch(m){console.error(m)}};return{today:ye,patient:c,guardian:n,landmarks:k,genderOptions:I,guardianAbsent:g,isBirthdateEstimated:a,onClear:f,onFinish:async()=>{const e=await S(c),s=g.value?!0:await S(n);if(e&&s)try{y.show("Checking for possible duplicates...");const r=T(c).formData,m=new me,l=await u(r.homeVillage),v=d(r,{...l,isPatient:!0,patient_type:null,gender:r.gender.value,landmark:r.landmark.value,birthdate_estimated:a.value?"Yes":"No",relationship:g.value?"No":"Yes"});y.hide();const V=await h(v);if(!Ie(V))return o.push("/patient/".concat(V.patient_id));await y.show("Saving..."),await m.createPerson(v),await m.createPatient();const N=m.getPersonID();if(r.nationalId&&await _e.create(N,ne,r.nationalId),!g.value&&s){const{formData:D}=T(n),L=await u(),M=d(D,{...L,middle_name:"",gender:"N/A",birthdate:"N/A",birthdate_estimated:"N/A",landmark:"N/A",relationship:"N/A",patient_type:"",isPatient:!1,patient_id:N});await m.registerGuardian(M);const G=m.getPersonID();await de.createRelation(N,G,13)}o.push("/patient/reception/".concat(N,"/true")),y.hide()}catch(r){console.log(r),y.hide()}},getVillagesByName:ge}}}),Ue={class:"ion-margin-start checkbox-label"};function Ae(o,a,g,k,I,c){const n=p("ion-col"),f=p("ion-row"),d=p("ion-title"),u=p("TextInput"),h=p("SelectInput"),U=p("DateInput"),e=p("ion-checkbox"),s=p("ion-button"),r=p("ion-grid"),m=p("Layout");return $(),se(m,null,{default:i(()=>[t(r,null,{default:i(()=>[t(f,null,{default:i(()=>[t(n,{class:"ion-margin-bottom"},{default:i(()=>[...a[14]||(a[14]=[P("h1",null,"New Patient Registration",-1)])]),_:1})]),_:1}),t(f,{class:"his-card"},{default:i(()=>[t(n,{size:"12"},{default:i(()=>[t(d,{class:"ion-text-center ion-margin-vertical"},{default:i(()=>[...a[15]||(a[15]=[P("b",null,"Personal Details",-1)])]),_:1}),t(f,{class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(n,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(u,{modelValue:o.patient.givenName,"onUpdate:modelValue":a[0]||(a[0]=l=>o.patient.givenName=l)},null,8,["modelValue"])]),_:1}),t(n,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(u,{modelValue:o.patient.middleName,"onUpdate:modelValue":a[1]||(a[1]=l=>o.patient.middleName=l)},null,8,["modelValue"])]),_:1}),t(n,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(u,{modelValue:o.patient.familyName,"onUpdate:modelValue":a[2]||(a[2]=l=>o.patient.familyName=l)},null,8,["modelValue"])]),_:1}),t(n,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(u,{modelValue:o.patient.nationalId,"onUpdate:modelValue":a[3]||(a[3]=l=>o.patient.nationalId=l)},null,8,["modelValue"])]),_:1}),t(n,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(h,{modelValue:o.patient.gender,"onUpdate:modelValue":a[4]||(a[4]=l=>o.patient.gender=l),options:o.genderOptions},null,8,["modelValue","options"])]),_:1}),t(n,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(u,{modelValue:o.patient.cellPhoneNumber,"onUpdate:modelValue":a[5]||(a[5]=l=>o.patient.cellPhoneNumber=l),allowUnknown:""},null,8,["modelValue"])]),_:1}),t(n,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(U,{modelValue:o.patient.birthdate,"onUpdate:modelValue":a[6]||(a[6]=l=>o.patient.birthdate=l),allowEstimation:!0,estimationLabel:"Estimate Age",minDate:"1920-01-01",maxDate:o.today(),onIsEstimated:a[7]||(a[7]=l=>o.isBirthdateEstimated=l)},null,8,["modelValue","maxDate"])]),_:1}),t(n,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(h,{modelValue:o.patient.homeVillage,"onUpdate:modelValue":a[8]||(a[8]=l=>o.patient.homeVillage=l),asyncOptions:o.getVillagesByName,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1}),t(n,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(h,{modelValue:o.patient.landmark,"onUpdate:modelValue":a[9]||(a[9]=l=>o.patient.landmark=l),options:o.landmarks,allowCustom:""},null,8,["modelValue","options"])]),_:1})]),_:1}),t(d,{class:"ion-text-center ion-margin-vertical ion-padding-top"},{default:i(()=>[a[17]||(a[17]=P("b",null,"Guardian details",-1)),P("span",Ue,[a[16]||(a[16]=_(" Guardian Details Unknown? ",-1)),t(e,{modelValue:o.guardianAbsent,"onUpdate:modelValue":a[10]||(a[10]=l=>o.guardianAbsent=l)},null,8,["modelValue"])])]),_:1}),t(f,{class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(n,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(u,{modelValue:o.guardian.givenName,"onUpdate:modelValue":a[11]||(a[11]=l=>o.guardian.givenName=l)},null,8,["modelValue"])]),_:1}),t(n,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(u,{modelValue:o.guardian.familyName,"onUpdate:modelValue":a[12]||(a[12]=l=>o.guardian.familyName=l)},null,8,["modelValue"])]),_:1}),t(n,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:i(()=>[t(u,{modelValue:o.guardian.cellPhoneNumber,"onUpdate:modelValue":a[13]||(a[13]=l=>o.guardian.cellPhoneNumber=l),allowUnknown:""},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{class:"ion-margin-top ion-float-right",onClick:o.onFinish,size:"large",color:"success"},{default:i(()=>[...a[18]||(a[18]=[_("Finish",-1)])]),_:1},8,["onClick"]),t(s,{class:"ion-margin-top ion-float-right",onClick:o.onClear,size:"large",color:"warning"},{default:i(()=>[...a[19]||(a[19]=[_("Clear",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})}const Je=re(Ce,[["render",Ae]]);export{Je as default};
