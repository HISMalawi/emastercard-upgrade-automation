import{K as E}from"./vue-datepicker-7c4021ca.js";import{_ as I}from"./LineChart.vue_vue_type_script_setup_true_lang-fed34691.js";import{G as b,d as N,i as O,j as L,k as j,r as R,H as V,L as u,h as z,w as a,o as J,a as o,f as G,b as d,t as w}from"./index-a3fc2e12.js";import{i as U}from"./common-abc2f84d.js";import{P as m}from"./index-95d3a767.js";import{R as K}from"./report_service-ee0f5881.js";import{l as A}from"./loader-1c88a23f.js";import{m as W,D as F}from"./DrilldownTable-df83cd6e.js";import{i as H}from"./his_date-1bddad28.js";import{t as M}from"./toasts-d882244a.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import"./arrays-31d2d38b.js";import"./url-ffe761c9.js";import"./index-b8a0d675.js";class Q extends K{constructor(){super()}static getLocationName(){return sessionStorage.getItem("locationName")}getBookedAppointments(n){return b.getJson("programs/".concat(m,"/scheduled_appointments"),{date:n})}getViralLoadResults(n){return this.getReport("/programs/".concat(m,"/reports/high_vl_patients"),{range:n})}getOtherOutcome(n){return this.getReport("patient_outcome_list",{outcome:n})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport("/programs/".concat(m,"/reports/retention"))}getExternalConsultationClients(){return this.getReport("".concat(m,"/external_consultation_clients"))}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport("/programs/".concat(m,"/reports/pregnant_patients"))}getArchivingCandidates(){return b.getJson("programs/".concat(m,"/reports/archiving_candidates"),{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}getVisitStats(){return b.getJson("programs/".concat(m,"/reports/visits"),{name:"visits",start_date:this.startDate,end_date:this.endDate})}}const X=N({components:{LineChart:I,IonGrid:O,IonRow:L,IonCol:j,VueDatePicker:E},setup(){const t=R(""),n=R(""),l=R([]),C=V(()=>{var e;return((e=l.value[0])==null?void 0:e.raw.flat())||[]}),S=V(()=>{var e;return((e=l.value[1])==null?void 0:e.raw.flat())||[]}),$=V(()=>{var e;return((e=l.value[2])==null?void 0:e.raw.flat())||[]}),v=V(()=>l.value.map(({raw:e})=>e).flat(3)),y={title:{text:"Patient Visits Statistics",align:"left"},yaxis:{title:{text:"Number of clients"}}},_=e=>{const r={},p={},f={},s=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(e).forEach(([i,B])=>{r[i]=[],p[i]=[],f[i]=[],Object.entries(B).forEach(([P,{patient_present:k,guardian_present:T}])=>{T&&k?f[i].push({patientId:P,date:i}):k?r[i].push({patientId:P,date:i}):T&&p[i].push({patientId:P,date:i})});const D=new Date(i).getTime();s[0].data.push([D,r[i].length]),s[0].raw.push(r[i]),s[1].data.push([D,p[i].length]),s[1].raw.push(p[i]),s[2].data.push([D,f[i].length]),s[2].raw.push(f[i])}),s},g=async()=>{if(!H(t.value,n.value))return M("Invalid date range");try{A.show();const e=new Q;e.setStartDate(t.value),e.setEndDate(n.value);const r=await e.getPatientVisitTypes();l.value=_(r)}catch(e){console.error(e),M("Unable to generate patient visits data")}A.hide()},c=async(e,r="Drill down clients")=>{await W.show(F,{patientIds:e.map(({patientId:p})=>p),title:r})};return{startDate:t,endDate:n,series:l,options:y,totalAttendance:v,totalPatientVisits:C,totalGuardianVisits:S,totalBothVisits:$,fetchData:g,pointSelection:async(e,r)=>{if(!U(l.value))try{await c(l.value[r].raw[e],"".concat(l.value[r].name," visits"))}catch(p){console.error(p)}},drilldown:c}}}),Y={style:{display:"flex","justify-content":"flex-start"}},Z={class:"his-card"};function x(t,n,l,C,S,$){const v=u("vue-date-picker"),y=u("ion-button"),_=u("ion-col"),g=u("ion-label"),c=u("ion-badge"),h=u("ion-item"),e=u("ion-list"),r=u("line-chart"),p=u("ion-row"),f=u("ion-grid");return J(),z(f,null,{default:a(()=>[o(p,null,{default:a(()=>[o(_,{size:"6",offset:"6",class:"ion-padding"},{default:a(()=>[G("div",Y,[o(v,{modelValue:t.startDate,"onUpdate:modelValue":n[0]||(n[0]=s=>t.startDate=s),placeholder:"Start Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),o(v,{modelValue:t.endDate,"onUpdate:modelValue":n[1]||(n[1]=s=>t.endDate=s),placeholder:"End Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),o(y,{color:"primary",class:"ion-no-margin",onClick:t.fetchData},{default:a(()=>[d("Generate")]),_:1},8,["onClick"])])]),_:1}),o(_,{size:"3",class:"ion-padding-top"},{default:a(()=>[G("div",Z,[o(e,null,{default:a(()=>[o(h,{button:"",onClick:n[2]||(n[2]=s=>t.drilldown(t.totalAttendance,"Total Attendance"))},{default:a(()=>[o(g,null,{default:a(()=>[d("Total Attendance ")]),_:1}),o(c,null,{default:a(()=>[d(w(t.totalAttendance.length),1)]),_:1})]),_:1}),o(h,{button:"",onClick:n[3]||(n[3]=s=>t.drilldown(t.totalPatientVisits,"Total patient visits"))},{default:a(()=>[o(g,null,{default:a(()=>[d("Patient Visit ")]),_:1}),o(c,null,{default:a(()=>[d(w(t.totalPatientVisits.length),1)]),_:1})]),_:1}),o(h,{button:"",onClick:n[4]||(n[4]=s=>t.drilldown(t.totalGuardianVisits,"Total guardian visits"))},{default:a(()=>[o(g,null,{default:a(()=>[d("Guardian Visit ")]),_:1}),o(c,null,{default:a(()=>[d(w(t.totalGuardianVisits.length),1)]),_:1})]),_:1}),o(h,{button:"",onClick:n[5]||(n[5]=s=>t.drilldown(t.totalBothVisits,"Total patient and guardian visits"))},{default:a(()=>[o(g,null,{default:a(()=>[d("Patient and Guardian Visit ")]),_:1}),o(c,null,{default:a(()=>[d(w(t.totalBothVisits.length),1)]),_:1})]),_:1})]),_:1})])]),_:1}),o(_,{size:"9"},{default:a(()=>[o(r,{style:{height:"600px"},series:t.series,options:t.options,onPointSelection:t.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})}const gt=q(X,[["render",x]]);export{gt as default};
