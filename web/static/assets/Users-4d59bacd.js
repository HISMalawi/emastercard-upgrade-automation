import{_ as z}from"./ReportTable.vue_vue_type_script_setup_true_lang-4a26db6e.js";import{U as f}from"./user_service-6bb4c9c3.js";import{d as h,I as E,D as O,S as L,C as M,q as j,Z as J,n as K,$ as W,v as Z,r as $,H as G,ae as Q,a2 as C,aJ as X,L as l,o as B,h as S,w as s,a as n,b,t as Y,aK as x,aL as ee,ai as oe,aM as ae}from"./index-9d5e84a5.js";import{m as I}from"./DrilldownTable-696672fe.js";import{T as ne}from"./TextInput-196eb5a4.js";import{S as te}from"./SelectInput-c163deec.js";import{i as re,r as se}from"./form-42211d1f.js";import{i as p,g}from"./common-8a0477e8.js";import{t as y,a as le}from"./toasts-a30647ed.js";import{R as ie}from"./services-f7c3fb9d.js";import{a as U}from"./validations-674ed7bf.js";import{_ as N}from"./_plugin-vue_export-helper-c27b6911.js";import{H as me}from"./Date-ea5dfce1.js";import"./exports-ecad058b.js";import"./index-fca9b4d0.js";import"./his_date-68cf9d33.js";import"./vue-datepicker-7955ae14.js";import"./arrays-d6bc15b2.js";import"./index-95d3a767.js";import"./Strs-7ee8a435.js";import"./loader-161c88b9.js";const ue=h({name:"UserModal",components:{IonButton:E,IonPage:O,IonHeader:L,IonContent:M,IonToolbar:j,IonButtons:J,IonFooter:K,IonTitle:W,IonIcon:Z,TextInput:ne,SelectInput:te},props:{user:{type:Object,default:()=>({})}},setup(e){var a,r;const t=$([]),c=G(()=>p(e.user)?"Add New User":"Edit User"),d=Q({givenName:{value:g(e.user,"person.names[0].given_name",""),label:"First Name",required:!0,validation:o=>U(o)},familyName:{validation:o=>U(o),value:g(e.user,"person.names[0].family_name",""),label:"Last Name",required:!0},username:{value:g(e.user,"username",""),label:"Username",required:!0,disabled:!p(e.user),validation:async o=>"".concat(o.value).length<4?["Username must be at least 4 characters long"]:null},password:{value:"",label:"Password",required:p(e.user),validation:async({value:o})=>o&&"".concat(o).length<6?["Password must be at least 6 characters long"]:null},confirmPassword:{value:"",label:"Confirm Password",required:p(e.user),validation:async({value:o},i)=>o&&o!==i.password.value?["Passwords not matching"]:null},roles:{value:((r=(a=e.user)==null?void 0:a.roles)==null?void 0:r.map(o=>({label:o.role,value:o.role,other:o})))||[],label:"Roles",placeholder:"Select Roles",required:!0}}),_=async()=>{if(!await re(d))return;const{formData:o}=se(d,!0);let i={...o,roles:o.roles.map(u=>u.label)};try{p(e.user)?i=await f.createUser(i):i=await f.updateUser(e.user.user_id,i),I.hide(i)}catch(u){if(u instanceof ie)return d.username.error="Username already exists";y(JSON.stringify(u),2e3)}};return C(()=>{f.getAllRoles().then(o=>{const i=Array.isArray(o.data)?o.data:[];t.value=i==null?void 0:i.map(u=>({value:u.role,label:u.role,other:u}))})}),{form:d,close:X,modal:I,roles:t,title:c,submit:_}}});function de(e,t,c,d,_,a){const r=l("IonIcon"),o=l("IonButton"),i=l("IonButtons"),u=l("IonTitle"),A=l("IonToolbar"),T=l("IonHeader"),D=l("text-input"),v=l("ion-col"),w=l("TextInput"),F=l("SelectInput"),P=l("ion-row"),k=l("ion-grid"),R=l("IonContent"),q=l("IonFooter"),H=l("IonPage");return B(),S(H,null,{default:s(()=>[n(T,null,{default:s(()=>[n(A,null,{default:s(()=>[n(i,{slot:"end"},{default:s(()=>[n(o,{slot:"end",onClick:t[0]||(t[0]=m=>e.modal.hide()),"icon-only":""},{default:s(()=>[n(r,{icon:e.close},null,8,["icon"])]),_:1})]),_:1}),n(u,null,{default:s(()=>[b(Y(e.title),1)]),_:1})]),_:1})]),_:1}),n(R,null,{default:s(()=>[n(k,null,{default:s(()=>[n(P,null,{default:s(()=>[n(v,{size:"12",class:"ion-margin-vertical"},{default:s(()=>[n(D,{modelValue:e.form.username,"onUpdate:modelValue":t[1]||(t[1]=m=>e.form.username=m)},null,8,["modelValue"])]),_:1}),n(v,{size:"6",class:"ion-margin-vertical"},{default:s(()=>[n(w,{modelValue:e.form.password,"onUpdate:modelValue":t[2]||(t[2]=m=>e.form.password=m),password:""},null,8,["modelValue"])]),_:1}),n(v,{size:"6",class:"ion-margin-vertical"},{default:s(()=>[n(w,{modelValue:e.form.confirmPassword,"onUpdate:modelValue":t[3]||(t[3]=m=>e.form.confirmPassword=m),form:e.form,password:""},null,8,["modelValue","form"])]),_:1}),n(v,{size:"12",class:"ion-margin-vertical"},{default:s(()=>[n(F,{modelValue:e.form.roles,"onUpdate:modelValue":t[4]||(t[4]=m=>e.form.roles=m),options:e.roles,multiple:""},null,8,["modelValue","options"])]),_:1}),n(v,{size:"12",class:"ion-margin-vertical"},{default:s(()=>[n(w,{modelValue:e.form.givenName,"onUpdate:modelValue":t[5]||(t[5]=m=>e.form.givenName=m)},null,8,["modelValue"])]),_:1}),n(v,{size:"12",class:"ion-margin-vertical"},{default:s(()=>[n(w,{modelValue:e.form.familyName,"onUpdate:modelValue":t[6]||(t[6]=m=>e.form.familyName=m)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),n(q,null,{default:s(()=>[n(o,{class:"ion-margin-end ion-margin-vertical ion-float-right",onClick:e.submit},{default:s(()=>[b("Save")]),_:1},8,["onClick"]),n(o,{class:"ion-margin-vertical ion-float-right",color:"light",onClick:t[7]||(t[7]=m=>e.modal.hide())},{default:s(()=>[b("Close")]),_:1})]),_:1})]),_:1})}const V=N(ue,[["render",de]]),ce=h({name:"Users",components:{BaseReportTable:z},setup(){const e=$([]),t=[{path:"username",label:"Username",initialSort:!0,initialSortOrder:"asc"},{path:"given_name",label:"First name"},{path:"family_name",label:"Last name"},{path:"role",label:"Roles"},{path:"deactivated_on",label:"Deactivated On",formatter:me.toStandardHisDisplayFormat}],c=a=>{try{return{given_name:g(a,"person.names[0].given_name","Unknown"),family_name:g(a,"person.names[0].family_name","Unknown"),role:a.roles.map(o=>o.role).join(", "),...a}}catch(r){return console.error("Error occurred while processing user details:",r),null}},d=[{icon:x,action:async a=>{const r=await I.show(V,{user:a});p(r)||Object.assign(a,c(r.data))}},{color:"danger",icon:ee,condition:a=>a.deactivated_on===null,action:async a=>{if(await oe("Are you sure you want to deactivate this user?"))try{const{user:r}=await(await f.deactivateUser(a.user_id)).data;a.deactivated_on=r.deactivated_on,le("User deactivated")}catch(r){y("Deactivation Failed: ".concat(r))}}},{color:"warning",icon:ae,condition:a=>a.deactivated_on!==null,action:async a=>{try{await f.activateUser(a.user_id),a.deactivated_on=null}catch(r){y("Activation Failed: ".concat(r))}}}],_=[{label:"Add New User",action:async()=>{const a=await I.show(V);p(a==null?void 0:a.user)||e.value.push(c(a.user))}}];return C(async()=>{const a=(await f.getAllUsers({paginate:!1})).data,r=await f.getCurrentUser();e.value=a.filter(o=>o.person_id!==(r==null?void 0:r.person_id)).map(o=>c(o))}),{rows:e,columns:t,rowActionBtns:d,actionBtns:_}}});function pe(e,t,c,d,_,a){const r=l("base-report-table");return B(),S(r,{title:"Users","report-icon":"patient-type.png",columns:e.columns,rows:e.rows,rowActionButtons:e.rowActionBtns,"action-buttons":e.actionBtns,canExportCsv:!1,canExportPDF:!1,showRefreshButton:!1},null,8,["columns","rows","rowActionButtons","action-buttons"])}const ke=N(ce,[["render",pe]]);export{ke as default};
