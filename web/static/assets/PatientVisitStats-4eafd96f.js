import{K as E}from"./vue-datepicker-312099be.js";import{_ as G}from"./LineChart.vue_vue_type_script_setup_true_lang-46342194.js";import{l as V,d as I,a7 as N,_ as O,$ as B,J,S as k,g as P,r as l,h as L,w as s,o as j,a,f as T,b as u,t as R}from"./index-1c16650e.js";import{i as z}from"./common-94ac9539.js";import{P as c}from"./index-95d3a767.js";import{R as F}from"./report_service-1011140c.js";import{l as A}from"./loader-1441845f.js";import{m as M,D as K}from"./DrilldownTable-d5470f91.js";import{c as H}from"./his_date-3ca53c6f.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import"./arrays-7f14d286.js";import"./url-ffe761c9.js";import"./index-e903e9ca.js";class W extends F{constructor(){super()}static getLocationName(){return sessionStorage.getItem("locationName")}getBookedAppointments(t){return V.getJson("programs/".concat(c,"/scheduled_appointments"),{date:t})}getViralLoadResults(t){return this.getReport("/programs/".concat(c,"/reports/high_vl_patients"),{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport("/programs/".concat(c,"/reports/retention"))}getExternalConsultationClients(){return this.getReport("".concat(c,"/external_consultation_clients"))}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport("/programs/".concat(c,"/reports/pregnant_patients"))}getArchivingCandidates(){return V.getJson("programs/".concat(c,"/reports/archiving_candidates"),{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}getVisitStats(){return V.getJson("programs/".concat(c,"/reports/visits"),{name:"visits",start_date:this.startDate,end_date:this.endDate})}}const q=I({components:{LineChart:G,IonGrid:N,IonRow:O,IonCol:B,VueDatePicker:E},setup(){J();const e=k(["",""]),t=k([]),y=P(()=>{var n;return((n=t.value[0])==null?void 0:n.raw.flat())||[]}),S=P(()=>{var n;return((n=t.value[1])==null?void 0:n.raw.flat())||[]}),b=P(()=>t.value.map(({raw:n})=>n).flat(3)),D={title:{text:"Patient Vists Statistics",align:"left"},yaxis:{title:{text:"Number of clients"},plotAreaHeight:800}},f=n=>{const i={},r={},m={},p=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(n).forEach(([o,g])=>{i[o]=[],r[o]=[],m[o]=[],Object.entries(g).forEach(([w,{patient_present:$,guardian_present:C}])=>{C&&$?m[o].push({patientId:w,date:o}):$?i[o].push({patientId:w,date:o}):C&&r[o].push({patientId:w,date:o})});const v=new Date(o).getTime();p[0].data.push([v,i[o].length]),p[0].raw.push(i[o]),p[1].data.push([v,r[o].length]),p[1].raw.push(r[o]),p[2].data.push([v,m[o].length]),p[2].raw.push(m[o])}),p},h=async()=>{A.show();const n=new W;n.setStartDate(e.value[0]),n.setEndDate(e.value[1]);const i=await n.getPatientVisitTypes();t.value=f(i),A.hide()},d=async(n,i="Drill down clients")=>{await M.show(K,{patientIds:n.map(({patientId:r})=>r),title:i})};return{range:e,series:t,options:D,totalAttendance:b,totalPatientVisits:y,totalGuardianVisits:S,fetchData:h,pointSelection:async(n,i)=>{if(!z(t.value))try{await d(t.value[i].raw[n],"".concat(t.value[i].name," visits"))}catch(r){console.error(r)}},drilldown:d,toDisplayRangeFmt:H}}}),Q={style:{display:"flex","justify-content":"flex-start"}},X={class:"his-card"};function Y(e,t,y,S,b,D){const f=l("vue-date-picker"),h=l("ion-button"),d=l("ion-col"),_=l("ion-label"),n=l("ion-badge"),i=l("ion-item"),r=l("ion-list"),m=l("line-chart"),p=l("ion-row"),o=l("ion-grid");return j(),L(o,null,{default:s(()=>[a(p,null,{default:s(()=>[a(d,{size:"5",offset:"7",class:"ion-padding"},{default:s(()=>[T("div",Q,[a(f,{modelValue:e.range,"onUpdate:modelValue":t[0]||(t[0]=g=>e.range=g),placeholder:"Select date range","partial-range":!0,"enable-time-picker":!1,format:e.toDisplayRangeFmt,"multi-calendars":"","auto-apply":"","text-input":"",range:"",class:"ion-margin-end",style:{padding:"5px"}},null,8,["modelValue","format"]),a(h,{color:"primary",onClick:e.fetchData,style:{height:"44px"}},{default:s(()=>[u("Submit")]),_:1},8,["onClick"])])]),_:1}),a(d,{size:"2",class:"ion-padding-top"},{default:s(()=>[T("div",X,[a(r,null,{default:s(()=>[a(i,{button:"",onClick:t[1]||(t[1]=g=>e.drilldown(e.totalAttendance,"Total Attendance"))},{default:s(()=>[a(_,null,{default:s(()=>[u(" Total Attendance ")]),_:1}),a(n,null,{default:s(()=>[u(R(e.totalAttendance.length),1)]),_:1})]),_:1}),a(i,{button:"",onClick:t[2]||(t[2]=g=>e.drilldown(e.totalPatientVisits,"Total patient visits"))},{default:s(()=>[a(_,null,{default:s(()=>[u(" Patient Visit ")]),_:1}),a(n,null,{default:s(()=>[u(R(e.totalPatientVisits.length),1)]),_:1})]),_:1}),a(i,{button:"",onClick:t[3]||(t[3]=g=>e.drilldown(e.totalGuardianVisits,"Total guardian visits"))},{default:s(()=>[a(_,null,{default:s(()=>[u(" Guardian Visit ")]),_:1}),a(n,null,{default:s(()=>[u(R(e.totalGuardianVisits.length),1)]),_:1})]),_:1})]),_:1})])]),_:1}),a(d,{size:"10"},{default:s(()=>[a(m,{series:e.series,options:e.options,onPointSelection:e.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})}const ct=U(q,[["render",Y]]);export{ct as default};
