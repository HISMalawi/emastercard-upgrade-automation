System.register(["./exports-legacy-c93e490f.js","./common-legacy-e8d6ba88.js","./index-legacy-c5b3ee2e.js","./his_date-legacy-5e1e6c30.js","./vue-datepicker-legacy-7f3df87e.js","./index-legacy-06c0c4ca.js","./toasts-legacy-337d818a.js","./DrilldownTable-legacy-e4256102.js","./arrays-legacy-86abe4a8.js","./datatable-legacy-fe111dab.js"],function(e,t){"use strict";var a,l,r,o,n,i,u,s,d,c,p,y,f,v,m,h,b,g,D,w,B,S,x,F,R,C,j,k,A,T,M,E,P,_,q,H,I,$,V,L,N;return{setters:[e=>{a=e.g,l=e.a},e=>{r=e.s,o=e.p,n=e.t,i=e.i,u=e.g},e=>{s=e.d,d=e.i,c=e.l,p=e.bD,y=e.k,f=e.w,v=e.u,m=e.J,h=e.o,b=e.e,g=e.q,D=e.r,w=e.A,B=e.b,S=e.a,x=e.t,F=e.aP,R=e.bE,C=e.Q,j=e.aH,k=e.a7,A=e.a8,T=e.am,M=e.aS,E=e.aU},e=>{P=e.k,_=e.t,q=e.i},e=>{H=e.K},e=>{I=e.D},e=>{$=e.t},e=>{V=e.D},e=>{L=e.c},e=>{N=e.g}],execute:function(){var t=document.createElement("style");t.textContent=".no-data-table{height:55vh!important}\n",document.head.appendChild(t),e("_",s({__name:"ReportTable",props:{title:{type:String,default:"Report"},subtitle:{type:String,default:""},period:{type:String,default:""},date:{type:String,default:""},quarter:{type:Object,default:()=>({})},totalClients:{type:Array},columns:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},actionButtons:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},canExportPDF:{type:Boolean,default:!0},useSecureExport:{type:Boolean,default:!1},showRefreshButton:{type:Boolean,default:!0},useDateRangeFilter:{type:Boolean,default:!1},useQuarterFilter:{type:Boolean,default:!1},useDateFilter:{type:Boolean,default:!1},customFilters:{type:Array,default:()=>[]},showIndices:{type:Boolean,default:!1},filename:{type:String,default:""},reportType:{type:String,default:""},drillTitle:{type:Function,default:()=>"Drill-down table"},customDrillColumns:{type:Array},drillRowParser:{type:Function},customDrillHandler:{type:Function},showDrillSelectButton:{type:Boolean,default:!0}},emits:["generate"],setup(e,{emit:t}){const s=t,Q=e,U=m({}),O=m({}),G=d(()=>r(`\n  ${Q.reportType} \n  ${c().facility.name} \n  ${(Q.filename||Q.title).replace(Q.reportType,"")} \n  ${Q.period?Q.period:Q.date}\n`)),J=d(()=>{const e=[...Q.customFilters];return Q.useDateRangeFilter?(e.push({id:"startDate",label:"Start Date",type:"date",placeholder:"Start Date",slotName:"datePicker",value:Q.period.split("-")[0]}),e.push({id:"endDate",label:"End Date",placeholder:"End Date",type:"date",slotName:"datePicker",value:Q.period.split("-")[1]})):Q.useQuarterFilter?e.push({id:"quarter",label:"Quarter:",type:"select",value:Q.quarter,options:P(10).map(e=>({label:e.name,value:e.name,other:e}))}):Q.useDateFilter&&e.push({id:"date",label:"Date",type:"date",slotName:"datePicker",value:Q.date}),e}),K=d(()=>{var e,t;const r=[...Q.actionButtons];return Q.canExportCsv&&r.push(a(G.value,null===(e=Q.quarter)||void 0===e?void 0:e.label,Q.period)),Q.canExportPDF&&r.push(l(G.value,Q.useSecureExport,null===(t=Q.quarter)||void 0===t?void 0:t.label,Q.period)),Q.showRefreshButton&&r.push({label:"Refresh/Rebuild",icon:p,color:"primary",action:()=>{if(i(O.value))return $("Invalid filters");s("generate",O.value,!0)}}),r}),z=d(()=>{var e;return null!==(e=Q.customDrillColumns)&&void 0!==e?e:[{path:"identifier",label:"ARV Number",preSort:o,initialSort:!0},{path:"birthdate",label:"Date of Birth",formatter:_},{path:"gender",label:"Gender",formatter:n}]});function W(e){if("startDate"in e&&"endDate"in e){const{startDate:t,endDate:a}=U.value;if(!q(t,a))return $("Invalid date range");e.startDate=t,e.endDate=a,e.dateRange={startDate:t,endDate:a}}if("date"in e){if(i(U.value.date))return $("Invalid date");e.date=U.value.date}if(function(e){return J.value.every(t=>!1===t.required||!i(e[t.id])&&("object"!=typeof e[t.id]||Object.values(e[t.id]).every(Boolean)))}(e))return O.value=e,s("generate",e,!1);$("Invalid filters")}function X(e){return e.preventDefault(),Y({row:{clients:Q.totalClients},column:{path:"clients",label:"Total Clients"}})}async function Y(e){var t,r;if("function"==typeof Q.customDrillHandler)return Q.customDrillHandler(e);const o=Q.drillTitle(e),n=m([]);return async function(e,t){if("function"==typeof Q.drillRowParser)t.push(...await Q.drillRowParser(e));else{const r=u(e.row,e.column.path,[]);for(const e of L(r,100)){var a,l;const r=await E.getAll(e);if(!r.ok)return $(null!==(a=r.errorMessage)&&void 0!==a?a:"Unable to load patient data");t.push(...null!==(l=r.data)&&void 0!==l?l:[])}}}(e,n.value),T.show(V,{title:o,columns:z.value,rows:n.value,rowActionButtons:Q.showDrillSelectButton?[N("person_id",M)]:[],actionButtons:[a(o,null===(t=Q.quarter)||void 0===t?void 0:t.label,Q.period),l(o,!1,null===(r=Q.quarter)||void 0===r?void 0:r.label,Q.period)]})}return(t,a)=>(h(),y(v(A),{style:{padding:"0 !important"}},{default:f(()=>[b(v(F),{style:{"border-bottom":"1px solid #c2c2c2","font-weight":"500",color:"#000"}},{default:f(()=>{var t;return[b(v(g),{innerHTML:e.title},null,8,["innerHTML"]),e.subtitle?(h(),y(v(D),{key:0,innerHTML:e.subtitle,style:{color:"#818181"}},null,8,["innerHTML"])):w("",!0),null!==(t=e.totalClients)&&void 0!==t&&t.length?(h(),y(v(D),{key:1},{default:f(()=>[a[0]||(a[0]=B(" Total Clients: ",-1)),S("a",{href:"#",onClick:X},x(e.totalClients.length),1)]),_:1})):w("",!0)]}),_:1}),b(v(k),{class:"ion-no-padding",style:{"padding-bottom":"30px","min-height":"55vh"}},{default:f(()=>[b(v(I),{rows:e.rows,"async-rows":e.asyncRows,columns:e.columns,"actions-buttons":K.value,"row-actions-buttons":e.rowActionButtons,"custom-filters":J.value,config:{showIndices:e.showIndices},onCustomFilter:W,onDrilldown:Y,color:"light"},R({datePicker:f(({filter:e})=>{var t,a;return[b(v(H),{modelValue:U.value[e.id],"onUpdate:modelValue":t=>U.value[e.id]=t,"enable-time-picker":!1,"model-type":"dd/MMM/yyyy",format:"dd/MMM/yyyy",placeholder:null!==(t=null!==(a=e.placeholder)&&void 0!==a?a:e.label)&&void 0!==t?t:"Select Date","auto-apply":"","text-input":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])]}),_:2},[C(t.$slots,(e,a)=>({name:a,fn:f(({filter:e})=>[j(t.$slots,a,{filter:{filter:e}})])}))]),1032,["rows","async-rows","columns","actions-buttons","row-actions-buttons","custom-filters","config"])]),_:3})]),_:3}))}}))}}});
