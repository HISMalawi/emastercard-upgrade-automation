System.register(["./index-legacy-084a8278.js","./toasts-legacy-35f2c029.js","./DTFormElements-legacy-8934eb68.js","./SelectInput-legacy-c35392c7.js","./index-legacy-a5979f3c.js","./VoidReason-legacy-a4e3b29d.js","./Strs-legacy-09248991.js","./index-legacy-aa705205.js","./his_date-legacy-31ba5787.js","./dde-legacy-2b546b66.js","./validations-legacy-d0f46810.js","./_plugin-vue_export-helper-legacy-762b7923.js","./common-legacy-0d7df615.js"],(function(e,a){"use strict";var t,n,l,r,i,o,s,c,d,u,p,h,m,g,v,y,b,f,_,I,w,S,x,R,j,C,D,V,$,A,T,N,B,E,M,P,k,F,K;return{setters:[e=>{t=e.d,n=e.h,l=e.i,r=e.j,i=e.I,o=e.af,s=e.f,c=e.r,d=e.ac,u=e.F,p=e.a0,h=e.E,m=e.D,g=e.aB,v=e.J,y=e.g,b=e.w,f=e.o,_=e.e,I=e.y,w=e.a,S=e.b},e=>{x=e.t,R=e.b},e=>{j=e.g},e=>{C=e.S},e=>{D=e.D},e=>{V=e.p},e=>{$=e.t},e=>{A=e.M,T=e.A},e=>{N=e.t,B=e.e},e=>{E=e.r,M=e.a,P=e.i,k=e.b},e=>{F=e.b},e=>{K=e._},null],execute:function(){var a=document.createElement("style");a.textContent=".sc-ion-searchbar-md-h{--box-shadow: none !important}\n",document.head.appendChild(a);const O=t({components:{IonGrid:n,IonRow:l,IonCol:r,SelectInput:C,IonButton:i,IonSearchbar:o,DataTable:D},setup(){const e=s(),{facility:a}=m(),t=c(""),n=c(document.getElementById("selectInput")),l=d({value:"",placeholder:"select gender"}),r=c(!1),i=c([]),o=u((()=>a.code+"-ARV-"));p((()=>E()));const v=[{label:"ARV Number",path:"arv_number"},{label:"MW National ID",path:"national_id"},{path:"given_name",label:"First name"},{path:"family_name",label:"Last name"},{path:"gender",label:"Gender",formatter:$},{path:"birthdate",label:"Date of Birth (AGE)",formatter:e=>`${N(e)} (${B(e)})`},{path:"source",label:"Source"}],y=async e=>{var a;const t=await g.searchByOtherID(T,e);return t.ok?t.data:(x(null!==(a=t.errorMessage)&&void 0!==a?a:`Searching client by ARV Number returned error: ${t.clientErrorType}`),[])},b=e=>{r.value&&(r.value=!1),null==e||e.map((e=>{var a,t,n,l,r;return i.value.push({arv_number:null===(a=e.patient_identifiers.find((e=>e.identifier_type==T)))||void 0===a?void 0:a.identifier,national_id:null===(t=e.patient_identifiers.find((e=>e.identifier_type==A)))||void 0===t?void 0:t.identifier,given_name:e.person.names[0].given_name,family_name:e.person.names[0].family_name,gender:e.person.gender,birthdate:e.person.birthdate,personId:e.patient_id,source:null!==(n=e.source)&&void 0!==n?n:"locals",docID:null!==(l=e.docID)&&void 0!==l?l:"",ddeClientRequiresImport:null!==(r=null==e?void 0:e.ddeClientRequiresImport)&&void 0!==r&&r})}))},f=async()=>{if(t.value&&!r.value)try{r.value=!0,i.value=[],t.value.match(/^(\w+-ARV-\w+)$/)&&y(t.value).then(b),null===F({value:t.value,label:t.value})&&(async e=>{var a;const t=await g.searchByOtherID(A,e);return t.ok?t.data:(x(null!==(a=t.errorMessage)&&void 0!==a?a:`Searching client by Malawi National ID returned error: ${t.clientErrorType}`),[])})(t.value).then(b),1===(e=t.value).split(" ").length&&(e.length>=6||13===e.length)&&M(t.value).then(b),t.value.match(/^(\d+)$/)?y(`${o.value}${t.value}`).then(b):((e,a)=>{const t={},n=e.split(" ").filter((e=>/\S/.test(e)));return a&&(t.gender=a),n.length>0&&(t.given_name=n[0],t.family_name=n[2]||n[1]||"",t.middle_name=n[2]?n[1]:""),k(t)})(t.value,l.value.value).then(b)}catch(a){x("Unable to search patients"),console.error(a)}var e},_=u((()=>{const a=[{label:"Select",action:a=>{a.ddeClientRequiresImport?P(a.docID).then((a=>{a&&e.push(`/patient/${a.patient_id}`)})):e.push(`/patient/${a.personId}`)}}];return h.userHasRoles(["Program Manager","Superuser","System Developer"])&&a.push({label:"void",color:"danger",action:async e=>{V((async a=>{try{await g.void(e.personId,a),await f()}catch(t){R(`${t}`)}}),"void-modal")}}),a}));return{searchText:t,gender:l,tableRows:i,tableColumns:v,tableConfig:{showSearchField:!1,showSubmitButton:!1},genderOptions:j,selectInput:n,TableRowActions:_,searchPatient:f,resetQuery:()=>{t.value="",l.value="",i.value=[]}}}}),q={style:{"max-width":"250px"},class:"ion-margin-end ion-margin-vertical"};e("default",K(O,[["render",function(e,a,t,n,l,r){const i=v("ion-searchbar"),o=v("SelectInput"),s=v("ion-button"),c=v("ion-col"),d=v("ion-row"),u=v("data-table"),p=v("ion-grid");return f(),y(p,null,{default:b((()=>[_(d,{class:"his-card"},{default:b((()=>[_(c,{size:"10",style:{display:"flex","justify-content":"flex-start"}},{default:b((()=>[_(i,{style:{width:"350px",height:"2.75rem"},class:"box-input ion-no-padding ion-margin-end ion-margin-vertical",placeholder:"Search by Name or ARV Number or MW National ID",modelValue:e.searchText,"onUpdate:modelValue":a[0]||(a[0]=a=>e.searchText=a),onKeyup:I(e.searchPatient,["enter"])},null,8,["modelValue","onKeyup"]),w("div",q,[_(o,{modelValue:e.gender,"onUpdate:modelValue":a[1]||(a[1]=a=>e.gender=a),options:e.genderOptions,onKeyup:I(e.searchPatient,["enter"])},null,8,["modelValue","options","onKeyup"])]),_(s,{class:"ion-margin-vertical",onClick:e.searchPatient},{default:b((()=>a[2]||(a[2]=[S("Search")]))),_:1},8,["onClick"]),_(s,{class:"ion-margin-vertical",onClick:e.resetQuery,color:"secondary"},{default:b((()=>a[3]||(a[3]=[S("Reset")]))),_:1},8,["onClick"])])),_:1}),_(c,null,{default:b((()=>[_(s,{class:"ion-margin-vertical",href:"/patient/registration",color:"success",style:{float:"right"}},{default:b((()=>a[4]||(a[4]=[S(" Add New Patient ")]))),_:1})])),_:1})])),_:1}),_(d,{class:"his-card ion-margin-top",style:{padding:"0 !important"}},{default:b((()=>[_(c,{size:"12",style:{"min-height":"320px"},class:"ion-no-padding"},{default:b((()=>[a[5]||(a[5]=w("h1",{class:"ion-margin"},"Patients Search Results",-1)),_(u,{rows:e.tableRows,columns:e.tableColumns,config:e.tableConfig,"row-actions-buttons":e.TableRowActions,color:"light"},null,8,["rows","columns","config","row-actions-buttons"])])),_:1})])),_:1})])),_:1})}]]))}}}));
