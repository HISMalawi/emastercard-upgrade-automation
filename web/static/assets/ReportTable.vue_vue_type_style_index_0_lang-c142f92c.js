import{g as R,a as S}from"./exports-f71f2146.js";import{s as N,p as H,t as q,i as b,g as Q}from"./common-abc2f84d.js";import{d as $,i as p,l as L,bD as j,k as h,w as s,u as i,J as D,o as g,e as d,q as U,r as F,A as T,b as G,a as K,t as O,aQ as z,bE as J,Q as W,aI as X,a7 as Y,a8 as Z,am as _,aT as ee,aV as te}from"./index-229c1236.js";import{k as ae,t as re,i as le}from"./his_date-b0a0907c.js";import{K as oe}from"./vue-datepicker-956f19a2.js";import{D as ne}from"./index-9f8e2b10.js";import{t as c}from"./toasts-6e9d0182.js";import{D as ie}from"./DrilldownTable-bbc276fc.js";import{c as se}from"./arrays-1b521787.js";import{g as ue}from"./datatable-84d9c34c.js";const we=$({__name:"ReportTable",props:{title:{type:String,default:"Report"},subtitle:{type:String,default:""},period:{type:String,default:""},date:{type:String,default:""},quarter:{type:Object,default:()=>({})},totalClients:{type:Array},columns:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},actionButtons:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},canExportPDF:{type:Boolean,default:!0},useSecureExport:{type:Boolean,default:!1},showRefreshButton:{type:Boolean,default:!0},useDateRangeFilter:{type:Boolean,default:!1},useQuarterFilter:{type:Boolean,default:!1},useDateFilter:{type:Boolean,default:!1},customFilters:{type:Array,default:()=>[]},showIndices:{type:Boolean,default:!1},filename:{type:String,default:""},reportType:{type:String,default:""},drillTitle:{type:Function,default:()=>"Drill-down table"},customDrillColumns:{type:Array},drillRowParser:{type:Function},customDrillHandler:{type:Function},showDrillSelectButton:{type:Boolean,default:!0}},emits:["generate"],setup(l,{emit:k}){const w=k,t=l,u=D({}),f=D({}),B=p(()=>N("\n  ".concat(t.reportType," \n  ").concat(L().facility.name," \n  ").concat((t.filename||t.title).replace(t.reportType,"")," \n  ").concat(t.period?t.period:t.date,"\n"))),v=p(()=>{const e=[...t.customFilters];return t.useDateRangeFilter?(e.push({id:"startDate",label:"Start Date",type:"date",placeholder:"Start Date",slotName:"datePicker",value:t.period.split("-")[0]}),e.push({id:"endDate",label:"End Date",placeholder:"End Date",type:"date",slotName:"datePicker",value:t.period.split("-")[1]})):t.useQuarterFilter?e.push({id:"quarter",label:"Quarter:",type:"select",value:t.quarter,options:ae(10).map(a=>({label:a.name,value:a.name,other:a}))}):t.useDateFilter&&e.push({id:"date",label:"Date",type:"date",slotName:"datePicker",value:t.date}),e}),V=p(()=>{var a,r;const e=[...t.actionButtons];return t.canExportCsv&&e.push(R(B.value,(a=t.quarter)==null?void 0:a.label,t.period)),t.canExportPDF&&e.push(S(B.value,t.useSecureExport,(r=t.quarter)==null?void 0:r.label,t.period)),t.showRefreshButton&&e.push(A()),e}),x=p(()=>{var e;return(e=t.customDrillColumns)!=null?e:[{path:"identifier",label:"ARV Number",preSort:H,initialSort:!0},{path:"birthdate",label:"Date of Birth",formatter:re},{path:"gender",label:"Gender",formatter:q}]});function A(){return{label:"Refresh/Rebuild",icon:j,color:"primary",action:()=>{if(b(f.value))return c("Invalid filters");w("generate",f.value,!0)}}}function I(e){return v.value.every(a=>a.required===!1?!0:b(e[a.id])?!1:typeof e[a.id]=="object"?Object.values(e[a.id]).every(Boolean):!0)}function E(e){if("startDate"in e&&"endDate"in e){const{startDate:a,endDate:r}=u.value;if(!le(a,r))return c("Invalid date range");e.startDate=a,e.endDate=r,e.dateRange={startDate:a,endDate:r}}if("date"in e){if(b(u.value.date))return c("Invalid date");e.date=u.value.date}if(I(e))return f.value=e,w("generate",e,!1);c("Invalid filters")}function M(e){return e.preventDefault(),C({row:{clients:t.totalClients},column:{path:"clients",label:"Total Clients"}})}async function P(e,a){var r,o;if(typeof t.drillRowParser=="function")a.push(...await t.drillRowParser(e));else{const n=Q(e.row,e.column.path,[]);for(const m of se(n,100)){const y=await te.getAll(m);if(!y.ok)return c((r=y.errorMessage)!=null?r:"Unable to load patient data");a.push(...(o=y.data)!=null?o:[])}}}async function C(e){var o,n;if(typeof t.customDrillHandler=="function")return t.customDrillHandler(e);const a=t.drillTitle(e),r=D([]);return P(e,r.value),_.show(ie,{title:a,columns:x.value,rows:r.value,rowActionButtons:t.showDrillSelectButton?[ue("person_id",ee)]:[],actionButtons:[R(a,(o=t.quarter)==null?void 0:o.label,t.period),S(a,!1,(n=t.quarter)==null?void 0:n.label,t.period)]})}return(e,a)=>(g(),h(i(Z),{style:{padding:"0 !important"}},{default:s(()=>[d(i(z),{style:{"border-bottom":"1px solid #c2c2c2","font-weight":"500",color:"#000"}},{default:s(()=>{var r;return[d(i(U),{innerHTML:l.title},null,8,["innerHTML"]),l.subtitle?(g(),h(i(F),{key:0,innerHTML:l.subtitle,style:{color:"#818181"}},null,8,["innerHTML"])):T("",!0),(r=l.totalClients)!=null&&r.length?(g(),h(i(F),{key:1},{default:s(()=>[a[0]||(a[0]=G(" Total Clients: ",-1)),K("a",{href:"#",onClick:M},O(l.totalClients.length),1)]),_:1})):T("",!0)]}),_:1}),d(i(Y),{class:"ion-no-padding",style:{"padding-bottom":"30px","min-height":"55vh"}},{default:s(()=>[d(i(ne),{rows:l.rows,"async-rows":l.asyncRows,columns:l.columns,"actions-buttons":V.value,"row-actions-buttons":l.rowActionButtons,"custom-filters":v.value,config:{showIndices:l.showIndices},onCustomFilter:E,onDrilldown:C,color:"light"},J({datePicker:s(({filter:r})=>{var o,n;return[d(i(oe),{modelValue:u.value[r.id],"onUpdate:modelValue":m=>u.value[r.id]=m,"enable-time-picker":!1,"model-type":"dd/MMM/yyyy",format:"dd/MMM/yyyy",placeholder:(n=(o=r.placeholder)!=null?o:r.label)!=null?n:"Select Date","auto-apply":"","text-input":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])]}),_:2},[W(e.$slots,(r,o)=>({name:o,fn:s(({filter:n})=>[X(e.$slots,o,{filter:{filter:n}})])}))]),1032,["rows","async-rows","columns","actions-buttons","row-actions-buttons","custom-filters","config"])]),_:3})]),_:3}))}});export{we as _};
