import{d as z,I as C,h as S,i as k,j as R,r as V,ac as F,a0 as B,J as m,g as y,w as l,o as U,e as o,a as p,b as I}from"./index-b34da4cb.js";import{T as q}from"./TextInput-6d943a31.js";import{S as T}from"./SelectInput-3966d61d.js";import{g as N}from"./common-abc2f84d.js";import{U as f}from"./user_service-c31a0c50.js";import{s as b}from"./form-4b6e0e9a.js";import{a as P,b as $}from"./toasts-5a6b8805.js";import{_ as h}from"./_plugin-vue_export-helper-c27b6911.js";import"./Strs-7ee8a435.js";import"./loader-d835876b.js";const A=z({name:"UserModal",components:{IonButton:C,IonGrid:S,IonRow:k,IonCol:R,TextInput:q,SelectInput:T},setup(){const s=V([]),e=V(-1),c=V(1),d=F({password:{value:"",label:"New Password",required:!0,validation:async({value:a})=>a&&"".concat(a).length<6?["Password must be at least 6 characters long"]:null},confirmPassword:{value:"",label:"Confirm New Password",required:!0,validation:async({value:a},r)=>a&&a!==r.password.value?["Passwords do not match"]:null}}),u=F({givenName:{value:"",label:"First Name",required:!0},familyName:{value:"",label:"Last Name",required:!0},username:{value:"",label:"Username",disabled:!0},roles:{value:[],label:"Roles",required:!0}}),v=async()=>{const a=await f.getCurrentUser();a&&(e.value=a.user_id,u.username.value=a.username,u.givenName.value=N(a,"person.names[0].given_name",""),u.familyName.value=N(a,"person.names[0].family_name",""),u.roles.value=a.roles.map(r=>({value:r.role,label:r.role,other:r})))},n=()=>b(u,async a=>{try{const r=await f.updateUser(e.value,{...a,roles:a.roles.map(t=>t.label)});if(r&&r.data){const t=r.data;sessionStorage.setItem("username",t.username),sessionStorage.setItem("userRoles",JSON.stringify(t.roles)),P("User profile has been updated successfully",3e3),v()}else throw new Error("Failed to update user profile")}catch(r){$("Failed to update user profile")}}),w=()=>b(d,async a=>{await f.updateUser(e.value,a),P("Password updated successfully",3e3);for(const r in d)d[r].value=""});return B(async()=>{await f.getAllRoles().then(a=>{const r=Array.isArray(a.data)?a.data:[];s.value=r.map(t=>({value:t.role,label:t.role,other:t}))}),await v(),c.value++}),{userForm:u,passwordForm:d,roles:s,refreshRoles:c,updateProfile:n,updatePassword:w}}}),J={class:"his-card"},M={class:"his-card"};function j(s,e,c,d,u,v){const n=m("ion-col"),w=m("text-input"),a=m("SelectInput"),r=m("TextInput"),t=m("IonButton"),g=m("ion-row"),_=m("ion-grid");return U(),y(_,null,{default:l(()=>[o(g,null,{default:l(()=>[o(n,{size:"8"},{default:l(()=>[p("div",J,[o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>e[6]||(e[6]=[p("h2",null,"User Profile",-1)])),_:1}),o(g,null,{default:l(()=>[o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>[o(w,{modelValue:s.userForm.username,"onUpdate:modelValue":e[0]||(e[0]=i=>s.userForm.username=i)},null,8,["modelValue"])]),_:1}),o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>[(U(),y(a,{modelValue:s.userForm.roles,"onUpdate:modelValue":e[1]||(e[1]=i=>s.userForm.roles=i),options:s.roles,multiple:"",key:s.refreshRoles},null,8,["modelValue","options"]))]),_:1}),o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>[o(r,{modelValue:s.userForm.givenName,"onUpdate:modelValue":e[2]||(e[2]=i=>s.userForm.givenName=i)},null,8,["modelValue"])]),_:1}),o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>[o(r,{modelValue:s.userForm.familyName,"onUpdate:modelValue":e[3]||(e[3]=i=>s.userForm.familyName=i)},null,8,["modelValue"])]),_:1}),o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>[o(t,{class:"ion-margin-end ion-margin-vertical ion-float-right",onClick:s.updateProfile},{default:l(()=>e[7]||(e[7]=[I("Save")])),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1}),o(n,{size:"4"},{default:l(()=>[p("div",M,[o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>e[8]||(e[8]=[p("h2",null,"Change Password",-1)])),_:1}),o(g,null,{default:l(()=>[o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>[o(r,{modelValue:s.passwordForm.password,"onUpdate:modelValue":e[4]||(e[4]=i=>s.passwordForm.password=i),password:""},null,8,["modelValue"])]),_:1}),o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>[o(r,{modelValue:s.passwordForm.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=i=>s.passwordForm.confirmPassword=i),form:s.passwordForm,password:""},null,8,["modelValue","form"])]),_:1}),o(n,{size:"12",class:"ion-margin-vertical"},{default:l(()=>[o(t,{class:"ion-margin-end ion-margin-vertical ion-float-right",onClick:s.updatePassword},{default:l(()=>e[9]||(e[9]=[I("Save")])),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})}const Y=h(A,[["render",j]]);export{Y as default};
