import{d as F,i as G,j as K,k as O,I as W,ah as L,g as U,r as b,ae as x,a2 as j,H as q,G as z,aD as w,F as H,L as c,h as Q,w as l,o as Y,a as r,A as B,f as P,b as R}from"./index-9d5e84a5.js";import{t as S,b as J}from"./toasts-a30647ed.js";import{g as X}from"./DTFormElements-a1199b88.js";import{S as Z}from"./SelectInput-c163deec.js";import{D as ee}from"./index-fca9b4d0.js";import{p as ae}from"./VoidReason-22182f61.js";import{t as te}from"./Strs-7ee8a435.js";import{M as C,A as $}from"./index-95d3a767.js";import{t as ne,f as oe}from"./his_date-68cf9d33.js";import{r as re,a as se,i as ie,b as le}from"./dde-35d847e9.js";import{b as ce}from"./validations-674ed7bf.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";import"./common-8a0477e8.js";const de=F({components:{IonGrid:G,IonRow:K,IonCol:O,SelectInput:Z,IonButton:W,IonSearchbar:L,DataTable:ee},setup(){const n=U(),{facility:u}=H(),o=b(""),N=b(document.getElementById("selectInput")),_=x({value:"",placeholder:"select gender"}),m=b(!1),d=b([]);j(()=>re());const y=[{label:"ARV Number",path:"arv_number"},{label:"MW National ID",path:"national_id"},{path:"given_name",label:"First name"},{path:"family_name",label:"Last name"},{path:"gender",label:"Gender",formatter:te},{path:"birthdate",label:"Date of Birth (AGE)",formatter:a=>"".concat(ne(a)," (").concat(oe(a),")")},{path:"source",label:"Source"}],p={showSearchField:!1,showSubmitButton:!1},h=async a=>{var t;const e=await w.searchByOtherID(C,a);return e.ok?e.data:(S((t=e.errorMessage)!=null?t:"Searching client by Malawi National ID returned error: ".concat(e.clientErrorType)),[])},f=async a=>{var t;const e=await w.searchByOtherID($,a);return e.ok?e.data:(S((t=e.errorMessage)!=null?t:"Searching client by ARV Number returned error: ".concat(e.clientErrorType)),[])},v=(a,e)=>{const t={},i=a.split(" ").filter(g=>/\S/.test(g));return e&&(t.gender=e),i.length>0&&(t.given_name=i[0],t.family_name=i[2]||i[1]||"",t.middle_name=i[2]?i[1]:""),le(t)},I=a=>a.split(" ").length===1&&(a.length>=6||a.length===13),s=a=>{m.value&&(m.value=!1),a==null||a.map(e=>{var t,i,g,T,V;return d.value.push({arv_number:(t=e.patient_identifiers.find(D=>D.identifier_type==$))==null?void 0:t.identifier,national_id:(i=e.patient_identifiers.find(D=>D.identifier_type==C))==null?void 0:i.identifier,given_name:e.person.names[0].given_name,family_name:e.person.names[0].family_name,gender:e.person.gender,birthdate:e.person.birthdate,personId:e.patient_id,source:(g=e.source)!=null?g:"locals",docID:(T=e.docID)!=null?T:"",ddeClientRequiresImport:(V=e==null?void 0:e.ddeClientRequiresImport)!=null?V:!1})})},A=async()=>{if(o.value&&!m.value)try{m.value=!0,d.value=[],o.value.match(/^(\w+-ARV-\w+)$/)&&f(o.value).then(s),ce({value:o.value,label:o.value})===null&&h(o.value).then(s),I(o.value)&&se(o.value).then(s),o.value.match(/^(\d+)$/)?f("".concat(u.code,"-ARV-").concat(o.value)).then(s):v(o.value,_.value).then(s)}catch(a){S("Unable to search patients"),console.error(a)}},M=()=>{o.value="",_.value="",d.value=[]},k=()=>({label:"void",color:"danger",action:async a=>{ae(async e=>{try{await w.void(a.personId,e),await A()}catch(t){J("".concat(t))}},"void-modal")}}),E=q(()=>{const a=[{label:"Select",action:e=>{e.ddeClientRequiresImport?ie(e.docID).then(t=>{t&&n.push("/patient/".concat(t.patient_id))}):n.push("/patient/".concat(e.personId))}}];return z.userHasRoles(["Program Manager","Superuser","System Developer"])&&a.push(k()),a});return{searchText:o,gender:_,tableRows:d,tableColumns:y,tableConfig:p,genderOptions:X,selectInput:N,TableRowActions:E,searchPatient:A,resetQuery:M}}});const me={style:{"max-width":"250px"},class:"ion-margin-end ion-margin-vertical"},pe=P("h1",{class:"ion-margin"},"Patients Search Results",-1);function he(n,u,o,N,_,m){const d=c("ion-searchbar"),y=c("SelectInput"),p=c("ion-button"),h=c("ion-col"),f=c("ion-row"),v=c("data-table"),I=c("ion-grid");return Y(),Q(I,null,{default:l(()=>[r(f,{class:"his-card"},{default:l(()=>[r(h,{size:"10",style:{display:"flex","justify-content":"flex-start"}},{default:l(()=>[r(d,{style:{width:"350px",height:"2.75rem"},class:"box-input ion-no-padding ion-margin-end ion-margin-vertical",placeholder:"Search by Name or ARV Number or MW National ID",modelValue:n.searchText,"onUpdate:modelValue":u[0]||(u[0]=s=>n.searchText=s),onKeyup:B(n.searchPatient,["enter"])},null,8,["modelValue","onKeyup"]),P("div",me,[r(y,{modelValue:n.gender,"onUpdate:modelValue":u[1]||(u[1]=s=>n.gender=s),options:n.genderOptions,onKeyup:B(n.searchPatient,["enter"])},null,8,["modelValue","options","onKeyup"])]),r(p,{class:"ion-margin-vertical",onClick:n.searchPatient},{default:l(()=>[R("Search")]),_:1},8,["onClick"]),r(p,{class:"ion-margin-vertical",onClick:n.resetQuery,color:"secondary"},{default:l(()=>[R("Reset")]),_:1},8,["onClick"])]),_:1}),r(h,null,{default:l(()=>[r(p,{class:"ion-margin-vertical",href:"/patient/registration",color:"success",style:{float:"right"}},{default:l(()=>[R(" Add New Patient ")]),_:1})]),_:1})]),_:1}),r(f,{class:"his-card ion-margin-top",style:{padding:"0 !important"}},{default:l(()=>[r(h,{size:"12",style:{"min-height":"320px"},class:"ion-no-padding"},{default:l(()=>[pe,r(v,{rows:n.tableRows,columns:n.tableColumns,config:n.tableConfig,"row-actions-buttons":n.TableRowActions,color:"light"},null,8,["rows","columns","config","row-actions-buttons"])]),_:1})]),_:1})]),_:1})}const Te=ue(de,[["render",he]]);export{Te as default};
