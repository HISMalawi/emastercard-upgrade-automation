import{d as F,I as b,m as S,n as z,p as C,r as p,ak as k,j as R,_ as B,O as n,k as g,w as t,o as I,e as a,a as U,b as P}from"./index-19c8710e.js";import{T}from"./TextInput-17be8061.js";import{S as $}from"./SelectInput-3b700faf.js";import{g as V}from"./common-abc2f84d.js";import{U as f}from"./user_service-78796486.js";import{s as h}from"./form-ab8f1d51.js";import{a as q,b as A}from"./toasts-e7d14f43.js";import{P as M}from"./PasswordUpdate-e7ed18d1.js";import"./Strs-0c962638.js";import"./loader-80f9a1f0.js";import"./his_date-8fc3311f.js";import"./validations-6f974720.js";const O=F({name:"UserModal",components:{IonButton:b,IonGrid:S,IonRow:z,IonCol:C,TextInput:T,SelectInput:$,PasswordUpdate:M},setup(){const s=p([]),o=p(-1),m=p(1),u=k({givenName:{value:"",label:"First Name",required:!0},familyName:{value:"",label:"Last Name",required:!0},username:{value:"",label:"Username",disabled:!0},roles:{value:[],label:"Roles",required:!0}}),d=async()=>{const e=await f.getCurrentUser();e&&(o.value=e.user_id,u.username.value=e.username,u.givenName.value=V(e,"person.names[0].given_name",""),u.familyName.value=V(e,"person.names[0].family_name",""),u.roles.value=e.roles.map(r=>({value:r.role,label:r.role,other:r})))},c=()=>h(u,async e=>{try{const r=await f.updateUser(o.value,{...e,roles:e.roles.map(l=>l.label)});if(r&&r.data){const l=r.data;sessionStorage.setItem("username",l.username),sessionStorage.setItem("userRoles",JSON.stringify(l.roles)),q("User profile has been updated successfully",3e3),d()}else throw new Error("Failed to update user profile")}catch(r){A("Failed to update user profile")}});return R(async()=>{await f.getAllRoles().then(e=>{const r=Array.isArray(e.data)?e.data:[];s.value=r.map(l=>({value:l.role,label:l.role,other:l}))}),await d(),m.value++}),{userForm:u,roles:s,refreshRoles:m,updateProfile:c}}}),j={class:"his-card"};function D(s,o,m,u,d,c){const e=n("ion-col"),r=n("text-input"),l=n("SelectInput"),v=n("TextInput"),w=n("IonButton"),_=n("ion-row"),y=n("password-update"),N=n("ion-grid");return I(),g(N,null,{default:t(()=>[a(_,null,{default:t(()=>[a(e,{size:"8"},{default:t(()=>[U("div",j,[a(e,{size:"12",class:"ion-margin-vertical"},{default:t(()=>[...o[4]||(o[4]=[U("h2",null,"User Profile",-1)])]),_:1}),a(_,null,{default:t(()=>[a(e,{size:"12",class:"ion-margin-vertical"},{default:t(()=>[a(r,{modelValue:s.userForm.username,"onUpdate:modelValue":o[0]||(o[0]=i=>s.userForm.username=i)},null,8,["modelValue"])]),_:1}),a(e,{size:"12",class:"ion-margin-vertical"},{default:t(()=>[(I(),g(l,{modelValue:s.userForm.roles,"onUpdate:modelValue":o[1]||(o[1]=i=>s.userForm.roles=i),options:s.roles,multiple:"",key:s.refreshRoles},null,8,["modelValue","options"]))]),_:1}),a(e,{size:"12",class:"ion-margin-vertical"},{default:t(()=>[a(v,{modelValue:s.userForm.givenName,"onUpdate:modelValue":o[2]||(o[2]=i=>s.userForm.givenName=i)},null,8,["modelValue"])]),_:1}),a(e,{size:"12",class:"ion-margin-vertical"},{default:t(()=>[a(v,{modelValue:s.userForm.familyName,"onUpdate:modelValue":o[3]||(o[3]=i=>s.userForm.familyName=i)},null,8,["modelValue"])]),_:1}),a(e,{size:"12",class:"ion-margin-vertical"},{default:t(()=>[a(w,{class:"ion-margin-vertical",onClick:s.updateProfile},{default:t(()=>[...o[5]||(o[5]=[P("Save Changes",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1}),a(e,{size:"4"},{default:t(()=>[a(y)]),_:1})]),_:1})]),_:1})}const ee=B(O,[["render",D]]);export{ee as default};
