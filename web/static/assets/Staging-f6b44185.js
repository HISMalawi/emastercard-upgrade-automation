import{d as _,j as F,k as z,I as k,$ as E,r as S,H as y,ae as R,a6 as D,a2 as N,ai as O,L as u,o as w,c as h,a,w as r,b as c,K as I,y as W}from"./index-4d483828.js";import{T}from"./TextInput-5c92f14c.js";import{D as U}from"./DateInput-e039fcb4.js";import{Y}from"./YesNoInput-d1f215ea.js";import{S as $}from"./SelectInput-28621325.js";import{g as q}from"./location_options-eb150e5f.js";import{s as B}from"./form-129546df.js";import{S as L}from"./HIVReception-f4b3aca7.js";import{E as P,a as j}from"./emc_event-4721851b.js";import{r as v,v as M}from"./validations-f5157998.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";import"./his_date-cffe3798.js";import"./vue-datepicker-f279bdcc.js";import"./common-abc2f84d.js";import"./Strs-7ee8a435.js";import"./toasts-8d20c315.js";import"./loader-c899e325.js";import"./patient_service-1e98eebd.js";import"./patient_identifier_service-5718ea46.js";import"./index-95d3a767.js";import"./Date-233a97af.js";import"./encounter_types-ae359711.js";import"./consultation_service-01abcaac.js";import"./program_service-b238d7cc.js";const K=_({components:{IonRow:F,IonCol:z,IonButton:k,IonTitle:E,TextInput:T,DateInput:U,YesNoInput:Y,SelectInput:$},props:{patient:{type:Object,required:!0},isNewPatient:{type:Boolean,default:!0},observations:{type:Object,default:()=>({})},initialVisitDate:{type:String,default:""},artStartDate:{type:String,default:""}},emits:["onValue","onPrevious","onFinish"],setup(e,{emit:n}){const p=S([]),C=S([]),V=y(()=>e.patient.getBirthdate()),s=new L(e.patient.getID(),e.patient.getAge(),e.initialVisitDate),g=y(()=>s.getAllReasonsForART(e.artStartDate||e.initialVisitDate,e.patient.isMale()).map(o=>({label:o.name,value:o.name}))),m=s.getAllWhoStages().filter(o=>o.name.match(/1|2|3|4/i)).map(o=>({label:o.name,value:o.name})),i=R({reasonsForEligibity:{value:e.observations["Reason for ART eligibility"]||"",label:"Reason for Starting",placeholder:"Select Reason for Starting",required:!0,computedValue:o=>({obs:s.buildReasonForArtObs(typeof o=="string"?o:o.label)})},whoStage:{value:e.observations["Who stage"]||"",label:"Select Stage",placeholder:"Select Stage",required:!0,computedValue:o=>({obs:s.buildWhoStageObs(typeof o=="string"?o:o.label)})},cd4countAvailable:{value:e.observations["CD4 count"]?"Yes":"No",label:"Recent CD4 Count results available?",required:!0},cd4CountDate:{value:e.observations["Cd4 count datetime"]||"",label:"CD4 Count date",placeholder:"CD4 Count date",computedValue:o=>({obs:s.buildValueDate("Cd4 count datetime",o)}),validation:async(o,l)=>{var t;return((t=l.cd4countAvailable)==null?void 0:t.value)==="Yes"&&v(o)}},cd4Count:{value:e.observations["CD4 count"]||"",label:"CD4 Count",placeholder:"CD4 Count e.g. <100 or >500",computedValue:o=>{const l=parseInt(o.substring(1)),t=o.substring(0,1);return{modifier:t,count:l,obs:s.buildValueNumber("CD4 count",l,t)}},validation:async(o,l)=>{var t;return((t=l.cd4countAvailable)==null?void 0:t.value)==="Yes"&&M([()=>v(o),()=>s.cd4CountIsValid(o.value.toString())?null:["Please start with a modifier. e.g. >, <, or ="]])}},cd4CountLocation:{value:e.observations["Cd4 count location"]||"",label:"CD4 Count location",computedValue:o=>({obs:s.buildValueText("Cd4 count location",typeof o=="string"?o:o.label)}),validation:async(o,l)=>{var t;return((t=l.cd4countAvailable)==null?void 0:t.value)==="Yes"&&v(o)}},whoConditions:{value:e.observations["Who stages criteria present"]?[{label:e.observations["Who stages criteria present"],value:e.observations["Who stages criteria present"]}]:"",required:!0,label:"Select Staging Conditions",computedValue:o=>({obs:typeof o=="string"?s.buildWhoCriteriaObs(o):o.map(l=>s.buildWhoCriteriaObs(l.label))})}}),b=async()=>{if(await O("Are you sure you want to clear all fields?")){for(const o in i)i[o].value=void 0,i[o].error="";P.emit(j.ON_CLEAR)}},f=async()=>{s.setDate(e.initialVisitDate),await B(i,async(o,l)=>{n("onValue",{type:"staging",data:{formData:o,computedData:l}}),n("onFinish")})},d=o=>{o&&(i.whoConditions.value="");const l=parseInt((o==null?void 0:o.split(" ")[2])||"1");p.value=s.getStagingConditions(l).map(t=>({label:t.name,value:t.name,other:t})).sort((t,A)=>t.label.localeCompare(A.label))};return D(()=>i.whoStage.value,o=>d(o==null?void 0:o.label)),D(()=>i.reasonsForEligibity.value,()=>{i.whoStage.value="",i.whoConditions.value=""}),N(()=>d()),{patientDob:V,form:i,whoStages:m,stagingCoditions:p,selectedConditions:C,reasonsForArt:g,getFacilities:q,onClear:b,onSubmit:f}}});function G(e,n,p,C,V,s){const g=u("ion-title"),m=u("SelectInput"),i=u("ion-col"),b=u("yes-no-input"),f=u("DateInput"),d=u("text-input"),o=u("ion-button"),l=u("ion-row");return w(),h(I,null,[a(g,{class:"ion-text-center ion-margin-vertical ion-padding-bottom bold"},{default:r(()=>[c(" Staging ")]),_:1}),a(l,{class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(m,{modelValue:e.form.reasonsForEligibity,"onUpdate:modelValue":n[0]||(n[0]=t=>e.form.reasonsForEligibity=t),options:e.reasonsForArt},null,8,["modelValue","options"])]),_:1}),a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(m,{modelValue:e.form.whoStage,"onUpdate:modelValue":n[1]||(n[1]=t=>e.form.whoStage=t),options:e.whoStages},null,8,["modelValue","options"])]),_:1}),a(i,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(b,{modelValue:e.form.cd4countAvailable,"onUpdate:modelValue":n[2]||(n[2]=t=>e.form.cd4countAvailable=t),inline:""},null,8,["modelValue"])]),_:1}),e.form.cd4countAvailable.value==="Yes"?(w(),h(I,{key:0},[a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(f,{modelValue:e.form.cd4CountDate,"onUpdate:modelValue":n[3]||(n[3]=t=>e.form.cd4CountDate=t),"min-date":e.patientDob,"max-date":e.initialVisitDate},null,8,["modelValue","min-date","max-date"])]),_:1}),a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(d,{modelValue:e.form.cd4Count,"onUpdate:modelValue":n[4]||(n[4]=t=>e.form.cd4Count=t)},null,8,["modelValue"])]),_:1}),a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(m,{modelValue:e.form.cd4CountLocation,"onUpdate:modelValue":n[5]||(n[5]=t=>e.form.cd4CountLocation=t),asyncOptions:e.getFacilities,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1})],64)):W("",!0),a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(m,{modelValue:e.form.whoConditions,"onUpdate:modelValue":n[6]||(n[6]=t=>e.form.whoConditions=t),options:e.stagingCoditions,multiple:""},null,8,["modelValue","options"])]),_:1}),a(i,{size:"12",class:"ion-margin-top"},{default:r(()=>[a(o,{class:"ion-margin-top ion-float-right",size:"large",onClick:e.onSubmit,color:"success"},{default:r(()=>[c("Finish")]),_:1},8,["onClick"]),a(o,{class:"ion-margin-top ion-float-right",size:"large",color:"warning",onClick:e.onClear},{default:r(()=>[c("Clear")]),_:1},8,["onClick"]),a(o,{class:"ion-margin-top ion-float-right",size:"large",onClick:n[7]||(n[7]=t=>e.$emit("onPrevious")),color:"primary"},{default:r(()=>[c("Previous")]),_:1})]),_:1})]),_:1})],64)}const So=H(K,[["render",G],["__scopeId","data-v-cc453135"]]);export{So as default};
