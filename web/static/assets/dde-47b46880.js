import{t as i,a as d}from"./toasts-efd70885.js";import{r as D,aC as b,ap as v,aO as g,ao as w}from"./index-0dab41e9.js";import{t as _}from"./his_date-1be895e6.js";const s=new b(v),o=D(!1),p=D([]);function f(a){return a.patient_identifiers.reduce((e,t)=>({...e,[t.type.name]:t.identifier}),{})["DDE person document ID"]}async function k(a){var t;if(o.value)return y(await s.findByNpid(a));const e=await g.searchByNpid(a);return e.ok?(d("DDE status updated"),e.data):(i((t=e.errorMessage)!=null?t:"Searching client by NPID returned error: ".concat(e.clientErrorType)),[])}async function I(a){var t;if(o.value)return y(await s.findByDemographics(a));const e=await g.searchBy(a);return e.ok?e.data:(i((t=e.errorMessage)!=null?t:"Searching client by Demographics returned error: ".concat(e.clientErrorType)),[])}async function B(a){var t;if(!await w("Are you sure you want to import client?"))return;const e=await s.importPatient(a);if(e.ok)return d("Client imported to local database"),e.data;i((t=e.errorMessage)!=null?t:"Error importing with error: ".concat(e.clientErrorType))}async function R(){o.value=await s.isDDeEnabled(),o.value&&await E()}async function $(a){var t;const e=await(a?s.enableDDe():s.disableDDe());e.ok?(o.value=a,d("DDE status updated")):i((t=e.errorMessage)!=null?t:"Unable to change status because ".concat(e.clientErrorType))}async function E(){var e,t,n,r;const a=await s.getRemainingNpids();if(a.ok&&a.data){const u=a.data.npid_status[0],c=(e=u.unassigned)!=null?e:0,l=(t=u.avg_consumption_rate_per_day)!=null?t:0,m=Math.floor(c/(l||1)),h=_(u.date_last_updated);p.value=[{label:"Assigned",value:(n=u.assigned)!=null?n:0},{label:"Unassigned",value:c},{label:"Average consumption per day",value:l},{label:"Estimated days left",value:m},{label:"Last Updated",value:h}],console.log("Npid status refreshed",p.value)}else i((r=a.errorMessage)!=null?r:"Unable to get NPID status because ".concat(a.clientErrorType))}function y(a){var e;return a.ok&&a.data?Object.keys(a.data).reduce((t,n)=>[...t,...a.data[n].map(r=>({...r,source:n,docID:f(r),ddeClientRequiresImport:f(r)&&n==="remotes"&&!r.patient_id}))],[]):(i((e=a.errorMessage)!=null?e:"An error happened with status code: ".concat(a.httpStatusResponse)),[])}export{k as a,I as b,o as d,E as g,B as i,p as n,R as r,$ as s};
