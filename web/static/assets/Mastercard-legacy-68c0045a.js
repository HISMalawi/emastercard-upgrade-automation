!function(){function e(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var l=t.call(e,a||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}System.register(["./index-legacy-11525bd0.js","./patient_service-legacy-d41ce981.js","./common-legacy-e8d6ba88.js","./consultation_service-legacy-ae1d3d79.js","./VoidReason-legacy-a77dba5f.js","./his_date-legacy-55fa139e.js","./DateInput.vue_vue_type_style_index_0_lang-legacy-7fdfee0a.js","./SelectInput-legacy-8a1f8c61.js","./regimen_service-legacy-7f33e2be.js","./encounter_types-legacy-4fed5cb0.js","./arrays-legacy-86abe4a8.js","./form-legacy-fd77c456.js","./emc_event-legacy-0252f26c.js","./toasts-legacy-7149d510.js","./Date-legacy-2bf00a21.js","./index-legacy-f4cad238.js","./loader-legacy-bf687919.js","./validations-legacy-9fbb99d9.js","./TextInput-legacy-788d8adc.js","./location_options-legacy-0691f861.js","./DTFormElements-legacy-6f485257.js","./YesNoInput-legacy-42479861.js","./DrilldownTable-legacy-a8ae302c.js","./Strs-legacy-b5721578.js","./relations_service-legacy-256117c5.js","./dde-legacy-a1ad88be.js","./patient_identifier_service-legacy-e658e724.js","./vue-datepicker-legacy-bbe1f770.js"],function(a,t){"use strict";var l,n,i,o,u,r,d,s,c,m,v,p,f,g,b,h,_,y,w,D,V,I,N,A,R,C,P,T,S,E,O,k,x,U,L,B,q,G,M,F,z,H,$,j,W,Y,J,Q,K,X,Z,ee,ae,te,le,ne,ie,oe,ue,re,de,se,ce,me,ve,pe,fe,ge,be,he,_e,ye,we,De,Ve,Ie,Ne,Ae,Re,Ce,Pe,Te,Se,Ee,Oe,ke,xe,Ue,Le,Be,qe,Ge,Me,Fe,ze,He,$e,je,We,Ye,Je,Qe,Ke,Xe,Ze,ea,aa,ta,la,na,ia,oa,ua,ra,da,sa,ca,ma;return{setters:[e=>{l=e.K,n=e.k,i=e.d,o=e.r,u=e.aj,r=e.a8,d=e.i,s=e.c,c=e.e,m=e.w,v=e.u,p=e.M,f=e.o,g=e.v,b=e.a2,h=e.b,_=e.U,y=e.l,w=e.m,D=e.n,V=e.L,I=e.x,N=e.aB,A=e.G,R=e.I,C=e.am,P=e.s,T=e.aq,S=e.h,E=e._,O=e.N,k=e.a,x=e.j,U=e.A,L=e.W,B=e.P,q=e.t,G=e.Y,M=e.aF,F=e.aG,z=e.aH,H=e.aI,$=e.aJ,j=e.aK,W=e.aL,Y=e.a7,J=e.aM,Q=e.p,K=e.a6,X=e.aN,Z=e.aO,ee=e.ak,ae=e.aD,te=e.ar,le=e.aP},e=>{ne=e.g,ie=e.D,oe=e.C,ue=e.P,re=e.O},e=>{de=e.g,se=e.i},e=>{ce=e.A,me=e.u,ve=e.V,pe=e.C,fe=e.E},e=>{ge=e.p},e=>{be=e.a,he=e.t,_e=e.d,ye=e.e,we=e.f},e=>{De=e._},e=>{Ve=e.S},e=>{Ie=e.N,Ne=e.R},e=>{Ae=e.e},e=>{Re=e.s,Ce=e.a,Pe=e.c,Te=e.u},e=>{Se=e.s,Ee=e.i,Oe=e.r,ke=e.a},e=>{xe=e.E,Ue=e.a},e=>{Le=e.a,Be=e.t},e=>{qe=e.D},e=>{Ge=e.D},e=>{Me=e.l},e=>{Fe=e.d,ze=e.r,He=e.v,$e=e.e,je=e.f,We=e.g,Ye=e.a,Je=e.b,Qe=e.c},e=>{Ke=e.T},e=>{Xe=e.g,Ze=e.a,ea=e.b},e=>{aa=e.t,ta=e.g},e=>{la=e.Y},e=>{na=e.D},e=>{ia=e.t,oa=e.i},e=>{ua=e.P,ra=e.R},e=>{da=e.r,sa=e.d,ca=e.h,ma=e.a},null,null],execute:function(){var t=document.createElement("style");t.textContent="ion-label[data-v-1fc2510f]{font-weight:700}ion-checkbox[data-v-1fc2510f]{--size: 20px !important}.title[data-v-824715c1]{font-weight:700}ion-list[data-v-1195e33c]{height:100%}\n",document.head.appendChild(t);const va=e=>{const a=e.given_name,t=e.family_name;return`${a} ${e.middle_name?e.middle_name:""} ${t}`};class pa{static getRelationships(e){return l.getJson(`/people/${e}/relationships`).then(e=>e.data)}static async getGuardianDetails(e){return await this.getRelationships(e).then(e=>e.map(e=>{const a=de(e,"relation.names[0]");return{id:e.relationship_id,name:a?va(a):"",relationshipType:de(e,"type.b_is_to_a",""),phoneNumber:ne(de(e,"relation.person_attributes",[]),12),names:a}}))}}class fa extends ce{constructor(e){super(e,Ae.LAB_ORDERS,be())}async loadConcepts(){fa.conceptID=await ce.getConceptID("HIV Viral Load")}createLabOrder(e,a){const t=l.getUsername(),i=n().facility.name,o=ce.getCachedConceptID(a,!0);return l.postJson("/lab/orders",{encounter_id:this.encounterID,orders:[{requesting_clinician:t,target_lab:i,reason_for_test_id:o,encounter_id:this.encounterID,tests:[{concept_id:fa.conceptID}],date:this.date,specimen:{concept_id:e}}]})}createLabResult(e,a,t,n="numeric"){return l.postJson(`lab/tests/${e}/results`,{encounter_id:this.encounterID,date:this.date,measures:[{indicator:{concept_id:fa.conceptID},value:a,value_modifier:t,value_type:n}]})}static getSpecimens(e){return l.getJson("/lab/specimen_types",{test_type:e})}static async getOrders(e,a={}){var t;return null!==(t=(await l.getJson("/lab/orders",{patient_id:e,...a})).data)&&void 0!==t?t:[]}static async getViralLoadResultTrail(e,a={}){return(await this.getOrders(e,a)).reduce((e,a)=>(a.tests.forEach(t=>t.result.forEach(l=>e.push({...a,test:t.name,result:`${l.value_modifier} ${l.value}`,result_date:l.date}))),e),[])}static async getlatestViralLoadResult(e,a={}){const t=(await this.getOrders(e,a)).flatMap(e=>e.tests.flatMap(e=>e.result)).filter(Boolean);if(se(t))return"N/A";const l=Re(t,"date","desc")[0];return`${l.value_modifier}${l.value} (${he(l.date)})`}}e(fa,"conceptID",-1);const ga=i({__name:"ViralLoadResult",props:{patient:{type:Object,required:!0}},setup(e){const a=e,t=o(!1),l=Ce(["=",">","<",">=","<="]),n=Ce(["Routine","Targeted","Confirmatory","Stat","Repeat / Missing","Follow up after Low Level Viremia","Follow up after High Viral Load"]),i=o([]),S=a.patient.getBirthdate(),E=u({orderDate:{value:"",label:"Order Date",required:!0,validation:async e=>_e(e.value).isValid()?new Date(e.value)>new Date(be())?["Order date cannot be in the future"]:new Date(e.value)<new Date(S)?["Order date cannot be before patient's date of birth"]:null:["Invalid date"]},resultDate:{value:"",label:"Result Date",required:!0,validation:async(e,a)=>_e(e.value).isValid()?new Date(e.value)>new Date(be())?["Result date cannot be in the future"]:new Date(e.value)<new Date(a.orderDate.value)?["Result date cannot be before order date"]:null:["Invalid date"]},specimen:{value:"",label:"Specimen",placeholder:"Select a specimen",required:!0},modifier:{value:"",label:"Modifier",placeholder:"Select a modifier",required:!0},reason:{value:"",label:"Reason",placeholder:"Select a reason",required:!0},result:{value:"",label:"Result Value",placeholder:"Enter a result value",required:!0}});async function O(){Se(E,async e=>{const l=new fa(a.patient.getID());await l.loadConcepts(),l.setDate(e.orderDate);if(!(await l.createEncounter()))throw new Error("Unable to create lab order encounter");const n=await l.createLabOrder(e.specimen.value,e.reason.value);if(!n.ok||!n.data)throw new Error("Unable to save lab orders");const i=new fa(a.patient.getID());i.setDate(e.resultDate);if(!(await i.createEncounter()))throw new Error("Unable to create lab result encounter");const o=t.value?"LDL":parseInt(e.result),u=t.value?"=":e.modifier.value,r=t.value?"text":"numeric",d=n.data[0].tests[0].id;await i.createLabResult(d,o,u,r),await C.hide(),xe.emit(Ue.RELOAD_LATEST_VL_RESULT),xe.emit(Ue.RELOAD_PATIENT_VISIT_DATA)})}async function k(){if(await T("Are you sure you want to clear all fields?")){t.value=!1;for(const e in E)E[e].value="",E[e].error="";xe.emit(Ue.ON_CLEAR)}}return r(t,e=>{e&&(E.modifier.value="",E.result.value=void 0,E.modifier.error="",E.result.error=""),E.modifier.disabled=e,E.modifier.required=!e,E.result.disabled=e,E.result.required=!e}),d(async()=>{i.value=(await fa.getSpecimens("HIV viral load")).data.map(e=>({label:e.name,value:e.concept_id}))}),(e,a)=>(f(),s(p,null,[c(v(_),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(b),null,{default:m(()=>[...a[8]||(a[8]=[h("Viral Load Results",-1)])]),_:1})]),_:1})]),_:1}),c(v(A),{class:"ion-padding"},{default:m(()=>[c(v(y),{style:{width:"100%"}},{default:m(()=>[c(v(w),null,{default:m(()=>[c(v(D),{size:"12",class:"ion-margin-vertical"},{default:m(()=>[c(De,{modelValue:E.orderDate,"onUpdate:modelValue":a[0]||(a[0]=e=>E.orderDate=e),form:E,minDate:v(S),maxDate:v(be)},null,8,["modelValue","form","minDate","maxDate"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ve,{modelValue:E.reason,"onUpdate:modelValue":a[1]||(a[1]=e=>E.reason=e),options:v(n)},null,8,["modelValue","options"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ve,{modelValue:E.specimen,"onUpdate:modelValue":a[2]||(a[2]=e=>E.specimen=e),options:i.value},null,8,["modelValue","options"])]),_:1}),c(v(D),{size:"12",class:"ion-margin-vertical"},{default:m(()=>[c(De,{modelValue:E.resultDate,"onUpdate:modelValue":a[3]||(a[3]=e=>E.resultDate=e),form:E,minDate:E.orderDate.value,"max-date":v(be)},null,8,["modelValue","form","minDate","max-date"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ve,{modelValue:E.modifier,"onUpdate:modelValue":a[4]||(a[4]=e=>E.modifier=e),options:v(l)},null,8,["modelValue","options"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:E.result,"onUpdate:modelValue":a[5]||(a[5]=e=>E.result=e),form:E,min:1},null,8,["modelValue","form"])]),_:1})]),_:1}),c(v(w),{class:"ion-margin-top"},{default:m(()=>[c(v(D),{size:"12"},{default:m(()=>[c(v(V),{class:"ion-padding-vertical bold"},{default:m(()=>[...a[9]||(a[9]=[h(" Other Results Options: ",-1)])]),_:1}),c(v(I),null,{default:m(()=>[c(v(V),null,{default:m(()=>[...a[10]||(a[10]=[h("LDL",-1)])]),_:1}),c(v(N),{slot:"start",modelValue:t.value,"onUpdate:modelValue":a[6]||(a[6]=e=>t.value=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),c(v(P),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(R),{color:"primary",onClick:a[7]||(a[7]=e=>v(C).hide()),slot:"end"},{default:m(()=>[...a[11]||(a[11]=[h(" Close ",-1)])]),_:1}),c(v(R),{color:"warning",onClick:k,slot:"end"},{default:m(()=>[...a[12]||(a[12]=[h(" Reset ",-1)])]),_:1}),c(v(R),{color:"success",onClick:O,slot:"end"},{default:m(()=>[...a[13]||(a[13]=[h(" Save ",-1)])]),_:1})]),_:1})]),_:1})],64))}}),ba=i({name:"OutcomesTable",props:{patientStates:{type:Array,required:!0}},components:{DataTable:Ge},emits:["voidOutcome"],setup(e,{emit:a}){const t=[{path:"name",label:"Outcome"},{path:"start_date",label:"Start Date",formatter:e=>_e(e).format(qe)},{path:"end_date",label:"End Date",formatter:e=>_e(e).format(qe)}];return{rows:S(()=>e.patientStates.map((e,a)=>({...e,index:a}))),columns:t,tableConfig:{showSearchField:!1,showSubmitButton:!1},TableRowActions:[{label:"void",color:"danger",action:async e=>{await T("Are you sure you want to void this outcome?")&&a("voidOutcome",{stateId:e.patient_state_id,index:e.index})}}]}}});const ha=E(ba,[["render",function(e,a,t,l,n,i){const o=O("data-table");return f(),s(p,null,[a[0]||(a[0]=k("p",{class:"ion-padding-horizontal ion-margin-vertical bold ion-margin-top"},"Previous Outcomes",-1)),c(o,{rows:e.rows,columns:e.columns,config:e.tableConfig,"row-actions-buttons":e.TableRowActions,color:"light"},null,8,["rows","columns","config","row-actions-buttons"])],64)}]]),_a=i({name:"EnrollmentForm",components:{DateInput:De,IonGrid:y,IonRow:w,IonCol:D,IonButton:R},props:["birthdate","patientId"],setup(e){const a=u({programId:{label:"Select program",required:!0,value:""},date:{value:"",label:"Date of Enrollment",required:!0,validation:async a=>Fe(a,e.birthdate)}}),{enrollPatient:t,fetchPatientPrograms:l}=me(e.patientId);return{form:a,today:be,onReset:async()=>{await T("Are you sure you want to clear all fields")&&(a.date.value="",a.date.error="",xe.emit(Ue.ON_CLEAR))},enrollProgram:async function(){await Ee(a)&&Me.show(),await t(a.date.value),await Le("Program enrolled successfully"),await C.hide(),l().catch(console.error)}}}});const ya=E(_a,[["render",function(e,a,t,l,n,i){const o=O("DateInput"),u=O("ion-col"),r=O("ion-button"),d=O("ion-row"),s=O("ion-grid");return f(),x(s,null,{default:m(()=>[c(d,null,{default:m(()=>[c(u,{size:"12"},{default:m(()=>[c(o,{modelValue:e.form.date,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.date=a),form:e.form,minDate:e.birthdate,"max-date":e.today},null,8,["modelValue","form","minDate","max-date"])]),_:1}),c(u,null,{default:m(()=>[c(r,{color:"warning",onClick:e.onReset},{default:m(()=>[...a[1]||(a[1]=[h("Reset",-1)])]),_:1},8,["onClick"]),c(r,{color:"success",onClick:e.enrollProgram},{default:m(()=>[...a[2]||(a[2]=[h("Enroll",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}]]),wa=i({name:"OutcomeForm",props:{outcomes:{type:Array,required:!0},dateEnrolled:{type:String,required:!0},birthdate:{type:String,required:!0}},components:{DateInput:De,IonGrid:y,IonRow:w,IonCol:D,IonButton:R,SelectInput:Ve,TextInput:Ke},emits:["saveOutcome"],setup(e,{emit:a}){const t=_e().format("YYYY-MM-DD"),l=u({date:{value:"",label:"Outcome Date",required:!0,validation:async a=>new Date(a.value)<new Date(e.birthdate)?[`Outcome date cannot be before date of birth - ${_e(e.birthdate).format(qe)}`]:new Date(a.value)<new Date(e.dateEnrolled)?[`Outcome date cannot be before enrollment date- ${_e(e.dateEnrolled).format(qe)}`]:null},status:{value:"",label:"Outcome",required:!0},nextFacility:{value:"",label:"Next Facility",validation:async(e,a)=>"Patient transferred out"===a.status.value.label&&ze(e)},reason:{value:"",label:"Reason for transfer out",validation:async(e,a)=>"Patient transferred out"===a.status.value.label&&ze(e)},otherReason:{value:"",label:"Other reason for transfer out",placeholder:"Specify other reason for transfer out",validation:async(e,a)=>{var t,l;return"Patient transferred out"===(null===(t=a.status)||void 0===t||null===(t=t.value)||void 0===t?void 0:t.label)&&"Other"===(null===(l=a.reason)||void 0===l||null===(l=l.value)||void 0===l?void 0:l.label)&&ze(e)}}}),n=S(()=>{var e;return"Patient transferred out"===(null===(e=l.status.value)||void 0===e?void 0:e.label)}),i=S(()=>{var e;return"Other"===(null===(e=l.reason)||void 0===e||null===(e=e.value)||void 0===e?void 0:e.label)});return{form:l,today:t,isTransferredOut:n,specifyOther:i,onSave:()=>Se(l,e=>a("saveOutcome",{...e,isTransferredOut:n.value})),onReset:async()=>{if(await T("are you sure you want to clear all fields")){for(const e in l)l[e].value="",l[e].error="";xe.emit(Ue.ON_CLEAR)}},getFacilities:Xe,transferOutReasons:aa}}});const Da=E(wa,[["render",function(e,a,t,l,n,i){const o=O("ion-col"),u=O("DateInput"),r=O("SelectInput"),d=O("text-input"),v=O("ion-button"),g=O("ion-row"),b=O("ion-grid");return f(),x(b,null,{default:m(()=>[c(g,null,{default:m(()=>[c(o,{size:"12"},{default:m(()=>[...a[5]||(a[5]=[k("p",null,"Add New Outcome",-1)])]),_:1}),c(o,{size:"6",class:"ion-margin-top-vertical"},{default:m(()=>[c(u,{modelValue:e.form.date,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.date=a),form:e.form,minDate:e.dateEnrolled,"max-date":e.today},null,8,["modelValue","form","minDate","max-date"])]),_:1}),c(o,{size:"6",class:"ion-margin-top-vertical"},{default:m(()=>[c(r,{modelValue:e.form.status,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.status=a),form:e.form,options:e.outcomes},null,8,["modelValue","form","options"])]),_:1}),e.isTransferredOut?(f(),s(p,{key:0},[c(o,{size:"6",class:"ion-margin-top-vertical"},{default:m(()=>[c(r,{modelValue:e.form.nextFacility,"onUpdate:modelValue":a[2]||(a[2]=a=>e.form.nextFacility=a),form:e.form,asyncOptions:e.getFacilities},null,8,["modelValue","form","asyncOptions"])]),_:1}),c(o,{size:"6",class:"ion-margin-top-vertical"},{default:m(()=>[c(r,{modelValue:e.form.reason,"onUpdate:modelValue":a[3]||(a[3]=a=>e.form.reason=a),form:e.form,options:e.transferOutReasons},null,8,["modelValue","form","options"])]),_:1}),e.specifyOther?(f(),x(o,{key:0,size:"12",class:"ion-margin-top-vertical"},{default:m(()=>[c(d,{modelValue:e.form.otherReason,"onUpdate:modelValue":a[4]||(a[4]=a=>e.form.otherReason=a),form:e.form},null,8,["modelValue","form"])]),_:1})):U("",!0)],64)):U("",!0),c(o,{size:"12",class:"ion-margin-top"},{default:m(()=>[c(v,{color:"warning",onClick:e.onReset},{default:m(()=>[...a[6]||(a[6]=[h("Reset",-1)])]),_:1},8,["onClick"]),c(v,{color:"success",onClick:e.onSave},{default:m(()=>[...a[7]||(a[7]=[h("Save",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}]]),Va={class:"ion-page",id:"main"},Ia={class:"ion-margin-start"},Na=i({__name:"OutcomeStatus",props:{patient:{type:Object,required:!0}},setup(e){const a=e,t=o(),l=S(()=>a.patient.getID()),n=S(()=>{var e;return null===(e=t.value)||void 0===e||null===(e=e.other)||void 0===e?void 0:e.date_enrolled}),i=S(()=>ye(a.patient.getBirthdate())),u=S(()=>{var e;return T.value.get(null===(e=t.value)||void 0===e?void 0:e.value)}),r=S(()=>{var e,a;return null!==(e=null===(a=t.value)||void 0===a||null===(a=a.other)||void 0===a||null===(a=a.patient_states)||void 0===a?void 0:a.length)&&void 0!==e?e:0}),{patientPrograms:N,programStates:T,hasArtProgram:E,updateState:H,voidProgram:$,voidState:j,fetchPatientPrograms:W}=me(l.value);async function Y(e){var a;const{date:n,status:i,nextFacility:o,reason:u,otherReason:r,isTransferredOut:d}=e;if(d){const e="Other"!==u.value?u.value:r;await async function(e,a,t=""){const n=new ce(l.value,Ae.EXIT_FROM_HIV_CARE,a);if(!(await n.createEncounter()))throw"Unable to transfer out encounter";return t&&await n.saveValueTextObs("Reason for transfer out",t),n.saveValueTextObs("Transfer to",e.name)}(o.other,n,e)}await H(i.value,n,null===(a=t.value)||void 0===a?void 0:a.value),await Le("Outcome saved successfully",1e3),await C.hide(),xe.emit(Ue.RELOAD_PATIENT_VISIT_DATA)}async function J(){var e,a;await $(null!==(e=null===(a=t.value)||void 0===a||null===(a=a.other)||void 0===a?void 0:a.patient_program_id)&&void 0!==e?e:-1,"duplicate / system error"),await Le("Patient voided from program successfully",1e3),await C.hide(),xe.emit(Ue.RELOAD_PATIENT_VISIT_DATA)}async function Q({stateId:e,index:a}){var l,n;await j(e,"duplicate / system error",null===(l=t.value)||void 0===l?void 0:l.value),Le("Outcome voided successfully"),null===(n=t.value)||void 0===n||null===(n=n.other)||void 0===n||n.patient_states.splice(a,1),xe.emit(Ue.RELOAD_PATIENT_VISIT_DATA)}async function K(){await C.show(ya,{birthdate:i.value,patientId:l.value},"custom-modal custom-modal-backdrop")}return d(W),(e,a)=>{const l=O("ion-icon"),o=O("ion-buttons");return f(),x(v(z),{when:"xs",contentId:"main"},{default:m(()=>[c(v(G),{contentId:"main"},{default:m(()=>[c(v(_),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(b),null,{default:m(()=>[...a[0]||(a[0]=[h("Patient Programs",-1)])]),_:1})]),_:1})]),_:1}),c(v(A),{class:"ion-no-padding"},{default:m(()=>[c(v(L),null,{default:m(()=>[(f(!0),s(p,null,B(v(N),e=>{var a;return f(),x(v(I),{button:"",key:e.value,color:e.value===(null===(a=t.value)||void 0===a?void 0:a.value)?"secondary":"light",onClick:a=>function(e){t.value=e}(e)},{default:m(()=>[c(v(V),null,{default:m(()=>[h(q(e.label),1)]),_:2},1024)]),_:2},1032,["color","onClick"])}),128))]),_:1})]),_:1}),c(v(P),null,{default:m(()=>[c(v(g),{class:"ion-padding-start"},{default:m(()=>[t.value?(f(),x(v(R),{key:0,color:"danger",onClick:J,slot:"start"},{default:m(()=>[...a[1]||(a[1]=[h("Void Program",-1)])]),_:1})):U("",!0),v(E)?U("",!0):(f(),x(v(R),{key:1,onClick:K,slot:"start"},{default:m(()=>[...a[2]||(a[2]=[h("Enroll HIV Program",-1)])]),_:1}))]),_:1})]),_:1})]),_:1}),k("div",Va,[c(v(_),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(o,{slot:"end"},{default:m(()=>[c(v(R),{onClick:v(C).hide,color:"danger",size:"large"},{default:m(()=>[c(l,{size:"large",icon:v(M)},null,8,["icon"])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),c(v(A),{class:"ion-padding"},{default:m(()=>[t.value?(f(),x(v(y),{key:0,style:{width:"100%"}},{default:m(()=>[c(v(w),{class:"his-card",style:F({minHeight:r.value?"0":"30vh"})},{default:m(()=>[c(v(D),{size:"12",class:"ion-no-padding"},{default:m(()=>{var e,a;return[k("h5",Ia," Enrollment Date: "+q(n.value?v(he)(n.value):"Unknown"),1),c(ha,{patientStates:null!==(e=null===(a=t.value)||void 0===a||null===(a=a.other)||void 0===a?void 0:a.patient_states)&&void 0!==e?e:[],onVoidOutcome:Q},null,8,["patientStates"])]}),_:1})]),_:1},8,["style"]),u.value?(f(),x(v(w),{key:0,class:"his-card ion-margin-top",style:{"margin-bottom":"0.4rem"}},{default:m(()=>[c(Da,{"date-enrolled":n.value,birthdate:i.value,outcomes:u.value,onSaveOutcome:Y},null,8,["date-enrolled","birthdate","outcomes"])]),_:1})):U("",!0)]),_:1})):U("",!0)]),_:1}),c(v(P),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(R),{slot:"end",color:"warning"},{default:m(()=>[...a[3]||(a[3]=[h(" Reset ",-1)])]),_:1}),c(v(R),{slot:"end",color:"primary"},{default:m(()=>[...a[4]||(a[4]=[h(" Submit ",-1)])]),_:1})]),_:1})]),_:1})])]),_:1})}}}),Aa=i({name:"MultiColumnView",components:{IonGrid:y,IonRow:w,IonCol:D},props:{items:{type:Object,required:!0},numberOfColumns:{type:Number,default:1}},setup:e=>({computedItems:S(()=>Pe(e.items,Math.ceil(e.items.length/e.numberOfColumns))),grid:{1:"12",2:"6",3:"4",4:"3",6:"2"}})});const Ra=E(Aa,[["render",function(e,a,t,l,n,i){const o=O("ion-col"),u=O("ion-row"),r=O("ion-grid");return f(),x(r,null,{default:m(()=>[c(u,null,{default:m(()=>[(f(!0),s(p,null,B(e.computedItems,(a,t)=>(f(),x(o,{key:t,size:e.grid[e.numberOfColumns]},{default:m(()=>[H(e.$slots,"default",{entries:a})]),_:2},1032,["size"]))),128))]),_:3})]),_:3})}]]);class Ca extends ce{constructor(e,a=be()){super(e,Ae.HIV_RECEPTION,a)}}class Pa extends ce{constructor(e,a=be()){super(e,Ae.ART_ADHERENCE,a)}buildPillCountObs(e,a){return this.buildValueNumber("Number of tablets brought to clinic",a,null,e)}async buildAdherenceObs(e,a,t){return{concept_id:await ce.getConceptID("Drug adherence",!0),value_numeric:t,value_drug:a,value_modifier:"%",order_id:e,person_id:this.patientID,obs_datetime:this.date}}calculateAdherence(e,a,t){return Math.round(100*(e-a)/(e-t))}calculateExpected(e,a,t,l){const n="QW"===l?"week":"day";return e-this.calcTimeElapsed(t,n)*parseFloat(a.toString())}calcTimeElapsed(e,a){return _e(this.date).diff(e,a)+1}}class Ta extends ce{constructor(e,a=be()){super(e,Ae.APPOINTMENT,a)}}class Sa extends ce{constructor(e,a=be()){super(e,Ae.TREATMENT,a)}calculateDosage(e,a){let t=0;return 0===a&&(t=e),0==e&&(t=a),e>0&&a>0&&(t=(e+a)/2),t}calculateEquivalentDosage(e,a){return e+a}calculateDrugRunOutDate(e,a){return ye(_e(a).add(e,"days"))}getInstructions(e,a,t,l){return`${e} :- Morning: ${a} ${l}, Evening: ${t} ${l}`}toDrugOrder(e,a,t,l){return{drug_inventory_id:e.drug_id,equivalent_daily_dose:this.calculateEquivalentDosage(e.am,e.pm),start_date:l,auto_expire_date:this.calculateDrugRunOutDate(t,l),units:e.units,instructions:this.getInstructions(e.drug_name,e.am,e.pm,e.units),dose:this.calculateDosage(e.am,e.pm),frequency:e.frequency,qty:a}}async createDrugOrder(e){return ie.create({encounter_id:this.encounterID,drug_orders:e})}}class Ea{static async getBMIData(){return(await fetch("/bmi.json")).json()}static async getBMIResult(e,a,t){let l={result:"",color:"",index:t};if(t<=0)return l.index=0,l;if(a<5&&a>0)l.result="Use MUAC to calculate nutrition status",l.color="red";else{a>18&&(a=19);const n=await this.getBMIData(),i=n[e][a];i&&(l=this.buildBounds(Object.keys(i),i,t,n.colors))}return l}static buildBounds(e,a,t,l){const n={result:"",color:"",index:t};return e.forEach(e=>{if(e.indexOf("-")>=0){const i=e.split("-");t>=parseFloat(i[0])&&t<=parseFloat(i[1])&&(n.result=a[e],n.color=l[a[e]])}else if(e.indexOf("<")>=0){const i=e.replace("<","");t<parseFloat(i)&&(n.result=a[e],n.color=l[a[e]])}else if(e.indexOf(">=")>=0){const i=e.replace(">=","");t>=parseFloat(i)&&(n.result=a[e],n.color=l[a[e]])}}),n}static getBMI(e,a,t,l){const n=this.calculateBMI(e,a);return this.getBMIResult(t,l,n)}static calculateBMI(e,a){if(0==a||0==e)return 0;let t=e/a/a*1e4;return Math.round(10*t)/10}}class Oa extends ce{constructor(e,a=be()){super(e,Ae.DISPENSING,a)}buildDispensations(e,a,t){const l=[];for(let n=0;n<t;n++)l.push({drug_order_id:e,date:this.date,quantity:a/t});return l}saveDispensations(e){return l.postJson("/dispensations",{dispensations:e,program_id:this.programID})}}const ka=E(i({__name:"PatientVisit",props:{patient:{type:Object,required:!0}},setup(e){const a=e,t=S(()=>a.patient.getID()),l=new ve(t.value),i=new pe(t.value),E=new Sa(t.value),O=new Oa(t.value),k=new Ca(t.value),L=new Pa(t.value),G=new Ta(t.value),M=o(),F=o(),z=o([]),H=o([]),Y=o([]),J=o([]),Q=S(()=>a.patient.isFemale()),K=o(""),X=a.patient.getBirthdate(),Z=o(!1),ee=u({}),ae=S(()=>!(M.value&&a.patient.getAge()>18)),{isDICSite:te,refreshDICStatus:le}=n(),{enrollPatient:ne,fetchPatientPrograms:ue,hasProgram:re,updateState:de}=me(t.value),ce=u({visitDate:{value:_e().format("YYYY-MM-DD"),label:"Visit Date",required:!0,validation:async e=>new Date(e.value)>new Date(be())?["Visit date cannot be after today's date"]:Fe(e,X)},weight:{value:void 0,label:"Weight",required:!0,computedValue:e=>({tag:"vitals",obs:l.buildValueNumber("Weight",e)}),validation:(e,a)=>!se(e)&&e.value||"No"!==a.patientPresent.value?He([()=>ze(e),()=>je(e,"DECIMALS"),()=>We(e,2,250)]):null},bp:{value:"",label:"Blood Pressure (mmHG)",placeholder:"Enter Blood Pressure e.g 120/80",validation:e=>se(e)||!e.value?null:$e(e),computedValue:e=>{if(se(e))return null;const[a,t]=e.split("/").map(Number);return{tag:"vitals",obs:[l.buildValueNumber("Systolic",a),l.buildValueNumber("Diastolic",t)]}}},height:{value:void 0,label:"Height (cm)",computedValue:e=>({tag:"vitals",obs:l.buildValueNumber("Height",e)}),validation:e=>ae.value&&(!se(e)&&e.value||"No"!==ce.patientPresent.value)?He([()=>ze(e),()=>je(e),()=>We(e,20,220)]):null},isPregnant:{value:void 0,label:"Is the patient pregnant?",required:Q.value,computedValue:e=>({tag:"consultation",obs:i.buildValueCoded("Is patient pregnant",e)}),validation:async e=>Q.value&&ze(e)},isBreastfeeding:{value:void 0,label:"Is the patient breastfeeding?",required:Q.value,computedValue:e=>({tag:"consultation",obs:i.buildValueCoded("Is patient breast feeding",e)}),validation:async e=>Q.value&&ze(e)},nextAppointmentDate:{value:void 0,label:"Next Appointment Date",required:!0,computedValue:e=>({tag:"appointment",obs:G.buildValueDate("Appointment date",e)}),validation:async(e,a)=>new Date(e.value)<new Date(a.visitDate.value)?["Appointment date cannot be before visit date"]:new Date(e.value)>new Date(K.value)?["Appointment date cannot be after drug run out date"]:null},patientPresent:{value:void 0,label:"Is the patient present?",required:!0,computedValue:e=>({tag:"reception",obs:k.buildValueCoded("Patient present",e)})},guardianPresent:{value:void 0,label:"Is the guardian present?",required:!0,computedValue:e=>({tag:"reception",obs:k.buildValueCoded("Guardian present",e)})},pillCount:{value:void 0,label:"Pill Count",required:J.value.length>0,validation:async e=>J.value.length>0&&je(e)},regimen:{value:void 0,label:"Regimen",placeholder:"Select a regimen",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","Antiretroviral drugs")})},totalCPTGiven:{value:void 0,label:"Total CPT Given",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","CPT")})},totalIPTGiven:{value:void 0,label:"Total IPT Given",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","INH")}),validation:async(e,a)=>{var t,l;return("6H"===(null===(t=a.tbMed.value)||void 0===t?void 0:t.label)||"3HP (RFP + INH)"===(null===(l=a.tbMed.value)||void 0===l?void 0:l.label))&&je(e)}},totalRFPGiven:{value:void 0,label:"Total RFP Given",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","3HP (RFP + INH)")}),validation:async(e,a)=>{var t;return"3HP (RFP + INH)"===(null===(t=a.tbMed.value)||void 0===t?void 0:t.label)&&je(e)}},total3HPGiven:{value:void 0,label:"Total 3HP Given",computedValue:()=>({tag:"consultation",obs:E.buildValueCoded("Medication orders","INH 300 / RFP 300 (3HP)")}),validation:async(e,a)=>{var t;return"3HP (INH 300 / RFP 300)"===(null===(t=a.tbMed.value)||void 0===t?void 0:t.label)&&je(e)}},totalPyridoxineGiven:{value:void 0,label:"Total Pyridoxine Given",validation:async(e,a)=>{var t;return(null===(t=a.tbMed.value)||void 0===t?void 0:t.label)&&je(e)}},tbMed:{value:void 0,label:"TPT Medication",placeholder:"Select a TPT medication"},hasContraindications:{value:"No",label:"Has Side Effects / Contraindications ?",validation:async e=>He([()=>ze(e),()=>"No"===e.value||H.value.some(e=>e.isChecked)?null:["Please select at least one side effect"]])},hasSideEffects:{value:"No",label:"Has Other Side Effects ?",validation:async e=>He([()=>ze(e),()=>"No"===e.value||Y.value.some(e=>e.isChecked)?null:["Please select at least one side effect"]])},tbStatus:{value:void 0,label:"TB Status",required:!0,computedValue:e=>({tag:"consultation",obs:i.buildValueCoded("TB Status",e.value)})},tbTreatmentStartDate:{value:"",label:"TB treatment start date",validation:async e=>{if(!Z.value){if(new Date(e.value)>new Date(be()))return["TB treatment start date cannot be after today's date"];if(new Date(e.value)<new Date(X))return["TB treatment start date cannot be before patient's birth date"]}return null},computedValue:e=>({tag:"consultation",obs:i.buildValueDate("TB treatment start date",e)})},tbTreatmentPeriod:{value:void 0,label:"TB treatment period (months)",computedValue:e=>({tag:"consultation",obs:i.buildValueNumber("TB treatment period",e)})},cxrResult:{value:"",label:"CXR (Chest X-ray) Screening method Result",computedValue:e=>({tag:"consultation",obs:i.buildGroupValueCoded("TB screening method used","chest xray",e)})},mwrdResult:{value:"",label:"mWRD (Molecular WHO Recommended Rapid Diagnostic test) Screening method Result",computedValue:e=>({tag:"consultation",obs:i.buildGroupValueCoded("TB screening method used","Molecular WHO Recommended Rapid Diagnostic test",e)})}});r(()=>ce.regimen.value,e=>{var a;(ta(),e)&&(null==e||null===(a=e.other)||void 0===a||a.forEach(e=>{var a;ee[e.drug_name]={label:`${null!==(a=e.alternative_drug_name)&&void 0!==a?a:e.drug_name} given`,value:0,required:!0,validation:e=>He([()=>je(e,"POSITIVE_INTEGERS"),()=>Number(e.value)%30!=0?["Quantity should be in multiples of 30"]:null])}}))}),r(ce.patientPresent,e=>{"No"===e.value?(ce.weight.required=!1,ce.weight.error="",ce.guardianPresent.value="Yes"):ce.weight.required=!0}),r(ce.guardianPresent,e=>{"No"===e.value&&(ce.patientPresent.value="Yes")}),r([()=>ce.weight.value,()=>ce.tbStatus.value],async([e,a])=>{var t;ce.regimen.value=void 0,ta();const l=/confirmed/i.test(null!==(t=null==a?void 0:a.label)&&void 0!==t?t:"");e?(z.value=await Ne.getRegimensByWeight(ce.weight.value,l),ce.patientPresent.value="Yes",ce.patientPresent.disabled=!0):!e&&ce.weight.required&&(ce.patientPresent.value=void 0,ce.patientPresent.disabled=!1),ce.tbMed.disabled=l}),r(()=>ce.nextAppointmentDate.value,async e=>{_e(K.value).diff(_e(e),"days")>7&&await T("Appointment date is more than 7 days earlier than drug run out date. The client will have excess medication",{header:"Drug Dispensation Alert",icon:$,confirmBtnLabel:"OK",showCancelBtn:!1,color:"danger"})});const fe=()=>{var e,a;return se(ee)?1/0:Math.min(...(null!==(e=null===(a=ce.regimen.value)||void 0===a?void 0:a.other)&&void 0!==e?e:[]).map(e=>{var a,t,l,n,i;return(null!==(a=null===(t=ee[e.drug_name])||void 0===t?void 0:t.value)&&void 0!==a?a:0)/((null!==(l=e.am)&&void 0!==l?l:0)+(null!==(n=e.noon)&&void 0!==n?n:0)+(null!==(i=e.pm)&&void 0!==i?i:0))||1}))};r([()=>ee,()=>ce.pillCount.value,()=>ce.visitDate.value],()=>{const e=parseInt(ce.pillCount.value)||0,a=fe();if(a!==1/0){K.value=E.calculateDrugRunOutDate(a+e,ce.visitDate.value),ce.nextAppointmentDate.label=`Next Appointment Date (Drug run out date: ${he(K.value)})`;const t=_e(K.value).subtract(2,"day"),l=t.day();let n;n=0===l?t.subtract(2,"day"):6===l?t.subtract(1,"day"):t,ce.nextAppointmentDate.value=ye(n)}},{deep:!0}),r(()=>ce.visitDate.value,()=>Ze());const ge=S(()=>{var e;return"3HP (INH 300 / RFP 300)"===(null===(e=ce.tbMed.value)||void 0===e?void 0:e.label)}),we=S(()=>{var e;return"3HP (RFP + INH)"===(null===(e=ce.tbMed.value)||void 0===e?void 0:e.label)}),Ae=S(()=>{var e;return"6H"===(null===(e=ce.tbMed.value)||void 0===e?void 0:e.label)}),Re=S(()=>"Yes"===ce.hasContraindications.value),Pe=S(()=>"Yes"===ce.hasSideEffects.value),qe=S(()=>{var e;return/Confirmed TB on treatment/i.test(null===(e=ce.tbStatus.value)||void 0===e?void 0:e.label)}),Ge=S(()=>{var e;return/Suspected/i.test(null===(e=ce.tbStatus.value)||void 0===e?void 0:e.label)}),Ye=[{label:"Normal",value:"Negative"},{label:"Abnormal",value:"Positive"},{label:"Unknown/Not done",value:"Unknown"}],Je=[{label:"Negative",value:"Negative"},{label:"Positive",value:"Positive"},{label:"Unknown/Not done",value:"Unknown"}],Qe=Ce(["6H","3HP (RFP + INH)","3HP (INH 300 / RFP 300)"]),Xe=Ce(["Confirmed TB Not on treatment","Confirmed TB on treatment","TB Not Suspected","TB Suspected"]),Ze=async()=>{i.setDate(ce.visitDate.value),Z.value=!1;const e=await i.getFirstValueCoded("TB status");if(/Confirmed TB on treatment/i.test(e)){const e=await i.getFirstValueDatetime("TB treatment start date"),a=30*(await i.getFirstValueNumber("TB treatment period")||6);if(e){const t=_e(ce.visitDate.value).diff(e,"days");Z.value=t<=a}}ce.tbStatus.required=!Z.value};async function ea(){l.setDate(ce.visitDate.value),i.setDate(ce.visitDate.value),E.setDate(ce.visitDate.value),k.setDate(ce.visitDate.value),L.setDate(ce.visitDate.value),G.setDate(ce.visitDate.value),O.setDate(ce.visitDate.value),await Se(ce,async(e,a)=>{var t;const n=[];let o=0;if(!se(e.regimen)&&await Ee(ee)){const a=e.regimen.other,t=Oe(ee).formData;o=fe(),a.forEach(a=>n.push(E.toDrugOrder(a,t[a.drug_name],o,e.visitDate)))}else{if(!(await T("Are you sure you want to continue without dispensing ART drugs?")))return}var u;(Me.show("Saving patient visit..."),e.totalCPTGiven)&&Te((await Ne.getRegimenExtras("Cotrimoxazole",null!==(u=e.weight)&&void 0!==u?u:F.value)).data,"concept_name").filter(e=>"Daily (QOD)"===e.frequency).forEach(a=>n.push(E.toDrugOrder(a,e.totalCPTGiven,o,e.visitDate)));if(null!==(t=e.tbMed)&&void 0!==t&&t.value){var r;const a=Te((await Ne.getRegimenExtras("INH",null!==(r=e.weight)&&void 0!==r?r:F.value)).data,["concept_name","frequency"]),t=a.find(e=>"Pyridoxine"===e.concept_name);if(t&&e.totalPyridoxineGiven&&n.push(E.toDrugOrder(t,e.totalPyridoxineGiven,o,e.visitDate)),e.totalIPTGiven){const t=a.find(e=>"Isoniazid"===e.concept_name&&(Ae.value&&"Daily (QOD)"===e.frequency||we.value&&"Weekly (QW)"===e.frequency));n.push(E.toDrugOrder(t,e.totalIPTGiven,o,e.visitDate))}if(e.totalRFPGiven&&we.value){var d;const a=(await Ne.getRegimenExtras("Rifapentine",null!==(d=e.weight)&&void 0!==d?d:F.value)).data;a.length&&n.push(E.toDrugOrder(a[0],e.totalRFPGiven,o,e.visitDate))}if(e.total3HPGiven&&ge.value){var s;const a=(await Ne.getRegimenExtras("INH / RFP",null!==(s=e.weight)&&void 0!==s?s:F.value)).data;n.push(E.toDrugOrder(a[0],e.total3HPGiven,o,e.visitDate))}}if(!se(n)){await E.createEncounter();const e=(await E.createDrugOrder(n)).data.map(e=>{const a=n.find(a=>a.drug_inventory_id===e.drug_inventory_id);return O.buildDispensations(e.order_id,a.qty,1)});await O.saveDispensations(e.flat(1))}const c=await ke(a,"vitals");if(!se(c)){await l.createEncounter();const a=await(async e=>{const a=e.height||M.value,t=Ea.calculateBMI(e.weight,a);return l.buildValueNumber("BMI",t)})(e);await l.saveObservationList([...c,a])}await i.createEncounter();const m=await ke(a,"consultation");m.push(...await i.buildOptionsGroupObs("Malawi ART side effects",H.value)),m.push(...await(async()=>Promise.all(oe.getConceptsByCategory("tb_symptom",!0).map(async e=>i.buildGroupValueCoded(e.name,e.name,"No"))))()),Pe.value&&m.push(...await i.buildOptionsGroupObs("Other side effect",Y.value)),Q.value&&m.push(...await(async()=>{const e=[await i.buildValueCoded("Patient using family planning","No")];return i.getFamilyPlanningMethods().forEach(async a=>{e.push(await i.buildValueCoded(a,"No"))}),e})()),await i.saveObservationList(m),await k.createEncounter();const v=await ke(a,"reception");if(await k.saveObservationList(v),J.value.length>0){await L.createEncounter();const a=await Promise.all(J.value.map(async a=>{const t=L.calculateExpected(a.quantity,a.equivalent_daily_dose,a.order.start_date,a.frequency),l=L.calculateAdherence(a.quantity,e.pillCount,t);return[await L.buildAdherenceObs(a.order_id,a.drug_inventory_id,l),await L.buildPillCountObs(a.order_id,e.pillCount)]}));await L.saveObservationList(a.flat(1))}await G.createEncounter();const p=await ke(a,"appointment");await G.saveObservationList(p),await Le("Patient visit saved successfully"),te.value&&!re(j)&&(await ne(e.visitDate,j),await de(W,e.visitDate,j)),await C.hide(),Me.hide(),xe.emit(Ue.RELOAD_PATIENT_VISIT_DATA),xe.emit(Ue.RELOAD_STAGING_INFORMATION)},{showloader:!1})}const aa=async()=>{if(await T("Are you sure you want to clear all fields?")){for(const e in ce)ce[e].value="",ce[e].error="",ce[e].disabled=!1;ta(),xe.emit(Ue.ON_CLEAR)}},ta=()=>{for(const e in ee)delete ee[e]};return d(async()=>{try{await Ze(),M.value=await a.patient.getRecentHeight(),F.value=await a.patient.getRecentWeight(),F.value&&(z.value=await Ne.getRegimensByWeight(F.value)),J.value=await ie.getLastDrugsReceived(a.patient.getID()),ce.pillCount.required=J.value.length>0,H.value=oe.getConceptsByCategory("contraindication",!0).map(e=>({value:e.concept_id,label:e.name,other:e})),Y.value=oe.getConceptsByCategory("side_effect",!0).map(e=>({value:e.concept_id,label:e.name,other:e}))}catch(e){Be("Form initialization failed. Try to refresh the page"),console.error(e)}le().catch(console.error),ue().catch(console.error)}),(e,a)=>(f(),s(p,null,[c(v(_),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(b),null,{default:m(()=>[...a[25]||(a[25]=[h("Patient Visit",-1)])]),_:1})]),_:1})]),_:1}),c(v(A),{class:"ion-padding"},{default:m(()=>[c(v(y),{style:{width:"100%"}},{default:m(()=>[c(v(w),null,{default:m(()=>[c(v(D),{size:"12",class:"ion-margin-vertical"},{default:m(()=>[c(De,{modelValue:ce.visitDate,"onUpdate:modelValue":a[0]||(a[0]=e=>ce.visitDate=e),form:ce,minDate:v(X),maxDate:v(be)},null,8,["modelValue","form","minDate","maxDate"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(la,{modelValue:ce.patientPresent,"onUpdate:modelValue":a[1]||(a[1]=e=>ce.patientPresent=e),inline:"",disabled:ce.patientPresent.disabled},null,8,["modelValue","disabled"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(la,{modelValue:ce.guardianPresent,"onUpdate:modelValue":a[2]||(a[2]=e=>ce.guardianPresent=e),inline:""},null,8,["modelValue"])]),_:1}),Q.value?(f(),s(p,{key:0},[c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(la,{modelValue:ce.isPregnant,"onUpdate:modelValue":a[3]||(a[3]=e=>ce.isPregnant=e),inline:""},null,8,["modelValue"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(la,{modelValue:ce.isBreastfeeding,"onUpdate:modelValue":a[4]||(a[4]=e=>ce.isBreastfeeding=e),inline:""},null,8,["modelValue"])]),_:1})],64)):U("",!0),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(la,{modelValue:ce.hasContraindications,"onUpdate:modelValue":a[5]||(a[5]=e=>ce.hasContraindications=e),inline:""},null,8,["modelValue"]),Re.value?(f(),x(Ra,{key:0,items:H.value,numberOfColumns:2},{default:m(({entries:e})=>[(f(!0),s(p,null,B(e,e=>(f(),x(v(I),{lines:"none",key:e.value},{default:m(()=>[c(v(V),null,{default:m(()=>[h(q(e.label),1)]),_:2},1024),c(v(N),{slot:"start",modelValue:e.isChecked,"onUpdate:modelValue":a=>e.isChecked=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1},8,["items"])):U("",!0)]),_:1}),c(v(D),{class:"ion-margin-vertical",size:"6"},{default:m(()=>[c(la,{modelValue:ce.hasSideEffects,"onUpdate:modelValue":a[6]||(a[6]=e=>ce.hasSideEffects=e),inline:""},null,8,["modelValue"]),Pe.value?(f(),x(Ra,{key:0,items:Y.value,numberOfColumns:2},{default:m(({entries:e})=>[(f(!0),s(p,null,B(e,e=>(f(),x(v(I),{lines:"none",key:e.value},{default:m(()=>[c(v(V),null,{default:m(()=>[h(q(e.label),1)]),_:2},1024),c(v(N),{slot:"start",modelValue:e.isChecked,"onUpdate:modelValue":a=>e.isChecked=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1},8,["items"])):U("",!0)]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:ce.weight,"onUpdate:modelValue":a[7]||(a[7]=e=>ce.weight=e),form:ce,min:1},null,8,["modelValue","form"])]),_:1}),ae.value?(f(),x(v(D),{key:1,size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:ce.height,"onUpdate:modelValue":a[8]||(a[8]=e=>ce.height=e),form:ce,min:1},null,8,["modelValue","form"])]),_:1})):U("",!0),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ke,{modelValue:ce.bp,"onUpdate:modelValue":a[9]||(a[9]=e=>ce.bp=e),form:ce},null,8,["modelValue","form"])]),_:1}),c(v(D),{class:"ion-margin-vertical",size:ae.value?"6":"12"},{default:m(()=>[c(Ve,{modelValue:ce.tbStatus,"onUpdate:modelValue":a[10]||(a[10]=e=>ce.tbStatus=e),options:v(Xe)},null,8,["modelValue","options"])]),_:1},8,["size"]),qe.value&&!Z.value?(f(),s(p,{key:2},[c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(De,{modelValue:ce.tbTreatmentStartDate,"onUpdate:modelValue":a[11]||(a[11]=e=>ce.tbTreatmentStartDate=e),form:ce,minDate:v(X),maxDate:v(be)},null,8,["modelValue","form","minDate","maxDate"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:ce.tbTreatmentPeriod,"onUpdate:modelValue":a[12]||(a[12]=e=>ce.tbTreatmentPeriod=e),form:ce,min:1},null,8,["modelValue","form"])]),_:1})],64)):Ge.value?(f(),s(p,{key:3},[c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(la,{modelValue:ce.cxrResult,"onUpdate:modelValue":a[13]||(a[13]=e=>ce.cxrResult=e),"custom-options":Ye},null,8,["modelValue"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(la,{modelValue:ce.mwrdResult,"onUpdate:modelValue":a[14]||(a[14]=e=>ce.mwrdResult=e),"custom-options":Je},null,8,["modelValue"])]),_:1})],64)):U("",!0),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ve,{modelValue:ce.regimen,"onUpdate:modelValue":a[15]||(a[15]=e=>ce.regimen=e),options:z.value},null,8,["modelValue","options"])]),_:1}),v(se)(ee)?U("",!0):(f(!0),s(p,{key:4},B(Object.values(ee),(e,a)=>(f(),x(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{"model-value":e,form:ee,min:1},null,8,["model-value","form"])]),_:2},1024))),256)),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:ce.totalCPTGiven,"onUpdate:modelValue":a[16]||(a[16]=e=>ce.totalCPTGiven=e),form:ce,min:1},null,8,["modelValue","form"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ve,{modelValue:ce.tbMed,"onUpdate:modelValue":a[17]||(a[17]=e=>ce.tbMed=e),options:v(Qe)},null,8,["modelValue","options"])]),_:1}),Ae.value||we.value?(f(),x(v(D),{key:5,size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:ce.totalIPTGiven,"onUpdate:modelValue":a[18]||(a[18]=e=>ce.totalIPTGiven=e),form:ce,min:1},null,8,["modelValue","form"])]),_:1})):U("",!0),we.value?(f(),x(v(D),{key:6,size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:ce.totalRFPGiven,"onUpdate:modelValue":a[19]||(a[19]=e=>ce.totalRFPGiven=e),form:ce,min:1},null,8,["modelValue","form"])]),_:1})):U("",!0),ge.value?(f(),x(v(D),{key:7,size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:ce.total3HPGiven,"onUpdate:modelValue":a[20]||(a[20]=e=>ce.total3HPGiven=e),form:ce,min:1},null,8,["modelValue","form"])]),_:1})):U("",!0),ge.value||we.value||Ae.value?(f(),x(v(D),{key:8,size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:ce.totalPyridoxineGiven,"onUpdate:modelValue":a[21]||(a[21]=e=>ce.totalPyridoxineGiven=e),form:ce,min:1},null,8,["modelValue","form"])]),_:1})):U("",!0),J.value.length>0?(f(),x(v(D),{key:9,size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{modelValue:ce.pillCount,"onUpdate:modelValue":a[22]||(a[22]=e=>ce.pillCount=e),form:ce,min:1},null,8,["modelValue","form"])]),_:1})):U("",!0),c(v(D),{size:J.value.length>0?"6":"12",class:"ion-margin-vertical"},{default:m(()=>[c(De,{modelValue:ce.nextAppointmentDate,"onUpdate:modelValue":a[23]||(a[23]=e=>ce.nextAppointmentDate=e),form:ce,minDate:ce.visitDate.value,maxDate:K.value},null,8,["modelValue","form","minDate","maxDate"])]),_:1},8,["size"])]),_:1})]),_:1})]),_:1}),c(v(P),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(R),{color:"primary",onClick:a[24]||(a[24]=e=>v(C).hide()),slot:"end"},{default:m(()=>[...a[26]||(a[26]=[h(" Close ",-1)])]),_:1}),c(v(R),{color:"warning",onClick:aa,slot:"end"},{default:m(()=>[...a[27]||(a[27]=[h(" Reset ",-1)])]),_:1}),c(v(R),{color:"success",onClick:ea,slot:"end"},{default:m(()=>[...a[28]||(a[28]=[h(" Save ",-1)])]),_:1})]),_:1})]),_:1})],64))}}),[["__scopeId","data-v-1fc2510f"]]),xa=i({__name:"EmergencyRefill",props:{patient:{type:Object,required:!0}},setup(e){const a=e,t=S(()=>a.patient.getID()),l=new Pa(t.value),n=o(),i=o([]),V=o([]),I=S(()=>{var e;return null===(e=V.value[0])||void 0===e?void 0:e.order.start_date}),N=o(""),E=a.patient.getBirthdate(),O=o({}),k=u({date:{value:be(),label:"Date of emergency refill",required:!0,computedValue:e=>({obs:l.buildValueDate("Prescription refill date",e)})},facility:{value:void 0,label:"Facility where emergency refill was collected",required:!0,placeholder:"Select a facility",computedValue:e=>({obs:l.buildValueText("Health facility name",e.label)})},nextAppointmentDate:{value:void 0,label:"Next Appointment Date",required:!0,computedValue:e=>({obs:l.buildValueDate("Appointment date",e)})}});async function U(){if(await T("Are you sure you want to clear all fields?")){for(const e in k)k[e].value="",k[e].error="",k[e].disabled=!1;!function(){for(const e in O.value)delete O.value[e]}(),xe.emit(Ue.ON_CLEAR)}}function L(e){return e.regimen?`${e.regimen} - ${e.drug.name}`:e.drug.name}async function q(){if(await Ee(k)&&await Ee(O.value))try{Me.show(),l.setDate(k.date.value);const e=await ke({...Oe(k).computedFormData,...Oe(O.value).computedFormData}),a=new ce(t.value,Ae.EMERGENCY_DRUG_REFILL,k.date.value);await a.createEncounter(),await a.saveObservationList(e),Le("Emergency refill saved successfully"),C.hide(),xe.emit(Ue.RELOAD_PATIENT_VISIT_DATA),xe.emit(Ue.RELOAD_STAGING_INFORMATION)}catch(e){console.error(e),Be("Failed to save emergency refill")}finally{Me.hide()}}function G(){V.value.forEach(e=>{const a=L(e);O.value[`${a}_brought`]={label:`${a} brought`,value:void 0,required:!0,placeholder:"Enter the number of pills brought",validation:e=>je(e,"POSITIVE_INTEGERS")},O.value[`${a}_given`]={label:`${a} given`,value:void 0,required:!0,placeholder:"Enter the number of pills given",validation:e=>je(e,"POSITIVE_INTEGERS"),computedValue:(t,n)=>async function(e,a,t){const n=l.calculateExpected(e.quantity,e.equivalent_daily_dose,e.order.start_date,e.frequency),i=l.calculateAdherence(e.quantity,t,n);return{...await l.buildValueCoded("Medications dispensed",e.drug.concept_id),child:[await l.buildAdherenceObs(e.order_id,e.drug_inventory_id,i),await l.buildPillCountObs(e.order_id,t),,await l.buildValueNumber("Amount of drug dispensed",a)]}}(e,t,n[`${a}_brought`].value)}})}return r([()=>O,()=>k.date.value],function(){const e=se(V.value)?1/0:Math.min(...V.value.map(e=>{var a,t,l,n;const i=L(e);return(Number(null!==(a=null===(t=O.value[`${i}_given`])||void 0===t?void 0:t.value)&&void 0!==a?a:0)+Number(null!==(l=null===(n=O.value[`${i}_brought`])||void 0===n?void 0:n.value)&&void 0!==l?l:0))/Number(e.equivalent_daily_dose)}));e!==1/0&&(N.value=we(k.date.value,e,"days"),k.nextAppointmentDate.label=`Next Appointment Date (Drug run out date: ${he(N.value)})`,k.nextAppointmentDate.value=N.value)},{deep:!0,immediate:!0}),d(async()=>{try{Me.show(),n.value=await a.patient.getRecentWeight(),i.value=await Ne.getRegimensByWeight(n.value),V.value=await ie.getLastDrugsReceived(t.value),G()}catch(e){Be("Form initialization failed. Try to refresh the page"),console.error(e)}finally{Me.hide()}}),(e,a)=>(f(),s(p,null,[c(v(_),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(b),null,{default:m(()=>[...a[4]||(a[4]=[h("Emergency Drug Refill",-1)])]),_:1})]),_:1})]),_:1}),c(v(A),{class:"ion-padding"},{default:m(()=>[c(v(y),{style:{width:"100%"}},{default:m(()=>[c(v(w),null,{default:m(()=>[c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(De,{modelValue:k.date,"onUpdate:modelValue":a[0]||(a[0]=e=>k.date=e),form:k,minDate:I.value||v(E),maxDate:v(be)},null,8,["modelValue","form","minDate","maxDate"])]),_:1}),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ve,{modelValue:k.facility,"onUpdate:modelValue":a[1]||(a[1]=e=>k.facility=e),form:k,asyncOptions:v(Xe)},null,8,["modelValue","form","asyncOptions"])]),_:1}),(f(!0),s(p,null,B(Object.values(O.value),e=>(f(),x(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(Ie,{"model-value":e,form:O.value,min:1},null,8,["model-value","form"])]),_:2},1024))),256)),c(v(D),{size:"6",class:"ion-margin-vertical"},{default:m(()=>[c(De,{modelValue:k.nextAppointmentDate,"onUpdate:modelValue":a[2]||(a[2]=e=>k.nextAppointmentDate=e),form:k,minDate:k.date.value,maxDate:N.value},null,8,["modelValue","form","minDate","maxDate"])]),_:1})]),_:1})]),_:1})]),_:1}),c(v(P),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(R),{color:"primary",onClick:a[3]||(a[3]=e=>v(C).hide()),slot:"end"},{default:m(()=>[...a[5]||(a[5]=[h(" Close ",-1)])]),_:1}),c(v(R),{color:"warning",onClick:U,slot:"end"},{default:m(()=>[...a[6]||(a[6]=[h(" Reset ",-1)])]),_:1}),c(v(R),{color:"success",onClick:q,slot:"end"},{default:m(()=>[...a[7]||(a[7]=[h(" Save ",-1)])]),_:1})]),_:1})]),_:1})],64))}}),Ua=i({props:{patient:{type:Object,required:!0},startDate:{type:String,required:!0}},components:{DataTable:Ge,IonCard:Y,IonCardHeader:J,IonCardTitle:Q,IonCardContent:K,IonButton:R},setup(e){const a=o([]),t=S(()=>e.patient.getID()),l=u({showIndex:!1,tableCssTheme:"emc-datatable-theme"}),n=o([{label:"Add Visit",action:async()=>{await C.show(ka,{patient:e.patient})}},{label:"Emegency Refill",action:async()=>{await C.show(xa,{patient:e.patient})}},{label:"Update Outcome",action:async()=>C.show(Na,{patient:e.patient})},{label:"Enter VL Results",action:async()=>C.show(ga,{patient:e.patient})}]),i=a=>{const t="N/A"!==e.startDate?"("+_e(a).diff(e.startDate,"months")+"M)":"";return`${he(a)} ${t}`},r={minWidth:"68px !important"},s=o([{path:"visitDate",label:"Visit Date"},{path:"visitBy",label:"Given To",sortable:!1,thStyles:r},{path:"vitals",label:"Vitals",sortable:!1,thStyles:r},...e.patient.isFemale()?[{path:"pregnant",label:"Preg",sortable:!1,thStyles:r},{path:"breastfeeding",label:"B/F",sortable:!1,thStyles:r}]:[],{path:"tbStatus",label:"TB Status",sortable:!1},{path:"sideEffects",label:"Side Effects",drillable:!0,formatter:e=>e.length>0?"Yes":"No",sortable:!1,thStyles:r},{path:"regimen",label:"ART Regimen",drillable:!0,sortable:!1,thStyles:r},{path:"nextAppointment",label:"Next Appointment",sortable:!1},{path:"outcome",label:"Outcome",sortable:!1,thStyles:r},{path:"vlResult",label:"Viral Load",sortable:!1}]),c=[{label:"void",icon:X,color:"danger",action(e,l){ge(async n=>{const i=await fe.getEncounters(t.value,{date:e.date});var o;i.ok?(null===(o=i.data)||void 0===o||o.forEach(async e=>{await fe.voidEncounter(e.encounter_id,n)}),a.value.splice(l,1)):Be(i.errorMessage||"Failed to void encounters")},"small-modal")}}],m=async e=>e.tb_status.match(/Unknown/i)||"Defaulted"===e.outcome?"":oe.getCachedConceptName(e.tb_status),v=e=>[e.weight?`Wt: ${e.weight}kg`:"",e.height?`Ht: ${e.height}cm`:"",e.bmi?`BMI: ${e.bmi}`:"",e.bp?`BP: ${e.bp}`:""].filter(Boolean).join(", "),p=()=>{const{getProgramInfo:e}=me(t.value);ue.getPatientVisits(t.value,!0).then(async l=>{a.value=[];for(const n of l){const l=await e(n);let o="",u="",r="",d="";if("Defaulted"!==l.outcome){const e=await re.getFirstValueDatetime(t.value,"appointment date",n);if(e&&(o=he(e)),u=await re.getFirstValueCoded(t.value,"Is patient pregnant",n),r=await re.getFirstValueCoded(t.value,"Is patient breast feeding",n),"N/A"===l.viral_load){const e=await re.getFirstObs(t.value,"HIV viral load",n);e&&e.value_text&&e.value_numeric&&(d=1===e.value_numeric?"LDL":e.value_text+e.value_numeric.toString())}else d=l.viral_load}l&&a.value.push({visitDate:i(n),visitBy:l.visit_by.match(/Unk/i)?"":l.visit_by,vitals:v(l),pregnant:u,breastfeeding:r,tbStatus:await m(l),sideEffects:"Defaulted"===l.outcome?"":l.side_effects,regimen:"Defaulted"===l.outcome?"":l.regimen,nextAppointment:o,outcome:l.outcome.match(/Unk/i)?"":l.outcome,vlResult:d,drugs:l.pills_dispensed,date:n})}})};return xe.on(Ue.RELOAD_PATIENT_VISIT_DATA,()=>p()),d(()=>{p()}),{actionButtons:n,tableConfig:l,rowButtons:c,columns:s,rows:a,onDrilldownHandler:async e=>{const a=/regimen/i.test(e.column.path)?(e=>({title:`Drugs dispensed on ${e.row.visitDate}`,columns:[{path:"name",label:"Drug Name"},{path:"quantity",label:"Quantity"},{path:"units",label:"Units"}],rows:e.row.drugs.map(e=>({name:e[0],quantity:e[1],units:"tab (s)"}))}))(e):(e=>({title:`Side effects noted on ${e.row.visitDate}`,rows:e.row.sideEffects.map(e=>({sideEffect:e})),columns:[{path:"sideEffect",label:"Name of Side Effect"}]}))(e);se(a.rows)||await C.show(na,a)}}}}),La={class:"ion-float-right ion-margin-end ion-margin-bottom"};const Ba=E(Ua,[["render",function(e,a,t,l,n,i){const o=O("ion-icon"),u=O("ion-button"),r=O("ion-card-title"),d=O("ion-card-header"),v=O("data-table"),g=O("ion-card-content"),b=O("ion-card");return f(),x(b,{class:"his-card",style:{padding:"0 !important"}},{default:m(()=>[c(d,null,{default:m(()=>[c(r,null,{default:m(()=>[a[0]||(a[0]=k("span",{class:"title"},"Summary of Visits",-1)),k("span",La,[(f(!0),s(p,null,B(e.actionButtons,e=>(f(),x(u,{key:e.label,onClick:e.action,color:e.color||"primary"},{default:m(()=>[e.icon?(f(),x(o,{key:0,icon:e.icon,class:"ion-margin-right"},null,8,["icon"])):U("",!0),h(" "+q(e.label),1)]),_:2},1032,["onClick","color"]))),128))])]),_:1})]),_:1}),c(g,{class:"ion-no-padding",style:{"min-height":"45vh"}},{default:m(()=>[c(v,{rows:e.rows,columns:e.columns,"row-actions-buttons":e.rowButtons,config:{showSearchField:!1},color:"light",onDrilldown:e.onDrilldownHandler},null,8,["rows","columns","row-actions-buttons","onDrilldown"])]),_:1})]),_:1})}],["__scopeId","data-v-824715c1"]]),qa=i({__name:"ViralLoadTrail",props:{patient:{}},setup(e){const a=e,t=S(()=>`Viral Load Results Trail for ${a.patient.getFullName()}`),l=o([]),n=[{path:"accession_number",label:"Accession"},{path:"test",label:"Test Name"},{path:"specimen.name",label:"Specimen"},{path:"order_date",label:"Order Date",formatter:he},{path:"result",label:"Result"},{path:"result_date",label:"Result Date",formatter:he}],i={label:"X",color:"danger",action({encounter_id:e}){ge(async a=>{try{await Z.void(e,a),C.hide(),xe.emit(Ue.RELOAD_LATEST_VL_RESULT),xe.emit(Ue.RELOAD_PATIENT_VISIT_DATA)}catch(t){console.error(t)}},"small-modal custom-modal-backdrop")}};return d(async()=>{l.value=await fa.getViralLoadResultTrail(a.patient.getID())}),(e,a)=>(f(),s(p,null,[c(v(_),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(b),null,{default:m(()=>[h(q(t.value),1)]),_:1})]),_:1})]),_:1}),c(v(A),null,{default:m(()=>[c(v(y),{style:{width:"100%"}},{default:m(()=>[c(v(w),{style:F([{padding:"0 !important"},{minHeight:l.value.length?"0":"30vh"}])},{default:m(()=>[c(v(D),{size:"12",class:"ion-no-padding"},{default:m(()=>[c(v(Ge),{rows:l.value,columns:n,"row-actions-buttons":[i],config:{showSearchField:!1},color:"custom"},null,8,["rows","row-actions-buttons"])]),_:1})]),_:1},8,["style"])]),_:1})]),_:1}),c(v(P),null,{default:m(()=>[c(v(g),null,{default:m(()=>[c(v(R),{color:"primary",onClick:a[0]||(a[0]=e=>v(C).hide()),slot:"end"},{default:m(()=>[...a[1]||(a[1]=[h(" Close ",-1)])]),_:1})]),_:1})]),_:1})],64))}}),Ga=i({components:{MultiColumnView:Ra,IonList:L,IonItem:I},props:{patient:{type:Object,required:!0},artStartDate:{type:String,required:!0},guardians:{type:Array,default:()=>[]}},emits:["updatePatient","updateARVNumber","updateGuardian"],setup(e,{emit:a}){const t=o(0),l=o(0),n=o(0),i=o(""),u=o(""),r=o(""),s=o(""),c=o(""),m=o(""),v=o(""),p=o(""),f=o(""),g=o(""),b=o(""),h=e=>e.other&&"function"==typeof e.other.onClickHandler,_=S(()=>!se(e.guardians)),y=()=>{const a=e.patient.getBirthdate(),t="N/A"!==e.artStartDate?_e(e.artStartDate).diff(a,"years"):"";return`${he(a)} (${t})`},w=()=>{fa.getlatestViralLoadResult(e.patient.getID()).then(e=>g.value=e)},D=()=>({onClickHandler(){ee.push(`/patient/reception/${e.patient.getID()}/false`)}}),V=()=>({onClickHandler:()=>a("updatePatient")}),I=S(()=>[{label:"ARV Number",value:e.patient.getArvNumber(),other:{onClickHandler:()=>a("updateARVNumber")}},{label:"NPID",value:e.patient.getNationalID()},{label:"MW National ID",value:e.patient.getMWNationalID(),other:V()},{label:"Name",value:e.patient.getGivenName()+" "+e.patient.getFamilyName(),other:V()},{label:"DOB and Age at Initiation",value:y(),other:V()},{label:"Sex",value:ia(e.patient.getGender()),other:V()},{label:"Location",value:e.patient.getCurrentVillage(),other:V()},{label:"Landmark",value:e.patient.getClosestLandmark(),other:V()},{label:"Phone Number",value:e.patient.getPhoneNumber(),other:V()},{label:"Guardian",value:_.value?e.guardians.map(e=>`${e.name} (${e.relationshipType})`).join(","):"Add",other:{onClickHandler:()=>a("updateGuardian")}},{label:"Agrees to follow up",value:c.value,other:D()},{label:"Date of starting first line ARV Regimen",value:e.artStartDate,other:D()},{label:"Initial Weight and Height",value:`${t.value}Kg, ${l.value}cm`,other:D()},{label:"Initial BMI",value:n.value,other:D()},{label:"Initial TB Status",value:i.value,other:D()},{label:"Pregnant at Initiation",value:r.value,other:D()},{label:"Breastfeeding at Initiation",value:u.value,other:D()},{label:"Latest VL Result and Result Date",value:g.value,other:{onClickHandler:()=>C.show(qa,{patient:e.patient})}},{label:"TI",value:s.value,other:D()},{label:"HIV test place",value:p.value,other:D()},{label:"HIV test date",value:v.value,other:D()},{label:"WHO stage",value:b.value,other:D()},{label:"Reason for starting ART",value:m.value,other:D()},{label:"Staging codition",value:f.value,other:D()}]),N=()=>{e.patient.getInitialWeight().then(e=>t.value=e),e.patient.getInitialHeight().then(e=>l.value=e),e.patient.getInitialBMI().then(e=>n.value=e),e.patient.getInitialTBStatus().then(e=>i.value=e),e.patient.hasPregnancyAtARTInitiation().then(e=>r.value=e),e.patient.breastFeedingAtARTInitiation().then(e=>u.value=e),e.patient.everReceivedART().then(e=>s.value=e),e.patient.agreesToFollowUp().then(e=>c.value=e),e.patient.getReasonForStartingART().then(e=>m.value=e),e.patient.getHIVTestLocation().then(e=>p.value=e),e.patient.getStagingCondition().then(e=>f.value=e),e.patient.getWhoStage().then(e=>b.value=e),(async()=>{const a=await e.patient.getHIVTestDate();a&&(v.value=he(a))})()};return d(()=>{N(),w(),xe.on(Ue.RELOAD_LATEST_VL_RESULT,()=>w()),xe.on(Ue.RELOAD_STAGING_INFORMATION,()=>N())}),{patientInfo:I,onClickHandler:async e=>{var a;h(e)&&await(null===(a=e.other)||void 0===a?void 0:a.onClickHandler())},clickable:h}}}),Ma={style:{width:"100%",display:"flex",justifyContent:"space-between"}},Fa={key:0},za={key:1},Ha={key:2},$a={key:3};const ja=E(Ga,[["render",function(e,a,t,l,n,i){const o=O("ion-item"),u=O("ion-list"),r=O("multi-column-view");return f(),x(r,{items:e.patientInfo,numberOfColumns:3},{default:m(({entries:a})=>[c(u,{class:"his-card ion-margin-end"},{default:m(()=>[(f(!0),s(p,null,B(a,(t,l)=>(f(),x(o,{key:l,lines:l===a.length-1?"none":void 0,button:e.clickable(t),onClick:a=>e.onClickHandler(t)},{default:m(()=>[k("div",Ma,[t.label?(f(),s("span",Fa,q(t.label)+": ",1)):(f(),s("span",za)),e.clickable(t)?(f(),s("span",Ha,[k("a",null,[k("b",null,q(t.value||"N/A"),1)])])):(f(),s("span",$a,[k("b",null,q(t.value||"N/A"),1)]))])]),_:2},1032,["lines","button","onClick"]))),128))]),_:2},1024)]),_:1},8,["items"])}],["__scopeId","data-v-1195e33c"]]),Wa=i({components:{IonGrid:y,IonRow:w,IonCol:D,TextInput:Ke,DateInput:De,SelectInput:Ve},props:{patientService:{type:Object,required:!0}},setup(e){const a=o(!1),t=S(()=>/Unknown/i.test(e.patientService.getMWNationalID())?"":e.patientService.getMWNationalID()),l=u({givenName:{label:"First Name",value:e.patientService.getGivenName(),placeholder:"First Name",required:!0,validation:e=>Ye(e)},familyName:{label:"last Name",value:e.patientService.getFamilyName(),placeholder:"Last Name",required:!0,validation:e=>Ye(e)},middleName:{label:"middle Name",value:e.patientService.getMiddleName(),placeholder:"middle Name",validation:e=>!!e&&Ye(e)},nationalId:{label:"Malawi National ID Number",value:t.value,placeholder:"Enter Malawi National ID Number",validation:e=>e&&e.label?Je(e):null},gender:{value:e.patientService.getGender(),required:!0,label:"Gender",placeholder:"select gender"},birthdate:{value:e.patientService.getBirthdate(),label:"Date of Birth",placeholder:"Date of Birth",required:!0},cellPhoneNumber:{value:e.patientService.getPhoneNumber(),required:!0,label:"Cellphone Number",placeholder:"cellphone number e.g. 0991234567",validation:async e=>!("Unknown"===e.value||"N/A"===e.value)&&Qe(e)},homeVillage:{value:e.patientService.getCurrentVillage(),label:"Home Village",placeholder:"Home Village",required:!0},landmark:{value:e.patientService.getClosestLandmark(),label:"Landmark",placeholder:"Closest Landmark or Plot Number",required:!0}}),n=async e=>{var a,t,l,n,i,o,u,r;let d,s;try{var c;null!=e&&null!==(c=e.other)&&void 0!==c&&c.traditional_authority_id&&(d=await ae.getTraditionalAuthorityById(e.other.traditional_authority_id)),d&&(s=await ae.getDistrictByID(d.district_id))}catch(m){Be("Unable to resolve patient address. Saving using default address"),console.error(m)}return{home_district:null!==(a=null===(t=s)||void 0===t?void 0:t.name)&&void 0!==a?a:"N/A",home_traditional_authority:null!==(l=null===(n=d)||void 0===n?void 0:n.name)&&void 0!==l?l:"N/A",home_village:(null==e?void 0:e.label)||"N/A",current_district:null!==(i=null===(o=s)||void 0===o?void 0:o.name)&&void 0!==i?i:"N/A",current_traditional_authority:null!==(u=null===(r=d)||void 0===r?void 0:r.name)&&void 0!==u?u:"N/A",current_village:(null==e?void 0:e.label)||"N/A"}};return{today:be,patient:l,getLandmarks:Ze,genderOptions:ta,isBirthdateEstimated:a,modal:C,onFinish:async()=>Se(l,async a=>{const l={};if(a.givenName!==e.patientService.getGivenName()&&(l.given_name=a.givenName),a.familyName!==e.patientService.getFamilyName()&&(l.family_name=a.familyName),a.middleName!==e.patientService.getMiddleName()&&(l.middle_name=a.middleName),a.birthdate!==e.patientService.getBirthdate()&&(l.birthdate=a.birthdate),a.gender.value!==e.patientService.getGender()&&(l.gender=a.gender.value),a.cellPhoneNumber!==e.patientService.getPhoneNumber()&&(l.cell_phone_number=a.cellPhoneNumber),a.landmark.label!==e.patientService.getClosestLandmark()&&(l.landmark=a.landmark.label),a.homeVillage!==e.patientService.getCurrentVillage()&&Object.assign(l,{...l,...await n(a.homeVillage)}),!se(l)){const a=new ua;a.setPersonID(e.patientService.getID()),await a.updatePerson(l)}a.nationalId!==t.value&&await e.patientService.updateMWNationalId(a.nationalId),await C.hide(),xe.emit(Ue.RELOAD_PATIENT_DATA)}),getVillagesByName:ea}}});const Ya=E(Wa,[["render",function(e,a,t,l,n,i){const o=O("ion-title"),u=O("ion-icon"),r=O("ion-button"),d=O("ion-buttons"),v=O("ion-toolbar"),g=O("ion-header"),b=O("TextInput"),_=O("ion-col"),y=O("SelectInput"),w=O("DateInput"),D=O("ion-row"),V=O("ion-grid"),I=O("ion-content"),N=O("ion-footer");return f(),s(p,null,[c(g,null,{default:m(()=>[c(v,null,{default:m(()=>[c(o,null,{default:m(()=>[...a[12]||(a[12]=[h("Edit Patient Demographics",-1)])]),_:1}),c(d,{slot:"end"},{default:m(()=>[c(r,{onClick:a[0]||(a[0]=a=>e.modal.hide())},{default:m(()=>[c(u,{slot:"icon-only",name:"close"})]),_:1})]),_:1})]),_:1})]),_:1}),c(I,{class:"ion-padding"},{default:m(()=>[c(V,null,{default:m(()=>[c(D,null,{default:m(()=>[c(_,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(b,{modelValue:e.patient.givenName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.patient.givenName=a)},null,8,["modelValue"])]),_:1}),c(_,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(b,{modelValue:e.patient.middleName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.patient.middleName=a)},null,8,["modelValue"])]),_:1}),c(_,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(b,{modelValue:e.patient.familyName,"onUpdate:modelValue":a[3]||(a[3]=a=>e.patient.familyName=a)},null,8,["modelValue"])]),_:1}),c(_,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(b,{modelValue:e.patient.nationalId,"onUpdate:modelValue":a[4]||(a[4]=a=>e.patient.nationalId=a)},null,8,["modelValue"])]),_:1}),c(_,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(y,{modelValue:e.patient.gender,"onUpdate:modelValue":a[5]||(a[5]=a=>e.patient.gender=a),options:e.genderOptions},null,8,["modelValue","options"])]),_:1}),c(_,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(w,{modelValue:e.patient.birthdate,"onUpdate:modelValue":a[6]||(a[6]=a=>e.patient.birthdate=a),allowEstimation:!0,estimationLabel:"Estimate Age",minDate:"1900-01-01",maxDate:e.today,onIsEstimated:a[7]||(a[7]=a=>e.isBirthdateEstimated=a)},null,8,["modelValue","maxDate"])]),_:1}),c(_,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(b,{modelValue:e.patient.cellPhoneNumber,"onUpdate:modelValue":a[8]||(a[8]=a=>e.patient.cellPhoneNumber=a),allowUnknown:""},null,8,["modelValue"])]),_:1}),c(_,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(y,{modelValue:e.patient.homeVillage,"onUpdate:modelValue":a[9]||(a[9]=a=>e.patient.homeVillage=a),asyncOptions:e.getVillagesByName,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1}),c(_,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(y,{modelValue:e.patient.landmark,"onUpdate:modelValue":a[10]||(a[10]=a=>e.patient.landmark=a),asyncOptions:e.getLandmarks,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1})]),_:1})]),_:1})]),_:1}),c(N,null,{default:m(()=>[c(v,null,{default:m(()=>[c(r,{color:"primary",onClick:a[11]||(a[11]=a=>e.modal.hide()),slot:"end"},{default:m(()=>[...a[13]||(a[13]=[h("Close",-1)])]),_:1}),c(r,{class:"ion-margin-end",color:"success",onClick:e.onFinish,slot:"end"},{default:m(()=>[...a[14]||(a[14]=[h("Save",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}]]),Ja=i({__name:"GuardianDemographics",props:{patientId:{},guardians:{}},setup(e){var a,t;const l=new ua,n=e,i=o(se(n.guardians)),g=S(()=>(i.value?"Add":"Edit")+" Guardian Demographics"),b=S(()=>(i.value?"Edit":"Add")+" Guardian"),_=o([]),V=null!==(a=null===(t=n.guardians)||void 0===t?void 0:t.map(e=>({label:`${e.name} (${e.relationshipType})`,value:e.name,other:e})))&&void 0!==a?a:[],I=u({guardian:{label:"Select Guardian",placeholder:"Select guardian to be edited",value:""}}),N=u({givenName:{label:"First Name",value:"",placeholder:"First Name",required:!0,validation:e=>Ye(e)},familyName:{label:"Last Name",value:"",placeholder:"Last Name",required:!0,validation:e=>Ye(e)},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",validation:async e=>"Unknown"!==e.value&&Qe(e)},relation:{label:"Select Relationship",placeholder:"Select the relationship between guardian and patient",value:""}});function A(){i.value=!i.value,I.guardian.value=""}r(()=>I.guardian.value,e=>{var a,t,l,n,i,o,u,r;N.givenName.value=null!==(a=null==e||null===(t=e.other)||void 0===t?void 0:t.names.given_name)&&void 0!==a?a:"",N.familyName.value=null!==(l=null==e||null===(n=e.other)||void 0===n?void 0:n.names.family_name)&&void 0!==l?l:"",N.cellPhoneNumber.value=null!==(i=null==e||null===(o=e.other)||void 0===o?void 0:o.phoneNumber)&&void 0!==i?i:"",N.relation.value=null!==(u=null==e||null===(r=e.other)||void 0===r?void 0:r.relationshipType)&&void 0!==u?u:""},{deep:!0,immediate:!0});const R=async()=>Se(N,async e=>{i.value||se(I.guardian.value)?await async function(e){var a,t;await l.registerGuardian({home_district:"N/A",home_traditional_authority:"N/A",home_village:"N/A",current_district:"N/A",current_traditional_authority:"N/A",current_village:"N/A",middle_name:"",gender:"N/A",birthdate:"N/A",birthdate_estimated:"N/A",landmark:"N/A",relationship:"N/A",patient_type:"",isPatient:!1,patient_id:n.patientId,...e}),await ra.createRelation(n.patientId,l.getPersonID(),null!==(a=null===(t=e.relation)||void 0===t?void 0:t.value)&&void 0!==a?a:13)}(e):await async function(e,a){const t=a.names.person_id,l={};if(a.names.given_name!==e.given_name&&(l.given_name=e.given_name),a.names.family_name!==e.family_name&&(l.family_name=e.family_name),a.phoneNumber!==e.cell_phone_number&&(l.cell_phone_number=e.cell_phone_number),!se(l)){const e=new ua;e.setPersonID(t),await e.updatePerson(l)}var i,o;a.relationshipType!==e.relation.label&&await ra.amendRelation(n.patientId,t,a.id,null!==(i=null===(o=e.relation)||void 0===o?void 0:o.value)&&void 0!==i?i:13)}(e,I.guardian.value.other),await C.hide(),xe.emit(Ue.RELOAD_GUARDIAN_DATA)},{underscoreKeys:!0});return d(async()=>{const e=(await ra.getRelations()).data;_.value=e.map(e=>({label:e.b_is_to_a,value:e.relationship_type_id,other:e}))}),(e,a)=>{const t=O("ion-title"),l=O("ion-icon"),o=O("ion-button"),u=O("ion-buttons"),r=O("ion-toolbar"),d=O("ion-header"),P=O("ion-content"),T=O("ion-footer");return f(),s(p,null,[c(d,null,{default:m(()=>[c(r,null,{default:m(()=>[c(t,null,{default:m(()=>[h(q(g.value),1)]),_:1}),c(u,{slot:"end"},{default:m(()=>[c(o,{onClick:a[0]||(a[0]=e=>v(C).hide())},{default:m(()=>[c(l,{slot:"icon-only",name:"close"})]),_:1})]),_:1})]),_:1})]),_:1}),c(P,{class:"ion-padding"},{default:m(()=>[c(v(y),null,{default:m(()=>[c(v(w),null,{default:m(()=>[i.value?U("",!0):(f(),x(v(D),{key:0,size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(Ve,{modelValue:I.guardian,"onUpdate:modelValue":a[1]||(a[1]=e=>I.guardian=e),options:v(V)},null,8,["modelValue","options"])]),_:1})),I.guardian.value||i.value?(f(),s(p,{key:1},[c(v(D),{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(Ke,{modelValue:N.givenName,"onUpdate:modelValue":a[2]||(a[2]=e=>N.givenName=e)},null,8,["modelValue"])]),_:1}),c(v(D),{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(Ke,{modelValue:N.familyName,"onUpdate:modelValue":a[3]||(a[3]=e=>N.familyName=e)},null,8,["modelValue"])]),_:1}),c(v(D),{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(Ke,{modelValue:N.cellPhoneNumber,"onUpdate:modelValue":a[4]||(a[4]=e=>N.cellPhoneNumber=e),allowUnknown:""},null,8,["modelValue"])]),_:1}),c(v(D),{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:m(()=>[c(Ve,{modelValue:N.relation,"onUpdate:modelValue":a[5]||(a[5]=e=>N.relation=e),options:_.value},null,8,["modelValue","options"])]),_:1})],64)):U("",!0)]),_:1})]),_:1})]),_:1}),c(T,null,{default:m(()=>[c(r,null,{default:m(()=>[v(se)(n.guardians)?U("",!0):(f(),x(o,{key:0,color:"primary",onClick:A,slot:"start"},{default:m(()=>[h(q(b.value),1)]),_:1})),c(o,{color:"primary",onClick:a[6]||(a[6]=e=>v(C).hide()),slot:"end"},{default:m(()=>[...a[7]||(a[7]=[h("Close",-1)])]),_:1}),c(o,{class:"ion-margin-end",color:"success",onClick:R,slot:"end"},{default:m(()=>[...a[8]||(a[8]=[h("Save",-1)])]),_:1})]),_:1})]),_:1})],64)}}}),Qa=i({components:{IonGrid:y,IonRow:w,IonCol:D,TextInput:Ke},props:{patient:{type:Object,required:!0}},setup(e){const{facility:a}=n(),t=S(()=>e.patient.getArvNumber()),i=S(()=>!se(t.value)&&"Unknown"!==t.value),o=u({arvNumber:{value:i.value?t.value.split("-")[2]:"",label:(i.value?"Edit":"Add New")+" ARV Number",placeholder:"Enter ARV Number",required:!0,validation:async e=>{const l=je(e,"POSITIVE_INTEGERS");if(null!==l)return l;if(e.value===t.value.split("-")[2])return null;const n=await ue.findByOtherID(4,`${a.code}-ARV-${e.value}`);return n.ok?se(n.data)?null:["ARV Number already taken"]:[n.errorMessage||n.clientErrorType||`Unable to determine ARV number with status: ${n.httpStatusResponse}`]}}});return{form:o,modal:C,arvNumber:t,facility:a,hasValidARVNumber:i,onFinish:async()=>Se(o,async l=>{l.arvNumber!==t.value.split("-")[2]&&(i.value?await e.patient.updateARVNumber(`${a.code}-ARV-${l.arvNumber}`):await e.patient.createArvNumber(`${a.code}-ARV-${l.arvNumber}`),xe.emit(Ue.RELOAD_PATIENT_DATA)),await C.hide()}),voidARV:async()=>{if(await T(`Are you sure you want to void this ARV Number ${t.value}?`)){await Me.show("Voiding ARV Number...");try{await l.postJson(`/programs/${te}/void_arv_number/${t}`,{}),await Me.hide(),await C.hide(),xe.emit(Ue.RELOAD_PATIENT_DATA)}catch(e){await Me.hide(),console.log(e)}}}}}});const Ka=E(Qa,[["render",function(e,a,t,l,n,i){const o=O("ion-title"),u=O("ion-icon"),r=O("ion-button"),d=O("ion-buttons"),v=O("ion-toolbar"),g=O("ion-header"),b=O("text-input"),_=O("ion-col"),y=O("ion-row"),w=O("ion-grid"),D=O("ion-content"),V=O("ion-footer");return f(),s(p,null,[c(g,null,{default:m(()=>[c(v,null,{default:m(()=>[c(o,null,{default:m(()=>[...a[3]||(a[3]=[h("ARV NUMBER",-1)])]),_:1}),c(d,{slot:"end"},{default:m(()=>[c(r,{onClick:a[0]||(a[0]=a=>e.modal.hide())},{default:m(()=>[c(u,{slot:"icon-only",name:"close"})]),_:1})]),_:1})]),_:1})]),_:1}),c(D,{class:"ion-padding"},{default:m(()=>[c(w,null,{default:m(()=>[c(y,null,{default:m(()=>[c(_,null,{default:m(()=>[c(b,{modelValue:e.form.arvNumber,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.arvNumber=a),form:e.form,prefix:`${e.facility.code}-ARV-`},null,8,["modelValue","form","prefix"])]),_:1})]),_:1})]),_:1})]),_:1}),c(V,{class:"ion-padding-horizontal"},{default:m(()=>[c(v,null,{default:m(()=>[c(r,{color:"primary",onClick:a[2]||(a[2]=a=>e.modal.hide()),slot:"end"},{default:m(()=>[...a[4]||(a[4]=[h("Close",-1)])]),_:1}),e.hasValidARVNumber?(f(),x(r,{key:0,color:"danger",onClick:e.voidARV,slot:"start"},{default:m(()=>[...a[5]||(a[5]=[h("Void ARV Number",-1)])]),_:1},8,["onClick"])):U("",!0),c(r,{color:"success",onClick:e.onFinish,slot:"end"},{default:m(()=>[...a[6]||(a[6]=[h("Save",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}]]),Xa=i({components:{VisitsSummary:Ba,InformationHeader:ja},setup(){const e=le(),a=parseInt(e.params.patientId.toString())||0,t=o(),l=o(""),n=o([]),i=S(()=>!se(t.value)),u=S(()=>{var e;return null===(e=t.value)||void 0===e?void 0:e.getNationalID()}),r=async()=>{if(a){const e=(await ue.findByID(a)).data;e&&(t.value=new ue(e))}},s=async()=>{n.value=await pa.getGuardianDetails(a)},c=async()=>{let e=!1;if(sa.value){var l;e=!(null===(l=t.value)||void 0===l?void 0:l.getDocID())||oa(u.value)||await ca(a)}else{const a=await ma(u.value);e=!a||a.length>1}e&&await(async()=>{await Me.show("Client has Invalid NPID. Assigning NPID...");const e=await ue.assignNPID(a);var t;e.ok?(await r(),await Me.hide()):(await Me.hide(),Be(null!==(t=e.errorMessage)&&void 0!==t?t:"Failed to assign NPID"))})()};return xe.on(Ue.RELOAD_PATIENT_DATA,async()=>{await r()}),xe.on(Ue.RELOAD_GUARDIAN_DATA,async()=>{await s()}),d(async()=>{var e;await da(),await r(),await c();const a=await(null===(e=t.value)||void 0===e?void 0:e.getARTStartDate());l.value=a?he(a):"N/A",s()}),{patient:t,artStartDate:l,guardians:n,isReady:i,updateDemographics:async e=>{await C.show(Ya,{patientService:t.value,attribute:e})},updateGuardian:async()=>{await C.show(Ja,{patientId:a,guardians:n.value})},updateARVNumber:async()=>{await C.show(Ka,{patient:t.value})}}}});a("default",E(Xa,[["render",function(e,a,t,l,n,i){const o=O("information-header"),u=O("ion-col"),r=O("ion-row"),d=O("visits-summary"),s=O("ion-grid");return e.isReady?(f(),x(s,{key:0,class:"ion-no-margin ion-no-padding"},{default:m(()=>[c(r,null,{default:m(()=>[c(u,{size:"12"},{default:m(()=>[e.patient?(f(),x(o,{key:0,patient:e.patient,guardians:e.guardians,artStartDate:e.artStartDate,onUpdateARVNumber:e.updateARVNumber,onUpdateGuardian:e.updateGuardian,onUpdatePatient:e.updateDemographics},null,8,["patient","guardians","artStartDate","onUpdateARVNumber","onUpdateGuardian","onUpdatePatient"])):U("",!0)]),_:1})]),_:1}),c(r,null,{default:m(()=>[c(u,null,{default:m(()=>[e.patient?(f(),x(d,{key:0,patient:e.patient,startDate:e.artStartDate},null,8,["patient","startDate"])):U("",!0)]),_:1})]),_:1})]),_:1})):U("",!0)}]]))}}})}();
