System.register(["./index-legacy-27718e38.js","./TextInput-legacy-d777b8a7.js","./SelectInput-legacy-fa3f851b.js","./common-legacy-e8d6ba88.js","./user_service-legacy-b6158e5e.js","./form-legacy-cd3f8599.js","./toasts-legacy-9b206dea.js","./PasswordUpdate-legacy-859bac8e.js","./Strs-legacy-b5721578.js","./loader-legacy-41f05d42.js","./his_date-legacy-88679395.js","./validations-legacy-de95e1f0.js"],function(e,a){"use strict";var l,s,r,o,t,n,u,i,m,d,c,p,f,g,v,y,_,j,I,h,U,b,w,F;return{setters:[e=>{l=e.d,s=e.I,r=e.l,o=e.m,t=e.n,n=e.r,u=e.aj,i=e.i,m=e._,d=e.N,c=e.j,p=e.w,f=e.o,g=e.e,v=e.a,y=e.b},e=>{_=e.T},e=>{j=e.S},e=>{I=e.g},e=>{h=e.U},e=>{U=e.s},e=>{b=e.a,w=e.b},e=>{F=e.P},null,null,null,null],execute:function(){const a=l({name:"UserModal",components:{IonButton:s,IonGrid:r,IonRow:o,IonCol:t,TextInput:_,SelectInput:j,PasswordUpdate:F},setup(){const e=n([]),a=n(-1),l=n(1),s=u({givenName:{value:"",label:"First Name",required:!0},familyName:{value:"",label:"Last Name",required:!0},username:{value:"",label:"Username",disabled:!0},roles:{value:[],label:"Roles",required:!0}}),r=async()=>{const e=await h.getCurrentUser();e&&(a.value=e.user_id,s.username.value=e.username,s.givenName.value=I(e,"person.names[0].given_name",""),s.familyName.value=I(e,"person.names[0].family_name",""),s.roles.value=e.roles.map(e=>({value:e.role,label:e.role,other:e})))};return i(async()=>{await h.getAllRoles().then(a=>{const l=Array.isArray(a.data)?a.data:[];e.value=l.map(e=>({value:e.role,label:e.role,other:e}))}),await r(),l.value++}),{userForm:s,roles:e,refreshRoles:l,updateProfile:()=>U(s,async e=>{try{const l=await h.updateUser(a.value,{...e,roles:e.roles.map(e=>e.label)});if(!l||!l.data)throw new Error("Failed to update user profile");{const e=l.data;sessionStorage.setItem("username",e.username),sessionStorage.setItem("userRoles",JSON.stringify(e.roles)),b("User profile has been updated successfully",3e3),r()}}catch(l){w("Failed to update user profile")}})}}}),N={class:"his-card"};e("default",m(a,[["render",function(e,a,l,s,r,o){const t=d("ion-col"),n=d("text-input"),u=d("SelectInput"),i=d("TextInput"),m=d("IonButton"),_=d("ion-row"),j=d("password-update"),I=d("ion-grid");return f(),c(I,null,{default:p(()=>[g(_,null,{default:p(()=>[g(t,{size:"8"},{default:p(()=>[v("div",N,[g(t,{size:"12",class:"ion-margin-vertical"},{default:p(()=>[...a[4]||(a[4]=[v("h2",null,"User Profile",-1)])]),_:1}),g(_,null,{default:p(()=>[g(t,{size:"12",class:"ion-margin-vertical"},{default:p(()=>[g(n,{modelValue:e.userForm.username,"onUpdate:modelValue":a[0]||(a[0]=a=>e.userForm.username=a)},null,8,["modelValue"])]),_:1}),g(t,{size:"12",class:"ion-margin-vertical"},{default:p(()=>[(f(),c(u,{modelValue:e.userForm.roles,"onUpdate:modelValue":a[1]||(a[1]=a=>e.userForm.roles=a),options:e.roles,multiple:"",key:e.refreshRoles},null,8,["modelValue","options"]))]),_:1}),g(t,{size:"12",class:"ion-margin-vertical"},{default:p(()=>[g(i,{modelValue:e.userForm.givenName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.userForm.givenName=a)},null,8,["modelValue"])]),_:1}),g(t,{size:"12",class:"ion-margin-vertical"},{default:p(()=>[g(i,{modelValue:e.userForm.familyName,"onUpdate:modelValue":a[3]||(a[3]=a=>e.userForm.familyName=a)},null,8,["modelValue"])]),_:1}),g(t,{size:"12",class:"ion-margin-vertical"},{default:p(()=>[g(m,{class:"ion-margin-vertical",onClick:e.updateProfile},{default:p(()=>[...a[5]||(a[5]=[y("Save Changes",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1}),g(t,{size:"4"},{default:p(()=>[g(j)]),_:1})]),_:1})]),_:1})}]]))}}});
