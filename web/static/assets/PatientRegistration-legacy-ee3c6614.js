System.register(["./index-legacy-91295254.js","./relations_service-legacy-1cecc8b6.js","./TextInput-legacy-b45439a0.js","./DateInput.vue_vue_type_style_index_0_lang-legacy-5758a68f.js","./SelectInput-legacy-afa7905e.js","./location_options-legacy-8a5e2b47.js","./form-legacy-0888a85c.js","./Strs-legacy-09248991.js","./loader-legacy-c82f4ab6.js","./emc_event-legacy-58754a45.js","./validations-legacy-77533b67.js","./his_date-legacy-87db423b.js","./toasts-legacy-ec8222ac.js","./patient_identifier_service-legacy-5f047932.js","./program_service-legacy-711b4b36.js","./vue-datepicker-legacy-efeca79e.js"],(function(e,a){"use strict";var l,n,t,i,o,r,d,u,m,s,c,g,p,v,b,h,N,_,f,y,V,w,k,I,U,P,A,j,D,z,C,E,x,q,F,L,S,B,G;return{setters:[e=>{l=e.d,n=e.i,t=e.j,i=e.k,o=e.au,r=e.f,d=e.r,u=e.ae,m=e.a6,s=e.ai,c=e.av,g=e.aw,p=e._,v=e.K,b=e.h,h=e.w,N=e.o,_=e.e,f=e.a,y=e.b},e=>{V=e.P,w=e.R},e=>{k=e.T},e=>{I=e._},e=>{U=e.S},e=>{P=e.a,A=e.b},e=>{j=e.i,D=e.r},e=>{z=e.a},e=>{C=e.l},e=>{E=e.E,x=e.a},e=>{q=e.a,F=e.b,L=e.c},e=>{S=e.a},e=>{B=e.t},e=>{G=e.P},null,null],execute:function(){const a=l({components:{IonGrid:n,IonRow:t,IonCol:i,TextInput:k,DateInput:I,SelectInput:U,IonCheckbox:o},setup(){const e=r(),a=d(!1),l=d(!1),n=P(),t=u({givenName:{label:"First Name",value:"",placeholder:"Enter First Name",required:!0,validation:e=>q(e)},familyName:{label:"Last Name",value:"",placeholder:"Enter Last Name",required:!0,validation:e=>q(e)},middleName:{label:"Middle Name",value:"",placeholder:"Enter middle Name",validation:e=>e&&e.label?q(e):null},nationalId:{label:"Malawi National ID Number",value:"",placeholder:"Enter Malawi National ID Number",validation:e=>e&&e.label?F(e):null},gender:{value:"",required:!0,label:"Gender",placeholder:"select gender"},birthdate:{value:"",label:"Date of Birth",required:!0},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",placeholder:"Enter cellphone number e.g. 0991234567",validation:async e=>"Unknown"!==e.value&&L(e)},homeVillage:{value:"",label:"Home Village",placeholder:"Home Village",required:!0},landmark:{value:"",label:"Landmark",placeholder:"Closest Landmark or Plot Number",required:!0}}),i=u({givenName:{label:"First Name",value:"",placeholder:"Enter First Name",required:!0,validation:e=>q(e)},familyName:{label:"Last Name",value:"",placeholder:"Enter Last Name",required:!0,validation:e=>q(e)},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",placeholder:"Enter cellphone number e.g. 0991234567",validation:async e=>"Unknown"!==e.value&&L(e)}});m(l,(e=>{e?(i.givenName.value="Unknown",i.familyName.value="Unknown",i.cellPhoneNumber.value="Unknown",i.givenName.disabled=!0,i.familyName.disabled=!0,i.givenName.error="",i.familyName.error="",i.cellPhoneNumber.error=""):(i.givenName.value="",i.familyName.value="",i.cellPhoneNumber.value="",i.givenName.disabled=!1,i.familyName.disabled=!1)}));const o=(e,a={})=>{const l={facility_name:null,occupation:null};for(const n in e)l[z(n)]=e[n];return{...l,...a}},p=async e=>{var a,l,n,t,i,o,r,d;let u,m;try{var s;null!=e&&null!==(s=e.other)&&void 0!==s&&s.traditional_authority_id&&(u=await g.getTraditionalAuthorityById(e.other.traditional_authority_id)),u&&(m=await g.getDistrictByID(u.district_id))}catch(c){B("Unable to resolve client address. Saving using default address"),console.error(c)}return{home_district:null!==(a=null===(l=m)||void 0===l?void 0:l.name)&&void 0!==a?a:"N/A",home_traditional_authority:null!==(n=null===(t=u)||void 0===t?void 0:t.name)&&void 0!==n?n:"N/A",home_village:(null==e?void 0:e.label)||"N/A",current_district:null!==(i=null===(o=m)||void 0===o?void 0:o.name)&&void 0!==i?i:"N/A",current_traditional_authority:null!==(r=null===(d=u)||void 0===d?void 0:d.name)&&void 0!==r?r:"N/A",current_village:(null==e?void 0:e.label)||"N/A"}};return{today:S,patient:t,guardian:i,landmarks:n,genderOptions:[{label:"Male",value:"M"},{label:"Female",value:"F"}],guardianAbsent:l,isBirthdateEstimated:a,onClear:async()=>{if(await s("Are you sure you want to clear all fields?")){for(const e in t)t[e].value=void 0,t[e].error="";for(const e in i)i[e].value=void 0,i[e].error="";E.emit(x.ON_CLEAR)}},onFinish:async()=>{const n=await j(t),r=!!l.value||await j(i);if(n&&r){await C.show("Saving...");try{const n=D(t).formData,d=new V,u=await p(n.homeVillage),m=o(n,{...u,isPatient:!0,patient_type:null,gender:n.gender.value,landmark:n.landmark.value,birthdate_estimated:a.value?"Yes":"No",relationship:l.value?"No":"Yes"});await d.createPerson(m),await d.createPatient();const s=d.getPersonID();if(n.nationalId&&await G.create(s,c,n.nationalId),!l.value&&r){const{formData:e}=D(i),a=await p(),l=o(e,{...a,middle_name:"",gender:"N/A",birthdate:"N/A",birthdate_estimated:"N/A",landmark:"N/A",relationship:"N/A",patient_type:"",isPatient:!1,patient_id:s});await d.registerGuardian(l);const n=d.getPersonID();await w.createRelation(s,n,13)}C.hide(),e.push(`/patient/reception/${s}/true`)}catch(d){console.log(d),C.hide()}}},getVillagesByName:A}}}),M={class:"ion-margin-start checkbox-label"};e("default",p(a,[["render",function(e,a,l,n,t,i){const o=v("ion-col"),r=v("ion-row"),d=v("ion-title"),u=v("TextInput"),m=v("SelectInput"),s=v("DateInput"),c=v("ion-checkbox"),g=v("ion-button"),p=v("ion-grid"),V=v("Layout");return N(),b(V,null,{default:h((()=>[_(p,null,{default:h((()=>[_(r,null,{default:h((()=>[_(o,{class:"ion-margin-bottom"},{default:h((()=>a[14]||(a[14]=[f("h1",null,"New Patient Registration",-1)]))),_:1})])),_:1}),_(r,{class:"his-card"},{default:h((()=>[_(o,{size:"12"},{default:h((()=>[_(d,{class:"ion-text-center ion-margin-vertical"},{default:h((()=>a[15]||(a[15]=[f("b",null,"Personal Details",-1)]))),_:1}),_(r,{class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(o,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(u,{modelValue:e.patient.givenName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.patient.givenName=a)},null,8,["modelValue"])])),_:1}),_(o,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(u,{modelValue:e.patient.middleName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.patient.middleName=a)},null,8,["modelValue"])])),_:1}),_(o,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(u,{modelValue:e.patient.familyName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.patient.familyName=a)},null,8,["modelValue"])])),_:1}),_(o,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(u,{modelValue:e.patient.nationalId,"onUpdate:modelValue":a[3]||(a[3]=a=>e.patient.nationalId=a)},null,8,["modelValue"])])),_:1}),_(o,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(m,{modelValue:e.patient.gender,"onUpdate:modelValue":a[4]||(a[4]=a=>e.patient.gender=a),options:e.genderOptions},null,8,["modelValue","options"])])),_:1}),_(o,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(u,{modelValue:e.patient.cellPhoneNumber,"onUpdate:modelValue":a[5]||(a[5]=a=>e.patient.cellPhoneNumber=a),allowUnknown:""},null,8,["modelValue"])])),_:1}),_(o,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(s,{modelValue:e.patient.birthdate,"onUpdate:modelValue":a[6]||(a[6]=a=>e.patient.birthdate=a),allowEstimation:!0,estimationLabel:"Estimate Age",minDate:"1920-01-01",maxDate:e.today(),onIsEstimated:a[7]||(a[7]=a=>e.isBirthdateEstimated=a)},null,8,["modelValue","maxDate"])])),_:1}),_(o,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(m,{modelValue:e.patient.homeVillage,"onUpdate:modelValue":a[8]||(a[8]=a=>e.patient.homeVillage=a),asyncOptions:e.getVillagesByName,allowCustom:""},null,8,["modelValue","asyncOptions"])])),_:1}),_(o,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(m,{modelValue:e.patient.landmark,"onUpdate:modelValue":a[9]||(a[9]=a=>e.patient.landmark=a),options:e.landmarks,allowCustom:""},null,8,["modelValue","options"])])),_:1})])),_:1}),_(d,{class:"ion-text-center ion-margin-vertical ion-padding-top"},{default:h((()=>[a[17]||(a[17]=f("b",null,"Guardian details",-1)),f("span",M,[a[16]||(a[16]=y(" Guardian Details Unknown? ")),_(c,{modelValue:e.guardianAbsent,"onUpdate:modelValue":a[10]||(a[10]=a=>e.guardianAbsent=a)},null,8,["modelValue"])])])),_:1}),_(r,{class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(o,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(u,{modelValue:e.guardian.givenName,"onUpdate:modelValue":a[11]||(a[11]=a=>e.guardian.givenName=a)},null,8,["modelValue"])])),_:1}),_(o,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(u,{modelValue:e.guardian.familyName,"onUpdate:modelValue":a[12]||(a[12]=a=>e.guardian.familyName=a)},null,8,["modelValue"])])),_:1}),_(o,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:h((()=>[_(u,{modelValue:e.guardian.cellPhoneNumber,"onUpdate:modelValue":a[13]||(a[13]=a=>e.guardian.cellPhoneNumber=a),allowUnknown:""},null,8,["modelValue"])])),_:1})])),_:1}),_(g,{class:"ion-margin-top ion-float-right",onClick:e.onFinish,size:"large",color:"success"},{default:h((()=>a[18]||(a[18]=[y("Finish")]))),_:1},8,["onClick"]),_(g,{class:"ion-margin-top ion-float-right",onClick:e.onClear,size:"large",color:"warning"},{default:h((()=>a[19]||(a[19]=[y("Clear")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})}]]))}}}));
