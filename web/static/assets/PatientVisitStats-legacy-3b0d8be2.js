System.register(["./vue-datepicker-legacy-7054a18b.js","./LineChart.vue_vue_type_script_setup_true_lang-legacy-9f2c6135.js","./index-legacy-1454b575.js","./common-legacy-0d7df615.js","./report_service-legacy-cf722847.js","./loader-legacy-b2508937.js","./DrilldownTable-legacy-38e367de.js","./his_date-legacy-62c8c4fa.js","./toasts-legacy-53045607.js","./arrays-legacy-4be31994.js","./url-legacy-2d97b2db.js","./index-legacy-5399571c.js"],(function(t,e){"use strict";var a,n,i,l,s,r,o,d,u,p,c,g,h,m,_,f,v,y,w,V,D,b,j,C,x,I;return{setters:[t=>{a=t.K},t=>{n=t._},t=>{i=t.H,l=t.ap,s=t.d,r=t.l,o=t.m,d=t.n,u=t.r,p=t.h,c=t.ak,g=t._,h=t.L,m=t.j,_=t.w,f=t.o,v=t.e,y=t.a,w=t.b,V=t.t},t=>{D=t.i},t=>{b=t.R},t=>{j=t.l},t=>{C=t.D},t=>{x=t.i},t=>{I=t.t},null,null,null],execute:function(){class e extends b{constructor(){super()}static getLocationName(){return sessionStorage.getItem("locationName")}getBookedAppointments(t){return i.getJson(`programs/${l}/scheduled_appointments`,{date:t})}getViralLoadResults(t){return this.getReport(`/programs/${l}/reports/high_vl_patients`,{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport(`/programs/${l}/reports/retention`)}getExternalConsultationClients(){return this.getReport(`${l}/external_consultation_clients`)}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport(`/programs/${l}/reports/pregnant_patients`)}getArchivingCandidates(){return i.getJson(`programs/${l}/reports/archiving_candidates`,{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}getVisitStats(){return i.getJson(`programs/${l}/reports/visits`,{name:"visits",start_date:this.startDate,end_date:this.endDate})}}const P=s({components:{LineChart:n,IonGrid:r,IonRow:o,IonCol:d,VueDatePicker:a},setup(){const t=u(""),a=u(""),n=u([]),i=p((()=>{var t;return(null===(t=n.value[0])||void 0===t?void 0:t.raw.flat())||[]})),l=p((()=>{var t;return(null===(t=n.value[1])||void 0===t?void 0:t.raw.flat())||[]})),s=p((()=>{var t;return(null===(t=n.value[2])||void 0===t?void 0:t.raw.flat())||[]})),r=p((()=>n.value.map((({raw:t})=>t)).flat(3))),o=async(t,e="Drill down clients")=>{await c.show(C,{patientIds:t.map((({patientId:t})=>t)),title:e})};return{startDate:t,endDate:a,series:n,options:{title:{text:"Patient Visits Statistics",align:"left"},yaxis:{title:{text:"Number of clients"}}},totalAttendance:r,totalPatientVisits:i,totalGuardianVisits:l,totalBothVisits:s,fetchData:async()=>{if(!x(t.value,a.value))return I("Invalid date range");try{j.show();const i=new e;i.setStartDate(t.value),i.setEndDate(a.value);const l=await i.getPatientVisitTypes();n.value=(t=>{const e={},a={},n={},i=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(t).forEach((([t,l])=>{e[t]=[],a[t]=[],n[t]=[],Object.entries(l).forEach((([i,{patient_present:l,guardian_present:s}])=>{s&&l?n[t].push({patientId:i,date:t}):l?e[t].push({patientId:i,date:t}):s&&a[t].push({patientId:i,date:t})}));const s=new Date(t).getTime();i[0].data.push([s,e[t].length]),i[0].raw.push(e[t]),i[1].data.push([s,a[t].length]),i[1].raw.push(a[t]),i[2].data.push([s,n[t].length]),i[2].raw.push(n[t])})),i})(l)}catch(i){console.error(i),I("Unable to generate patient visits data")}j.hide()},pointSelection:async(t,e)=>{if(!D(n.value))try{await o(n.value[e].raw[t],`${n.value[e].name} visits`)}catch(a){console.error(a)}},drilldown:o}}}),k={style:{display:"flex","justify-content":"flex-start"}},R={class:"his-card"};t("default",g(P,[["render",function(t,e,a,n,i,l){const s=h("vue-date-picker"),r=h("ion-button"),o=h("ion-col"),d=h("ion-label"),u=h("ion-badge"),p=h("ion-item"),c=h("ion-list"),g=h("line-chart"),D=h("ion-row"),b=h("ion-grid");return f(),m(b,null,{default:_((()=>[v(D,null,{default:_((()=>[v(o,{size:"6",offset:"6",class:"ion-padding"},{default:_((()=>[y("div",k,[v(s,{modelValue:t.startDate,"onUpdate:modelValue":e[0]||(e[0]=e=>t.startDate=e),placeholder:"Start Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),v(s,{modelValue:t.endDate,"onUpdate:modelValue":e[1]||(e[1]=e=>t.endDate=e),placeholder:"End Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),v(r,{color:"primary",class:"ion-no-margin",onClick:t.fetchData},{default:_((()=>e[6]||(e[6]=[w("Generate")]))),_:1},8,["onClick"])])])),_:1}),v(o,{size:"3",class:"ion-padding-top"},{default:_((()=>[y("div",R,[v(c,null,{default:_((()=>[v(p,{button:"",onClick:e[2]||(e[2]=e=>t.drilldown(t.totalAttendance,"Total Attendance"))},{default:_((()=>[v(d,null,{default:_((()=>e[7]||(e[7]=[w("Total Attendance ")]))),_:1}),v(u,null,{default:_((()=>[w(V(t.totalAttendance.length),1)])),_:1})])),_:1}),v(p,{button:"",onClick:e[3]||(e[3]=e=>t.drilldown(t.totalPatientVisits,"Total patient visits"))},{default:_((()=>[v(d,null,{default:_((()=>e[8]||(e[8]=[w("Patient Visit ")]))),_:1}),v(u,null,{default:_((()=>[w(V(t.totalPatientVisits.length),1)])),_:1})])),_:1}),v(p,{button:"",onClick:e[4]||(e[4]=e=>t.drilldown(t.totalGuardianVisits,"Total guardian visits"))},{default:_((()=>[v(d,null,{default:_((()=>e[9]||(e[9]=[w("Guardian Visit ")]))),_:1}),v(u,null,{default:_((()=>[w(V(t.totalGuardianVisits.length),1)])),_:1})])),_:1}),v(p,{button:"",onClick:e[5]||(e[5]=e=>t.drilldown(t.totalBothVisits,"Total patient and guardian visits"))},{default:_((()=>[v(d,null,{default:_((()=>e[10]||(e[10]=[w("Patient and Guardian Visit ")]))),_:1}),v(u,null,{default:_((()=>[w(V(t.totalBothVisits.length),1)])),_:1})])),_:1})])),_:1})])])),_:1}),v(o,{size:"9"},{default:_((()=>[v(g,{style:{height:"600px"},series:t.series,options:t.options,onPointSelection:t.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])])),_:1})])),_:1})])),_:1})}]]))}}}));
