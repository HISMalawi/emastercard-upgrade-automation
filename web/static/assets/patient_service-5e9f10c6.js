var p=Object.defineProperty;var g=(i,e,t)=>e in i?p(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>(g(i,typeof e!="symbol"?e+"":e,t),t);import{G as s}from"./index-9d5e84a5.js";import{P as a}from"./patient_identifier_service-38d617de.js";import{d as l,a as m}from"./his_date-68cf9d33.js";import{P as u}from"./index-95d3a767.js";const h=(i,e)=>{const t=i.filter(r=>r.person_attribute_type_id==e);return t.length>0?t[0].value:""};class o{constructor(e){d(this,"patient");this.patient=e}static async findByID(e){return s.getJson("/patients/".concat(e))}createArvNumber(e){return a.create(this.getID(),4,e)}getID(){return this.patient.patient_id}getAge(){return l(m()).diff(this.patient.person.birthdate,"years")}isFemale(){return["Female","F"].includes(this.getGender())}isMale(){return["Male","M"].includes(this.getGender())}getGender(){return this.patient.person.gender}static async search(e){return s.getJson("/search/patients",e)}static findByOtherID(e,t){return s.getJson("search/patients/by_identifier",{type_id:e,identifier:t})}getFullName(){try{const e=this.patient.person.names[0],t=e.given_name,r=e.family_name,n=e.middle_name;return this.normaliseName("".concat(t," ").concat(n," ").concat(r))}catch(e){return console.error(e),"Unknown"}}getDocID(){const e=this.findIdentifierByType("DDE person document ID");return e.match(/unknown/i)?null:e}getNationalID(){return this.findIdentifierByType("National id")}getMWNationalID(){return this.findIdentifierByType("Malawi National ID")}getArvNumber(){return this.findIdentifierByType("ARV Number")}getBirthdate(){return this.patient.person.birthdate}findIdentifierByType(e){return this.patient.patient_identifiers.filter(t=>t.type.name===e).sort((t,r)=>t.date_created<r.date_created?1:0).reduce((t,r)=>t==="Unknown"?r.identifier:t,"Unknown")}getHomeVillage(){return this.getAddresses().ancestryVillage}getHomeDistrict(){return this.getAddresses().ancestryDistrict}getAddresses(){const e={ancestryDistrict:"",ancestryTA:"",ancestryVillage:"",currentDistrict:"",currentTA:"",currentVillage:""};if(this.patient.person.addresses.length>0){const t=this.patient.person.addresses[0];e.ancestryDistrict=t.address2,e.ancestryTA=t.county_district,e.ancestryVillage=t.neighborhood_cell,e.currentDistrict=t.state_province,e.currentTA=t.township_division,e.currentVillage=t.city_village}return e}getCurrentDistrict(){return this.getAddresses().currentDistrict}getCurrentVillage(){return this.getAddresses().currentVillage}static mergePatients(e){return e.program_id=u,s.postJson("dde/patients/merge",e)}normaliseName(e){return e.replace(/n\/a|unknown|null|undefined/gi,"").trim()}getGivenName(){return this.patient.person.names[0].given_name}getFamilyName(){return this.patient.person.names[0].family_name}getClosestLandmark(){return this.getAttribute(19)}getPhoneNumber(){return this.getAttribute(12)}getAttribute(e){return h(this.patient.person.person_attributes,e)}getMiddleName(){return this.patient.person.names[0].middle_name}updateARVNumber(e){var r;const t=((r=this.getIdentifiers().find(n=>n.type.name==="ARV Number"))==null?void 0:r.patient_identifier_id)||"";return o.reassignARVNumber(t,{identifier:e})}updateMWNationalId(e){var r;const t=(r=this.getIdentifiers().find(n=>n.type.name==="Malawi National ID"))==null?void 0:r.patient_identifier_id;return t?a.update(t,e):a.create(this.getID(),28,e)}getIdentifiers(){return this.patient.patient_identifiers}static reassignARVNumber(e,t){return s.putJson("patient_identifiers/"+e,t)}static async getPatientVisits(e,t){const r=(await s.getJson("patients/".concat(e,"/visits"),{program_id:u,include_defaulter_dates:t==!0})).data;return r?r.sort((n,c)=>new Date(n)<new Date(c)?1:0):[]}}export{o as P,h as g};
