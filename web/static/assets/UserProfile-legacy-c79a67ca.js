System.register(["./index-legacy-2d6958b4.js","./TextInput-legacy-77d3c90b.js","./SelectInput-legacy-23442b79.js","./common-legacy-0d7df615.js","./user_service-legacy-875cc696.js","./form-legacy-e9cfa28a.js","./toasts-legacy-ce48abc6.js","./PasswordUpdate-legacy-f023d823.js","./Strs-legacy-09248991.js","./loader-legacy-61800ad3.js","./his_date-legacy-70b43096.js"],(function(e,a){"use strict";var l,s,r,o,t,u,n,i,m,d,c,p,f,g,v,y,_,I,h,U,j,w,F,V;return{setters:[e=>{l=e.d,s=e.I,r=e.k,o=e.l,t=e.m,u=e.r,n=e.ah,i=e.i,m=e._,d=e.L,c=e.j,p=e.w,f=e.o,g=e.e,v=e.a,y=e.b},e=>{_=e.T},e=>{I=e.S},e=>{h=e.g},e=>{U=e.U},e=>{j=e.s},e=>{w=e.a,F=e.b},e=>{V=e.P},null,null,null],execute:function(){const a=l({name:"UserModal",components:{IonButton:s,IonGrid:r,IonRow:o,IonCol:t,TextInput:_,SelectInput:I,PasswordUpdate:V},setup(){const e=u([]),a=u(-1),l=u(1),s=n({givenName:{value:"",label:"First Name",required:!0},familyName:{value:"",label:"Last Name",required:!0},username:{value:"",label:"Username",disabled:!0},roles:{value:[],label:"Roles",required:!0}}),r=async()=>{const e=await U.getCurrentUser();e&&(a.value=e.user_id,s.username.value=e.username,s.givenName.value=h(e,"person.names[0].given_name",""),s.familyName.value=h(e,"person.names[0].family_name",""),s.roles.value=e.roles.map((e=>({value:e.role,label:e.role,other:e}))))};return i((async()=>{await U.getAllRoles().then((a=>{const l=Array.isArray(a.data)?a.data:[];e.value=l.map((e=>({value:e.role,label:e.role,other:e})))})),await r(),l.value++})),{userForm:s,roles:e,refreshRoles:l,updateProfile:()=>j(s,(async e=>{try{const l=await U.updateUser(a.value,{...e,roles:e.roles.map((e=>e.label))});if(!l||!l.data)throw new Error("Failed to update user profile");{const e=l.data;sessionStorage.setItem("username",e.username),sessionStorage.setItem("userRoles",JSON.stringify(e.roles)),w("User profile has been updated successfully",3e3),r()}}catch(l){F("Failed to update user profile")}}))}}}),b={class:"his-card"};e("default",m(a,[["render",function(e,a,l,s,r,o){const t=d("ion-col"),u=d("text-input"),n=d("SelectInput"),i=d("TextInput"),m=d("IonButton"),_=d("ion-row"),I=d("password-update"),h=d("ion-grid");return f(),c(h,null,{default:p((()=>[g(_,null,{default:p((()=>[g(t,{size:"8"},{default:p((()=>[v("div",b,[g(t,{size:"12",class:"ion-margin-vertical"},{default:p((()=>a[4]||(a[4]=[v("h2",null,"User Profile",-1)]))),_:1}),g(_,null,{default:p((()=>[g(t,{size:"12",class:"ion-margin-vertical"},{default:p((()=>[g(u,{modelValue:e.userForm.username,"onUpdate:modelValue":a[0]||(a[0]=a=>e.userForm.username=a)},null,8,["modelValue"])])),_:1}),g(t,{size:"12",class:"ion-margin-vertical"},{default:p((()=>[(f(),c(n,{modelValue:e.userForm.roles,"onUpdate:modelValue":a[1]||(a[1]=a=>e.userForm.roles=a),options:e.roles,multiple:"",key:e.refreshRoles},null,8,["modelValue","options"]))])),_:1}),g(t,{size:"12",class:"ion-margin-vertical"},{default:p((()=>[g(i,{modelValue:e.userForm.givenName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.userForm.givenName=a)},null,8,["modelValue"])])),_:1}),g(t,{size:"12",class:"ion-margin-vertical"},{default:p((()=>[g(i,{modelValue:e.userForm.familyName,"onUpdate:modelValue":a[3]||(a[3]=a=>e.userForm.familyName=a)},null,8,["modelValue"])])),_:1}),g(t,{size:"12",class:"ion-margin-vertical"},{default:p((()=>[g(m,{class:"ion-margin-vertical",onClick:e.updateProfile},{default:p((()=>a[5]||(a[5]=[y("Save Changes")]))),_:1},8,["onClick"])])),_:1})])),_:1})])])),_:1}),g(t,{size:"4"},{default:p((()=>[g(I)])),_:1})])),_:1})])),_:1})}]]))}}}));
